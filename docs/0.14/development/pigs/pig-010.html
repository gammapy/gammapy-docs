

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PIG 10 - Regions &mdash; gammapy v0.14</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.gammapy.org/dev/development/pigs/pig-010.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
        <script type="text/javascript" src="../../_static/gammapy.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gammapy.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PIG 12 - High-level interface" href="pig-012.html" />
    <link rel="prev" title="PIG 9 - Event Sampling" href="pig-009.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> gammapy
          

          
          </a>

          
            
            
              <div class="version">
                0.14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install/dependencies.html">Gammapy Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install/dependencies.html#required-dependencies">Required dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/dependencies.html#optional-dependencies">Optional dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/dependencies.html#versions">Versions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install/conda.html">Gammapy conda installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install/conda.html#background-information">Background information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install/conda.html#stable-version">Stable version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install/check.html">Check Gammapy installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install/check.html#how-to-run-checks">How to run checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/check.html#common-issues">Common issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/check.html#known-issues">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install/pip.html">Installation with pip or setup.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install/pip.html#install-pip">pip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/pip.html#setup-py">setup.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/pip.html#development-version">Development version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install/other.html">Other package managers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install/other.html#id1">apt-get</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/other.html#id2">yum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/other.html#id3">Homebrew</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install/other.html#id4">Fermi ScienceTools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#help">Help!?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#check">Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#download-tutorials">Download tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#check-your-setup">Check your setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#use-gammapy">Use Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#id2">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#id3">IPython</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#python-script">Python script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#command-line">Command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#jupyter-notebooks">Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#install-issues">Install issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorial notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#notebooks">Notebooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/first_steps.html">Getting started with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Maps">Maps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Event-lists">Event lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Source-catalogs">Source catalogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#Spectral-models-and-flux-points">Spectral models and flux points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/first_steps.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/intro_maps.html">Gammapy Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#0.-Setup">0. Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#1.-Creating-WCS-Maps">1. Creating WCS Maps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#2.-Accessing-and-Modifying-Data">2. Accessing and Modifying Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#3.-Reading-and-Writing">3. Reading and Writing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#4.-Visualizing-and-Plotting">4. Visualizing and Plotting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/intro_maps.html#5.-Reprojecting,-Interpolating-and-Miscellaneous">5. Reprojecting, Interpolating and Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html">CTA first data challenge (1DC) with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Notebook-and-Gammapy-Setup">Notebook and Gammapy Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#DC-1-data">DC-1 data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#EVENT-data">EVENT data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#EVENT-analysis-example">EVENT analysis example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#IRFs">IRFs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Index-files-and-DataStore">Index files and DataStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Select-observations">Select observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Load-data">Load data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Model-XML-files">Model XML files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_1dc_introduction.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/cta_data_analysis.html">CTA data analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Select-observations">Select observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Make-sky-images">Make sky images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Source-Detection">Source Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Spatial-analysis">Spatial analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Spectrum">Spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_data_analysis.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/analysis_3d.html">3D analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Prepare-modeling-input-data">Prepare modeling input data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Likelihood-fit">Likelihood fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Computing-Flux-Points">Computing Flux Points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/analysis_3d_joint.html">Joint 3D Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d_joint.html#Prepare-modeling-input-data">Prepare modeling input data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d_joint.html#Likelihood-fit">Likelihood fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/analysis_3d_joint.html#Plotting-residuals">Plotting residuals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/simulate_3d.html">3D simulation and fitting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/simulate_3d.html#Imports-and-versions">Imports and versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/simulate_3d.html#Simulate">Simulate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/simulate_3d.html#Fit">Fit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/hess.html">Analysis of H.E.S.S. DL3 data with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Analysis-configuration">Analysis configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Observation-selection">Observation selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Data-reduction">Data reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Model-fitting">Model fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hess.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/detect_ts.html">Source detection with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Read-in-input-images">Read in input images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Plot-images">Plot images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Source-catalog">Source catalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Measurements">Measurements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Compare-to-3FHL">Compare to 3FHL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/detect_ts.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html">Fitting 2D images with Sherpa</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Necessary-imports">Necessary imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Making-a-PSF-Map">Making a PSF Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Make-2D-images-from-3D-ones">Make 2D images from 3D ones</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Read-the-maps-and-store-them-in-a-sherpa-model">Read the maps and store them in a sherpa model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Find-and-fit-the-brightest-source">Find and fit the brightest source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Iteratively-find-and-fit-additional-sources">Iteratively find and fit additional sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Generating-output-table-and-Test-Statistics-estimation">Generating output table and Test Statistics estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_fitting_with_sherpa.html#More-about-sherpa">More about sherpa</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/spectrum_analysis.html">Spectral analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Load-Data">Load Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Define-Target-Region">Define Target Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Create-exclusion-mask">Create exclusion mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Estimate-background">Estimate background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Source-statistic">Source statistic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Extract-spectrum">Extract spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Fit-spectrum">Fit spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Compute-Flux-Points">Compute Flux Points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Stack-observations">Stack observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_analysis.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html">Fitting gammapy spectra with sherpa</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Load-data-stack">Load data stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Define-source-model">Define source model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Fit-and-error-estimation">Fit and error estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Results-plot">Results plot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Errors-and-confidence-contours">Errors and confidence contours</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_fitting_with_sherpa.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html">Flux point fitting in Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Load-spectral-points">Load spectral points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Power-Law-Fit">Power Law Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Exponential-Cut-Off-Powerlaw-Fit">Exponential Cut-Off Powerlaw Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Log-Parabola-Fit">Log-Parabola Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/sed_fitting_gammacat_fermi.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/fermi_lat.html">Fermi-LAT data with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Events">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Counts">Counts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Exposure">Exposure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Galactic-diffuse-background">Galactic diffuse background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Isotropic-diffuse-background">Isotropic diffuse background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#PSF">PSF</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Excess-and-flux">Excess and flux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Fit">Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/fermi_lat.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/light_curve.html">Light curve estimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Select-the-data">Select the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Define-time-intervals">Define time intervals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#3D-data-reduction">3D data reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Light-Curve-estimation:-the-3D-case">Light Curve estimation: the 3D case</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Performing-the-same-analysis-with-1D-spectra">Performing the same analysis with 1D spectra</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/light_curve.html#Light-Curve-estimation-for-1D-spectra">Light Curve estimation for 1D spectra</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/cta_sensitivity.html">Estimation of the CTA point source sensitivity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Define-analysis-region-and-energy-binning">Define analysis region and energy binning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Load-IRFs">Load IRFs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Determine-energy-dependent-integration-radius">Determine energy dependent integration radius</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Estimate-background">Estimate background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Compute-sensitivity">Compute sensitivity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Results">Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cta_sensitivity.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/spectrum_simulation.html">Spectrum simulation for CTA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#Simulation-of-a-single-spectrum">Simulation of a single spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#Include-Background">Include Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#Adding-a-user-defined-model">Adding a user defined model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/spectrum_simulation.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/image_analysis.html">Fitting 2D images with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Prepare-modeling-input-data">Prepare modeling input data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Define-a-mask">Define a mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Modeling-the-source">Modeling the source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Modeling-the-background">Modeling the background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Classical-Ring-Background-Analysis">Classical Ring Background Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/image_analysis.html#Exercises">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#extra-topics">Extra topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/hgps.html">HGPS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Notebook-Overview">Notebook Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Packages">Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Download-Data">Download Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Catalog-with-Astropy">Catalog with Astropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Maps-with-Astropy">Maps with Astropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Catalog-with-Gammapy">Catalog with Gammapy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Maps-with-Gammapy">Maps with Gammapy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Conclusions">Conclusions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/hgps.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/source_population_model.html">Astrophysical source population modeling with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Simulate-positions">Simulate positions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Simulate-luminosities">Simulate luminosities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Compute-observable-parameters">Compute observable parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Check-output">Check output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/source_population_model.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/cwt.html">CWT Algorithm</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cwt.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cwt.html#CWT-Algorithm">CWT Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/cwt.html#Results-of-analysis">Results of analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/astro_dark_matter.html">Dark matter utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#Profiles">Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#J-Factors">J Factors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#Gamma-ray-spectra-at-production">Gamma-ray spectra at production</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/astro_dark_matter.html#Flux-maps">Flux maps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/background_model.html">Make template background model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Select-off-data">Select off data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Background-model">Background model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Zenith-dependence">Zenith dependence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Index-tables">Index tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/background_model.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/mcmc_sampling.html">Fitting and error estimation with MCMC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Simulate-an-observation">Simulate an observation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Estimate-parameter-correlations-with-MCMC">Estimate parameter correlations with MCMC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Plot-the-results">Plot the results</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Plot-the-model-dispersion">Plot the model dispersion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#Fun-Zone">Fun Zone</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/mcmc_sampling.html#PeVatrons-in-CTA-?">PeVatrons in CTA ?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../notebooks/pulsar_analysis.html">Pulsar analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/pulsar_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/pulsar_analysis.html#Opening-the-data">Opening the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/pulsar_analysis.html#Phasogram">Phasogram</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/pulsar_analysis.html#Phase-resolved-map">Phase-resolved map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../notebooks/pulsar_analysis.html#Phase-resolved-spectrum">Phase-resolved spectrum</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#basics">Basics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../references.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../references.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../references.html#other-gamma-ray-packages">Other gamma-ray packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../references.html#other-useful-packages">Other useful packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#sep-30-2019">0.14 (Sep 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#pull-requests">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#july-26-2019">0.13 (July 26, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id2">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id3">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#may-30-2019">0.12 (May 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id4">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id5">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#mar-29-2019">0.11 (Mar 29, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id6">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id7">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#jan-28-2019">0.10 (Jan 28, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id8">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id9">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#nov-29-2018">0.9 (Nov 29, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id10">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id11">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#sep-23-2018">0.8 (Sep 23, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id12">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id13">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#feb-28-2018">0.7 (Feb 28, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id14">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id15">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#apr-28-2017">0.6 (Apr 28, 2017)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id16">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id17">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#nov-22-2016">0.5 (Nov 22, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id18">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id19">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#apr-20-2016">0.4 (Apr 20, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id20">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id21">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#aug-13-2015">0.3 (Aug 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id22">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id23">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#apr-13-2015">0.2 (Apr 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id24">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id25">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#aug-25-2014">0.1 (Aug 25, 2014)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id26">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id27">Pull requests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Gammapy Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">data - Data and observations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/index.html#using-gammapy-data">Using <code class="docutils literal notranslate"><span class="pre">gammapy.data</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../data/index.html#module-gammapy.data">gammapy.data Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../data/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../irf/index.html">irf - Instrument response functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#effective-area">Effective area</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#psf">PSF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#energy-dispersion">Energy Dispersion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#using-gammapy-irf">Using <code class="docutils literal notranslate"><span class="pre">gammapy.irf</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../irf/theory.html">IRF Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../irf/aeff.html">Effective area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../irf/edisp.html">Energy dispersion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../irf/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../irf/index.html#module-gammapy.irf">gammapy.irf Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../irf/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../irf/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../maps/index.html">maps - Sky maps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../maps/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../maps/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#constructing-with-factory-methods">Constructing with Factory Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#indexing-and-slicing">Indexing and Slicing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#accessor-methods">Accessor Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#interface-with-mapcoord-and-skycoord">Interface with <code class="docutils literal notranslate"><span class="pre">MapCoord</span></code> and <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#mapcoord">MapCoord</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#interpolation">Interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#projection">Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#iterating-by-image">Iterating by image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#fits-i-o">FITS I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../maps/index.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#creating-a-counts-cube-from-an-ft1-file">Creating a Counts Cube from an FT1 File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#generating-a-cutout-of-a-model-cube">Generating a Cutout of a Model Cube</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../maps/index.html#using-gammapy-maps">Using <code class="docutils literal notranslate"><span class="pre">gammapy.maps</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../maps/hpxmap.html">HEALPix-based Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../maps/hpxmap.html#healpix-geometry">HEALPix Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../maps/hpxmap.html#sparse-maps">Sparse Maps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/wcsmap.html">WCS-based Maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../maps/plotting.html">Image plotting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../maps/plotting.html#colormaps">Colormaps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../maps/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../maps/index.html#module-gammapy.maps">gammapy.maps Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../maps/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../maps/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling/index.html">modeling - Models and fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../modeling/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modeling/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#spectral-models">Spectral Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#spatial-models">Spatial Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#skymodel-and-skydiffusecube">SkyModel and SkyDiffuseCube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#fitting">Fitting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../modeling/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#module-gammapy.modeling">gammapy.modeling Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../modeling/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../modeling/index.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../modeling/index.html#module-gammapy.modeling.models">gammapy.modeling.models Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../modeling/index.html#id1">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../modeling/index.html#id2">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../modeling/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cube/index.html">cube - Map cube analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cube/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cube/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cube/index.html#using-gammapy-cube">Using <code class="docutils literal notranslate"><span class="pre">gammapy.cube</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cube/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../cube/index.html#module-gammapy.cube">gammapy.cube Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../cube/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cube/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../detect/index.html">detect - Source detection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../detect/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../detect/index.html#computation-of-ts-images">Computation of TS images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../detect/index.html#computation-of-li-ma-significance-images">Computation of Li &amp; Ma significance images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../detect/index.html#using-gammapy-detect">Using <code class="docutils literal notranslate"><span class="pre">gammapy.detect</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../detect/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../detect/index.html#module-gammapy.detect">gammapy.detect Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../detect/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../detect/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../spectrum/index.html">spectrum - 1D spectrum analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum/index.html#using-gammapy-spectrum">Using <code class="docutils literal notranslate"><span class="pre">gammapy.spectrum</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../spectrum/fitting.html">Spectral Fitting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/fitting.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/fitting.html#interactive-sherpa-fit">Interactive Sherpa Fit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../spectrum/reflected.html">Reflected regions background</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/reflected.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/reflected.html#using-regions">Using regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/reflected.html#the-reflected-region-finder">The reflected region finder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/reflected.html#using-the-reflected-background-estimator">Using the reflected background estimator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../spectrum/index.html#module-gammapy.spectrum">gammapy.spectrum Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../spectrum/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../time/index.html">time - Time analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../time/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../time/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../time/index.html#lightcurve">Lightcurve</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time/index.html#variability-test">Variability test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../time/index.html#other-codes">Other codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../time/index.html#using-gammapy-time">Using <code class="docutils literal notranslate"><span class="pre">gammapy.time</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../time/period.html">Period detection and plotting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../time/period.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../time/period.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../time/period.html#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../time/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../time/index.html#module-gammapy.time">gammapy.time Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../time/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../time/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stats/index.html">stats - Statistics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stats/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stats/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stats/index.html#li-ma-significance">Li &amp; Ma Significance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stats/index.html#confidence-intervals">Confidence Intervals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stats/index.html#using-gammapy-stats">Using <code class="docutils literal notranslate"><span class="pre">gammapy.stats</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stats/feldman_cousins.html">Feldman and Cousins Confidence Intervals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../stats/feldman_cousins.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/feldman_cousins.html#acceptance-interval-fixing">Acceptance Interval Fixing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/feldman_cousins.html#sensitivity">Sensitivity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/feldman_cousins.html#general-case">General Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/feldman_cousins.html#verification">Verification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../stats/fit_statistics.html">Fit statistics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../stats/fit_statistics.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/fit_statistics.html#gaussian-data">Gaussian data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/fit_statistics.html#poisson-data">Poisson data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/fit_statistics.html#poisson-data-with-background-measurement">Poisson data with background measurement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/fit_statistics.html#further-references">Further references</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stats/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stats/index.html#module-gammapy.stats">gammapy.stats Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../stats/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../stats/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/index.html">utils - Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utils/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utils/index.html#time-handling-in-gammapy">Time handling in Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#time-format-and-scale">Time format and scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#mission-elapsed-times-met">Mission elapsed times (MET)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#time-differences">Time differences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../utils/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.units">gammapy.utils.units Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.coordinates">gammapy.utils.coordinates Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id3">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#variables">Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.integrate">gammapy.utils.integrate Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id4">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.interpolation">gammapy.utils.interpolation Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id5">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.table">gammapy.utils.table Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id6">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.fits">gammapy.utils.fits Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#gammapy-fits-utilities">Gammapy FITS utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id7">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id8">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.random">gammapy.utils.random Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id9">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id10">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.regions">gammapy.utils.regions Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id11">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.scripts">gammapy.utils.scripts Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id12">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.testing">gammapy.utils.testing Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id13">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id14">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.nddata">gammapy.utils.nddata Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id15">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id16">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../utils/index.html#module-gammapy.utils.time">gammapy.utils.time Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html#id17">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/index.html">scripts - High-level interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html#configuration-and-methods">Configuration and methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#general-settings">General settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#observations-selection">Observations selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#data-reduction-and-datasets">Data reduction and datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#model">Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#fitting">Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#flux-points">Flux points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#residuals">Residuals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#using-the-high-level-interface">Using the high-level interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html#command-line-tools">Command line tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/cli.html">scripts - Command line tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#reference">Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#limitations">Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#plan">Plan</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#write-your-own-cli">Write your own CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/cli.html#reference-api">Reference/API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scripts/index.html#module-gammapy.scripts">gammapy.scripts Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../scripts/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../catalog/index.html">catalog - Source catalogs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../catalog/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../catalog/index.html#available-catalogs">Available catalogs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../catalog/index.html#how-it-works">How it works</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../catalog/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../catalog/index.html#using-gammapy-catalog">Using <code class="docutils literal notranslate"><span class="pre">gammapy.catalog</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../catalog/gammacat.html">gamma-cat</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../catalog/gammacat.html#catalog">Catalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../catalog/gammacat.html#data-collection">Data collection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../catalog/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../catalog/index.html#module-gammapy.catalog">gammapy.catalog Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../catalog/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../catalog/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../astro/index.html">astro - Astrophysics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../astro/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astro/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astro/index.html#sub-packages">Sub-packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../astro/source/index.html">Astrophysical source models (<code class="docutils literal notranslate"><span class="pre">gammapy.astro.source</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../astro/source/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/source/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/source/index.html#using-gammapy-astro-source">Using <code class="docutils literal notranslate"><span class="pre">gammapy.astro.source</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/source/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../astro/population/index.html">Astrophysical source population models (<code class="docutils literal notranslate"><span class="pre">gammapy.astro.population</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../astro/population/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/population/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/population/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../astro/darkmatter/index.html">Dark matter (<code class="docutils literal notranslate"><span class="pre">gammapy.astro.darkmatter</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../astro/darkmatter/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/darkmatter/index.html#other-packages">Other packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/darkmatter/index.html#using-gammapy-spectrum">Using <code class="docutils literal notranslate"><span class="pre">gammapy.spectrum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../astro/darkmatter/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">How to contribute to Gammapy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../setup.html">Gammapy project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html">Developer HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release.html">How to make a Gammapy release</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">PIGs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pig-001.html">PIG 1 - PIG purpose and guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-002.html">PIG 2 - Organization of low-level analysis code</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-003.html">PIG 3 - Plan for dropping Python 2.7 support</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-004.html">PIG 4 - Setup for tutorial notebooks and data</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-005.html">PIG 5 - Gammapy 1.0 Roadmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-009.html">PIG 9 - Event Sampling</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">PIG 10 - Regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-012.html">PIG 12 - High-level interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-013.html">PIG 13 - Gammapy dependencies and distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="pig-016.html">PIG 16 - Gammapy package structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dataformats.html">Data Formats</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gammapy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer documentation</a> &raquo;</li>
        
          <li><a href="index.html">PIGs</a> &raquo;</li>
        
      <li>PIG 10 - Regions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/development/pigs/pig-010.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="pig-10-regions">
<span id="pig-010"></span><h1>PIG 10 - Regions<a class="headerlink" href="#pig-10-regions" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li>Author: Christoph Deil, Axel Donath, Rgis Terrier</li>
<li>Created: May 3, 2019</li>
<li>Accepted: June 17, 2019</li>
<li>Status: accepted</li>
<li>Discussion: <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2129">GH 2129</a></li>
</ul>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline"></a></h2>
<p>We propose to use <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a> to handle spatial sky and pixel regions
throughout Gammapy. We already use <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code>, so why a PIG? There are
a few decisions we need to make concerning where to use sky and where to use
pixel regions and where to support both. This affects the algorithms used (e.g.
for rotated region background estimation) and the API (where a WCS or exclusion
map is needed in functions and methods working with regions). Also
<code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> was started after Gammapy - so we have some code to work
with sky cones and boxes that should partially be removed, partially refactored
to use <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code>.</p>
<p>The scope of this PIG is small and limited to spatial sky and pixel regions. The
work to implement it is small, we propose to complete it for Gammapy v0.13 in
July 2019.</p>
<p>The question of more general data subspace selections that include energy, time
or phase regions and selections, or general n-dimensional regions, or whether to
introduce a field of view (FOV) coordinate frame and special FOV regions is not
addressed here. Also some things like the clean-up of <code class="docutils literal notranslate"><span class="pre">gammapy.image</span></code> which
contains some region-related code is left as future work.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>This long introduction describes the history and design of <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a>
and regions in Gammapy. It is background information, you are welcome to skip
ahead to the <a class="reference internal" href="#proposal">Proposal</a> and <a class="reference internal" href="#task-list">Task list</a> in this PIG below.</p>
<p>Spatial regions are used a lot in gamma-ray astronomy (and other domains of
astronomy as well). Often a users chooses a region of interest, and then selects
the observations or events or pixels for analysis. Besides on regions or
regions of interest, there are a few use cases to create regions within
Gammapy, e.g. to restrict analysis to a maximum field of view offset, or to
compute off regions for background estimation for a given on region.</p>
<p>In early versions of Gammapy we started to develop <code class="docutils literal notranslate"><span class="pre">gammapy.regions</span></code>, but soon
realised that the functionality really is very generic, and also needed by many
other astronomers (radio, optical, X-ray, ). Astropy and <a class="reference external" href="https://photutils.readthedocs.io">photutils</a> was
being developed, there was <a class="reference external" href="https://pyregion.readthedocs.io">pyregion</a>. At <a class="reference external" href="http://openastronomy.org/pyastro/2015/">Python in Astronomy 2015</a> we
discussed and decided to create a new Astropy-affiliated regions package from
scratch and have been developing it since: <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a>. The goal is to
merge it as <code class="docutils literal notranslate"><span class="pre">astropy.regions</span></code> into the Astropy core once its in a certain
sense complete, for now it is an extra package that has been a dependency of
Gammapy since Gammapy v0.5 in 2016. This is OK, the situation for
<code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> is the same as for <a class="reference external" href="https://reproject.readthedocs.io">reproject</a> and soon  <a class="reference external" href="https://astropy-healpix.readthedocs.io">astropy-healpix</a>
(see <a class="reference external" href="https://github.com/gammapy/gammapy/pull/1167">GH 1167</a>), they are extra packages and dependencies of Gammapy. We should
continue to contribute to these three projects until they are complete and help
get them in Astropy core some day.</p>
<p>The <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a> package contains sky and pixel regions with methods to
filter positions and to make masks, ways to transform between sky and pixel
region for a given WCS, support for plotting with matplotlib and I/O (string
serialisation and parsing) for the <a class="reference external" href="http://ds9.si.edu/doc/ref/region.html">DS9 region format</a>. As described below,
there are a few things still missing in astropy-regions that we need in Gammapy,
thus the work described in this PIG is partly for <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a> and partly
in Gammapy.</p>
<p>The places where regions appear in the Gammapy code and API are very few and
overall region handling is pretty simple. Gammapy is mostly a binned analysis
framework, so mainly regions are used to create pixel masks, and then the
analysis is mask-based, not involving region objects any more (see section
below: <a class="reference internal" href="#images-and-masks">Images and masks</a>). The second place where regions appear is to select
objects of interest (events, observations, sources) for a given region (see
section below: <a class="reference internal" href="#sky-and-pixel-regions">Sky and pixel regions</a>). Finally, there is the use case of
rotated regions for background estimation in  1D spectral analysis (see section
below: <a class="reference internal" href="#rotated-regions">Rotated regions</a>).</p>
<p>However, it turns out that working with regions is surprisingly tricky, because
there are different ways to define the basic semantics and computations for
contains of a region, how to transform between pixel and sky regions and how
to visualise them. The origin of the issue is that to make an image for analysis
or visualisation, one has to choose a projection that maps sky to pixel
coordinates, and there are many different projections, and they all have
distortions. For example, the <a class="reference external" href="https://en.wikipedia.org/wiki/Aitoff_projection">Wikipedia page on Aitoff projection</a> contains an
illustration of how sky circles map to pixel regions that are to a good
approximation pixel circles in some parts of the image, but in others have
complex shapes and different sizes, and at the edge even split in two disjoint
pixel regions on the left and right part of the image.</p>
<p>In <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a>, after a lot of discussions, we have agreed to keep it
simple, and to follow the lead of DS9 and to handle sky and pixel regions and
their transforms in the same way that DS9 does. This has the advantage that we
can use the DS9 string format to define and exchange regions (see section below:
<a class="reference internal" href="#region-arguments">Region arguments</a>), and we can use DS9 to view them. As can be seen in the
<code class="docutils literal notranslate"><span class="pre">CircleSkyRegion.to_pixel</span></code> method implementation below, the definition used to
map a sky circle to a pixel circle region is an approximation where the center
is transformed according to the given <code class="docutils literal notranslate"><span class="pre">wcs</span></code>, and the radius is transformed
using the local pixel scale at the center point for the given <code class="docutils literal notranslate"><span class="pre">wcs</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CircleSkyRegion</span><span class="p">(</span><span class="n">SkyRegion</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wcs</span><span class="p">):</span>
        <span class="n">center</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">skycoord_to_pixel_scale_angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">wcs</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="k">return</span> <span class="n">CirclePixelRegion</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visual</span><span class="p">)</span>
</pre></div>
</div>
<p>So a sky circle is converted to a pixel circle. This works well for most use
cases where one has an image with an extent and WCS of roughly constant pixel
scale, e.g. a local TAN projection at a source location and 10 deg image size.
In general the strategy in Gammapy will be to accept both pixel or sky regions
as inputs, but to internally always call <code class="docutils literal notranslate"><span class="pre">to_pixel</span></code> first if a sky region is
passed, and to internally always work with pixel regions.</p>
<p>This approximation fails for all-sky analysis and image parts where the
projection has a shear or is varying like the sky circles that are distorted in
the image on the  <a class="reference external" href="https://en.wikipedia.org/wiki/Aitoff_projection">Wikipedia page on Aitoff projection</a>. One possible future
improvement to <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> would be to implement sky contains directly
for <code class="docutils literal notranslate"><span class="pre">CircleSkyRegion</span></code> using sky distance, and for <code class="docutils literal notranslate"><span class="pre">PolygonSkyRegion</span></code> using
the assumption that polygon edges follow great circles, and for other shapes to
implement <code class="docutils literal notranslate"><span class="pre">to_polygon</span></code> methods that approximate any region as a
<code class="docutils literal notranslate"><span class="pre">PolygonSkyRegion</span></code> (using any number of points and accuracy the user wants),
and then transforming the <code class="docutils literal notranslate"><span class="pre">PolygonSkyRegion</span></code> to <code class="docutils literal notranslate"><span class="pre">PolygonPixelRegion</span></code>, as
defined already by simply transforming the vertex points. This is feasible and
useful for circles, ellipses and polygons (one would have to decide what to do
with image projection edges like at longitude 180 deg in the Aitoff example,
whether to split into disjoint pixel region parts), but is difficult for other
shapes such as wedges or already for rectangles, because their shape only
becomes well-defined for a given projection. These things are not in scope for
this PIG or needed for Gammapy for now, Gammapy simply doesnt have all-sky
analysis support built in yet, although already now users could write Python
scripts to do it using a combination of HEALPix and WCS maps and Gammapy.</p>
<p>Now that we know how <a class="reference external" href="https://astropy-regions.readthedocs.io">astropy-regions</a> works and how we plan to handle pixel
and sky regions in Gammapy, lets move on to the detailed proposal and task list
outlining additions and changes to make.</p>
</div>
<div class="section" id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline"></a></h2>
<p>This section contains a detailed proposal concerning region-related code in
Gammapy. The <a class="reference internal" href="#task-list">Task list</a> at the end of this PIG references these descriptions.</p>
<div class="section" id="region-arguments">
<h3>Region arguments<a class="headerlink" href="#region-arguments" title="Permalink to this headline"></a></h3>
<p>We propose to add support for DS9 region strings (in addition to region objects)
in all functions in Gammapy that take a <code class="docutils literal notranslate"><span class="pre">region</span></code> argument. This can be
achieved via a <code class="docutils literal notranslate"><span class="pre">make_region</span></code> helper function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">regions</span> <span class="k">import</span> <span class="n">DS9Parser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">make_region</span><span class="p">(</span><span class="n">region</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># This is basic and works for simple regions</span>
<span class="gp">... </span>        <span class="c1"># It could be extended to cover more things,</span>
<span class="gp">... </span>        <span class="c1"># like e.g. compound regions, exclusion regions, ....</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">DS9Parser</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_region</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">region</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">make_region</span><span class="p">(</span><span class="s2">&quot;image;circle(42,43,3)&quot;</span><span class="p">)</span>
<span class="go">&lt;CirclePixelRegion(PixCoord(x=41.0, y=42.0), radius=3.0)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">make_region</span><span class="p">(</span><span class="s2">&quot;galactic;circle(42,43,3)&quot;</span><span class="p">)</span>
<span class="go">&lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg</span>
<span class="go">    (42., 43.)&gt;, radius=3.0 deg)&gt;</span>
</pre></div>
</div>
<p>This is convenient, a simple <code class="docutils literal notranslate"><span class="pre">region=&quot;galactic;circle(42,43,3)&quot;</span></code> is much
shorter than having to remember and type this equivalent code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">Angle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">regions</span> <span class="k">import</span> <span class="n">CircleSkyRegion</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radius</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">region</span> <span class="o">=</span> <span class="n">CircleSkyRegion</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">region</span>
<span class="go">&lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg</span>
<span class="go">    (42., 43.)&gt;, radius=3.0 deg)&gt;</span>
</pre></div>
</div>
<p>There is precendence for this pattern in Gammapy, we usually pass <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>
and <code class="docutils literal notranslate"><span class="pre">Angle</span></code> arguments through via e.g. <code class="docutils literal notranslate"><span class="pre">angle</span> <span class="pre">=</span> <span class="pre">Angle(angle)</span></code> in Gammapy
functions, and often call them with strings <code class="docutils literal notranslate"><span class="pre">angle=&quot;3</span> <span class="pre">deg&quot;</span></code>.</p>
<p>We propose to add a second function <code class="docutils literal notranslate"><span class="pre">make_pixel_region</span></code> which in addition to
the string case handling also does the sky region case handling, and gives good
error messages on invalid inputs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">regions</span> <span class="k">import</span> <span class="n">DS9Parser</span><span class="p">,</span> <span class="n">SkyRegion</span><span class="p">,</span> <span class="n">PixelRegion</span>

<span class="k">def</span> <span class="nf">make_pixel_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">SkyRegion</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sky regions not supported here.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">region</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">wcs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">PixelRegion</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">region</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;What is this? Giving up.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since in Gammapy we implement almost all algorithms using pixel regions, we
could then call this helper function on each Gammapy method or function on the
first line. E.g. <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.region_mask">gammapy.maps.WcsGeom.region_mask</a> would start like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">region_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">make_pixel_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="c1"># do computation, knowing region is a PixelRegion object</span>
</pre></div>
</div>
<p>We suggest to start by implementing these two helper functions in
<code class="docutils literal notranslate"><span class="pre">gammapy/utils/regions.py</span></code> and to use it internally, but not expose it as part
of the public API via the Gammapy docs. Once this is done, we would open an
issue in <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> asking whether inclusion there is welcome. This
might or might not be the case, because <code class="docutils literal notranslate"><span class="pre">make_region</span></code> is basically a
one-liner, and is DS9 format specific, whereas <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> supports
other region formats as well. Based on the outcome of this discussion, we would
then either move <code class="docutils literal notranslate"><span class="pre">gammapy/utils/regions.py</span></code> to <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code>, or expose
it as part of the public Gammapy API in the docs, since users might want to call
them directly in their scripts or analysis codes that build on Gammapy.</p>
<p>We note that this means that we commit to support DS9 region strings as part of
the Gammapy API. Many users will use this feature, so changing to something else
would break user scripts. If we add this now, there are still a few months to
gather user feedback, and to possibly add as similar <code class="docutils literal notranslate"><span class="pre">make_sky_coord</span></code> helper
function throughout Gammapy and to consider how the format there compares with
the regions format. There is also the <a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/skymaps/healpix/index.html#healpix-region-string">HEALPix region string</a> format in the
HEALPix map spec and support in <code class="docutils literal notranslate"><span class="pre">gammapy.maps</span></code>; ideally this format wouldnt
exist, but avoiding it probably isnt possible, since it includes the
<code class="docutils literal notranslate"><span class="pre">DISK_INC</span></code> and <code class="docutils literal notranslate"><span class="pre">HPX_PIXEL</span></code> regions cannot be represented in the DS9 or any
other existing region format. So at this time, there are no plans to improve or
unify that region format.</p>
<p>We propose to change the current <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.region_mask">gammapy.maps.WcsGeom.region_mask</a> input (and
everywhere else) from a list of regions, to a single region. The same effect of
a list of regions (meaning union) can be achieved by creating a <a class="reference external" href="https://astropy-regions.readthedocs.io/en/latest/compound.html">Compound
region</a>. That should be as efficient computationally, and more flexible (e.g.
one could also do intersection in the region definition). It might be useful
to add a factory function in <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> that makes the creation of such
compound regions a bit simpler.</p>
</div>
<div class="section" id="sky-and-pixel-regions">
<h3>Sky and pixel regions<a class="headerlink" href="#sky-and-pixel-regions" title="Permalink to this headline"></a></h3>
<p>As already explained in the <a class="reference internal" href="#introduction">Introduction</a> above, there are projection-related
issues when it comes to defining the basic operations for sky regions like
<code class="docutils literal notranslate"><span class="pre">contains</span></code>, <code class="docutils literal notranslate"><span class="pre">to_pixel</span></code> or <code class="docutils literal notranslate"><span class="pre">plot</span></code>. Currently <code class="docutils literal notranslate"><span class="pre">contains</span></code> and <code class="docutils literal notranslate"><span class="pre">plot</span></code>
methods simply arent defined for <code class="docutils literal notranslate"><span class="pre">SkyRegion</span></code>, and for <code class="docutils literal notranslate"><span class="pre">to_pixel</span></code> only the
local pixel scale approximation method is implemented.</p>
<p>This could be improved in <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code>:</p>
<ul class="simple">
<li>Implement contains for <code class="docutils literal notranslate"><span class="pre">PolygonSkyRegion</span></code> (see <a class="reference external" href="https://github.com/astropy/regions/issues/46">astropy-regions GH 46</a>)</li>
<li>Is is possible to define <code class="docutils literal notranslate"><span class="pre">RectangleSkyRegion.contains</span></code>
without a WCS (i.e. to compute corners from data members)?</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">SkyRegion.plot</span></code> (see <a class="reference external" href="https://github.com/astropy/regions/pull/221">astropy-regions GH 221</a>)?</li>
<li>Add generic <code class="docutils literal notranslate"><span class="pre">SkyRegion.contains</span></code> using a local TAN or CAR projection
with reference point at the region center, to allow use without a WCS?</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">SkyRegion.to_polygon</span></code>, try to be consistent with plot and contains.</li>
</ul>
<p>Having improved support for sky regions would make it convenient to do some
things without requiring a WCS. Especially for circle and polygon, it can be
useful to filter positions from an observation or event list, and it is possible
and common to do this. In Gammapy we currently have  <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.catalog.select_sky_box.html">select_sky_box</a>,
<a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.catalog.select_sky_circle.html">select_sky_circle</a> and <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.catalog.skycoord_from_table.html">skycoord_from_table</a> which do this in an ad-hoc way.
They are called from <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.data.EventList.html">gammapy.data.EventList</a>, <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.data.ObservationTable.html">gammapy.data.ObservationTable</a>
and <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.catalog.SourceCatalog.html">gammapy.catalog.SourceCatalog</a> which each are a wrapper or subclass of an
<a class="reference external" href="http://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v4.0.dev919)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.table.Table</span></code></a>.</p>
<p>We propose to replace those functions and methods with a <code class="docutils literal notranslate"><span class="pre">select_region</span></code>
method, which for now requires a WCS to be passed on call.</p>
<p>In the future, if <code class="docutils literal notranslate"><span class="pre">astropy-healpix</span></code> sky region methods improve, passing a
<code class="docutils literal notranslate"><span class="pre">WCS</span></code> might no longer be needed. Depending on the details of how
<code class="docutils literal notranslate"><span class="pre">SkyRegion.contains</span></code> is defined, this change might or might not be backward
compatible for Gammapy users. So ideally, this work should be done soon, but it
is better discussed in the <code class="docutils literal notranslate"><span class="pre">astropy-healpix</span></code> issue tracker, not this Gammapy
PIG.</p>
</div>
<div class="section" id="rotated-regions">
<h3>Rotated regions<a class="headerlink" href="#rotated-regions" title="Permalink to this headline"></a></h3>
<p>Rotated regions are used for background estimation in 1D spectral analysis in
gamma-ray astronomy (see <a class="reference internal" href="../../references.html#berge2007" id="id1">[Berge2007]</a>). The rotation is done arount the pointing
position of the IACT telescope array. This method is also called reflected
regions, but really thats a bad name, reflecting would only give one region on
the other side; what is done is rotating the regions.</p>
<p>In Gammapy, rotated regions are implemented in
<code class="docutils literal notranslate"><span class="pre">gammapy/background/reflected.py</span></code>. This is one of the most complex pieces of
code in Gammapy, because it was started before <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> or
<code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> existed and then adapted many times, never achieving a clean
design and implementation until now. The problem was that <code class="docutils literal notranslate"><span class="pre">astropy-region</span></code>
objects didnt support a rotate operation, and also their representation is such
that its not clear how to compute and represent e.g. a rotated
<code class="docutils literal notranslate"><span class="pre">RectangleSkyRegion</span></code> (see discussion of ambiguity in <code class="docutils literal notranslate"><span class="pre">SkyRegion.contains</span></code>
above). Also, the current code tried to handle the case with and without having
an exclusion mask and a WCS.</p>
<p>A recent attempt to improve our rotated regions code is <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2089">GH 2089</a>, which shows
that it is difficult to to in a clean way without having a <code class="docutils literal notranslate"><span class="pre">Region.rotate</span></code>
method, because if-else and specific case handling is needed for the operation.</p>
<p>We propose to add a <code class="docutils literal notranslate"><span class="pre">PixelRegion.rotate(center,</span> <span class="pre">angle)</span></code> method for all regions
in <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> (or all that can be represented again as a pixel region
object after rotating), and to only handle the case of pixel regions and a given
exclusion mask and WCS in <code class="docutils literal notranslate"><span class="pre">reflected.py</span></code>. For convenience, a dummy WCS as a
local TAN projection to the pointing position is used, if the user doesnt need
of have an exclusion mask, as is already done in the current code. This is a
common case e.g. for isolated point sources like AGN, where the rotated regions
method is most commonly used.</p>
<p>One complication is that in the current code, to have fewer off test regions,
the algorithm takes a large step <code class="docutils literal notranslate"><span class="pre">arctan(2*radius/offset)</span></code> at the start and
after placing an off region. This requires a radius, which is is not available
for regions of a complex shape. We propose that this optimisation is only left
for the circle case (which already has a specialised fast algorithm anyways
using a distance mask), and for other regions for now the normal thing is done
to test all positions in small angle increments.</p>
</div>
<div class="section" id="images-and-masks">
<h3>Images and masks<a class="headerlink" href="#images-and-masks" title="Permalink to this headline"></a></h3>
<p>Often regions are used to analyse images, and usually this happens via binary
masks (with <code class="docutils literal notranslate"><span class="pre">False</span></code> for outside and <code class="docutils literal notranslate"><span class="pre">True</span></code> for inside), or in some cases
integer label images (with 0 for outside, 1 for in region 1, 2 for in
region 2 and N for in region N). This is used in Gammapy, but also in
<code class="docutils literal notranslate"><span class="pre">scipy.ndimage</span></code>, <code class="docutils literal notranslate"><span class="pre">scikit-image</span></code>, <code class="docutils literal notranslate"><span class="pre">photutils</span></code> and other packages.</p>
<p>We leave the description of the details how we work with images and masks in
Gammapy as future work. This could be done in another PIG, or just directly by
improving the Gammapy code and documentation.</p>
<p>There are open issues already discussing when to use <code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code> arrays,
and a lot of code in <code class="docutils literal notranslate"><span class="pre">gammapy.image</span></code> (especially <code class="docutils literal notranslate"><span class="pre">gammapy/image/measure.py</span></code>
and <code class="docutils literal notranslate"><span class="pre">gammapy/image/profile.py</span></code>) should either be removed from Gammapy,
replaced by documentation examples, or improved to in some cases used regions.
This is not high priority and a separate task, since this functionality isnt
used anywhere else in Gammapy.</p>
</div>
</div>
<div class="section" id="outlook">
<h2>Outlook<a class="headerlink" href="#outlook" title="Permalink to this headline"></a></h2>
<p>This PIG only describes some short-term improvements to spatial regions.
Long-term, we might want to develop a more general solution for regions that
also includes non-spatial regions, e.g. spectral regions or time regions.</p>
<p>Just to mention what we have at the moment: spectral regions are handled via
<code class="docutils literal notranslate"><span class="pre">energy_bounds</span></code> or <code class="docutils literal notranslate"><span class="pre">(energy_min,</span> <span class="pre">energy_max)</span></code> in a not very consistent way.
We could look towards the Astropy <a class="reference external" href="https://specutils.readthedocs.io">specutils</a> package and the
<a class="reference external" href="https://specutils.readthedocs.io/en/latest/spectral_regions.html">specutils.SpectralRegion</a> object as an example how to implement spectral
regions. Currently there is plan to integrate <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> and
<code class="docutils literal notranslate"><span class="pre">specutils</span></code>, <a class="reference external" href="https://github.com/astropy/regions/issues/228">astropy-regions GH 228</a> has been opened for discussion.</p>
<p>Supporting an energy-dependent maximum field of view radius selection, or a
field-of-view dependent safe energy offset might be a motivation to couple
spatial and spectral region, possibly supported via <code class="docutils literal notranslate"><span class="pre">gammapy.maps</span></code>.</p>
<p>For time regions we currently often have <code class="docutils literal notranslate"><span class="pre">(time_min,</span> <span class="pre">time_max)</span></code> in the API,
and we have the <a class="reference external" href="https://docs.gammapy.org/0.11/api/gammapy.data.GTI.html">gammapy.data.GTI</a> class to represent multiple intervals. Its
not clear if this needs to be changed or wrapped somehow into a time region,
or if there are any use cases to couple time with the spatial and spectral
regions, e.g. for a time-dependent safe energy threshold or user analysis
option.</p>
<p>There is an issue <a class="reference external" href="https://github.com/gammapy/gammapy/issues/1805">GH 1805</a> Introduce RegionGeom and RegionNDMap? with first
thoughts in this direction. Discussion or working out a solution for that is
beyond the scope of this PIG.</p>
<p>In the HESS software, there is a region class that wraps a mask, and that is
sometimes useful, specifically because in the HESS software exclusion regions
are region objects, sometimes compound with a mask region and other regions like
circles. Its clearly an option, easy to implement as a <code class="docutils literal notranslate"><span class="pre">SkyRegion</span></code> sub-class.
But also causes problems, especially when it comes to serialisation. Thoughts?
Im OK to not add this for now, and just use <code class="docutils literal notranslate"><span class="pre">Map</span></code> objects for exclusion
masks, and require that users create that before using Gammapy, in case they
e.g. have a list of circles or whatever they want to use as exclusion region.</p>
</div>
<div class="section" id="task-list">
<h2>Task list<a class="headerlink" href="#task-list" title="Permalink to this headline"></a></h2>
<p>We propose to implement this PIG though a series of small pull requests. Some are
dependent on others, but for many also the order doesnt matter and overall the
amount of work is limited.</p>
<ul class="simple">
<li>Add region copy method, needed for region rotate (see <a class="reference external" href="https://github.com/astropy/regions/issues/266">astropy-regions GH 266</a>)</li>
<li>Add region rotate method (see <a class="reference external" href="https://github.com/astropy/regions/issues/265">astropy-regions GH 265</a> and <a class="reference internal" href="#rotated-regions">Rotated regions</a> above)</li>
<li>Release <code class="docutils literal notranslate"><span class="pre">astropy-regions</span></code> v0.4, then bump Gammapy dependency to that version.</li>
<li>Improve rotated region code and tests and docs in Gammapy.
This could mean a rebase and continuation of <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2089">GH 2089</a>, or closing that and
re-starting from master, copying over the useful parts or cherry-picking
useful commits from that branch.</li>
</ul>
<p>Other tasks, mostly independent from the previous ones, can happen in any order:</p>
<ul class="simple">
<li>Add <code class="docutils literal notranslate"><span class="pre">gammapy/utils/regions.py</span></code> with two helper functions. See <a class="reference internal" href="#region-arguments">Region arguments</a> above.</li>
<li>Use the helper functions throughout Gammapy. Should be 5-10 cases, could be
several PRs. See <a class="reference internal" href="#region-arguments">Region arguments</a> above.</li>
<li>Replace sky circle and box select with generic region select (see <a class="reference internal" href="#sky-and-pixel-regions">Sky and
pixel regions</a>, resolves <a class="reference external" href="https://github.com/gammapy/gammapy/issues/1172">GH 1172</a>)</li>
</ul>
<p>Beyond those core tasks that really should be done for Gammapy v0.13, further
improvements in <code class="docutils literal notranslate"><span class="pre">astropy-healpix</span></code> and Gammapy should be done, but are lower
priority:</p>
<ul class="simple">
<li>Implement <code class="docutils literal notranslate"><span class="pre">SkyRegion.contains(point)</span></code> (see <a class="reference internal" href="#sky-and-pixel-regions">Sky and pixel regions</a> above)</li>
<li>Implement <code class="docutils literal notranslate"><span class="pre">SkyRegion.plot</span></code> (see <a class="reference internal" href="#sky-and-pixel-regions">Sky and pixel regions</a> above)</li>
<li>Review and improve region-related tests, especially for complicated edge lon = 0 / 360 and the poles.</li>
<li>Review and improve region-related end-user docs. Possibly add a dedicated tutorial notebook.</li>
<li>Support region_mask for multi-resolution maps (<a class="reference external" href="https://github.com/gammapy/gammapy/issues/1715">GH 1715</a>)</li>
<li>HPX up/down sample issue with partial skymaps (<a class="reference external" href="https://github.com/gammapy/gammapy/issues/1445">GH 1445</a>)</li>
<li>Introduce RegionGeom and RegionNDMap? (<a class="reference external" href="https://github.com/gammapy/gammapy/issues/1805">GH 1805</a>)</li>
</ul>
</div>
<div class="section" id="alternatives">
<h2>Alternatives<a class="headerlink" href="#alternatives" title="Permalink to this headline"></a></h2>
<p>As mentioned in <a class="reference internal" href="#sky-and-pixel-regions">Sky and pixel regions</a> and <a class="reference internal" href="#rotated-regions">Rotated regions</a>, we could use
sky regions more instead of pixel regions, and restrict analysis to sky regions
where contains or rotate is well defined, namely circles and polygons, and to
polygonise other sky regions using some approximation, before passing them to
Gammapy.</p>
<p>In the future we might want a more general solution, and theres the question
whether a mask-backed region should be added (see <a class="reference internal" href="#outlook">Outlook</a>)</p>
</div>
<div class="section" id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline"></a></h2>
<p>The PIG was discussed in <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2129">GH 2129</a> and the weekly Gammapy developer calls. A
final review announced on the Gammapy and CC mailing list did not yield any
additional comments. Therefore the PIG was accepted on June 17, 2019.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pig-012.html" class="btn btn-neutral float-right" title="PIG 12 - High-level interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pig-009.html" class="btn btn-neutral float-left" title="PIG 9 - Event Sampling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, The Gammapy developers
      <span class="lastupdated">
        Last updated on 01 Oct 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>