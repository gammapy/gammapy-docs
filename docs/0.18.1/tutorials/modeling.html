

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modeling and fitting &mdash; gammapy v0.18.1</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/gammapy_logo.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.gammapy.org/dev/tutorials/modeling.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/gammapy.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Gammapy Models" href="models.html" />
    <link rel="prev" title="Gammapy Maps" href="maps.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> gammapy
          

          
          </a>

          
            
            
              <div class="version">
                0.18.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#workflow">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#data-reduction">Data reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#datasets">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#modeling-and-fitting">Modeling and Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#time-analysis">Time analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#other-topics">Other topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#what-next">What next?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/DL3.html">The Data Level 3 (DL3) format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../overview/DL3.html#data-levels-in-cta">Data levels in CTA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../overview/DL3.html#application-in-gammapy">Application in gammapy</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#using-anaconda">Using Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#using-other-package-managers">Using other package managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#download-tutorials">Download tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#what-next">What next?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install/dependencies.html">Gammapy Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../install/dependencies.html#required-dependencies">Required dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../install/dependencies.html#optional-dependencies">Optional dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../install/other.html">Other package managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install/pip.html">Installation with pip</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#help">Help!?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#check-your-setup">Check your setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#use-gammapy">Use Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#id2">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#id3">IPython</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#python-script">Python script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#jupyter-notebooks">Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#install-issues">Install issues</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis_1.html">First analysis with gammapy high level interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Analysis-configuration">Analysis configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Running-the-analysis">Running the analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Data-reduction">Data reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Save-dataset-to-disk">Save dataset to disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#Model-fitting">Model fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_1.html#What’s-next">What’s next</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis_2.html">First analysis with gammapy library API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Defining-the-datastore-and-selecting-observations">Defining the datastore and selecting observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Preparing-reduced-datasets-geometry">Preparing reduced datasets geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Data-reduction">Data reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Save-dataset-to-disk">Save dataset to disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Define-the-model">Define the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Fit-the-model">Fit the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_2.html#Plot-the-fitted-spectrum">Plot the fitted spectrum</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#core-tutorials">Core tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cta.html">CTA with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Tutorial-overview">Tutorial overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#CTA-1DC">CTA 1DC</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Events">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#IRFs">IRFs</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Source-models">Source models</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#CTA-performance-files">CTA performance files</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta.html#Next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hess.html">H.E.S.S. data with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hess.html#DL3-DR1">DL3 DR1</a></li>
<li class="toctree-l4"><a class="reference internal" href="hess.html#Theta-squared-event-distribution">Theta squared event distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="hess.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="hess.html#Next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fermi_lat.html">Fermi-LAT data with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Events">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Counts">Counts</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Exposure">Exposure</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Galactic-diffuse-background">Galactic diffuse background</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Isotropic-diffuse-background">Isotropic diffuse background</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#PSF">PSF</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Fit">Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="fermi_lat.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cta_data_analysis.html">CTA data analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Select-observations">Select observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Make-sky-images">Make sky images</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Source-Detection">Source Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Spatial-analysis">Spatial analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Spectrum">Spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_data_analysis.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis_3d.html">3D analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Analysis-configuration">Analysis configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Configuration-for-stacked-and-joint-analysis">Configuration for stacked and joint analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Stacked-analysis">Stacked analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Joint-analysis">Joint analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_3d.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="simulate_3d.html">3D simulation and fitting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Imports-and-versions">Imports and versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Simulation">Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulate_3d.html#Fit">Fit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spectrum_analysis.html">Spectral analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Load-Data">Load Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Define-Target-Region">Define Target Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Create-exclusion-mask">Create exclusion mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Run-data-reduction-chain">Run data reduction chain</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Plot-off-regions">Plot off regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Source-statistic">Source statistic</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Fit-spectrum">Fit spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Fit-quality-and-model-residuals">Fit quality and model residuals</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Compute-Flux-Points">Compute Flux Points</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Stack-observations">Stack observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_analysis.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sed_fitting.html">Flux point fitting in Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Load-spectral-points">Load spectral points</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Power-Law-Fit">Power Law Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Exponential-Cut-Off-Powerlaw-Fit">Exponential Cut-Off Powerlaw Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Log-Parabola-Fit">Log-Parabola Fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="sed_fitting.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="light_curve.html">Light curve estimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Analysis-configuration">Analysis configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Light-Curve-estimation:-by-observation">Light Curve estimation: by observation</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Running-the-light-curve-extraction-in-1D">Running the light curve extraction in 1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#Night-wise-LC-estimation">Night-wise LC estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="light_curve_flare.html">Light curve - Flare</a><ul>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Select-the-data">Select the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Define-time-intervals">Define time intervals</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Filter-the-observations-list-in-time-intervals">Filter the observations list in time intervals</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Building-1D-datasets-from-the-new-observations">Building 1D datasets from the new observations</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Define-the-Model">Define the Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_flare.html#Extract-the-light-curve">Extract the light curve</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="light_curve_simulation.html">Binned light curve simulation and fitting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#id1">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Simulating-a-light-curve">Simulating a light curve</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Extract-the-lightcurve">Extract the lightcurve</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Fit-the-datasets">Fit the datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="light_curve_simulation.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spectrum_simulation.html">Spectrum simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Simulation-of-a-single-spectrum">Simulation of a single spectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectrum_simulation.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modeling_2D.html">Modeling and fitting 2D images using Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Context:">Context:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Objective:">Objective:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Creating-the-config-file">Creating the config file</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Getting-the-reduced-dataset">Getting the reduced dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Modelling">Modelling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ring_background.html">Ring Background Estimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Context:">Context:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Objective:">Objective:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Creating-the-config-file">Creating the config file</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Getting-the-reduced-dataset">Getting the reduced dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Extracting-the-ring-background">Extracting the ring background</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Compute-correlated-significance-and-correlated-excess-maps">Compute correlated significance and correlated excess maps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="event_sampling.html">Event Sampling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Objective">Objective</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Extended-source-using-a-template">Extended source using a template</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_sampling.html#Exercises">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#advanced-tutorials">Advanced tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="analysis_mwl.html">Joint modeling, fitting, and serialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#The-setup">The setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Data-and-models-files">Data and models files</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Reading-different-datasets">Reading different datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Datasets-serialization">Datasets serialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis_mwl.html#Joint-analysis">Joint analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="extended_source_spectral_analysis.html">Spectral analysis of extended sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Select-the-data">Select the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Prepare-the-datasets-creation">Prepare the datasets creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Perform-the-data-reduction-loop.">Perform the data reduction loop.</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Explore-the-results">Explore the results</a></li>
<li class="toctree-l4"><a class="reference internal" href="extended_source_spectral_analysis.html#Perform-spectral-model-fitting">Perform spectral model fitting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="detect.html">Source detection with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Read-in-input-images">Read in input images</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Adaptive-smoothing">Adaptive smoothing</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#TS-map-estimation">TS map estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#Source-candidates">Source candidates</a></li>
<li class="toctree-l4"><a class="reference internal" href="detect.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cta_sensitivity.html">Estimation of the CTA point source sensitivity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Define-analysis-region-and-energy-binning">Define analysis region and energy binning</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Load-IRFs-and-prepare-dataset">Load IRFs and prepare dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Compute-sensitivity">Compute sensitivity</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Results">Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="cta_sensitivity.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modeling_2D.html">Modeling and fitting 2D images using Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Prerequisites:">Prerequisites:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Context:">Context:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Objective:">Objective:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Creating-the-config-file">Creating the config file</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Getting-the-reduced-dataset">Getting the reduced dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="modeling_2D.html#Modelling">Modelling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ring_background.html">Ring Background Estimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Context:">Context:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Objective:">Objective:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Proposed-approach:">Proposed approach:</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Creating-the-config-file">Creating the config file</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Getting-the-reduced-dataset">Getting the reduced dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Extracting-the-ring-background">Extracting the ring background</a></li>
<li class="toctree-l4"><a class="reference internal" href="ring_background.html#Compute-correlated-significance-and-correlated-excess-maps">Compute correlated significance and correlated excess maps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exclusion_mask.html">Creating exclusion masks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Create-the-mask-from-a-list-of-regions">Create the mask from a list of regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Create-the-mask-from-a-catalog-of-sources">Create the mask from a catalog of sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Create-the-mask-from-statistically-significant-pixels-in-a-dataset">Create the mask from statistically significant pixels in a dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="exclusion_mask.html#Reading-and-writing-exclusion-masks">Reading and writing exclusion masks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="overview.html">Getting started with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Maps">Maps</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Event-lists">Event lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Source-catalogs">Source catalogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#Spectral-models-and-flux-points">Spectral models and flux points</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#What-next?">What next?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="maps.html">Gammapy Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Creating-WCS-Maps">Creating WCS Maps</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Accessing-and-Modifying-Data">Accessing and Modifying Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Reading-and-Writing">Reading and Writing</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Visualizing-and-Plotting">Visualizing and Plotting</a></li>
<li class="toctree-l4"><a class="reference internal" href="maps.html#Interpolating-and-Miscellaneous">Interpolating and Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Modeling and fitting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-setup">The setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model-and-dataset">Model and dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fitting-options">Fitting options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fit-quality-assessment">Fit quality assessment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Covariance-and-parameters-errors">Covariance and parameters errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Confidence-contours">Confidence contours</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="models.html">Gammapy Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Spectral-Models">Spectral Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Spatial-Models">Spatial Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#SkyModel">SkyModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Model-Lists-and-Serialisation">Model Lists and Serialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Implementing-a-Custom-Model">Implementing a Custom Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#Models-with-Energy-dependent-morphology">Models with Energy dependent morphology</a></li>
<li class="toctree-l3"><a class="reference internal" href="catalog.html">Source catalogs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#List-available-catalogs">List available catalogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Load-catalogs">Load catalogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Select-a-source">Select a source</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Pretty-print-source-information">Pretty-print source information</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Source-models">Source models</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Flux-points">Flux points</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Lightcurves">Lightcurves</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Catalog-table-and-source-dictionary">Catalog table and source dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="catalog.html#Next-steps">Next steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#scripts">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="survey_map.html">Survey map</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extra-topics">Extra topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="astro_dark_matter.html">Dark matter utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#Profiles">Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#J-Factors">J Factors</a></li>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#Gamma-ray-spectra-at-production">Gamma-ray spectra at production</a></li>
<li class="toctree-l4"><a class="reference internal" href="astro_dark_matter.html#Flux-maps">Flux maps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="background_model.html">Make template background model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Proposed-approach">Proposed approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Select-off-data">Select off data</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Background-model">Background model</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Zenith-dependence">Zenith dependence</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Index-tables">Index tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_model.html#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcmc_sampling.html">Fitting and error estimation with MCMC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Simulate-an-observation">Simulate an observation</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Estimate-parameter-correlations-with-MCMC">Estimate parameter correlations with MCMC</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Plot-the-results">Plot the results</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Plot-the-model-dispersion">Plot the model dispersion</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#Fun-Zone">Fun Zone</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcmc_sampling.html#PeVatrons-in-CTA-?">PeVatrons in CTA ?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pulsar_analysis.html">Pulsar analysis with Gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pulsar_analysis.html#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulsar_analysis.html#Opening-the-data">Opening the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulsar_analysis.html#Phasogram">Phasogram</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulsar_analysis.html#Phase-resolved-map">Phase-resolved map</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulsar_analysis.html#Phase-resolved-spectrum">Phase-resolved spectrum</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto.html">How To</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#access-iact-data">Access IACT data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#check-irfs">Check IRFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#use-gammapy-for-modeling-2d-images">Use gammapy for modeling 2D images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#extract-1d-spectra">Extract 1D spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#extract-a-lightcurve">Extract a lightcurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#compute-source-significance">Compute source significance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#compute-cumulative-significance">Compute cumulative significance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#detect-sources-in-a-map">Detect sources in a map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#astrophysical-source-modeling">Astrophysical source modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#implement-a-custom-model">Implement a custom model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#energy-dependent-spatial-models">Energy Dependent Spatial Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Glossary and references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../references.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#other-gamma-ray-packages">Other gamma-ray packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#other-useful-packages">Other useful packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-6th-2020">0.18.1 (Nov 6th, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#pull-requests">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-4th-2020">0.18 (Nov 4th, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id2">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-1-2020">0.17 (Apr 1, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id3">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#feb-1-2020">0.16 (Feb 1, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id4">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id5">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#dec-3-2019">0.15 (Dec 3, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id6">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id7">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#sep-30-2019">0.14 (Sep 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id8">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id9">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#jul-26-2019">0.13 (Jul 26, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id10">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id11">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#may-30-2019">0.12 (May 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id12">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id13">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#mar-29-2019">0.11 (Mar 29, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id14">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id15">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#jan-28-2019">0.10 (Jan 28, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id16">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id17">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-29-2018">0.9 (Nov 29, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id18">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id19">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#sep-23-2018">0.8 (Sep 23, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id20">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id21">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#feb-28-2018">0.7 (Feb 28, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id22">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id23">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-28-2017">0.6 (Apr 28, 2017)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id24">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id25">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-22-2016">0.5 (Nov 22, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id26">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id27">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-20-2016">0.4 (Apr 20, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id28">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id29">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#aug-13-2015">0.3 (Aug 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id30">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id31">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-13-2015">0.2 (Apr 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id32">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id33">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#aug-25-2014">0.1 (Aug 25, 2014)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id34">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id35">Pull requests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Gammapy Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../analysis/index.html">analysis - High-level interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#configuration-and-methods">Configuration and methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#general-settings">General settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#observations-selection">Observations selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#data-reduction-and-datasets">Data reduction and datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#model">Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#fitting">Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#flux-points">Flux points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#residuals">Residuals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#using-the-high-level-interface">Using the high-level interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#module-gammapy.analysis">gammapy.analysis Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../analysis/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">data - DL3 data access and observations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#using-gammapy-data">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.data</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../data/index.html#module-gammapy.data">gammapy.data Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../data/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../data/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../makers/index.html">makers - Data reduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#safe-data-range-handling">Safe Data Range Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#stacking-of-datasets">Stacking of Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#combining-data-reduction-steps">Combining Data Reduction Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../makers/reflected.html">Reflected regions background</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../makers/reflected.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../makers/reflected.html#using-regions">Using regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../makers/reflected.html#the-reflected-region-finder">The reflected region finder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../makers/reflected.html#using-the-reflected-background-estimator">Using the reflected background estimator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../makers/ring.html">Ring background</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../makers/ring.html#overview">Overview</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#using-gammapy-makers">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.makers</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../makers/index.html#module-gammapy.makers">gammapy.makers Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../makers/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../makers/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../datasets/index.html">datasets - Reduced datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../datasets/index.html#module-gammapy.datasets">gammapy.datasets Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../datasets/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../datasets/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modeling/index.html">modeling - Models and fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modeling/index.html#module-gammapy.modeling">gammapy.modeling Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../modeling/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modeling/index.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modeling/index.html#module-gammapy.modeling.models">gammapy.modeling.models Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../modeling/index.html#id1">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modeling/index.html#id2">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modeling/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../estimators/index.html">estimators - High level estimators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../estimators/detect.html">Flux and significance maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../estimators/detect.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/detect.html#computation-of-ts-images">Computation of TS images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/detect.html#computation-of-significance-images-a-la-li-ma">Computation of significance images a la Li &amp; Ma</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/detect.html#using-gammapy-estimators">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.estimators</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../estimators/lightcurve.html">Lightcurves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../estimators/lightcurve.html#id1">Lightcurve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/lightcurve.html#light-curve-extraction">Light Curve Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/lightcurve.html#tutorials">Tutorials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../estimators/index.html#module-gammapy.estimators">gammapy.estimators Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../estimators/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../estimators/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../irf/index.html">irf - Instrument response functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/index.html#irf-axis-naming">IRF Axis naming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#using-gammapy-irf">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.irf</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/theory.html">IRF Theory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/theory.html#modeling-the-expected-number-of-detected-events">Modeling the expected number of detected events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/theory.html#the-instrument-response-functions">The Instrument Response Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../irf/aeff.html">Effective area</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/aeff.html#as-a-function-of-true-energy-and-offset-angle-gadf-aeff-2d">as a function of true energy and offset angle (<span class="xref std std-ref">gadf:aeff_2d</span>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/aeff.html#as-a-function-of-true-energy-gadf-ogip-arf">as a function of true energy (<span class="xref std std-ref">gadf:ogip-arf</span>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../irf/edisp.html">Energy Dispersion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/edisp.html#as-a-function-of-of-true-energy-and-offset-angle-gadf-edisp-2d">as a function of of true energy and offset angle (<span class="xref std std-ref">gadf:edisp_2d</span>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/edisp.html#as-a-function-of-true-energy-gadf-ogip-rmf">as a function of true energy (<span class="xref std std-ref">gadf:ogip-rmf</span>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../irf/psf.html">Point Spread Function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/psf.html#as-a-function-of-of-true-energy-and-offset-angle-gadf-psf-table">as a function of of true energy and offset angle (<span class="xref std std-ref">gadf:psf_table</span>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/psf.html#as-a-function-of-true-energy-gadf-psf-gtpsf">as a function of true energy (<span class="xref std std-ref">gadf:psf_gtpsf</span>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/psf.html#additional-psf-classes">additional PSF classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../irf/bkg.html">Background</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/bkg.html#as-a-function-of-reconstructed-energy-and-detector-coordinates-gadf-bkg-3d">as a function of reconstructed energy and detector coordinates (<span class="xref std std-ref">gadf:bkg_3d</span>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/bkg.html#as-a-function-of-reconstructed-energy-and-offset-angle-radially-symmetric-gadf-bkg-2d">as a function of reconstructed energy and offset angle, radially symmetric (<span class="xref std std-ref">gadf:bkg_2d</span>)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/index.html#module-gammapy.irf">gammapy.irf Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../irf/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../irf/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maps/index.html">maps - Sky maps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#constructing-with-factory-methods">Constructing with Factory Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#indexing-and-slicing">Indexing and Slicing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#accessor-methods">Accessor Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#interface-with-mapcoord-and-skycoord">Interface with <code class="xref py py-obj docutils literal notranslate"><span class="pre">MapCoord</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyCoord</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#differential-and-integral-maps">Differential and integral maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#mapcoord">MapCoord</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#interpolation">Interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#iterating-by-image">Iterating by image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#fits-i-o">FITS I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#creating-counts-cubes-from-event-lists">Creating counts cubes from event lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#generating-a-cutout-of-a-model-cube">Generating a Cutout of a Model Cube</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#using-gammapy-maps">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/hpxmap.html">HEALPix-based Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../maps/hpxmap.html#healpix-geometry">HEALPix Geometry</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#module-gammapy.maps">gammapy.maps Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../maps/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../catalog/index.html">catalog - Source catalogs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#module-gammapy.catalog">gammapy.catalog Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../catalog/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../catalog/index.html#variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../astro/index.html">astro - Astrophysics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#sub-packages">Sub-packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../astro/source/index.html">Astrophysical source models (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.source</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../astro/source/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/source/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/source/index.html#using-gammapy-astro-source">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.source</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/source/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../astro/population/index.html">Astrophysical source population models (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.population</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../astro/population/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/population/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/population/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../astro/darkmatter/index.html">Dark matter (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.darkmatter</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../astro/darkmatter/index.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/darkmatter/index.html#other-packages">Other packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/darkmatter/index.html#using-gammapy-astro-darkmatter">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.darkmatter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../astro/darkmatter/index.html#reference-api">Reference/API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/index.html">scripts - Command line tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#execute">Execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#running-config-driven-data-reduction">Running config driven data reduction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#write-your-own-cli">Write your own CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#command-not-found">Command not found</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#reference">Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#gammapy">gammapy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../scripts/index.html#gammapy-analysis">analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scripts/index.html#gammapy-check">check</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scripts/index.html#gammapy-download">download</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scripts/index.html#gammapy-info">info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scripts/index.html#gammapy-jupyter">jupyter</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stats/index.html">stats - Statistics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#notations">Notations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#counts-and-fit-statistics">Counts and fit statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#estimating-ts">Estimating TS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#counts-statistics-classes">Counts statistics classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#cash-counts-statistic">Cash counts statistic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#excess-and-significance">Excess and Significance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#excess-errors">Excess errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#wstat-counts-statistic">WStat counts statistic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#id2">Excess and Significance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#id4">Excess errors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#using-gammapy-stats">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.stats</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/fit_statistics.html">Fit statistics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../stats/fit_statistics.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/fit_statistics.html#cash-poisson-data-with-background-model">Cash : Poisson data with background model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/fit_statistics.html#wstat-poisson-data-with-background-measurement">WStat : Poisson data with background measurement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/fit_statistics.html#further-references">Further references</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../stats/wstat_derivation.html">Derivation of the WStat formula</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../stats/wstat_derivation.html#profile-likelihood">Profile Likelihood</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/wstat_derivation.html#goodness-of-fit">Goodness of fit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/wstat_derivation.html#final-result">Final result</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/wstat_derivation.html#special-cases">Special cases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#module-gammapy.stats">gammapy.stats Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stats/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">visualization - Plotting and Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualization/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#colormaps">Colormaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#survey-panel-plots">Survey Panel Plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visualization/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#module-gammapy.visualization">gammapy.visualization Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../visualization/index.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../visualization/index.html#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">utils - Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#time-handling-in-gammapy">Time handling in Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#time-format-and-scale">Time format and scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#mission-elapsed-times-met">Mission elapsed times (MET)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#time-differences">Time differences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.units">gammapy.utils.units Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.coordinates">gammapy.utils.coordinates Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id1">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#variables">Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.integrate">gammapy.utils.integrate Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id2">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.interpolation">gammapy.utils.interpolation Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id3">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.table">gammapy.utils.table Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id4">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.fits">gammapy.utils.fits Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id5">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id6">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.random">gammapy.utils.random Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id7">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id8">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.regions">gammapy.utils.regions Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id9">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.scripts">gammapy.utils.scripts Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id10">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.testing">gammapy.utils.testing Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id11">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id12">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.nddata">gammapy.utils.nddata Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id13">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.time">gammapy.utils.time Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/index.html#id14">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/intro.html">How to contribute to Gammapy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/setup.html">Gammapy project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/howto.html">Developer HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/release.html">How to make a Gammapy release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pigs/index.html">PIGs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-001.html">PIG 1 - PIG purpose and guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-002.html">PIG 2 - Organization of low-level analysis code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-003.html">PIG 3 - Plan for dropping Python 2.7 support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-004.html">PIG 4 - Setup for tutorial notebooks and data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-005.html">PIG 5 - Gammapy 1.0 Roadmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-006.html">PIG 6 - CTA observation handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-007.html">PIG 7 - Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-008.html">PIG 8 - Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-009.html">PIG 9 - Event Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-010.html">PIG 10 - Regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-011.html">PIG 11 - Light curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-012.html">PIG 12 - High-level interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-013.html">PIG 13 - Gammapy dependencies and distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-014.html">PIG 14 - Uncertainty estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-016.html">PIG 16 - Gammapy package structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-018.html">PIG 18 - Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-019.html">PIG 19 - Gammapy package structure follow up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-021.html">PIG 21 - Models Improvements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/dataformats.html">Data Formats</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gammapy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Modeling and fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/modeling.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>This is a fixed-text formatted version of a Jupyter notebook</strong></p>
<ul class="simple">
<li><p>Try online <a class="reference external" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/modeling.ipynb"><img alt="Binder" src="https://static.mybinder.org/badge.svg" /></a></p></li>
<li><p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy/tree/master/docs/tutorials">GitHub repository</a>.</p></li>
<li><p><strong>Source files:</strong> <a class="reference external" href="../_static/notebooks/modeling.ipynb">modeling.ipynb</a> | <a class="reference external" href="../_static/notebooks/modeling.py">modeling.py</a></p></li>
</ul>
</div>
<div class="section" id="Modeling-and-fitting">
<h1>Modeling and fitting<a class="headerlink" href="#Modeling-and-fitting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Knowledge of spectral analysis to produce 1D On-Off datasets, <a class="reference internal" href="spectrum_analysis.html"><span class="doc">see the following tutorial</span></a></p></li>
<li><p>Reading of pre-computed datasets <a class="reference internal" href="analysis_mwl.html"><span class="doc">see the MWL tutorial</span></a></p></li>
<li><p>General knowledge on statistics and optimization methods</p></li>
</ul>
</div>
<div class="section" id="Proposed-approach">
<h2>Proposed approach<a class="headerlink" href="#Proposed-approach" title="Permalink to this headline">¶</a></h2>
<p>This is a hands-on tutorial to <code class="docutils literal notranslate"><a href='../modeling/index.html'>gammapy.modeling</a></code>, showing how the model, dataset and fit classes work together. As an example we are going to work with HESS data of the Crab Nebula and show in particular how to : - perform a spectral analysis - use different fitting backends - acces covariance matrix informations and parameter errors - compute likelihood profile - compute confidence contours</p>
<p>See also: <a class="reference internal" href="models.html"><span class="doc">Models gallery tutorial</span></a> and <code class="docutils literal notranslate"><span class="pre">docs/modeling/index.rst</span></code>.</p>
</div>
<div class="section" id="The-setup">
<h2>The setup<a class="headerlink" href="#The-setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling</span> <span class="kn">import</span> <span class="n">Fit</span>
<span class="kn">from</span> <span class="nn">gammapy.datasets</span> <span class="kn">import</span> <span class="n">Datasets</span><span class="p">,</span> <span class="n">SpectrumDatasetOnOff</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">LogParabolaSpectralModel</span><span class="p">,</span> <span class="n">SkyModel</span>
<span class="kn">from</span> <span class="nn">gammapy.visualization.utils</span> <span class="kn">import</span> <span class="n">plot_contour_line</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Model-and-dataset">
<h2>Model and dataset<a class="headerlink" href="#Model-and-dataset" title="Permalink to this headline">¶</a></h2>
<p>First we define the source model, here we need only a spectral model for which we choose a log-parabola</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">crab_spectrum</span> <span class="o">=</span> <span class="n">LogParabolaSpectralModel</span><span class="p">(</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mf">1e-11</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">reference</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">crab_spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">crab_spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">crab_model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">crab_spectrum</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crab&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The data and background are read from pre-computed ON/OFF datasets of HESS observations, for simplicity we stack them together. Then we set the model and fit range to the resulting dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">obs_id</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">23523</span><span class="p">,</span> <span class="mi">23526</span><span class="p">]:</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">SpectrumDatasetOnOff</span><span class="o">.</span><span class="n">from_ogip_files</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;$GAMMAPY_DATA/joint-crab/spectra/hess/pha_obs</span><span class="si">{</span><span class="n">obs_id</span><span class="si">}</span><span class="s2">.fits&quot;</span>
    <span class="p">)</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="n">dataset_hess</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="o">.</span><span class="n">stack_reduce</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;HESS&quot;</span><span class="p">)</span>

<span class="c1"># Set model and fit range</span>
<span class="n">dataset_hess</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">crab_model</span>
<span class="n">e_min</span> <span class="o">=</span> <span class="mf">0.66</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">e_max</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">dataset_hess</span><span class="o">.</span><span class="n">mask_fit</span> <span class="o">=</span> <span class="n">dataset_hess</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">energy_mask</span><span class="p">(</span><span class="n">e_min</span><span class="p">,</span> <span class="n">e_max</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Fitting-options">
<h2>Fitting options<a class="headerlink" href="#Fitting-options" title="Permalink to this headline">¶</a></h2>
<p>First let’s create a <code class="docutils literal notranslate"><span class="pre">Fit</span></code> instance:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">Fit</span><span class="p">([</span><span class="n">dataset_hess</span><span class="p">],</span> <span class="n">store_trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>By default the fit is performed using MINUIT, you can select alternative optimizers and set their option using the <code class="docutils literal notranslate"><span class="pre">optimize_opts</span></code> argument of the <code class="docutils literal notranslate"><span class="pre">Fit.run()</span></code> method. In addition we have specified to store the trace of parameter values of the fit.</p>
<p>Note that, for now, covaraince matrix and errors are computed only for the fitting with MINUIT. However depending on the problem other optimizers can better perform, so somethimes it can be usefull to run a pre-fit with alternative optimization methods.</p>
<div class="line-block">
<div class="line">For the “scipy” backend the available options are desribed in detail here:</div>
<div class="line"><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html</a></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">scipy_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-05</span><span class="p">}}</span>
<span class="n">result_scipy</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;scipy&quot;</span><span class="p">,</span> <span class="n">optimize_opts</span><span class="o">=</span><span class="n">scipy_opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No covariance estimate - not supported by this backend.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 208 ms, sys: 2 ms, total: 210 ms
Wall time: 210 ms
</pre></div></div>
</div>
<div class="line-block">
<div class="line">For the “sherpa” backend you can choose the optimization algorithm between method = {“simplex”, “levmar”, “moncar”, “gridsearch”}.</div>
<div class="line">Those methods are described and compared in detail on <a class="reference external" href="http://cxc.cfa.harvard.edu/sherpa/methods/index.html">http://cxc.cfa.harvard.edu/sherpa/methods/index.html</a>.</div>
<div class="line">The available options of the optimization methods are described on the following page <a class="reference external" href="https://cxc.cfa.harvard.edu/sherpa/methods/opt_methods.html">https://cxc.cfa.harvard.edu/sherpa/methods/opt_methods.html</a></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">sherpa_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;simplex&quot;</span><span class="p">,</span> <span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="s2">&quot;maxfev&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)}</span>
<span class="n">results_simplex</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;sherpa&quot;</span><span class="p">,</span> <span class="n">optimize_opts</span><span class="o">=</span><span class="n">sherpa_opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No covariance estimate - not supported by this backend.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 471 ms, sys: 8.09 ms, total: 479 ms
Wall time: 488 ms
</pre></div></div>
</div>
<p>For the “minuit” backend see <a class="reference external" href="https://iminuit.readthedocs.io/en/latest/reference.html">https://iminuit.readthedocs.io/en/latest/reference.html</a> for a detailed description of the available options. If there is an entry ‘migrad_opts’, those options will be passed to <a class="reference external" href="https://iminuit.readthedocs.io/en/latest/reference.html#iminuit.Minuit.migrad">iminuit.Minuit.migrad</a>. Additionnaly you can set the fit tolerance using the <a class="reference external" href="https://iminuit.readthedocs.io/en/latest/reference.html#iminuit.Minuit.tol">tol</a> option. The minimization will stop when the
estimated distance to the minimum is less than 0.001*tol (by default tol=0.1). The <a class="reference external" href="https://iminuit.readthedocs.io/en/latest/reference.html#iminuit.Minuit.strategy">strategy</a> option change the speed and accuracy of the optimizer: 0 fast, 1 default, 2 slow but accurate. If you want more reliable error estimates, you should run the final fit with strategy 2.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">minuit_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tol&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">result_minuit</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;minuit&quot;</span><span class="p">,</span> <span class="n">optimize_opts</span><span class="o">=</span><span class="n">minuit_opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 145 ms, sys: 3.08 ms, total: 148 ms
Wall time: 153 ms
</pre></div></div>
</div>
</div>
<div class="section" id="Fit-quality-assessment">
<h2>Fit quality assessment<a class="headerlink" href="#Fit-quality-assessment" title="Permalink to this headline">¶</a></h2>
<p>There are various ways to check the convergence and quality of a fit. Among them:</p>
<ul class="simple">
<li><p>Refer to the automatically-generated results dictionary</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">result_scipy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OptimizeResult

        backend    : scipy
        method     : L-BFGS-B
        success    : True
        message    : b&#39;CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH&#39;
        nfev       : 60
        total stat : 30.35

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_simplex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OptimizeResult

        backend    : sherpa
        method     : simplex
        success    : True
        message    : Optimization terminated successfully
        nfev       : 135
        total stat : 30.35

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">result_minuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OptimizeResult

        backend    : minuit
        method     : minuit
        success    : True
        message    : Optimization terminated successfully.
        nfev       : 39
        total stat : 30.35

</pre></div></div>
</div>
<ul class="simple">
<li><p>Check the trace of the fit e.g. in case the fit did not converge properly</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result_minuit</span><span class="o">.</span><span class="n">trace</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<i>Table length=39</i>
<table id="table4801448536" class="table-striped table-bordered table-condensed">
<thead><tr><th>total_stat</th><th>crab.spectral.amplitude</th><th>crab.spectral.alpha</th><th>crab.spectral.beta</th></tr></thead>
<thead><tr><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>30.34953052852609</td><td>3.812199712807204e-11</td><td>2.1957469738566533</td><td>0.2264826943628319</td></tr>
<tr><td>30.351034173642805</td><td>3.822199712807204e-11</td><td>2.1957469738566533</td><td>0.2264826943628319</td></tr>
<tr><td>30.351002220499467</td><td>3.802199712807204e-11</td><td>2.1957469738566533</td><td>0.2264826943628319</td></tr>
<tr><td>30.34954724027155</td><td>3.813199712807204e-11</td><td>2.1957469738566533</td><td>0.2264826943628319</td></tr>
<tr><td>30.34954357006592</td><td>3.8111997128072045e-11</td><td>2.1957469738566533</td><td>0.2264826943628319</td></tr>
<tr><td>30.370145263807213</td><td>3.812199712807204e-11</td><td>2.2080054893554912</td><td>0.2264826943628319</td></tr>
<tr><td>30.37074319965505</td><td>3.812199712807204e-11</td><td>2.1834577934580546</td><td>0.2264826943628319</td></tr>
<tr><td>30.34973248878548</td><td>3.812199712807204e-11</td><td>2.196974237051734</td><td>0.2264826943628319</td></tr>
<tr><td>30.349746831225467</td><td>3.812199712807204e-11</td><td>2.194519404008612</td><td>0.2264826943628319</td></tr>
<tr><td>30.3495366889649</td><td>3.812199712807204e-11</td><td>2.195979011091453</td><td>0.2264826943628319</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>30.34953805634204</td><td>3.812174134402915e-11</td><td>2.195755431840351</td><td>0.22635139153323025</td></tr>
<tr><td>30.34953075274277</td><td>3.8123158974689993e-11</td><td>2.195755431840351</td><td>0.22648880390558834</td></tr>
<tr><td>30.349530736291847</td><td>3.812032371336831e-11</td><td>2.195755431840351</td><td>0.22648880390558834</td></tr>
<tr><td>30.34953078561551</td><td>3.812174134402915e-11</td><td>2.195801840090526</td><td>0.22648880390558834</td></tr>
<tr><td>30.349530703377614</td><td>3.812174134402915e-11</td><td>2.1957090231517693</td><td>0.22648880390558834</td></tr>
<tr><td>30.34953071751978</td><td>3.812174134402915e-11</td><td>2.195755431840351</td><td>0.22651628638005997</td></tr>
<tr><td>30.349530771463897</td><td>3.812174134402915e-11</td><td>2.195755431840351</td><td>0.22646132143111675</td></tr>
<tr><td>30.349535792731178</td><td>3.812882949733337e-11</td><td>2.195987468705072</td><td>0.22648880390558834</td></tr>
<tr><td>30.349537136721338</td><td>3.812882949733337e-11</td><td>2.195755431840351</td><td>0.22662621627794644</td></tr>
<tr><td>30.349559344539628</td><td>3.812174134402915e-11</td><td>2.195987468705072</td><td>0.22662621627794644</td></tr>
</table></div>
</div>
<ul class="simple">
<li><p>Check that the fitted values and errors for all parameters are reasonable, and no fitted parameter value is “too close” - or even outside - its allowed min-max range</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result_minuit</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<i>Table length=4</i>
<table id="table4518683536" class="table-striped table-bordered table-condensed">
<thead><tr><th>name</th><th>value</th><th>unit</th><th>min</th><th>max</th><th>frozen</th><th>error</th></tr></thead>
<thead><tr><th>str9</th><th>float64</th><th>str14</th><th>float64</th><th>float64</th><th>bool</th><th>float64</th></tr></thead>
<tr><td>amplitude</td><td>3.8122e-11</td><td>cm-2 s-1 TeV-1</td><td>nan</td><td>nan</td><td>False</td><td>3.546e-12</td></tr>
<tr><td>reference</td><td>1.0000e+00</td><td>TeV</td><td>nan</td><td>nan</td><td>True</td><td>0.000e+00</td></tr>
<tr><td>alpha</td><td>2.1958e+00</td><td></td><td>1.000e+00</td><td>3.000e+00</td><td>False</td><td>2.626e-01</td></tr>
<tr><td>beta</td><td>2.2649e-01</td><td></td><td>nan</td><td>nan</td><td>False</td><td>1.397e-01</td></tr>
</table></div>
</div>
<ul class="simple">
<li><p>Plot fit statistic profiles for all fitted prameters, using <code class="docutils literal notranslate"><a href='../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit.stat_profile'>gammapy.modeling.Fit.stat_profile()</a></code>. For a good fit and error estimate each profile should be parabolic</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">total_stat</span> <span class="o">=</span> <span class="n">result_minuit</span><span class="o">.</span><span class="n">total_stat</span>

<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">dataset_hess</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">frozen</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">stat_profile</span><span class="p">(</span><span class="n">parameter</span><span class="o">=</span><span class="n">par</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">profile</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_scan&quot;</span><span class="p">],</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;stat_scan&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">total_stat</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">par</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Delta TS&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">par</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">par</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_24_0.png" src="../_images/tutorials_modeling_24_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_24_1.png" src="../_images/tutorials_modeling_24_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_24_2.png" src="../_images/tutorials_modeling_24_2.png" />
</div>
</div>
<ul class="simple">
<li><p>Inspect model residuals. Those can always be accessed using <code class="docutils literal notranslate"><span class="pre">~Dataset.residuals()</span></code>, that will return an array in case a the fitted <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> is a <code class="docutils literal notranslate"><span class="pre">SpectrumDataset</span></code> and a full cube in case of a <code class="docutils literal notranslate"><span class="pre">MapDataset</span></code>. For more details, we refer here to the dedicated fitting tutorials: <a class="reference internal" href="analysis_3d.html"><span class="doc">analysis_3d.ipynb</span></a> (for <code class="docutils literal notranslate"><span class="pre">MapDataset</span></code> fitting) and <a class="reference internal" href="spectrum_analysis.html"><span class="doc">spectrum_analysis.ipynb</span></a> (for <code class="docutils literal notranslate"><span class="pre">SpectrumDataset</span></code> fitting).</p></li>
</ul>
</div>
<div class="section" id="Covariance-and-parameters-errors">
<h2>Covariance and parameters errors<a class="headerlink" href="#Covariance-and-parameters-errors" title="Permalink to this headline">¶</a></h2>
<p>After the fit the covariance matrix is attached to the model. You can get the error on a specific parameter by accessing the <code class="docutils literal notranslate"><span class="pre">.error</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">crab_model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">error</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.2625818166100611
</pre></div></div>
</div>
<p>As an example, this step is needed to produce a butterfly plot showing the envelope of the model taking into account parameter uncertainties.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">energy_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">crab_spectrum</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="n">energy_range</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">crab_spectrum</span><span class="o">.</span><span class="n">plot_error</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="n">energy_range</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_29_0.png" src="../_images/tutorials_modeling_29_0.png" />
</div>
</div>
</div>
<div class="section" id="Confidence-contours">
<h2>Confidence contours<a class="headerlink" href="#Confidence-contours" title="Permalink to this headline">¶</a></h2>
<p>In most studies, one wishes to estimate parameters distribution using observed sample data. A 1-dimensional confidence interval gives an estimated range of values which is likely to include an unknown parameter. A confidence contour is a 2-dimensional generalization of a confidence interval, often represented as an ellipsoid around the best-fit value.</p>
<p>Gammapy offers two ways of computing confidence contours, in the dedicated methods <code class="docutils literal notranslate"><span class="pre">Fit.minos_contour()</span></code> and <code class="docutils literal notranslate"><span class="pre">Fit.stat_profile()</span></code>. In the following sections we will describe them.</p>
<p>An important point to keep in mind is: <em>what does a :math:`Nsigma` confidence contour really mean?</em> The answer is it represents the points of the parameter space for which the model likelihood is <span class="math notranslate nohighlight">\(N\sigma\)</span> above the minimum. But one always has to keep in mind that <strong>1 standard deviation in two dimensions has a smaller coverage probability than 68%</strong>, and similarly for all other levels. In particular, in 2-dimensions the probability enclosed by the <span class="math notranslate nohighlight">\(N\sigma\)</span> confidence contour is
<span class="math notranslate nohighlight">\(P(N)=1-e^{-N^2/2}\)</span>.</p>
<div class="section" id="Computing-contours-using-Fit.minos_contour()">
<h3>Computing contours using <code class="docutils literal notranslate"><span class="pre">Fit.minos_contour()</span></code><a class="headerlink" href="#Computing-contours-using-Fit.minos_contour()" title="Permalink to this headline">¶</a></h3>
<p>After the fit, MINUIT offers the possibility to compute the confidence confours. gammapy provides an interface to this functionnality throught the <code class="docutils literal notranslate"><span class="pre">Fit</span></code> object using the <code class="docutils literal notranslate"><span class="pre">minos_contour</span></code> method. Here we defined a function to automatize the contour production for the differents parameterer and confidence levels (expressed in term of sigma):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">make_contours</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">):</span>
    <span class="n">cts_sigma</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sigma</span> <span class="ow">in</span> <span class="n">sigmas</span><span class="p">:</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">par_1</span><span class="p">,</span> <span class="n">par_2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">([</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;amplitude&quot;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">contour</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">minos_contour</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">par_1</span><span class="p">],</span>
                <span class="n">result</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">par_2</span><span class="p">],</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="n">npoints</span><span class="p">,</span>
                <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">contours</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;contour_</span><span class="si">{</span><span class="n">par_1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">par_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">par_1</span><span class="p">:</span> <span class="n">contour</span><span class="p">[</span><span class="n">par_1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">par_2</span><span class="p">:</span> <span class="n">contour</span><span class="p">[</span><span class="n">par_2</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="n">cts_sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cts_sigma</span>
</pre></div>
</div>
</div>
<p>Now we can compute few contours.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">cts_sigma</span> <span class="o">=</span> <span class="n">make_contours</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">result_minuit</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 13.9 s, sys: 124 ms, total: 14 s
Wall time: 14.5 s
</pre></div></div>
</div>
<p>Then we prepare some aliases and annotations in order to make the plotting nicer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\phi_0 \,/\,(10^{-11}\,{\rm TeV}^{-1} \, {\rm cm}^{-2} {\rm s}^{-1})$&quot;</span><span class="p">,</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\alpha$&quot;</span><span class="p">,</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\beta$&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">panels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;phi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_alpha_amplitude&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1e11</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_alpha_amplitude&quot;</span><span class="p">][</span><span class="s2">&quot;amplitude&quot;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;phi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_beta_amplitude&quot;</span><span class="p">][</span><span class="s2">&quot;beta&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1e11</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_beta_amplitude&quot;</span><span class="p">][</span><span class="s2">&quot;amplitude&quot;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_alpha_beta&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">ct</span><span class="p">:</span> <span class="n">ct</span><span class="p">[</span><span class="s2">&quot;contour_alpha_beta&quot;</span><span class="p">][</span><span class="s2">&quot;beta&quot;</span><span class="p">]),</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Finally we produce the confidence contours figures.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]]</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">ks</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cts_sigma</span><span class="p">)):</span>
        <span class="n">plot_contour_line</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;cx&quot;</span><span class="p">](</span><span class="n">cts_sigma</span><span class="p">[</span><span class="n">ks</span><span class="p">]),</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;cy&quot;</span><span class="p">](</span><span class="n">cts_sigma</span><span class="p">[</span><span class="n">ks</span><span class="p">]),</span>
            <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">ks</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sigma</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\sigma$&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_40_0.png" src="../_images/tutorials_modeling_40_0.png" />
</div>
</div>
</div>
<div class="section" id="Computing-contours-using-Fit.stat_surface()">
<h3>Computing contours using <code class="docutils literal notranslate"><span class="pre">Fit.stat_surface()</span></code><a class="headerlink" href="#Computing-contours-using-Fit.stat_surface()" title="Permalink to this headline">¶</a></h3>
<p>This alternative method for the computation of confidence contours, although more time consuming than <code class="docutils literal notranslate"><span class="pre">Fit.minos_contour()</span></code>, is expected to be more stable. It consists of a generalization of <code class="docutils literal notranslate"><span class="pre">Fit.stat_profile()</span></code> to a 2-dimensional parameter space. The algorithm is very simple: - First, passing two arrays of parameters values, a 2-dimensional discrete parameter space is defined; - For each node of the parameter space, the two parameters of interest are frozen. This way, a likelihood value
(<span class="math notranslate nohighlight">\(-2\mathrm{ln}\,\mathcal{L}\)</span>, actually) is computed, by either freezing (default) or fitting all nuisance parameters; - Finally, a 2-dimensional surface of <span class="math notranslate nohighlight">\(-2\mathrm{ln}(\mathcal{L})\)</span> values is returned. Using that surface, one can easily compute a surface of <span class="math notranslate nohighlight">\(TS = -2\Delta\mathrm{ln}(\mathcal{L})\)</span> and compute confidence contours.</p>
<p>Let’s see it step by step.</p>
<p>First of all, we can notice that this method is “backend-agnostic”, meaning that it can be run with MINUIT, sherpa or scipy as fitting tools. Here we will stick with MINUIT, which is the default choice:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimize_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="s2">&quot;minuit&quot;</span><span class="p">,</span> <span class="s2">&quot;print_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>As an example, we can compute the confidence contour for the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> parameters of the <code class="docutils literal notranslate"><span class="pre">dataset_hess</span></code>. Here we define the parameter space:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span> <span class="o">=</span> <span class="n">result_minuit</span>
<span class="n">par_1</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
<span class="n">par_2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">par_1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">par_2</span>
<span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we run the algorithm, by choosing <code class="docutils literal notranslate"><span class="pre">reoptimize=False</span></code> for the sake of time saving. In real life applications, we strongly recommend to use <code class="docutils literal notranslate"><span class="pre">reoptimize=True</span></code>, so that all free nuisance parameters will be fit at each grid node. This is the correct way, statistically speaking, of computing confidence contours, but is expected to be time consuming.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stat_surface</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">stat_surface</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">reoptimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">optimize_opts</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>In order to easily inspect the results, we can convert the <span class="math notranslate nohighlight">\(-2\mathrm{ln}(\mathcal{L})\)</span> surface to a surface of statistical significance (in units of Gaussian standard deviations from the surface minimum):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute TS</span>
<span class="n">TS</span> <span class="o">=</span> <span class="n">stat_surface</span><span class="p">[</span><span class="s2">&quot;stat_scan&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">total_stat</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute the corresponding statistical significance surface</span>
<span class="n">gaussian_sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">TS</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Notice that, as explained before, <span class="math notranslate nohighlight">\(1\sigma\)</span> contour obtained this way will not contain 68% of the probability, but rather</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute the corresponding statistical significance surface</span>
<span class="c1"># p_value = 1 - st.chi2(df=1).cdf(TS)</span>
<span class="c1"># gaussian_sigmas = st.norm.isf(p_value / 2).T</span>
</pre></div>
</div>
</div>
<p>Finally, we can plot the surface values together with contours:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># We choose to plot 1 and 2 sigma confidence contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">contours</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">gaussian_sigmas</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">$\,\sigma$&quot;</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">gaussian_sigmas</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_values</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_modeling_55_0.png" src="../_images/tutorials_modeling_55_0.png" />
</div>
</div>
<p>Note that, if computed with <code class="docutils literal notranslate"><span class="pre">reoptimize=True</span></code>, this plot would be completely consistent with the third panel of the plot produced with <code class="docutils literal notranslate"><span class="pre">Fit.minos_contour</span></code> (try!).</p>
<p>Finally, it is always remember that confidence contours are approximations. In particular, when the parameter range boundaries are close to the contours lines, it is expected that the statistical meaning of the countours is not well defined. That’s why we advise to always choose a parameter space that com contain the contours you’re interested in.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="models.html" class="btn btn-neutral float-right" title="Gammapy Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="maps.html" class="btn btn-neutral float-left" title="Gammapy Maps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The Gammapy developers
      <span class="lastupdated">
        Last updated on 06 Nov 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>