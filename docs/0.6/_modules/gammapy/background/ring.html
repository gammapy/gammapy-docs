<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gammapy.background.ring &#8212; gammapy v0.6</title>
    
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.gammapy.org/en/latest/_modules/gammapy/background/ring.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = '_modules/gammapy/background/ring'
</script>

<script type="text/javascript" src="../../../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.6</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.background.ring</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;Ring background estimation.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="k">import</span> <span class="n">Ring2DKernel</span><span class="p">,</span> <span class="n">Tophat2DKernel</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">..image</span> <span class="k">import</span> <span class="n">SkyImageList</span><span class="p">,</span> <span class="n">SkyImage</span>
<span class="kn">from</span> <span class="nn">..image.utils</span> <span class="k">import</span> <span class="n">scale_cube</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;AdaptiveRingBackgroundEstimator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RingBackgroundEstimator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ring_r_out&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ring_area_factor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ring_alpha&#39;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="AdaptiveRingBackgroundEstimator"><a class="viewcode-back" href="../../../api/gammapy.background.AdaptiveRingBackgroundEstimator.html#gammapy.background.AdaptiveRingBackgroundEstimator">[docs]</a><span class="k">class</span> <span class="nc">AdaptiveRingBackgroundEstimator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adaptive ring background algorithm.</span>

<span class="sd">    This algorithm extends the standard `RingBackground` method by adapting the</span>
<span class="sd">    size of the ring to achieve a minimum on / off exposure ratio (alpha) in regions</span>
<span class="sd">    where the area to estimate the background from is limited.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_in : `~astropy.units.Quantity`</span>
<span class="sd">        Inner radius of the ring.</span>
<span class="sd">    r_out_max : `~astropy.units.Quantity`</span>
<span class="sd">        Maximal outer radius of the ring.</span>
<span class="sd">    width : `~astropy.units.Quantity`</span>
<span class="sd">        Width of the ring.</span>
<span class="sd">    stepsize : `~astropy.units.Quantity`</span>
<span class="sd">        Stepsize used for increasing the radius.</span>
<span class="sd">    threshold_alpha : float</span>
<span class="sd">        Threshold on alpha above which the adaptive ring takes action.</span>
<span class="sd">    theta : `~astropy.units.Quantity`</span>
<span class="sd">        Integration radius used for alpha computation.</span>
<span class="sd">    method : {&#39;fixed_width&#39;, &#39;fixed_r_in&#39;}</span>
<span class="sd">        Adaptive ring method.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here&#39;s an example how to use the `AdaptiveRingBackgroundEstimator`:</span>

<span class="sd">    .. code::</span>

<span class="sd">        from astropy import units as u</span>
<span class="sd">        from gammapy.background import AdaptiveRingBackgroundEstimator</span>
<span class="sd">        from gammapy.image import SkyImageList</span>

<span class="sd">        filename = &#39;$GAMMAPY_EXTRA/test_datasets/unbundled/poisson_stats_image/input_all.fits.gz&#39;</span>
<span class="sd">        images = SkyImageList.read(filename)</span>
<span class="sd">        images[&#39;exposure&#39;].name = &#39;exposure_on&#39;</span>
<span class="sd">        adaptive_ring_bkg = RingBackgroundEstimator(r_in=0.22 * u.deg,</span>
<span class="sd">                                                    r_out_max=0.8 * u.deg,</span>
<span class="sd">                                                    width=0.1 * u.deg)</span>
<span class="sd">        results = adaptive_ring_bkg.run(images)</span>
<span class="sd">        results[&#39;background&#39;].show()</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    RingBackgroundEstimator, gammapy.detect.KernelBackgroundEstimator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">r_out_max</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                 <span class="n">threshold_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.22</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fixed_width&#39;</span><span class="p">):</span>
        <span class="c1"># input validation</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fixed_width&#39;</span><span class="p">,</span> <span class="s1">&#39;fixed_r_in&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not a valid adaptive ring method.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">r_in</span><span class="o">=</span><span class="n">r_in</span><span class="p">,</span> <span class="n">r_out_max</span><span class="o">=</span><span class="n">r_out_max</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                      <span class="n">stepsize</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">threshold_alpha</span><span class="o">=</span><span class="n">threshold_alpha</span><span class="p">,</span>
                                      <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>

<div class="viewcode-block" id="AdaptiveRingBackgroundEstimator.kernels"><a class="viewcode-back" href="../../../api/gammapy.background.AdaptiveRingBackgroundEstimator.html#gammapy.background.AdaptiveRingBackgroundEstimator.kernels">[docs]</a>    <span class="k">def</span> <span class="nf">kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ring kernels according to the specified method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        image : `~gammapy.image.SkyImage`</span>
<span class="sd">            Sky image specifying the WCS information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        kernels : list</span>
<span class="sd">            List of `~astropy.convolution.Ring2DKernel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">wcs_pixel_scale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r_in</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="n">r_out_max</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_out_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;stepsize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>

        <span class="n">kernels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fixed_width&#39;</span><span class="p">:</span>
            <span class="n">r_ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r_in</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">r_out_max</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fixed_r_in&#39;</span><span class="p">:</span>
            <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">width</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">r_out_max</span> <span class="o">-</span> <span class="n">r_in</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">r_ins</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_in</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">r_ins</span><span class="p">,</span> <span class="n">widths</span><span class="p">):</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">Ring2DKernel</span><span class="p">(</span><span class="n">r_in</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="n">kernel</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;peak&#39;</span><span class="p">)</span>
            <span class="n">kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kernels</span></div>

    <span class="k">def</span> <span class="nf">_alpha_approx_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cubes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute alpha as on_exposure / off_exposure.</span>

<span class="sd">        Where off_exposure &lt; 0, alpha is set to infinity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exposure_on</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;exposure_on&#39;</span><span class="p">]</span>
        <span class="n">exposure_off</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span>

        <span class="n">alpha_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">exposure_off</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exposure_on</span> <span class="o">/</span> <span class="n">exposure_off</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alpha_approx</span>

    <span class="k">def</span> <span class="nf">_exposure_off_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute off exposure cube.</span>

<span class="sd">        The on exposure is convolved with different</span>
<span class="sd">        ring kernels and stacking the data along the third dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exposure</span>  <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;exposure_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">exclusion</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;exclusion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">scale_cube</span><span class="p">(</span><span class="n">exposure</span> <span class="o">*</span> <span class="n">exclusion</span><span class="p">,</span> <span class="n">kernels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_exposure_on_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute on exposure cube.</span>

<span class="sd">        Calculated by convolving the on exposure with a tophat</span>
<span class="sd">        of radius theta, and stacking all images along the third dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">convolve</span>

        <span class="n">exposure_on</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;exposure_on&#39;</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">exposure_on</span><span class="o">.</span><span class="n">wcs_pixel_scale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span>

        <span class="n">tophat</span> <span class="o">=</span> <span class="n">Tophat2DKernel</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">tophat</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;peak&#39;</span><span class="p">)</span>
        <span class="n">exposure_on</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">exposure_on</span><span class="p">,</span> <span class="n">tophat</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="n">exposure_on_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">exposure_on</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernels</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exposure_on_cube</span>

    <span class="k">def</span> <span class="nf">_off_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute off cube.</span>

<span class="sd">        Calculated by convolving the raw counts with different ring kernels</span>
<span class="sd">        and stacking the data along the third dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">exclusion</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;exclusion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">scale_cube</span><span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="n">exclusion</span><span class="p">,</span> <span class="n">kernels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reduce_cubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cubes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute off and off exposure map.</span>

<span class="sd">        Calulated by reducing the cubes. The data is</span>
<span class="sd">        iterated along the third axis (i.e. increasing ring sizes), the value</span>
<span class="sd">        with the first approximate alpha &lt; threshold is taken.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;threshold_alpha&#39;</span><span class="p">]</span>

        <span class="n">alpha_approx_cube</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;alpha_approx&#39;</span><span class="p">]</span>
        <span class="n">off_cube</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">]</span>
        <span class="n">exposure_off_cube</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">alpha_approx_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="n">exposure_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">alpha_approx_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_approx_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
            <span class="n">off</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">off_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">exposure_off</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">exposure_off_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">exposure_off</span><span class="p">,</span> <span class="n">off</span>

<div class="viewcode-block" id="AdaptiveRingBackgroundEstimator.run"><a class="viewcode-back" href="../../../api/gammapy.background.AdaptiveRingBackgroundEstimator.html#gammapy.background.AdaptiveRingBackgroundEstimator.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run adaptive ring background algorithm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        images : `SkyImageList`</span>
<span class="sd">            Input sky images.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `SkyImageList`</span>
<span class="sd">            Result sky images.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span> <span class="s1">&#39;exposure_on&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusion&#39;</span><span class="p">]</span>
        <span class="n">images</span><span class="o">.</span><span class="n">check_required</span><span class="p">(</span><span class="n">required</span><span class="p">)</span>
        <span class="n">wcs</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">cubes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">kernels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">])</span>

        <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;exposure_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exposure_on_cube</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">)</span>
        <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exposure_off_cube</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">)</span>
        <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_off_cube</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">kernels</span><span class="p">)</span>
        <span class="n">cubes</span><span class="p">[</span><span class="s1">&#39;alpha_approx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_approx_cube</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>

        <span class="n">exposure_off</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_cubes</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;exposure_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">exposure_off</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">off</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">SkyImageList</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">exposure_off</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">off</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">background</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="RingBackgroundEstimator"><a class="viewcode-back" href="../../../api/gammapy.background.RingBackgroundEstimator.html#gammapy.background.RingBackgroundEstimator">[docs]</a><span class="k">class</span> <span class="nc">RingBackgroundEstimator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ring background method for cartesian coordinates.</span>

<span class="sd">    Step 1: apply exclusion mask</span>
<span class="sd">    Step 2: ring-correlate</span>
<span class="sd">    Step 3: apply psi cut</span>

<span class="sd">    TODO: add method to apply the psi cut</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_in : `~astropy.units.Quantity`</span>
<span class="sd">        Inner ring radius</span>
<span class="sd">    width : `~astropy.units.Quantity`</span>
<span class="sd">        Ring width.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here&#39;s an example how to use the `RingBackgroundEstimator`:</span>

<span class="sd">    .. code::</span>

<span class="sd">        from astropy import units as u</span>
<span class="sd">        from gammapy.background import RingBackgroundEstimator</span>
<span class="sd">        from gammapy.image import SkyImageList</span>

<span class="sd">        filename = &#39;$GAMMAPY_EXTRA/test_datasets/unbundled/poisson_stats_image/input_all.fits.gz&#39;</span>
<span class="sd">        images = SkyImageList.read(filename)</span>
<span class="sd">        images[&#39;exposure&#39;].name = &#39;exposure_on&#39;</span>
<span class="sd">        ring_bkg = RingBackgroundEstimator(r_in=0.35 * u.deg, width=0.3 * u.deg)</span>
<span class="sd">        results = ring_bkg.run(images)</span>
<span class="sd">        results[&#39;background&#39;].show()</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gammapy.detect.KernelBackgroundEstimator, AdaptiveRingBackgroundEstimator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">r_in</span><span class="o">=</span><span class="n">r_in</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>

<div class="viewcode-block" id="RingBackgroundEstimator.kernel"><a class="viewcode-back" href="../../../api/gammapy.background.RingBackgroundEstimator.html#gammapy.background.RingBackgroundEstimator.kernel">[docs]</a>    <span class="k">def</span> <span class="nf">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ring kernel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        image : `gammapy.image.SkyImage`</span>
<span class="sd">            Image</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ring : `~astropy.convolution.Ring2DKernel`</span>
<span class="sd">            Ring kernel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">wcs_pixel_scale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r_in</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>

        <span class="n">ring</span> <span class="o">=</span> <span class="n">Ring2DKernel</span><span class="p">(</span><span class="n">r_in</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">width</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ring</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;peak&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ring</span></div>

<div class="viewcode-block" id="RingBackgroundEstimator.run"><a class="viewcode-back" href="../../../api/gammapy.background.RingBackgroundEstimator.html#gammapy.background.RingBackgroundEstimator.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run ring background algorithm.</span>

<span class="sd">        Required sky images: {required}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        images : `SkyImageList`</span>
<span class="sd">            Input sky images.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `SkyImageList`</span>
<span class="sd">            Result sky images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span> <span class="s1">&#39;exposure_on&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusion&#39;</span><span class="p">]</span>
        <span class="n">images</span><span class="o">.</span><span class="n">check_required</span><span class="p">(</span><span class="n">required</span><span class="p">)</span>
        <span class="n">counts</span><span class="p">,</span> <span class="n">exposure_on</span><span class="p">,</span> <span class="n">exclusion</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">required</span><span class="p">]</span>
        <span class="n">wcs</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">SkyImageList</span><span class="p">()</span>
        <span class="n">ring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>

        <span class="n">counts_excluded</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">exclusion</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts_excluded</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>

        <span class="n">exposure_on_excluded</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">exposure_on</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">exclusion</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exposure_on_excluded</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">exposure_on</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;exposure_off&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="RingBackgroundEstimator.info"><a class="viewcode-back" href="../../../api/gammapy.background.RingBackgroundEstimator.html#gammapy.background.RingBackgroundEstimator.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print summary info about the parameters.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation of the class.&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;RingBackground parameters: </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s1">&#39;r_in : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;r_in&#39;</span><span class="p">])</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s1">&#39;width: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="ring_r_out"><a class="viewcode-back" href="../../../api/gammapy.background.ring_r_out.html#gammapy.background.ring_r_out">[docs]</a><span class="k">def</span> <span class="nf">ring_r_out</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">area_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute ring outer radius.</span>

<span class="sd">    The determining equation is:</span>
<span class="sd">        area_factor =</span>
<span class="sd">        off_area / on_area =</span>
<span class="sd">        (pi (r_out**2 - r_in**2)) / (pi * theta**2 )</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta : float</span>
<span class="sd">        On region radius</span>
<span class="sd">    r_in : float</span>
<span class="sd">        Inner ring radius</span>
<span class="sd">    area_factor : float</span>
<span class="sd">        Desired off / on area ratio</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r_out : float</span>
<span class="sd">        Outer ring radius</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area_factor</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">r_in</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="ring_area_factor"><a class="viewcode-back" href="../../../api/gammapy.background.ring_area_factor.html#gammapy.background.ring_area_factor">[docs]</a><span class="k">def</span> <span class="nf">ring_area_factor</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">r_out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute ring area factor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta : float</span>
<span class="sd">        On region radius</span>
<span class="sd">    r_in : float</span>
<span class="sd">        Inner ring radius</span>
<span class="sd">    r_out : float</span>
<span class="sd">        Outer ring radius</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r_out</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">r_in</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">theta</span> <span class="o">**</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="ring_alpha"><a class="viewcode-back" href="../../../api/gammapy.background.ring_alpha.html#gammapy.background.ring_alpha">[docs]</a><span class="k">def</span> <span class="nf">ring_alpha</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">r_out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute ring alpha, the inverse area factor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta : float</span>
<span class="sd">        On region radius</span>
<span class="sd">    r_in : float</span>
<span class="sd">        Inner ring radius</span>
<span class="sd">    r_out : float</span>
<span class="sd">        Outer ring radius</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">ring_area_factor</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">r_in</span><span class="p">,</span> <span class="n">r_out</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="ring.html#">Back to Top</a></p>
  <p>
    &copy; Copyright 2017, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.5. &nbsp;
    Last built 28 Apr 2017. <br/>
  </p>
</footer>
  </body>
</html>