<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gammapy.data.data_store &#8212; gammapy v0.6</title>
    
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.gammapy.org/en/latest/_modules/gammapy/data/data_store.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = '_modules/gammapy/data/data_store'
</script>

<script type="text/javascript" src="../../../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.6</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >Module code</a> &#187;</li>
      <li><a href="../data.html" accesskey="U">gammapy.data</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.data.data_store</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">astropy.extern.six.moves</span> <span class="k">import</span> <span class="n">UserList</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.utils</span> <span class="k">import</span> <span class="n">lazyproperty</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="k">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="k">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">..utils.scripts</span> <span class="k">import</span> <span class="n">make_path</span>
<span class="kn">from</span> <span class="nn">..utils.energy</span> <span class="k">import</span> <span class="n">Energy</span>
<span class="kn">from</span> <span class="nn">.obs_table</span> <span class="k">import</span> <span class="n">ObservationTable</span>
<span class="kn">from</span> <span class="nn">.hdu_index_table</span> <span class="k">import</span> <span class="n">HDUIndexTable</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">_earth_location_from_dict</span>
<span class="kn">from</span> <span class="nn">..irf</span> <span class="k">import</span> <span class="n">EnergyDependentTablePSF</span><span class="p">,</span> <span class="n">IRFStacker</span><span class="p">,</span> <span class="n">PSF3D</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;DataStore&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DataStoreObservation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ObservationList&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="DataStore"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore">[docs]</a><span class="k">class</span> <span class="nc">DataStore</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;IACT data store.</span>

<span class="sd">    The data selection and access happens using an observation</span>
<span class="sd">    and an HDU index file as described at :ref:`gadf:iact-storage`.</span>

<span class="sd">    See :ref:`data_store` or :gp-extra-notebook:`data_iact` for usage examples.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hdu_table : `~gammapy.data.HDUIndexTable`</span>
<span class="sd">        HDU index table</span>
<span class="sd">    obs_table : `~gammapy.data.ObservationTable`</span>
<span class="sd">        Observation index table</span>
<span class="sd">    name : str</span>
<span class="sd">        Data store name</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here&#39;s an example how to create a `DataStore` to access H.E.S.S. data:</span>

<span class="sd">    &gt;&gt;&gt; from gammapy.data import DataStore</span>
<span class="sd">    &gt;&gt;&gt; dir = &#39;$GAMMAPY_EXTRA/datasets/hess-crab4-hd-hap-prod2&#39;</span>
<span class="sd">    &gt;&gt;&gt; data_store = DataStore.from_dir(dir)</span>
<span class="sd">    &gt;&gt;&gt; data_store.info()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_HDU_TABLE</span> <span class="o">=</span> <span class="s1">&#39;hdu-index.fits.gz&#39;</span>
    <span class="sd">&quot;&quot;&quot;Default HDU table filename.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_OBS_TABLE</span> <span class="o">=</span> <span class="s1">&#39;obs-index.fits.gz&#39;</span>
    <span class="sd">&quot;&quot;&quot;Default observation table filename.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_NAME</span> <span class="o">=</span> <span class="s1">&#39;noname&#39;</span>
    <span class="sd">&quot;&quot;&quot;Default data store name.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdu_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obs_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdu_table</span> <span class="o">=</span> <span class="n">hdu_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span> <span class="o">=</span> <span class="n">obs_table</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_NAME</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataStore.from_files"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.from_files">[docs]</a>    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">hdu_table_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obs_table_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct from HDU and observation index table files.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hdu_table_filename</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdu_table_filename</span><span class="p">))</span>
            <span class="n">hdu_table</span> <span class="o">=</span> <span class="n">HDUIndexTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hdu_table_filename</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">)</span>

            <span class="n">hdu_table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;BASE_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hdu_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">obs_table_filename</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs_table_filename</span><span class="p">)))</span>
            <span class="n">obs_table</span> <span class="o">=</span> <span class="n">ObservationTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs_table_filename</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obs_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">hdu_table</span><span class="o">=</span><span class="n">hdu_table</span><span class="p">,</span>
            <span class="n">obs_table</span><span class="o">=</span><span class="n">obs_table</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataStore.from_dir"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.from_dir">[docs]</a>    <span class="k">def</span> <span class="nf">from_dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create from a directory.</span>

<span class="sd">        This assumes that the HDU and observations index tables</span>
<span class="sd">        have the default filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">make_path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span>
            <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span>
            <span class="n">hdu_table_filename</span><span class="o">=</span><span class="n">base_dir</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_HDU_TABLE</span><span class="p">,</span>
            <span class="n">obs_table_filename</span><span class="o">=</span><span class="n">base_dir</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_OBS_TABLE</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataStore.from_config"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.from_config">[docs]</a>    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create from a config dict.&quot;&quot;&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;base_dir&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_NAME</span><span class="p">)</span>
        <span class="n">hdu_table_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hduindx&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_HDU_TABLE</span><span class="p">)</span>
        <span class="n">obs_table_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obsindx&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_OBS_TABLE</span><span class="p">)</span>

        <span class="n">hdu_table_filename</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_find_file</span><span class="p">(</span><span class="n">hdu_table_filename</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">)</span>
        <span class="n">obs_table_filename</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_find_file</span><span class="p">(</span><span class="n">obs_table_filename</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span>
            <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span>
            <span class="n">hdu_table_filename</span><span class="o">=</span><span class="n">hdu_table_filename</span><span class="p">,</span>
            <span class="n">obs_table_filename</span><span class="o">=</span><span class="n">obs_table_filename</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find a file at an absolute or relative location.</span>

<span class="sd">        - First tries ``Path(filename)``</span>
<span class="sd">        - Second tries ``Path(dir) / filename``</span>
<span class="sd">        - Raises ``OSError`` if both don&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path1</span> <span class="o">=</span> <span class="n">make_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">path2</span> <span class="o">=</span> <span class="n">make_path</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="n">path1</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">path1</span>
        <span class="k">elif</span> <span class="n">path2</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">path2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s1">&#39;File not found at </span><span class="si">{}</span><span class="s1"> or </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">filename</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataStore.from_name"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.from_name">[docs]</a>    <span class="k">def</span> <span class="nf">from_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience method to look up DataStore from DataManager.&quot;&quot;&quot;</span>
        <span class="c1"># This import needs to be delayed to avoid a circular import</span>
        <span class="c1"># It can&#39;t be moved to the top of the file</span>
        <span class="kn">from</span> <span class="nn">.data_manager</span> <span class="k">import</span> <span class="n">DataManager</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">DataManager</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataStore.from_all"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.from_all">[docs]</a>    <span class="k">def</span> <span class="nf">from_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try different DataStore constructors.</span>

<span class="sd">        Currently tried (in this order)</span>
<span class="sd">        - :func:`~gammapy.data.DataStore.from_dir`</span>
<span class="sd">        - :func:`~gammapy.data.DataStore.from_name`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : str</span>
<span class="sd">            Key to construct DataStore from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">store</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">store</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not able to contruct DataStore using key:&#39;</span>
                                 <span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">Errors</span><span class="se">\n</span><span class="s1">from_dir: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">from_name: </span><span class="si">{2}</span><span class="s1">&#39;</span>
                                 <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">store</span></div>

<div class="viewcode-block" id="DataStore.info"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print some info.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data store summary info:&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;name: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdu_table</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataStore.obs"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.obs">[docs]</a>    <span class="k">def</span> <span class="nf">obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Access a given `~gammapy.data.DataStoreObservation`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obs_id : int</span>
<span class="sd">            Observation ID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obs : `~gammapy.data.DataStoreObservation`</span>
<span class="sd">            Observation container</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataStoreObservation</span><span class="p">(</span>
            <span class="n">obs_id</span><span class="o">=</span><span class="n">obs_id</span><span class="p">,</span>
            <span class="n">data_store</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="DataStore.obs_list"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.obs_list">[docs]</a>    <span class="k">def</span> <span class="nf">obs_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a `~gammapy.data.ObservationList`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obs_id : list</span>
<span class="sd">            Observation IDs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obs : `~gammapy.data.ObservationList`</span>
<span class="sd">            List of `~gammapy.data.DataStoreObservation`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ObservationList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">obs_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataStore.load_all"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.load_all">[docs]</a>    <span class="k">def</span> <span class="nf">load_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdu_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a given file type for all observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdu_type : str</span>
<span class="sd">            HDU type (see `~gammapy.data.HDUIndexTable.VALID_HDU_TYPE`)</span>
<span class="sd">        hdu_class : str</span>
<span class="sd">            HDU class (see `~gammapy.data.HDUIndexTable.VALID_HDU_CLASS`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : python list of object</span>
<span class="sd">            Object depends on type, e.g. for `events` it is a list of `~gammapy.data.EventList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_many</span><span class="p">(</span><span class="n">obs_ids</span><span class="o">=</span><span class="n">obs_ids</span><span class="p">,</span> <span class="n">hdu_type</span><span class="o">=</span><span class="n">hdu_type</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="n">hdu_class</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataStore.load_many"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.load_many">[docs]</a>    <span class="k">def</span> <span class="nf">load_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_ids</span><span class="p">,</span> <span class="n">hdu_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a given file type for certain observations in an observation table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obs_ids : list</span>
<span class="sd">            List of observation IDs</span>
<span class="sd">        hdu_type : str</span>
<span class="sd">            HDU type (see `~gammapy.data.HDUIndexTable.VALID_HDU_TYPE`)</span>
<span class="sd">        hdu_class : str</span>
<span class="sd">            HDU class (see `~gammapy.data.HDUIndexTable.VALID_HDU_CLASS`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : list of object</span>
<span class="sd">            Object depends on type, e.g. for `events` it is a list of `~gammapy.data.EventList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">things</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obs_id</span> <span class="ow">in</span> <span class="n">obs_ids</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="n">obs_id</span><span class="p">)</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="n">hdu_type</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="n">hdu_class</span><span class="p">)</span>
            <span class="n">things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">things</span></div>

<div class="viewcode-block" id="DataStore.check_integrity"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.check_integrity">[docs]</a>    <span class="k">def</span> <span class="nf">check_integrity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check integrity, i.e. whether index and observation table match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Todo: This is broken - remove or fix?</span>
        <span class="n">sane</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Checking event list files&#39;</span><span class="p">)</span>
        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_available_event_lists</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">available</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Number of missing event list files: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>

        <span class="c1"># TODO: implement better, more complete integrity checks.</span>
        <span class="k">return</span> <span class="n">sane</span></div>

<div class="viewcode-block" id="DataStore.make_table_of_files"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.make_table_of_files">[docs]</a>    <span class="k">def</span> <span class="nf">make_table_of_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filetypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Make list of files in the datastore directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_table : `~gammapy.data.ObservationTable` or None</span>
<span class="sd">            Observation table (``None`` means select all observations).</span>
<span class="sd">        filetypes : list of str</span>
<span class="sd">            File types (TODO: document in a central location and reference from here).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : `~astropy.table.Table`</span>
<span class="sd">            Table summarising info about files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : remove or fix</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="k">if</span> <span class="n">observation_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">observation_table</span> <span class="o">=</span> <span class="n">ObservationTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">observation_table</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filetype</span> <span class="ow">in</span> <span class="n">filetypes</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">observation</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span>
                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;filetype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filetype</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">observation</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">],</span> <span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span><span class="p">,</span> <span class="n">abspath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;filetype&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="DataStore.check_available_event_lists"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.check_available_event_lists">[docs]</a>    <span class="k">def</span> <span class="nf">check_available_event_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if all event lists are available.</span>

<span class="sd">        TODO: extend this function, or combine e.g. with ``make_table_of_files``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        file_available : `~numpy.ndarray`</span>
<span class="sd">            Boolean mask which files are available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: This is broken. Remove (covered by HDUlocation class)?</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="n">observation_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span>
        <span class="n">file_available</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_table</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_table</span><span class="p">)):</span>
            <span class="n">obs_id</span> <span class="o">=</span> <span class="n">observation_table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">obs_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">make_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">file_available</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;For OBS_ID = </span><span class="si">{:06d}</span><span class="s1"> the event list file is missing: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                   <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">file_available</span></div>

<div class="viewcode-block" id="DataStore.copy_obs"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.copy_obs">[docs]</a>    <span class="k">def</span> <span class="nf">copy_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_id</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new `~gammapy.data.DataStore` containing a subset of observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obs_id : array-like, `~gammapy.data.ObservationTable`</span>
<span class="sd">            List of observations to copy</span>
<span class="sd">        outdir : str, Path</span>
<span class="sd">            Directory for the new store</span>
<span class="sd">        hdu_class : list of str</span>
<span class="sd">            see :attr:`gammapy.data.HDUIndexTable.VALID_HDU_CLASS`</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            Print copied files</span>
<span class="sd">        clobber : bool</span>
<span class="sd">            Overwrite</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : Does rsync give any benefits here?</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="n">make_path</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">ObservationTable</span><span class="p">):</span>
            <span class="n">obs_id</span> <span class="o">=</span> <span class="n">obs_id</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="n">hdutable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu_table</span>
        <span class="n">hdutable</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">hdutable</span><span class="o">.</span><span class="n">index_mode</span><span class="p">(</span><span class="s1">&#39;discard_on_copy&#39;</span><span class="p">):</span>
            <span class="n">subhdutable</span> <span class="o">=</span> <span class="n">hdutable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hdu_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subhdutable</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="s1">&#39;HDU_CLASS&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">subhdutable</span><span class="o">.</span><span class="n">index_mode</span><span class="p">(</span><span class="s1">&#39;discard_on_copy&#39;</span><span class="p">):</span>
                <span class="n">subhdutable</span> <span class="o">=</span> <span class="n">subhdutable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hdu_class</span><span class="p">]</span>
        <span class="n">subobstable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span><span class="o">.</span><span class="n">select_obs_id</span><span class="p">(</span><span class="n">obs_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subhdutable</span><span class="p">)):</span>
            <span class="c1"># Changes to the file structure could be made here</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">subhdutable</span><span class="o">.</span><span class="n">location_info</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">targetdir</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">/</span> <span class="n">loc</span><span class="o">.</span><span class="n">file_dir</span>
            <span class="n">targetdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clobber</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-n&#39;</span><span class="p">]</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">path</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetdir</span><span class="p">)]</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">subhdutable</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outdir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_HDU_TABLE</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">clobber</span><span class="p">)</span>
        <span class="n">subobstable</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outdir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_OBS_TABLE</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">clobber</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataStore.data_summary"><a class="viewcode-back" href="../../../api/gammapy.data.DataStore.html#gammapy.data.DataStore.data_summary">[docs]</a>    <span class="k">def</span> <span class="nf">data_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a summary `~astropy.table.Table` with HDU size information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obs_id : array-like, `~gammapy.data.ObservationTable`</span>
<span class="sd">            Observations to create summary for</span>
<span class="sd">        summed : bool</span>
<span class="sd">            Add up file size over all obs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obs_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obs_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">ObservationTable</span><span class="p">):</span>
            <span class="n">obs_id</span> <span class="o">=</span> <span class="n">obs_id</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="n">hdut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu_table</span>
        <span class="n">hdut</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">)</span>
        <span class="n">subhdut</span> <span class="o">=</span> <span class="n">hdut</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs_id</span><span class="p">]</span>

        <span class="n">subhdut_grpd</span> <span class="o">=</span> <span class="n">subhdut</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="n">subhdut_grpd</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;HDU_CLASS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colnames</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subhdut_grpd</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">subhdut_grpd</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>
            <span class="c1"># This is needed to get the column order right</span>
            <span class="n">group</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="s1">&#39;HDU_CLASS&#39;</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">colnames</span><span class="p">][</span><span class="s1">&#39;SIZE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">summed</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">vals</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">],</span> <span class="n">vals</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">summed</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colnames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">],</span> <span class="n">colnames</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DataStoreObservation"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation">[docs]</a><span class="k">class</span> <span class="nc">DataStoreObservation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;IACT data store observation.</span>

<span class="sd">    See :ref:`data_store`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_id</span><span class="p">,</span> <span class="n">data_store</span><span class="p">):</span>
        <span class="c1"># Assert that `obs_id` is available</span>
        <span class="k">if</span> <span class="n">obs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;OBS_ID = </span><span class="si">{}</span><span class="s1"> not in obs index table.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">obs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;OBS_ID = </span><span class="si">{}</span><span class="s1"> not in HDU index table.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="n">obs_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_store</span> <span class="o">=</span> <span class="n">data_store</span>

<div class="viewcode-block" id="DataStoreObservation.location"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation.location">[docs]</a>    <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdu_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;HDU location object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdu_type : str</span>
<span class="sd">            HDU type (see `~gammapy.data.HDUIndexTable.VALID_HDU_TYPE`)</span>
<span class="sd">        hdu_class : str</span>
<span class="sd">            HDU class (see `~gammapy.data.HDUIndexTable.VALID_HDU_CLASS`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        location : `~gammapy.data.HDULocation`</span>
<span class="sd">            HDU location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="o">.</span><span class="n">hdu_location</span><span class="p">(</span>
            <span class="n">obs_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">,</span>
            <span class="n">hdu_type</span><span class="o">=</span><span class="n">hdu_type</span><span class="p">,</span>
            <span class="n">hdu_class</span><span class="o">=</span><span class="n">hdu_class</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="DataStoreObservation.load"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdu_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load data file as appropriate object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdu_type : str</span>
<span class="sd">            HDU type (see `~gammapy.data.HDUIndexTable.VALID_HDU_TYPE`)</span>
<span class="sd">        hdu_class : str</span>
<span class="sd">            HDU class (see `~gammapy.data.HDUIndexTable.VALID_HDU_CLASS`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        object : object</span>
<span class="sd">            Object depends on type, e.g. for `events` it&#39;s a `~gammapy.data.EventList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="n">hdu_type</span><span class="p">,</span> <span class="n">hdu_class</span><span class="o">=</span><span class="n">hdu_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">location</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></div>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load `gammapy.data.EventList` object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;events&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">gti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load `gammapy.data.GTI` object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;gti&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">aeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load effective area object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;aeff&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">edisp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load energy dispersion object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;edisp&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">psf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load point spread function object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;psf&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">bkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load background object (lazy property).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hdu_type</span><span class="o">=</span><span class="s1">&#39;bkg&#39;</span><span class="p">)</span>

    <span class="c1"># TODO: maybe the obs table row info should be put in a separate object?</span>
    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">_obs_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observation information.&quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="o">.</span><span class="n">select_obs_id</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">as_void</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">pointing_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pointing RA / DEC sky coordinates (`~astropy.coordinates.SkyCoord`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;RA_PNT&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;DEC_PNT&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">tstart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observation start time (`~astropy.time.Time`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">Time</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;TSTART&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;mjd&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">tstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observation stop time (`~astropy.time.Time`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">Time</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;TSTOP&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;mjd&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">muoneff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observation muon efficiency.&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;MUONEFF&#39;</span><span class="p">]</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">pointing_altaz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pointing ALT / AZ sky coordinates (`~astropy.coordinates.SkyCoord`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="n">alt</span><span class="p">,</span> <span class="n">az</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ALT_PNT&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;AZ_PNT&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;altaz&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">pointing_zen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pointing zenith angle sky (`~astropy.units.Quantity`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="n">zen</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ZEN_PNT&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">zen</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;TSTART&#39;</span><span class="p">],</span> <span class="s1">&#39;second&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">target_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Target RA / DEC sky coordinates (`~astropy.coordinates.SkyCoord`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;RA_OBJ&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;DEC_OBJ&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">observatory_earth_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observatory location (`~astropy.coordinates.EarthLocation`).&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">_earth_location_from_dict</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">observation_time_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observation time duration in seconds (`~astropy.units.Quantity`).</span>

<span class="sd">        The wall time, including dead-time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ONTIME&#39;</span><span class="p">],</span> <span class="s1">&#39;second&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">observation_live_time_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Live-time duration in seconds (`~astropy.units.Quantity`).</span>

<span class="sd">        The dead-time-corrected observation time.</span>

<span class="sd">        Computed as ``t_live = t_observation * (1 - f_dead)``</span>
<span class="sd">        where ``f_dead`` is the dead-time fraction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;LIVETIME&#39;</span><span class="p">],</span> <span class="s1">&#39;second&#39;</span><span class="p">)</span>

    <span class="nd">@lazyproperty</span>
    <span class="k">def</span> <span class="nf">observation_dead_time_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dead-time fraction (float).</span>

<span class="sd">        Defined as dead-time over observation time.</span>

<span class="sd">        Dead-time is defined as the time during the observation</span>
<span class="sd">        where the detector didn&#39;t record events:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Dead_time</span>
<span class="sd">        http://adsabs.harvard.edu/abs/2004APh....22..285F</span>

<span class="sd">        The dead-time fraction is used in the live-time computation,</span>
<span class="sd">        which in turn is used in the exposure and flux computation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_info</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;DEADC&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate summary info string.&quot;&quot;&quot;</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;Info for OBS_ID = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;- Start time: </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tstart</span><span class="o">.</span><span class="n">mjd</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;- Pointing pos: RA </span><span class="si">{:.2f}</span><span class="s1"> / Dec </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointing_radec</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointing_radec</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;- Observation duration: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_time_duration</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;- Dead-time fraction: </span><span class="si">{:5.3f}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_dead_time_fraction</span><span class="p">)</span>

        <span class="c1"># TODO: Which target was observed?</span>
        <span class="c1"># TODO: print info about available HDUs for this observation ...</span>
        <span class="k">return</span> <span class="n">ss</span>

<div class="viewcode-block" id="DataStoreObservation.peek"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation.peek">[docs]</a>    <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Quick-look plots in a few panels.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DataStoreObservation.make_exposure_image"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation.make_exposure_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_exposure_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fov</span><span class="p">,</span> <span class="n">energy_range</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make exposure image.</span>

<span class="sd">        TODO: Do we want such methods here or as standalone functions that work with obs objects?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DataStoreObservation.make_psf"><a class="viewcode-back" href="../../../api/gammapy.data.DataStoreObservation.html#gammapy.data.DataStoreObservation.make_psf">[docs]</a>    <span class="k">def</span> <span class="nf">make_psf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make energy-dependent PSF for a given source position.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position : `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            Position at which to compute the PSF</span>
<span class="sd">        energy : `~astropy.units.Quantity`</span>
<span class="sd">            1-dim energy array for the output PSF.</span>
<span class="sd">            If none is given, the energy array of the PSF from the observation is used.</span>
<span class="sd">        rad : `~astropy.coordinates.Angle`</span>
<span class="sd">            1-dim offset wrt source position array for the output PSF.</span>
<span class="sd">            If none is given, the offset array of the PSF from the observation is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : `~gammapy.irf.EnergyDependentTablePSF`</span>
<span class="sd">            Energy dependent psf table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointing_radec</span><span class="p">)</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">to_energy_dependent_table_psf</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">to_energy_dependent_table_psf</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">rad</span>

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="p">,</span> <span class="n">PSF3D</span><span class="p">):</span>
            <span class="c1"># PSF3D is a table PSF, so we use the native RAD binning by default</span>
            <span class="c1"># TODO: should handle this via a uniform caller API</span>
            <span class="n">psf_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">to_energy_dependent_table_psf</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psf_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">to_energy_dependent_table_psf</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>

        <span class="n">arf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aeff</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="n">arf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_live_time_duration</span>

        <span class="n">psf</span> <span class="o">=</span> <span class="n">EnergyDependentTablePSF</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span>
                                      <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">psf_value</span><span class="o">=</span><span class="n">psf_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">psf</span></div></div>


<div class="viewcode-block" id="ObservationList"><a class="viewcode-back" href="../../../api/gammapy.data.ObservationList.html#gammapy.data.ObservationList">[docs]</a><span class="k">class</span> <span class="nc">ObservationList</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List of `~gammapy.data.DataStoreObservation`.</span>

<span class="sd">    Could be extended to hold a more generic class of observations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Number of observations: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">make_mean_psf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute mean energy-dependent PSF.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position : `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            Position at which to compute the PSF</span>
<span class="sd">        energy : `~astropy.units.Quantity`</span>
<span class="sd">            1-dim energy array for the output PSF.</span>
<span class="sd">            If none is given, the energy array of the PSF from the first</span>
<span class="sd">            observation is used.</span>
<span class="sd">        rad : `~astropy.coordinates.Angle`</span>
<span class="sd">            1-dim offset wrt source position array for the output PSF.</span>
<span class="sd">            If none is given, the energy array of the PSF from the first</span>
<span class="sd">            observation is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : `~gammapy.irf.EnergyDependentTablePSF`</span>
<span class="sd">            Mean PSF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">psf</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">make_psf</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>

        <span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span> <span class="ow">or</span> <span class="n">psf</span><span class="o">.</span><span class="n">rad</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span> <span class="ow">or</span>  <span class="n">psf</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">exposure</span>
        <span class="n">psf_value</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">psf_value</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">psf</span><span class="o">.</span><span class="n">exposure</span>

        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">psf</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">make_psf</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>
            <span class="n">exposure</span> <span class="o">+=</span> <span class="n">psf</span><span class="o">.</span><span class="n">exposure</span>
            <span class="n">psf_value</span> <span class="o">+=</span> <span class="n">psf</span><span class="o">.</span><span class="n">psf_value</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">psf</span><span class="o">.</span><span class="n">exposure</span>

        <span class="n">psf_value</span> <span class="o">/=</span> <span class="n">exposure</span>
        <span class="n">psf_tot</span> <span class="o">=</span> <span class="n">EnergyDependentTablePSF</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span>
                                          <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                                          <span class="n">psf_value</span><span class="o">=</span><span class="n">psf_value</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">psf_tot</span>

    <span class="k">def</span> <span class="nf">make_mean_edisp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">e_true</span><span class="p">,</span> <span class="n">e_reco</span><span class="p">,</span>
                        <span class="n">low_reco_threshold</span><span class="o">=</span><span class="n">Energy</span><span class="p">(</span><span class="mf">0.002</span><span class="p">,</span> <span class="s2">&quot;TeV&quot;</span><span class="p">),</span>
                        <span class="n">high_reco_threshold</span><span class="o">=</span><span class="n">Energy</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;TeV&quot;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Compute mean energy dispersion.</span>

<span class="sd">        Compute the mean edisp of a set of observations j at a given position</span>

<span class="sd">        The stacking is implemented in :func:`~gammapy.irf.IRFStacker.stack_edisp`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position : `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            Position at which to compute the mean EDISP</span>
<span class="sd">        e_true : `~gammapy.utils.energy.EnergyBounds`</span>
<span class="sd">            True energy axis</span>
<span class="sd">        e_reco : `~gammapy.utils.energy.EnergyBounds`</span>
<span class="sd">            Reconstructed energy axis</span>
<span class="sd">        low_reco_threshold : `~gammapy.utils.energy.Energy`</span>
<span class="sd">            low energy threshold in reco energy, default 0.002 TeV</span>
<span class="sd">        high_reco_threshold : `~gammapy.utils.energy.Energy`</span>
<span class="sd">            high energy threshold in reco energy , default 150 TeV</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stacked_edisp : `~gammapy.irf.EnergyDispersion`</span>
<span class="sd">            Stacked EDISP for a set of observation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_aeff</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_edisp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_livetime</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_low_threshold</span> <span class="o">=</span> <span class="p">[</span><span class="n">low_reco_threshold</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">list_high_threshold</span> <span class="o">=</span> <span class="p">[</span><span class="n">high_reco_threshold</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">pointing_radec</span><span class="p">)</span>
            <span class="n">list_aeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">aeff</span><span class="o">.</span><span class="n">to_effective_area_table</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span>
                                                              <span class="n">energy</span><span class="o">=</span><span class="n">e_true</span><span class="p">))</span>
            <span class="n">list_edisp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">edisp</span><span class="o">.</span><span class="n">to_energy_dispersion</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span>
                                                             <span class="n">e_reco</span><span class="o">=</span><span class="n">e_reco</span><span class="p">,</span>
                                                             <span class="n">e_true</span><span class="o">=</span><span class="n">e_true</span><span class="p">))</span>
            <span class="n">list_livetime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">observation_live_time_duration</span><span class="p">)</span>

        <span class="n">irf_stack</span> <span class="o">=</span> <span class="n">IRFStacker</span><span class="p">(</span><span class="n">list_aeff</span><span class="o">=</span><span class="n">list_aeff</span><span class="p">,</span> <span class="n">list_edisp</span><span class="o">=</span><span class="n">list_edisp</span><span class="p">,</span>
                               <span class="n">list_livetime</span><span class="o">=</span><span class="n">list_livetime</span><span class="p">,</span>
                               <span class="n">list_low_threshold</span><span class="o">=</span><span class="n">list_low_threshold</span><span class="p">,</span>
                               <span class="n">list_high_threshold</span><span class="o">=</span><span class="n">list_high_threshold</span><span class="p">)</span>
        <span class="n">irf_stack</span><span class="o">.</span><span class="n">stack_edisp</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">irf_stack</span><span class="o">.</span><span class="n">stacked_edisp</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="data_store.html#">Back to Top</a></p>
  <p>
    &copy; Copyright 2017, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.5. &nbsp;
    Last built 28 Apr 2017. <br/>
  </p>
</footer>
  </body>
</html>