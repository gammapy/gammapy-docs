<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gammapy.image.plotting &#8212; gammapy v0.6</title>
    
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.gammapy.org/en/latest/_modules/gammapy/image/plotting.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = '_modules/gammapy/image/plotting'
</script>

<script type="text/javascript" src="../../../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.6</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.image.plotting</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;Helper functions and functions for plotting gamma-ray images.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;colormap_hess&#39;</span><span class="p">,</span>
    <span class="s1">&#39;colormap_milagro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fits_to_png&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GalacticPlaneSurveyPanelPlot&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fitsfigure_add_psf_inset&#39;</span><span class="p">,</span>
    <span class="s1">&#39;illustrate_colormap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;grayify_colormap&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">__doctest_requires__</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;colormap_hess&#39;</span><span class="p">,</span> <span class="s1">&#39;colormap_milagro&#39;</span><span class="p">):</span> <span class="p">[</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">]}</span>


<div class="viewcode-block" id="colormap_hess"><a class="viewcode-back" href="../../../api/gammapy.image.colormap_hess.html#gammapy.image.colormap_hess">[docs]</a><span class="k">def</span> <span class="nf">colormap_hess</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Colormap often used in H.E.S.S. collaboration publications.</span>

<span class="sd">    This colormap goes black -&gt; blue -&gt; red -&gt; yellow -&gt; white.</span>

<span class="sd">    A sharp blue -&gt; red -&gt; yellow transition is often used for significance images</span>
<span class="sd">    with a value of red at ``transition ~ 5`` or ``transition ~ 7``</span>
<span class="sd">    so that the following effect is achieved:</span>

<span class="sd">    - black, blue: non-significant features, not well visible</span>
<span class="sd">    - red: features at the detection threshold ``transition``</span>
<span class="sd">    - yellow, white: significant features, very well visible</span>

<span class="sd">    The transition parameter is defined between 0 and 1. To calculate the value</span>
<span class="sd">    from data units an `~astropy.visualization.mpl_normalize.ImageNormalize`</span>
<span class="sd">    instance should be used (see example below).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transition : float (default = 0.5)</span>
<span class="sd">        Value of the transition to red (between 0 and 1).</span>
<span class="sd">    width : float (default = 0.5)</span>
<span class="sd">        Width of the blue-red color transition (between 0 and 1).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormap : `matplotlib.colors.LinearSegmentedColormap`</span>
<span class="sd">        Colormap</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from gammapy.image import colormap_hess</span>
<span class="sd">    &gt;&gt;&gt; from astropy.visualization.mpl_normalize import ImageNormalize</span>
<span class="sd">    &gt;&gt;&gt; from astropy.visualization import LinearStretch</span>
<span class="sd">    &gt;&gt;&gt; normalize = ImageNormalize(vmin=-5, vmax=15, stretch=LinearStretch())</span>
<span class="sd">    &gt;&gt;&gt; transition = normalize(5)</span>
<span class="sd">    &gt;&gt;&gt; cmap = colormap_hess(transition=transition)</span>

<span class="sd">    .. plot::</span>

<span class="sd">        from gammapy.image import colormap_hess, illustrate_colormap</span>
<span class="sd">        import matplotlib.pyplot as plt</span>
<span class="sd">        cmap = colormap_hess()</span>
<span class="sd">        illustrate_colormap(cmap)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>

    <span class="c1"># Compute normalised values (range 0 to 1) that</span>
    <span class="c1"># correspond to red, blue, yellow.</span>
    <span class="n">red</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="n">red</span><span class="p">:</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">red</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="n">red</span> <span class="o">-</span> <span class="n">width</span>

    <span class="n">yellow</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">red</span><span class="p">)</span> <span class="o">+</span> <span class="n">red</span>

    <span class="n">black</span><span class="p">,</span> <span class="n">white</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="c1"># Create custom colormap</span>
    <span class="c1"># List entries: (value, (R, G, B))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">black</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">),</span>
              <span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)),</span>
              <span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span>
              <span class="p">(</span><span class="n">yellow</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
              <span class="p">(</span><span class="n">white</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),</span>
              <span class="p">]</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hess&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span></div>


<div class="viewcode-block" id="colormap_milagro"><a class="viewcode-back" href="../../../api/gammapy.image.colormap_milagro.html#gammapy.image.colormap_milagro">[docs]</a><span class="k">def</span> <span class="nf">colormap_milagro</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">huestart</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Colormap often used in Milagro collaboration publications.</span>

<span class="sd">    This colormap is gray below ``transition`` and similar to the jet colormap above.</span>

<span class="sd">    A sharp gray -&gt; color transition is often used for significance images</span>
<span class="sd">    with a transition value of ``transition ~ 5`` or ``transition ~ 7``,</span>
<span class="sd">    so that the following effect is achieved:</span>

<span class="sd">    - gray: non-significant features are not well visible</span>
<span class="sd">    - color: significant features at the detection threshold ``transition``</span>

<span class="sd">    Note that this colormap is often criticised for over-exaggerating small differences</span>
<span class="sd">    in significance below and above the gray - color transition threshold.</span>

<span class="sd">    The transition parameter is defined between 0 and 1. To calculate the value</span>
<span class="sd">    from data units an `~astropy.visualization.mpl_normalize.ImageNormalize` instance should be</span>
<span class="sd">    used (see example below).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transition : float (default = 0.5)</span>
<span class="sd">        Transition value (below: gray, above: color).</span>
<span class="sd">    width : float (default = 0.0001)</span>
<span class="sd">        Width of the transition</span>
<span class="sd">    huestart : float (default = 0.6)</span>
<span class="sd">        Hue of the color at ``transition``</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormap : `~matplotlib.colors.LinearSegmentedColormap`</span>
<span class="sd">        Colormap</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from gammapy.image import colormap_milagro</span>
<span class="sd">    &gt;&gt;&gt; from astropy.visualization.mpl_normalize import ImageNormalize</span>
<span class="sd">    &gt;&gt;&gt; from astropy.visualization import LinearStretch</span>
<span class="sd">    &gt;&gt;&gt; normalize = ImageNormalize(vmin=-5, vmax=15, stretch=LinearStretch())</span>
<span class="sd">    &gt;&gt;&gt; transition = normalize(5)</span>
<span class="sd">    &gt;&gt;&gt; cmap = colormap_milagro(transition=transition)</span>


<span class="sd">    .. plot::</span>

<span class="sd">        from gammapy.image import colormap_milagro, illustrate_colormap</span>
<span class="sd">        import matplotlib.pyplot as plt</span>
<span class="sd">        cmap = colormap_milagro()</span>
<span class="sd">        illustrate_colormap(cmap)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">colorsys</span> <span class="k">import</span> <span class="n">hls_to_rgb</span>
    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>

    <span class="c1"># Compute normalised red, blue, yellow values</span>
    <span class="n">transition</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span>

    <span class="c1"># Create custom colormap</span>
    <span class="c1"># List entries: (value, (H, L, S))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
              <span class="p">(</span><span class="n">transition</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
              <span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">(</span><span class="n">huestart</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)),</span>
              <span class="p">(</span><span class="n">transition</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">huestart</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
              <span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
              <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
              <span class="p">]</span>

    <span class="c1"># Convert HLS values to RGB values</span>
    <span class="n">rgb_colors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">,</span> <span class="n">hls_to_rgb</span><span class="p">(</span><span class="o">*</span><span class="n">hls</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">hls</span><span class="p">)</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;milagro&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">rgb_colors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span></div>


<div class="viewcode-block" id="fits_to_png"><a class="viewcode-back" href="../../../api/gammapy.image.fits_to_png.html#gammapy.image.fits_to_png">[docs]</a><span class="k">def</span> <span class="nf">fits_to_png</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot FITS image in PNG format.</span>

<span class="sd">    For the default ``dpi=100`` a 1:1 copy of the pixels in the FITS image</span>
<span class="sd">    and the PNG image is achieved, i.e. they have exactly the same size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    infile : str</span>
<span class="sd">        Input FITS file name</span>
<span class="sd">    outfile : str</span>
<span class="sd">        Output PNG file name</span>
<span class="sd">    draw : callable</span>
<span class="sd">        Callback function ``draw(figure)``</span>
<span class="sd">        where ``figure`` is an `~aplpy.FITSFigure`.</span>
<span class="sd">    dpi : int</span>
<span class="sd">        Resolution</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; def draw(figure):</span>
<span class="sd">    ...     x, y, width, height = 42, 0, 3, 2</span>
<span class="sd">    ...     figure.recenter(x, y, width, height)</span>
<span class="sd">    ...     figure.show_grayscale()</span>
<span class="sd">    &gt;&gt;&gt; from gammapy.image import fits_to_png</span>
<span class="sd">    &gt;&gt;&gt; fits_to_png(&#39;image.fits&#39;, &#39;image.png&#39;, draw)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>  <span class="c1"># Prevents image popup</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
    <span class="kn">from</span> <span class="nn">aplpy</span> <span class="k">import</span> <span class="n">FITSFigure</span>

    <span class="c1"># Peak ahead just to get the figure size</span>
    <span class="n">NAXIS1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;NAXIS1&#39;</span><span class="p">))</span>
    <span class="n">NAXIS2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;NAXIS2&#39;</span><span class="p">))</span>

    <span class="c1"># Note: For dpi=100 I get exactly the same FITS and PNG image size in pix.</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">NAXIS1</span><span class="p">,</span> <span class="n">NAXIS2</span><span class="p">))</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span> <span class="o">/</span> <span class="n">dpi</span><span class="p">)</span>
    <span class="c1"># Also try this:</span>
    <span class="c1"># matplotlib.rcParams[&#39;figure.figsize&#39;] = NAXIS1, NAXIS2</span>
    <span class="c1"># figsize(x,y)</span>

    <span class="n">subplot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">FITSFigure</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="n">subplot</span><span class="p">)</span>

    <span class="n">draw</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>

    <span class="n">figure</span><span class="o">.</span><span class="n">axis_labels</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">figure</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">max_dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">adjust_bbox</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot">[docs]</a><span class="k">class</span> <span class="nc">GalacticPlaneSurveyPanelPlot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot Galactic plane survey images in multiple panels.</span>

<span class="sd">    This is useful for very wide, but not so high survey images</span>
<span class="sd">    (~100 deg in Galactic longitude and ~10 deg in Galactic latitude).</span>

<span class="sd">    TODO: describe how the callbacks work</span>

<span class="sd">    References:</span>
<span class="sd">    http://aplpy.readthedocs.io/en/latest/howto_subplot.html</span>

<span class="sd">    Attributes:</span>

<span class="sd">    * ``panel_parameters`` -- dict of panel parameters</span>
<span class="sd">    * ``figure`` --- Main matplotlib figure (cantains all panels)</span>
<span class="sd">    * ``fits_figure`` --- Current `aplpy.FITSFigure`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fits_figure : `aplpy.FITSFigure`</span>
<span class="sd">        FITSFigure to plot on all panels</span>
<span class="sd">    npanels : int</span>
<span class="sd">        Number of panels</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    TODO: Link to tutorial example</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npanels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fov</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">xsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xborder</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">yborder</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">yspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">xoverlap</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute panel parameters and make a matplotlib Figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">panel_parameters</span> <span class="o">=</span> <span class="n">_panel_parameters</span><span class="p">(</span><span class="n">npanels</span><span class="o">=</span><span class="n">npanels</span><span class="p">,</span>
                                                  <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                                                  <span class="n">fov</span><span class="o">=</span><span class="n">fov</span><span class="p">,</span>
                                                  <span class="n">xsize</span><span class="o">=</span><span class="n">xsize</span><span class="p">,</span>
                                                  <span class="n">ysize</span><span class="o">=</span><span class="n">ysize</span><span class="p">,</span>
                                                  <span class="n">xborder</span><span class="o">=</span><span class="n">xborder</span><span class="p">,</span>
                                                  <span class="n">yborder</span><span class="o">=</span><span class="n">yborder</span><span class="p">,</span>
                                                  <span class="n">yspacing</span><span class="o">=</span><span class="n">yspacing</span><span class="p">,</span>
                                                  <span class="n">xoverlap</span><span class="o">=</span><span class="n">xoverlap</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">panel_parameters</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot.bottom"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot.bottom">[docs]</a>    <span class="k">def</span> <span class="nf">bottom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colorbar_pars</span><span class="o">=</span><span class="p">{},</span> <span class="n">colorbar_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: needed?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">colorbar_pars</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fits_figure</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">(</span><span class="o">**</span><span class="n">colorbar_pars</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar_label</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fits_figure</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fits_figure</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">_colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot.top"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot.top">[docs]</a>    <span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: needed?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot.draw_panels"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot.draw_panels">[docs]</a>    <span class="k">def</span> <span class="nf">draw_panels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panels</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw panels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panels : list of ints or &#39;all&#39;</span>
<span class="sd">            List of panels to draw.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">panels</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">panels</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel_parameters</span><span class="p">[</span><span class="s1">&#39;npanels&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_panel</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span></div>

            <span class="c1"># self.figure.canvas.draw()</span>

<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot.draw_panel"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot.draw_panel">[docs]</a>    <span class="k">def</span> <span class="nf">draw_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw panel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panel : int</span>
<span class="sd">            Panel index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panel_parameters</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;centers&#39;</span><span class="p">][</span><span class="n">panel</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span> <span class="o">=</span> <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;subplots&#39;</span><span class="p">][</span><span class="n">panel</span><span class="p">]</span>

        <span class="c1"># Execute user-defined plotting ...</span>
        <span class="c1"># This must set self.fits_figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="p">)</span>

        <span class="c1"># self.fits_figure.set_auto_refresh(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fits_figure</span><span class="o">.</span><span class="n">recenter</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">width</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;npanels&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>

        <span class="c1"># fits_figure.refresh()</span>
        <span class="c1"># self.figure.canvas.draw()</span>

        <span class="c1"># To ensure compatibility with old code</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">format</span><span class="p">:</span>
            <span class="n">GalacticPlaneSurveyPanelPlot</span><span class="o">.</span><span class="n">format_fits_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fits_figure</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="GalacticPlaneSurveyPanelPlot.format_fits_figure"><a class="viewcode-back" href="../../../api/gammapy.image.GalacticPlaneSurveyPanelPlot.html#gammapy.image.GalacticPlaneSurveyPanelPlot.format_fits_figure">[docs]</a>    <span class="k">def</span> <span class="nf">format_fits_figure</span><span class="p">(</span><span class="n">fits_figure</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: describe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">theme</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fits_figure</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="s1">&#39;publication&#39;</span><span class="p">)</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">axis_labels</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">set_xspacing</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">set_yspacing</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">set_xformat</span><span class="p">(</span><span class="s1">&#39;dd&#39;</span><span class="p">)</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">set_yformat</span><span class="p">(</span><span class="s1">&#39;dd&#39;</span><span class="p">)</span>
        <span class="n">fits_figure</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;colons&#39;</span><span class="p">)</span></div></div>
        <span class="c1"># fits_figure.tick_labels.set_font(size=&#39;small&#39;)</span>


<span class="k">def</span> <span class="nf">_panel_parameters</span><span class="p">(</span><span class="n">npanels</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">fov</span><span class="p">,</span> <span class="n">xborder</span><span class="p">,</span> <span class="n">yborder</span><span class="p">,</span>
                      <span class="n">yspacing</span><span class="p">,</span> <span class="n">xoverlap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute panel parameters.</span>

<span class="sd">    This function computes all relevant quantities to plot</span>
<span class="sd">    a very wide survey map in n slices.</span>

<span class="sd">    This is surprisingly complicated because coordinates are</span>
<span class="sd">    relative to figsize, which is already not 1:1.</span>

<span class="sd">    TODO: document panel parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npanels : int</span>
<span class="sd">        Number of slices</span>
<span class="sd">    center : pair</span>
<span class="sd">        Image center position (lon, lat)</span>
<span class="sd">    fov : pair</span>
<span class="sd">        Image full-width and full-height</span>
<span class="sd">    xsize : float</span>
<span class="sd">        Width of the figure in inches</span>
<span class="sd">    ysize : float (None)</span>
<span class="sd">        Height of the figure in inches</span>
<span class="sd">    xborder : float</span>
<span class="sd">        Free space to x border in inches</span>
<span class="sd">    yborder : float</span>
<span class="sd">        Free space to y border in inches</span>
<span class="sd">    yspacing : float</span>
<span class="sd">        Free space between slices in inches</span>
<span class="sd">    xoverlap : float</span>
<span class="sd">        Overlap between single panels in deg.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    panel_parameters : dict</span>
<span class="sd">        Dictionary of panel parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Need floats for precise divisions</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">fov</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">fov</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fov</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">xborder</span><span class="p">,</span> <span class="n">yborder</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xborder</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">yborder</span><span class="p">)</span>
    <span class="n">yspacing</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">yspacing</span><span class="p">)</span>

    <span class="c1"># Width and height in deg of a slice</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">fov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">npanels</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">fov</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Aspect ratio y:x of a slice</span>
    <span class="n">aspectratio</span> <span class="o">=</span> <span class="n">fov</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">fov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">npanels</span><span class="p">)</span>
    <span class="c1"># Absolute figure dimensions</span>
    <span class="k">if</span> <span class="n">ysize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ysize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">yborder</span> <span class="o">+</span> <span class="p">(</span><span class="n">npanels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">yspacing</span> <span class="o">+</span>
                 <span class="n">npanels</span> <span class="o">*</span> <span class="n">aspectratio</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xsize</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xborder</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">xsize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ysize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xsize</span> <span class="o">=</span> <span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">ysize</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">yborder</span> <span class="o">+</span> <span class="p">(</span><span class="n">npanels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">yspacing</span><span class="p">))</span> <span class="o">/</span>
                 <span class="p">(</span><span class="n">npanels</span> <span class="o">*</span> <span class="n">aspectratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xborder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either xsize or ysize must be specified.&#39;</span><span class="p">)</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">]</span>

    <span class="c1"># Relative slice subplot dimensions</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xborder</span> <span class="o">/</span> <span class="n">xsize</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">aspectratio</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">xsize</span> <span class="o">/</span> <span class="n">ysize</span>
    <span class="n">dyspacing</span> <span class="o">=</span> <span class="n">yspacing</span> <span class="o">/</span> <span class="n">ysize</span>

    <span class="c1"># List of y slice offsets</span>
    <span class="n">subplots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">subplot_centers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npanels</span><span class="p">):</span>
        <span class="n">subplot_center</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">subplot</span> <span class="o">=</span> <span class="p">[</span><span class="n">xborder</span> <span class="o">/</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">yborder</span> <span class="o">/</span> <span class="n">ysize</span> <span class="o">+</span> <span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">dy</span> <span class="o">+</span> <span class="n">dyspacing</span><span class="p">),</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">]</span>
        <span class="n">subplot_centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subplot_center</span><span class="p">)</span>
        <span class="n">subplots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subplot</span><span class="p">)</span>

    <span class="n">pp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figsize</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;npanels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">npanels</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;centers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subplot_centers</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;subplots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subplots</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="n">xoverlap</span>
    <span class="n">pp</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">height</span>

    <span class="k">return</span> <span class="n">pp</span>


<div class="viewcode-block" id="fitsfigure_add_psf_inset"><a class="viewcode-back" href="../../../api/gammapy.image.fitsfigure_add_psf_inset.html#gammapy.image.fitsfigure_add_psf_inset">[docs]</a><span class="k">def</span> <span class="nf">fitsfigure_add_psf_inset</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">psf</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                             <span class="n">psf_position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add PSF inset to `~aplpy.FITSFigure` instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ff : `~aplpy.FITSFigure`</span>
<span class="sd">        `~aplpy.FITSFigure` instance.</span>
<span class="sd">    psf : `astropy.io.fits.ImageHDU`</span>
<span class="sd">        PSF image.</span>
<span class="sd">    box : tuple</span>
<span class="sd">        (x, y, width, height) of the PSF inset in world coordinates.</span>
<span class="sd">    linewidth : float</span>
<span class="sd">        Linewidth of the PSF inset frame.</span>
<span class="sd">    color : str</span>
<span class="sd">        Color of the PSF inset frame.</span>
<span class="sd">    psf_position : tuple</span>
<span class="sd">        (x, y) position of the psf in in the psf image in pixel coordinates.</span>
<span class="sd">    kwargs : dict</span>
<span class="sd">        Further arguments passed to `~matplotlib.pyplot.imshow`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : `~matplotlib.axes.Axes`</span>
<span class="sd">        PSF `~matplotlib.axes.Axes` instance, can be used for further plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">_rect_world2fig</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>

    <span class="c1"># WCSAxes should be used here</span>
    <span class="n">psf_axes</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">spline</span> <span class="ow">in</span> <span class="n">psf_axes</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">spline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">spline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>

    <span class="n">psf_axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
    <span class="n">psf_axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>

    <span class="n">psf_axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="n">psf_position</span>
    <span class="n">wc</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">hc</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT2&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">psf_axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xc</span> <span class="o">-</span> <span class="n">wc</span><span class="p">,</span> <span class="n">xc</span> <span class="o">+</span> <span class="n">wc</span><span class="p">)</span>
    <span class="n">psf_axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yc</span> <span class="o">-</span> <span class="n">hc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">+</span> <span class="n">hc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psf_axes</span></div>


<span class="k">def</span> <span class="nf">fitsfigure_add_colorbar_inset</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label_position</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">label_pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="n">n_ticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ticklabel_format</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span> <span class="n">tick_size</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add colorbar inset to existing `~aplpy.FITSFigure` instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ff : `~aplpy.FITSFigure`</span>
<span class="sd">        `~aplpy.FITSFigure` instance.</span>
<span class="sd">    box : tuple</span>
<span class="sd">        (x, y, width, height) of the colorbar inset in world coordinates.</span>
<span class="sd">    linewidth : float</span>
<span class="sd">        Linewidth of the colorbar inset frame.</span>
<span class="sd">    color : str</span>
<span class="sd">        Color of the colorbar inset frame.</span>
<span class="sd">    normalize : `~astropy.visualization.mpl_normalize.ImageNormalize` (None)</span>
<span class="sd">        `~astropy.visualization.mpl_normalize.ImageNormalize` instance.</span>
<span class="sd">    label : str</span>
<span class="sd">        Colorbar label.</span>
<span class="sd">    label_position : {&#39;right&#39;, &#39;bottom&#39;}</span>
<span class="sd">        Colorbar label position.</span>
<span class="sd">    label_pad : float</span>
<span class="sd">        Colorbar label padding.</span>
<span class="sd">    n_ticks : int (default = 5)</span>
<span class="sd">        Number of ticks and tick labels.</span>
<span class="sd">    ticklabel_format : str (default = &#39;.1f&#39;)</span>
<span class="sd">        Tick label fomating string.</span>
<span class="sd">    ticksize : float</span>
<span class="sd">        Size of the colorbar ticks.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : `~matplotlib.axes.Axes`</span>
<span class="sd">        Colorbar `~matplotlib.axes.Axes` instance, can be used for further plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">_rect_world2fig</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="n">cbar_axes</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_axes</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">solids</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">tick_size</span><span class="p">)</span>
    <span class="n">ticks_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_ticks</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ticks_pos</span> <span class="o">=</span> <span class="n">normalize</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">ticks_pos</span><span class="p">)</span>
    <span class="n">tick_labels</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;{0:&#39;</span> <span class="o">+</span> <span class="n">ticklabel_format</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ticks_pos</span><span class="p">]</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_ticks</span><span class="p">))</span>
    <span class="n">cbar_axes</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">tick_labels</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label_position</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
        <span class="n">cbar_axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">label_pad</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label_position</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">cbar_axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">label_pad</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Position of the label must be either &#39;right&#39; or &#39;bottom&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cbar_axes</span>


<span class="k">def</span> <span class="nf">_rect_world2fig</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">rect</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform rectangle from world to figure coordinates.</span>

<span class="sd">    Paramaters</span>
<span class="sd">    ----------</span>
<span class="sd">    ff : `~aplpy.FITSFigure`</span>
<span class="sd">        `~aplpy.FITSFigure` instance.</span>
<span class="sd">    rect : tuple</span>
<span class="sd">        Tuple that defines the rectangle like [x, y, width, height] in world</span>
<span class="sd">        coordinates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rect : tuple</span>
<span class="sd">        Tuple that defines the rectangle like [x, y, width, height] in figure</span>
<span class="sd">        coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span>
    <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span> <span class="o">=</span> <span class="n">_world2fig</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">xf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xf</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yf</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>


<span class="k">def</span> <span class="nf">_world2fig</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert world to figure coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ff : `~aplpy.FITSFigure`</span>
<span class="sd">        `~aplpy.FITSFigure` instance.</span>
<span class="sd">    x : ndarray</span>
<span class="sd">        Array of x coordinates.</span>
<span class="sd">    y : ndarray</span>
<span class="sd">        Array of y coordinates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coordsf : tuple</span>
<span class="sd">        Figure coordinates as tuple (xfig, yfig) of arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert world to pixel coordinates</span>
    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">world2pixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Pixel to Axes coordinates</span>
    <span class="n">coordsa</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_ax1</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>

    <span class="c1"># Axes to figure coordinates</span>
    <span class="n">coordsf</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_figure</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">coordsa</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coordsf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coordsf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>


<div class="viewcode-block" id="grayify_colormap"><a class="viewcode-back" href="../../../api/gammapy.image.grayify_colormap.html#gammapy.image.grayify_colormap">[docs]</a><span class="k">def</span> <span class="nf">grayify_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;hsp&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a grayscale version a the colormap.</span>

<span class="sd">    The grayscale conversion of the colormap is bases on perceived luminance of</span>
<span class="sd">    the colors. For the conversion either the `~skimage.color.rgb2gray` or a</span>
<span class="sd">    generic method called ``hsp`` [1]_ can be used. The code is loosely based</span>
<span class="sd">    on [2]_.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmap : str or `~matplotlib.colors.Colormap`</span>
<span class="sd">        Colormap name or instance.</span>
<span class="sd">    mode : {&#39;skimage, &#39;hsp&#39;}</span>
<span class="sd">        Grayscale conversion method. Either ``skimage`` or ``hsp``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] Darel Rex Finley, &quot;HSP Color Model - Alternative to HSV (HSB) and HSL&quot;</span>
<span class="sd">       http://alienryderflex.com/hsp.html</span>

<span class="sd">    .. [2] Jake VanderPlas, &quot;How Bad Is Your Colormap?&quot;</span>
<span class="sd">       https://jakevdp.github.io/blog/2014/10/16/how-bad-is-your-colormap/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;skimage&#39;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">skimage.color</span> <span class="k">import</span> <span class="n">rgb2gray</span>
        <span class="n">luminance</span> <span class="o">=</span> <span class="n">rgb2gray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">colors</span><span class="p">]))</span>
        <span class="n">colors</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">luminance</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;hsp&#39;</span><span class="p">:</span>
        <span class="n">RGB_weight</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.299</span><span class="p">,</span> <span class="mf">0.587</span><span class="p">,</span> <span class="mf">0.114</span><span class="p">]</span>
        <span class="n">luminance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">colors</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">RGB_weight</span><span class="p">))</span>
        <span class="n">colors</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">luminance</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a valid grayscale conversion mode.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_grayscale&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span></div>


<div class="viewcode-block" id="illustrate_colormap"><a class="viewcode-back" href="../../../api/gammapy.image.illustrate_colormap.html#gammapy.image.illustrate_colormap">[docs]</a><span class="k">def</span> <span class="nf">illustrate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Illustrate color distribution and perceived luminance of a colormap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmap : str or `~matplotlib.colors.Colormap`</span>
<span class="sd">        Colormap name or instance.</span>
<span class="sd">    kwargs : dicts</span>
<span class="sd">        Keyword arguments passed to `grayify_colormap`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">cmap_gray</span> <span class="o">=</span> <span class="n">grayify_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># Show colormap</span>
    <span class="n">show_cmap</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">show_cmap</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">show_cmap</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">show_cmap</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">show_cmap</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">show_cmap</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RGB &amp; Gray Luminance of colormap </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># Show colormap gray</span>
    <span class="n">show_cmap_gray</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">])</span>
    <span class="n">show_cmap_gray</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_gray</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">show_cmap_gray</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">show_cmap_gray</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">show_cmap_gray</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="c1"># Plot RGB profiles</span>
    <span class="n">plot_rgb</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#A60628&#39;</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#467821&#39;</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#348ABD&#39;</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">cmap_gray</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Luminance&#39;</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">1.005</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="plotting.html#">Back to Top</a></p>
  <p>
    &copy; Copyright 2017, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.5. &nbsp;
    Last built 28 Apr 2017. <br/>
  </p>
</footer>
  </body>
</html>