<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Where to stick your Spectral Points? &#8212; gammapy v0.6</title>
    
    <link rel="stylesheet" href="../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Background Estimation" href="../background/index.html" />
    <link rel="prev" title="Catalog &amp; Simulation Images" href="../catalog/index.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../_static/copybutton.js"></script>


  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.gammapy.org/en/latest/tutorials/flux_point/" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'tutorials/flux_point/index' 		
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="../../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../background/index.html" title="Background Estimation">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../catalog/index.html" title="Catalog &amp; Simulation Images">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">gammapy v0.6</a>
	 &#187;
      </li>
      <li><a href="../index.html" accesskey="U">Tutorials and Examples</a> &#187;</li>
      
      <li>Where to stick your Spectral Points?</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="where-to-stick-your-spectral-points">
<span id="tutorials-flux-point"></span><h1>Where to stick your Spectral Points?<a class="headerlink" href="index.html#where-to-stick-your-spectral-points" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../../spectrum/index.html#module-gammapy.spectrum" title="gammapy.spectrum"><code class="xref py py-obj docutils literal"><span class="pre">gammapy.spectrum</span></code></a> module offers a number of options for positioning data points within  an energy band. This example offers a comparison between
the log center and Lafferty &amp; Wyatt (described in <a class="reference internal" href="../../references.html#lafferty1994" id="id1">[Lafferty1994]</a>) methods. See <code class="xref py py-obj docutils literal"><span class="pre">gammapy.spectrum.compute_differential_flux_points</span></code> for documentation on usage.</p>
<div class="section" id="lafferty-wyatt-vs-log-center">
<h2>Lafferty &amp; Wyatt vs. Log Center<a class="headerlink" href="index.html#lafferty-wyatt-vs-log-center" title="Permalink to this headline">¶</a></h2>
<p>In measurements of spectra which do not vary rapidly, it is usually sufficient to represent the data within a bin using the log bin center.
However, it is sometimes the case where the region of interest lies within a low frequency regime such that
large bin widths must be chosen to ensure statistical errors remain small. In cases where the spectrum varies rapidly (for
instance, exponentially) over wide bins, simply choosing the log bin center does not offer a good representation of the true underlying spectrum.</p>
<p>Instead, Lafferty &amp; Wyatt <a class="reference internal" href="../../references.html#lafferty1994" id="id2">[Lafferty1994]</a> offer an alternative approach for such situations. In a bin of width <span class="math">\(\Delta E\)</span> between bounds
<span class="math">\(E_1\)</span> and <span class="math">\(E_2\)</span> for energy <span class="math">\(E\)</span>, the expectation <span class="math">\(&lt;g_{meas}&gt;\)</span> of the true underlying spectrum, <span class="math">\(g(E)\)</span> is defined as</p>
<div class="math">
\[&lt;g_{meas}&gt; = \frac{1}{\Delta E}\int_{E_1}^{E_2}{g(E) dE}\]</div>
<p>As the bin size tends to zero, the expectation of the spectrum tends to it&#8217;s true value. The value of <span class="math">\(E\)</span> within a bin for
which the expectation should be regarded as a measurement of the true spectrum is determined by Lafferty &amp; Wyatt as the energy at
which the expectation value is equal to the mean value of the underlying true spectrum within that bin, noted as <span class="math">\(E_{lw}\)</span>. Thus knowledge of the true spectrum
<span class="math">\(g(E)\)</span> or an estimate for this (determined by fitting) is required.</p>
<p>So it follows that, in setting expectation equal to <span class="math">\(g(E)\)</span> at <span class="math">\(E_{lw}\)</span>, the position of <span class="math">\(E_{lw}\)</span> is given by the following equation:</p>
<div class="math">
\[E_{lw} = g^{-1}\left(\frac{1}{\Delta E}\int_{E_1}^{E_2}{g(E) dE}\right)\]</div>
<p>For instances where a power law of spectral index 2 is taken, it can be analytically shown that the Lafferty &amp; Wyatt method and log center method are
coincident. In the case of steeper power laws (e.g. spectral index 3), the Lafferty &amp; Wyatt method
returns a lower coordinate on the energy axis than the log bin center, and the reverse effect is seen for less steep power laws (e.g. spectral index 1).</p>
</div>
<div class="section" id="power-law-assumption">
<h2>Power Law Assumption<a class="headerlink" href="index.html#power-law-assumption" title="Permalink to this headline">¶</a></h2>
<p>In many &#8220;real world&#8221; examples, the nature of the true underlying spectrum is unknown and can only be estimated, either by using a
fitting algorithm with data points or by assuming a certain spectral form. In this example, the true spectrum (being a piecewise power law
function of spectral indices 1 through to 5 for bins of increasing energy) is shown in blue for illustration. This would be
unknown to the user who, in this example, assumes the spectrum follows a simple power law with spectral index 4 across all energies.</p>
<p>The plot demonstrates that in these cases where the true spectrum is not known, the Lafferty &amp; Wyatt method of positioning the data
points offers a closer representation than the log center method. Residuals showing the percentage difference of each data point from the true
spectrum are also shown.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Spectral plotting with gammapy.spectrum.flux_point</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="c1">#from gammapy.spectrum.flux_point import (compute_differential_flux_points,</span>
<span class="c1">#                                         _x_lafferty, _integrate)</span>
<span class="c1">#from gammapy.spectrum.powerlaw import power_law_integral_flux</span>

<span class="n">SPECTRAL_INDEX</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">my_spectrum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">E_1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">E_2</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">E_3</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">E_4</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">E_5</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    <span class="n">g3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
    <span class="n">g4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
    <span class="n">g5</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">E_2</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">E_3</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">E_4</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">E_5</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">E_5</span><span class="p">],</span>
                   <span class="p">[(</span><span class="n">x</span> <span class="o">/</span> <span class="n">E_1</span><span class="p">)</span> <span class="o">**</span> <span class="n">g1</span><span class="p">,</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">E_2</span><span class="p">)</span> <span class="o">**</span> <span class="n">g2</span><span class="p">,</span>
                    <span class="mf">1e-5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">E_3</span><span class="p">)</span> <span class="o">**</span> <span class="n">g3</span><span class="p">,</span> <span class="mf">1e-9</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">E_4</span><span class="p">)</span> <span class="o">**</span> <span class="n">g4</span><span class="p">,</span>
                    <span class="mf">1e-14</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">E_5</span><span class="p">)</span> <span class="o">**</span> <span class="n">g5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">im</span>


<span class="k">def</span> <span class="nf">get_flux_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">y_method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">spectral_index</span><span class="p">):</span>
    <span class="n">table1</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">lafferty_flux</span> <span class="o">=</span> <span class="n">compute_differential_flux_points</span><span class="p">(</span><span class="s1">&#39;lafferty&#39;</span><span class="p">,</span> <span class="n">y_method</span><span class="p">,</span> <span class="n">table1</span><span class="p">,</span>
                                                     <span class="n">function</span><span class="p">,</span> <span class="n">spectral_index</span><span class="p">)</span>
    <span class="n">table2</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">log_flux</span> <span class="o">=</span> <span class="n">compute_differential_flux_points</span><span class="p">(</span><span class="s1">&#39;log_center&#39;</span><span class="p">,</span> <span class="n">y_method</span><span class="p">,</span> <span class="n">table2</span><span class="p">,</span>
                                                <span class="n">function</span><span class="p">,</span> <span class="n">spectral_index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lafferty_flux</span><span class="p">,</span> <span class="n">log_flux</span>


<span class="k">def</span> <span class="nf">plot_flux_points</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">energy_min</span><span class="p">,</span> <span class="n">y_method</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">lafferty_flux</span><span class="p">,</span> <span class="n">log_flux</span> <span class="o">=</span> <span class="n">get_flux_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">y_method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span>
                                              <span class="n">SPECTRAL_INDEX</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">],</span>
                 <span class="p">((</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">]),</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lafferty Method&#39;</span><span class="p">)</span>
    <span class="n">residuals_lafferty</span> <span class="o">=</span> <span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">]</span>
                          <span class="o">-</span> <span class="n">function</span><span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="n">function</span><span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">],</span>
                 <span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">],</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Log Center Method&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">residuals_log</span> <span class="o">=</span> <span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">]</span> <span class="o">-</span>
                     <span class="n">function</span><span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="n">function</span><span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">],</span> <span class="n">residuals_lafferty</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">],</span> <span class="n">residuals_log</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_min</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">energy_min</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                      <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">energy_min</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                      <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;E^2 * Differential Flux&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals/%&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">def</span> <span class="nf">plot_power_law</span><span class="p">():</span>
    <span class="c1"># Define the function</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">spectral_model</span> <span class="o">=</span> <span class="n">my_spectrum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">spectral_model_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">my_spectrum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">spectral_model</span>
    <span class="c1"># Set the x-bins</span>
    <span class="n">energy_min</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
    <span class="n">energy_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_x_lafferty</span><span class="p">(</span><span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="p">,</span>
                                    <span class="n">spectral_model_function</span><span class="p">))</span>
    <span class="n">diff_fluxes</span> <span class="o">=</span> <span class="n">spectral_model_function</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">int_flux</span> <span class="o">=</span> <span class="n">power_law_integral_flux</span><span class="p">(</span><span class="n">diff_fluxes</span><span class="p">,</span> <span class="p">(</span><span class="n">indices</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                       <span class="n">energies</span><span class="p">,</span> <span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="p">)</span>
    <span class="n">special</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">int_flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_integrate</span><span class="p">([</span><span class="n">energy_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="n">energy_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">special</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Put data into table</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY_MIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_min</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY_MAX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_max</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;INT_FLUX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">int_flux</span>
    <span class="n">plot_flux_points</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spectral_model_function</span><span class="p">,</span>
                     <span class="n">energy_min</span><span class="p">,</span> <span class="s1">&#39;power_law&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="flux_point_demo.py">Source code</a>)</p>
</div>
<div class="section" id="method-evaluation">
<h2>Method Evaluation<a class="headerlink" href="index.html#method-evaluation" title="Permalink to this headline">¶</a></h2>
<p>The dependence of the positioning of the x coordinate of the flux point with assumed spectral index is demonstrated below.
As before, the underlying spectrum is a simple power law of index 4. The position is given as the fraction of the size of
the bin in Log Energy, for instance the Log Center method always positions the flux point at the center of the bin for a
Log Energy scale, and so the position is 0.5. The coincidence of the two methods for the power law case of index 2 is evident,
with the Lafferty method positioning the flux point to the right of the Log Center position for power law spectra of index
less than 2, and to the left for index greater than 2.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot of x position depending on spectral index estimation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="c1">#from gammapy.spectrum.flux_point import _energy_lafferty_power_law</span>
<span class="kn">from</span> <span class="nn">gammapy.spectrum.powerlaw</span> <span class="kn">import</span> <span class="n">power_law_evaluate</span><span class="p">,</span> <span class="n">power_law_integral_flux</span>
<span class="kn">from</span> <span class="nn">flux_point_demo</span> <span class="kn">import</span> <span class="n">get_flux_tables</span>

<span class="n">SPECTRAL_INDEX</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">make_x_plot</span><span class="p">():</span>
    <span class="n">energy_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">])</span>
    <span class="n">energy_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span><span class="p">])</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_energy_lafferty_power_law</span><span class="p">(</span><span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="p">,</span>
                                                   <span class="n">SPECTRAL_INDEX</span><span class="p">))</span>
    <span class="n">diff_flux</span> <span class="o">=</span> <span class="n">power_law_evaluate</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SPECTRAL_INDEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># `True&#39; differential &amp; integral fluxes</span>
    <span class="n">int_flux</span> <span class="o">=</span> <span class="n">power_law_integral_flux</span><span class="p">(</span><span class="n">diff_flux</span><span class="p">,</span> <span class="n">SPECTRAL_INDEX</span><span class="p">,</span>
                                       <span class="n">energies</span><span class="p">,</span> <span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="p">)</span>
    <span class="c1"># Put data into table</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY_MIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_min</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY_MAX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_max</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;INT_FLUX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">int_flux</span>
    <span class="n">lafferty_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">log_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectral_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">spectral_index</span> <span class="ow">in</span> <span class="n">spectral_indices</span><span class="p">:</span>
        <span class="n">lafferty_flux</span><span class="p">,</span> <span class="n">log_flux</span> <span class="o">=</span> <span class="n">get_flux_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s1">&#39;power_law&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                                                  <span class="n">spectral_index</span><span class="p">)</span>
        <span class="n">dlog_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_max</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_min</span><span class="p">)</span>
        <span class="n">residuals_lafferty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lafferty_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_min</span><span class="p">))</span> <span class="o">/</span> <span class="n">dlog_energy</span>
        <span class="n">residuals_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log_flux</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_min</span><span class="p">))</span> <span class="o">/</span> <span class="n">dlog_energy</span>
        <span class="n">lafferty_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals_lafferty</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">log_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals_log</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectral_indices</span><span class="p">,</span> <span class="n">lafferty_array</span><span class="p">,</span>
             <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lafferty Method&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectral_indices</span><span class="p">,</span> <span class="n">log_array</span><span class="p">,</span>
             <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Log Center Method&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X position in bin&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Guessed spectral Index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="x_position_plot.py">Source code</a>)</p>
<p>The ability of the two methods to represent an underlying spectrum is demonstrated in the residual images below. Here,
flux points are positioned using the Lafferty method (left image) and Log Center method (central image) for different
&#8216;true&#8217; and &#8216;assumed&#8217; power law spectral indices. Residuals are determined as the difference between the reconstructed flux
compared to the true flux of the underlying spectrum. The closer the residual value is to zero (white), the better the
representation offered.</p>
<p>The residuals log ratio image (right) shows the log ratio of residuals of the Lafferty method to those of the Log Center method,
indicating the regions of assumed/true parameter space for which the Lafferty method offers an improved representation
of the underlying frequency over the Log Center method (blue regions), and where it does not (red regions).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Create residuals image based on the two flux point methods</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="c1">#from gammapy.spectrum.flux_point import compute_differential_flux_points</span>
<span class="kn">from</span> <span class="nn">gammapy.spectrum.powerlaw</span> <span class="kn">import</span> <span class="n">power_law_evaluate</span><span class="p">,</span> <span class="n">power_law_integral_flux</span>


<span class="k">def</span> <span class="nf">compute_flux_error</span><span class="p">(</span><span class="n">gamma_true</span><span class="p">,</span> <span class="n">gamma_reco</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="c1"># Let&#39;s assume a concrete true spectrum and energy bin.</span>
    <span class="c1"># Note that the residuals computed below do *not* depend on</span>
    <span class="c1"># these parameters.</span>
    <span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span>
    <span class="n">energy_ref</span><span class="p">,</span> <span class="n">diff_flux_ref</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="c1"># Compute integral flux in the energy band assuming `gamma_true`</span>
    <span class="n">int_flux</span> <span class="o">=</span> <span class="n">power_law_integral_flux</span><span class="p">(</span><span class="n">diff_flux_ref</span><span class="p">,</span> <span class="n">gamma_true</span><span class="p">,</span>
                                       <span class="n">energy_ref</span><span class="p">,</span> <span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="p">)</span>
    <span class="c1"># Compute flux point</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">compute_differential_flux_points</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;power_law&#39;</span><span class="p">,</span>
                                             <span class="n">spectral_index</span><span class="o">=</span><span class="n">gamma_reco</span><span class="p">,</span>
                                             <span class="n">energy_min</span><span class="o">=</span><span class="n">energy_min</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="n">energy_max</span><span class="p">,</span>
                                             <span class="n">int_flux</span><span class="o">=</span><span class="n">int_flux</span><span class="p">)</span>
    <span class="c1"># Compute relative error of the flux point</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">flux_reco</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">flux_true</span> <span class="o">=</span> <span class="n">power_law_evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">diff_flux_ref</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_true</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                   <span class="n">energy_ref</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">energy</span><span class="p">))</span>
    <span class="n">flux_true</span> <span class="o">=</span> <span class="n">flux_true</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gamma_true</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">flux_reco</span> <span class="o">=</span> <span class="n">flux_reco</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gamma_true</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">flux_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_reco</span> <span class="o">-</span> <span class="n">flux_true</span><span class="p">)</span> <span class="o">/</span> <span class="n">flux_true</span>
    <span class="k">return</span> <span class="n">flux_error</span>


<span class="k">def</span> <span class="nf">residuals_image</span><span class="p">():</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">gamma_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">gamma_reco</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">gamma_true</span><span class="p">,</span> <span class="n">gamma_reco</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">gamma_true</span><span class="p">,</span> <span class="n">gamma_reco</span><span class="p">)</span>
    <span class="n">flux_error_lafferty</span> <span class="o">=</span> <span class="n">compute_flux_error</span><span class="p">(</span><span class="n">gamma_true</span><span class="p">,</span> <span class="n">gamma_reco</span><span class="p">,</span>
                                             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lafferty&#39;</span><span class="p">)</span>
    <span class="n">flux_error_log_center</span> <span class="o">=</span> <span class="n">compute_flux_error</span><span class="p">(</span><span class="n">gamma_true</span><span class="p">,</span> <span class="n">gamma_reco</span><span class="p">,</span>
                                               <span class="n">method</span><span class="o">=</span><span class="s1">&#39;log_center&#39;</span><span class="p">)</span>
    <span class="n">flux_error_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">flux_error_lafferty</span> <span class="o">/</span> <span class="n">flux_error_log_center</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">]</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">axes_1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">axes_1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux_error_lafferty</span><span class="p">),</span>
                  <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                  <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
    <span class="n">axes_1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Assumed Spectral Index&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axes_1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Lafferty Method&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">axes_2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">axes_2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux_error_log_center</span><span class="p">),</span>
                  <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                  <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
    <span class="n">axes_2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True Spectral Index&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axes_2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-Center Method&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">axes_3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axes_3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux_error_ratio</span><span class="p">),</span>
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                       <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                       <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
    <span class="n">axes_3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual Log Ratio: </span><span class="se">\n</span><span class="s1"> Log(Lafferty/Log Center)&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
<p>(<a class="reference external" href="residuals_images.py">Source code</a>)</p>
</div>
<div class="section" id="caveats">
<h2>Caveats<a class="headerlink" href="index.html#caveats" title="Permalink to this headline">¶</a></h2>
<p>It should be noted that in some cases (for instance, a power law with spectral index lower than 2), the Lafferty &amp; Wyatt approach
does not offer a better representation of the underlying spectrum compared to simply taking the log bin center. Indeed, the
improvements that are seen in the Lafferty &amp; Wyatt approach over using the bin Log Center occurs due to Lafferty &amp; Wyatt
simply positioning the flux point further to the left of the bin. Thus there is reason to consider further methods, namely:</p>
<ul class="simple">
<li>Positioning the flux point such that the integral flux on either side of it within the energy bin are equal.</li>
<li>Simply choosing a position towards the left of the bin, for instance at a position 0.2 bin lengths from the left of the bin in log energy.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="index.html#">Where to stick your Spectral Points?</a><ul>
<li><a class="reference internal" href="index.html#lafferty-wyatt-vs-log-center">Lafferty &amp; Wyatt vs. Log Center</a></li>
<li><a class="reference internal" href="index.html#power-law-assumption">Power Law Assumption</a></li>
<li><a class="reference internal" href="index.html#method-evaluation">Method Evaluation</a></li>
<li><a class="reference internal" href="index.html#caveats">Caveats</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/tutorials/flux_point/index.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="index.html#">Back to Top</a></p>
  <p>
    &copy; Copyright 2017, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.5. &nbsp;
    Last built 28 Apr 2017. <br/>
  </p>
</footer>
  </body>
</html>