
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>astropy.table.table &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astropy.table.table</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">from</span> <span class="nn">.index</span> <span class="k">import</span> <span class="n">TableIndices</span><span class="p">,</span> <span class="n">TableLoc</span><span class="p">,</span> <span class="n">TableILoc</span><span class="p">,</span> <span class="n">TableLocIndices</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">ma</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">..io</span> <span class="k">import</span> <span class="n">registry</span> <span class="k">as</span> <span class="n">io_registry</span>
<span class="kn">from</span> <span class="nn">..units</span> <span class="k">import</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">QuantityInfo</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="k">import</span> <span class="n">isiterable</span><span class="p">,</span> <span class="n">ShapedLikeNDArray</span>
<span class="kn">from</span> <span class="nn">..utils.console</span> <span class="k">import</span> <span class="n">color_print</span>
<span class="kn">from</span> <span class="nn">..utils.metadata</span> <span class="k">import</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">..utils.data_info</span> <span class="k">import</span> <span class="n">BaseColumnInfo</span><span class="p">,</span> <span class="n">MixinInfo</span><span class="p">,</span> <span class="n">ParentDtypeInfo</span><span class="p">,</span> <span class="n">DataInfo</span>
<span class="kn">from</span> <span class="nn">..utils.exceptions</span> <span class="k">import</span> <span class="n">AstropyDeprecationWarning</span><span class="p">,</span> <span class="n">NoValue</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">groups</span>
<span class="kn">from</span> <span class="nn">.pprint</span> <span class="k">import</span> <span class="n">TableFormatter</span>
<span class="kn">from</span> <span class="nn">.column</span> <span class="k">import</span> <span class="p">(</span><span class="n">BaseColumn</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MaskedColumn</span><span class="p">,</span> <span class="n">_auto_names</span><span class="p">,</span> <span class="n">FalseArray</span><span class="p">,</span>
                     <span class="n">col_copy</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.row</span> <span class="k">import</span> <span class="n">Row</span>
<span class="kn">from</span> <span class="nn">.np_utils</span> <span class="k">import</span> <span class="n">fix_column_name</span><span class="p">,</span> <span class="n">recarray_fromrecords</span>
<span class="kn">from</span> <span class="nn">.info</span> <span class="k">import</span> <span class="n">TableInfo</span>
<span class="kn">from</span> <span class="nn">.index</span> <span class="k">import</span> <span class="n">Index</span><span class="p">,</span> <span class="n">_IndexModeContext</span><span class="p">,</span> <span class="n">get_index</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">conf</span>


<span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Table.read&#39;</span><span class="p">,</span> <span class="s1">&#39;Table.write&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Table.convert_bytestring_to_unicode&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Table.convert_unicode_to_bytestring&#39;</span><span class="p">,</span>
                    <span class="p">]</span>


<span class="k">class</span> <span class="nc">TableReplaceWarning</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Warning class for cases when a table column is replaced via the</span>
<span class="sd">    Table.__setitem__ syntax e.g. t[&#39;a&#39;] = val.</span>

<span class="sd">    This does not inherit from AstropyWarning because we want to use</span>
<span class="sd">    stacklevel=3 to show the user where the issue occurred in their code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">descr</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Array-interface compliant full description of a column.</span>

<span class="sd">    This returns a 3-tuple (name, type, shape) that can always be</span>
<span class="sd">    used in a structured array dtype definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col_dtype</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">col_shape</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col_dtype</span><span class="p">,</span> <span class="n">col_shape</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">has_info_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TableColumns</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;OrderedDict subclass for a set of columns.</span>

<span class="sd">    This class enhances item access to provide convenient access to columns</span>
<span class="sd">    by name or index, including slice access.  It also handles renaming</span>
<span class="sd">    of columns.</span>

<span class="sd">    The initialization argument ``cols`` can be a list of ``Column`` objects</span>
<span class="sd">    or any structure that is valid for initializing a Python dict.  This</span>
<span class="sd">    includes a dict, list of (key, val) tuples or [key, val] lists, etc.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cols : dict, list, tuple; optional</span>
<span class="sd">        Column objects as data structure that can init dict (see above)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="c1"># `cols` should be a list of two-tuples, but it is allowed to have</span>
            <span class="c1"># columns (BaseColumn or mixins) in the list.</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">has_info_class</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">BaseColumnInfo</span><span class="p">):</span>
                    <span class="n">newcols</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">newcols</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get items from a TableColumns object.</span>
<span class="sd">        ::</span>

<span class="sd">          tc = TableColumns(cols=[Column(name=&#39;a&#39;), Column(name=&#39;b&#39;), Column(name=&#39;c&#39;)])</span>
<span class="sd">          tc[&#39;a&#39;]  # Column(&#39;a&#39;)</span>
<span class="sd">          tc[1] # Column(&#39;b&#39;)</span>
<span class="sd">          tc[&#39;a&#39;, &#39;b&#39;] # &lt;TableColumns names=(&#39;a&#39;, &#39;b&#39;)&gt;</span>
<span class="sd">          tc[1:3] # &lt;TableColumns names=(&#39;b&#39;, &#39;c&#39;)&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="n">item</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Illegal key or index value for </span><span class="si">{}</span><span class="s1"> object&#39;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot replace column &#39;</span><span class="si">{0}</span><span class="s2">&#39;.  Use Table.replace_column() instead.&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{1}</span><span class="s2"> names=(</span><span class="si">{0}</span><span class="s2">)&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rename_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">new_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0}</span><span class="s2"> already exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_name</span><span class="p">))</span>

        <span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">new_name</span><span class="p">}</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new_names</span><span class="p">,</span> <span class="n">cols</span><span class="p">)))</span>

    <span class="c1"># Define keys and values for Python 2 and 3 source compatibility</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of columns which are instances of the specified classes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cls : class or tuple of classes</span>
<span class="sd">            Column class (including mixin) or tuple of Column classes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        col_list : list of Columns</span>
<span class="sd">            List of Column objects which are instances of given classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">cols</span>

    <span class="k">def</span> <span class="nf">not_isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of columns which are not instances of the specified classes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cls : class or tuple of classes</span>
<span class="sd">            Column class (including mixin) or tuple of Column classes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        col_list : list of Columns</span>
<span class="sd">            List of Column objects which are not instances of given classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">cols</span>


<span class="k">class</span> <span class="nc">Table</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class to represent tables of heterogeneous data.</span>

<span class="sd">    `Table` provides a class for heterogeneous tabular data, making use of a</span>
<span class="sd">    `numpy` structured array internally to store the data values.  A key</span>
<span class="sd">    enhancement provided by the `Table` class is the ability to easily modify</span>
<span class="sd">    the structure of the table by adding or removing columns, or adding new</span>
<span class="sd">    rows of data.  In addition table and column metadata are fully supported.</span>

<span class="sd">    `Table` differs from `~astropy.nddata.NDData` by the assumption that the</span>
<span class="sd">    input data consists of columns of homogeneous data, where each column</span>
<span class="sd">    has a unique identifier and may contain additional metadata such as the</span>
<span class="sd">    data unit, format, and description.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy ndarray, dict, list, Table, or table-like object, optional</span>
<span class="sd">        Data to initialize table.</span>
<span class="sd">    masked : bool, optional</span>
<span class="sd">        Specify whether the table is masked.</span>
<span class="sd">    names : list, optional</span>
<span class="sd">        Specify column names.</span>
<span class="sd">    dtype : list, optional</span>
<span class="sd">        Specify column data types.</span>
<span class="sd">    meta : dict, optional</span>
<span class="sd">        Metadata associated with the table.</span>
<span class="sd">    copy : bool, optional</span>
<span class="sd">        Copy the input data. If the input is a Table the ``meta`` is always</span>
<span class="sd">        copied regardless of the ``copy`` parameter.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    rows : numpy ndarray, list of lists, optional</span>
<span class="sd">        Row-oriented data for table instead of ``data`` argument.</span>
<span class="sd">    copy_indices : bool, optional</span>
<span class="sd">        Copy any indices in the input data. Default is True.</span>
<span class="sd">    **kwargs : dict, optional</span>
<span class="sd">        Additional keyword args when converting table-like object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

    <span class="c1"># Define class attributes for core container objects to allow for subclass</span>
    <span class="c1"># customization.</span>
    <span class="n">Row</span> <span class="o">=</span> <span class="n">Row</span>
    <span class="n">Column</span> <span class="o">=</span> <span class="n">Column</span>
    <span class="n">MaskedColumn</span> <span class="o">=</span> <span class="n">MaskedColumn</span>
    <span class="n">TableColumns</span> <span class="o">=</span> <span class="n">TableColumns</span>
    <span class="n">TableFormatter</span> <span class="o">=</span> <span class="n">TableFormatter</span>

    <span class="k">def</span> <span class="nf">as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_byteorder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new copy of the table in the form of a structured np.ndarray or</span>
<span class="sd">        np.ma.MaskedArray object (as appropriate).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keep_byteorder : bool, optional</span>
<span class="sd">            By default the returned array has all columns in native byte</span>
<span class="sd">            order.  However, if this option is `True` this preserves the</span>
<span class="sd">            byte order of all columns (if any are non-native).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table_array : np.ndarray (unmasked) or np.ma.MaskedArray (masked)</span>
<span class="sd">            Copy of table as a numpy structured array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">sys_byteorder</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)[</span><span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;little&#39;</span><span class="p">]</span>
        <span class="n">native_order</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">sys_byteorder</span><span class="p">)</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">col_descr</span> <span class="o">=</span> <span class="n">descr</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_byteorder</span> <span class="ow">and</span> <span class="n">byteorder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">native_order</span><span class="p">:</span>
                <span class="n">new_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">col_descr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">col_descr</span> <span class="o">=</span> <span class="p">(</span><span class="n">col_descr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_dt</span><span class="p">,</span> <span class="n">col_descr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_descr</span><span class="p">)</span>

        <span class="n">empty_init</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">empty</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">empty_init</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c1"># When assigning from one array into a field of a structured array,</span>
            <span class="c1"># Numpy will automatically swap those columns to their destination</span>
            <span class="c1"># byte order where applicable</span>
            <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Set up a placeholder empty table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TableColumns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TableFormatter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_indices</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># copy indices from this Table by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span> <span class="o">=</span> <span class="n">copy_indices</span>  <span class="c1"># whether to copy indices in init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Must copy if dtype are changing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">copy</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot specify dtype when copy=False&#39;</span><span class="p">)</span>

        <span class="c1"># Row-oriented input, e.g. list of lists or list of tuples, list of</span>
        <span class="c1"># dict, Row instance.  Set data to something that the subsequent code</span>
        <span class="c1"># will parse correctly.</span>
        <span class="n">is_list_of_dict</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot supply both `data` and `rows` values&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">):</span>
                <span class="n">is_list_of_dict</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Avoid doing the all(...) test twice.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Row</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec_data</span> <span class="o">=</span> <span class="n">recarray_fromrecords</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rec_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="c1"># Infer the type of the input data and set up the initialization</span>
        <span class="c1"># function, number of columns, and potentially the default col names</span>

        <span class="n">default_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;__astropy_table__&#39;</span><span class="p">):</span>
            <span class="c1"># Data object implements the __astropy_table__ interface method.</span>
            <span class="c1"># Calling that method returns an appropriate instance of</span>
            <span class="c1"># self.__class__ and respects the `copy` arg.  The returned</span>
            <span class="c1"># Table object should NOT then be copied (though the meta</span>
            <span class="c1"># will be deep-copied anyway).</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__astropy_table__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;__init__() got unexpected keyword argument </span><span class="si">{!r}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Row</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_table</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">_index</span><span class="p">:</span><span class="n">data</span><span class="o">.</span><span class="n">_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_list_of_dict</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)):</span>
                <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_ndarray</span>  <span class="c1"># _struct</span>
                <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                <span class="n">default_names</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_ndarray</span>  <span class="c1"># _homog</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not initialize a Table with a scalar&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">n_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
            <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_dict</span>
            <span class="n">default_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_names</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_table</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="n">default_names</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">colnames</span>
            <span class="c1"># don&#39;t copy indices if the input Table is in non-copy mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">_copy_indices</span>

        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span>  <span class="c1"># Empty table</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># No data nor names but dtype is available.  This must be</span>
                    <span class="c1"># valid to initialize a structured array.</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dtype was specified but could not be &#39;</span>
                                     <span class="s1">&#39;parsed for column names&#39;</span><span class="p">)</span>
            <span class="c1"># names is guaranteed to be set at this point</span>
            <span class="n">init_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[[]]</span> <span class="o">*</span> <span class="n">n_cols</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Data type </span><span class="si">{0}</span><span class="s1"> not allowed to init Table&#39;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

        <span class="c1"># Set up defaults if names and/or dtype are not specified.</span>
        <span class="c1"># A value of None means the actual value will be inferred</span>
        <span class="c1"># within the appropriate initialization routine, either from</span>
        <span class="c1"># existing specification or auto-generated.</span>

        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">default_names</span> <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_cols</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_cols</span>

        <span class="c1"># Numpy does not support bytes column names on Python 3, so fix them</span>
        <span class="c1"># up now.</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_names_dtype</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>

        <span class="c1"># Finally do the real initialization</span>
        <span class="n">init_func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>

        <span class="c1"># Whatever happens above, the masked property should be set to a boolean</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;masked property has not been set to True or False&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">col</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">BaseColumn</span><span class="p">)</span> <span class="k">else</span> <span class="n">col_copy</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
                              <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">columns</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dynamic view of available masks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
            <span class="n">mask_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">mask</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
                               <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Set hidden attribute to force inplace setitem so that code like</span>
            <span class="c1"># t.mask[&#39;a&#39;] = [1, 0, 1] will correctly set the underlying mask.</span>
            <span class="c1"># See #5556 for discussion.</span>
            <span class="n">mask_table</span><span class="o">.</span><span class="n">_setitem_inplace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">mask_table</span>

    <span class="nd">@mask</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is needed so that comparison of a masked Table and a</span>
<span class="sd">        MaskedArray works.  The requirement comes from numpy.ma.core</span>
<span class="sd">        so don&#39;t remove this property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span><span class="o">.</span><span class="n">mask</span>

    <span class="k">def</span> <span class="nf">filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of self, with masked values filled.</span>

<span class="sd">        If input ``fill_value`` supplied then that value is used for all</span>
<span class="sd">        masked entries in the table.  Otherwise the individual</span>
<span class="sd">        ``fill_value`` defined for each table column is used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill_value : str</span>
<span class="sd">            If supplied, this ``fill_value`` is used for all masked entries</span>
<span class="sd">            in the entire table.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filled_table : Table</span>
<span class="sd">            New table with masked values filled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the indices associated with columns of the table</span>
<span class="sd">        as a TableIndices object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">column</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">index</span> <span class="ow">is</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># ensure uniqueness</span>
                    <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TableIndices</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a TableLoc object that can be used for retrieving</span>
<span class="sd">        rows by index in a given data range. Note that both loc</span>
<span class="sd">        and iloc work only with single-column indices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">TableLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loc_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a TableLocIndices object that can be used for retrieving</span>
<span class="sd">        the row indices corresponding to given table index key value or values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TableLocIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iloc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a TableILoc object that can be used for retrieving</span>
<span class="sd">        indexed rows in the order they appear in the index.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">TableILoc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Insert a new index among one or more columns.</span>
<span class="sd">        If there are no indices, make this index the</span>
<span class="sd">        primary table index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        colnames : str or list</span>
<span class="sd">            List of column names (or a single column name) to index</span>
<span class="sd">        engine : type or None</span>
<span class="sd">            Indexing engine class to use, from among SortedArray, BST,</span>
<span class="sd">            FastBST, and FastRBT. If the supplied argument is None (by</span>
<span class="sd">            default), use SortedArray.</span>
<span class="sd">        unique : bool</span>
<span class="sd">            Whether the values of the index must be unique. Default is False.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="n">colnames</span><span class="p">,)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">colnames</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># make sure all columns support indexing</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="s1">&#39;_supports_indexing&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot create an index on column &quot;</span><span class="si">{0}</span><span class="s1">&quot;, of &#39;</span>
                                 <span class="s1">&#39;type &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">colnames</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove all indices involving the given column.</span>
<span class="sd">        If the primary index is removed, the new primary</span>
<span class="sd">        index will be the most recently added remaining</span>
<span class="sd">        index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        colname : str</span>
<span class="sd">            Name of column</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">col_position</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a context manager for an indexing mode.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : str</span>
<span class="sd">            Either &#39;freeze&#39;, &#39;copy_on_getitem&#39;, or &#39;discard_on_copy&#39;.</span>
<span class="sd">            In &#39;discard_on_copy&#39; mode,</span>
<span class="sd">            indices are not copied whenever columns or tables are copied.</span>
<span class="sd">            In &#39;freeze&#39; mode, indices are not modified whenever columns are</span>
<span class="sd">            modified; at the exit of the context, indices refresh themselves</span>
<span class="sd">            based on column values. This mode is intended for scenarios in</span>
<span class="sd">            which one intends to make many additions or modifications in an</span>
<span class="sd">            indexed column.</span>
<span class="sd">            In &#39;copy_on_getitem&#39; mode, indices are copied when taking column</span>
<span class="sd">            slices as well as table slices, so col[i0:i1] will preserve</span>
<span class="sd">            indices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_IndexModeContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Support converting Table to np.array via np.array(table).</span>

<span class="sd">        Coercion to a different dtype via np.array(table, dtype) is not</span>
<span class="sd">        supported and will raise a ValueError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Datatype coercion is not allowed&#39;</span><span class="p">)</span>

        <span class="c1"># This limitation is because of the following unexpected result that</span>
        <span class="c1"># should have made a table copy while changing the column names.</span>
        <span class="c1">#</span>
        <span class="c1"># &gt;&gt;&gt; d = astropy.table.Table([[1,2],[3,4]])</span>
        <span class="c1"># &gt;&gt;&gt; np.array(d, dtype=[(&#39;a&#39;, &#39;i8&#39;), (&#39;b&#39;, &#39;i8&#39;)])</span>
        <span class="c1"># array([(0, 0), (0, 0)],</span>
        <span class="c1">#       dtype=[(&#39;a&#39;, &#39;&lt;i8&#39;), (&#39;b&#39;, &#39;&lt;i8&#39;)])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_names_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make sure that names and dtype are both iterable and have</span>
<span class="sd">        the same length as data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">inp_list</span><span class="p">,</span> <span class="n">inp_str</span> <span class="ow">in</span> <span class="p">((</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">inp_list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> must be a list or None&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp_str</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_cols</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Arguments &quot;names&quot; and &quot;dtype&quot; must match number of columns&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp_str</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_masked_from_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="p">(</span><span class="n">MaskedColumn</span><span class="p">,</span> <span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="p">(</span><span class="n">MaskedColumn</span><span class="p">,</span> <span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_from_list_of_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">):</span>
        <span class="n">names_from_data</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">names_from_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names_from_data</span><span class="p">:</span>
            <span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Row </span><span class="si">{0}</span><span class="s1"> has no value for column </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names_from_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_dict</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_init_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize table from a list of columns.  A column can be a</span>
<span class="sd">        Column object, np.ndarray, mixin, or any other iterable object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list_of_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Set self.masked appropriately, then get class to create column instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked_from_cols</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">def_names</span> <span class="o">=</span> <span class="n">_auto_names</span><span class="p">(</span><span class="n">n_cols</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">def_name</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">def_names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
            <span class="c1"># Structured ndarray gets viewed as a mixin unless already a valid</span>
            <span class="c1"># mixin class</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_as_mixin_column</span><span class="p">(</span><span class="n">col</span><span class="p">)):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NdarrayMixin</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">MaskedColumn</span><span class="p">)):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">def_name</span><span class="p">),</span>
                                       <span class="n">data</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                                       <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">copy_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_as_mixin_column</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                <span class="c1"># Copy the mixin column attributes if they exist since the copy below</span>
                <span class="c1"># may not get this attribute.</span>
                <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col_copy</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">copy_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span><span class="p">)</span>

                <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">def_name</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="n">def_name</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                                       <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">copy_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_indices</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Elements in list initialization must be &#39;</span>
                                 <span class="s1">&#39;either Column or list-like&#39;</span><span class="p">)</span>

            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_from_ndarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize table from an ndarray structured array&quot;&quot;&quot;</span>

        <span class="n">data_names</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">or</span> <span class="n">_auto_names</span><span class="p">(</span><span class="n">n_cols</span><span class="p">)</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="ow">or</span> <span class="n">data_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)]</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_names</span><span class="p">]</span> <span class="k">if</span> <span class="n">struct</span> <span class="k">else</span>
                <span class="p">[</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">)])</span>

        <span class="c1"># Set self.masked appropriately, then get class to create column instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked_from_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">cols</span><span class="p">)]</span>
            <span class="n">newdata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TableColumns</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">newdata</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">def</span> <span class="nf">_init_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize table from a dictionary of columns&quot;&quot;&quot;</span>

        <span class="c1"># TODO: is this restriction still needed with no ndarray?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">copy</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot use copy=False with a dict data input&#39;</span><span class="p">)</span>

        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_from_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize table from an existing Table object &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># data is really a Table, rename for clarity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_list</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_col_for_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that all Column objects have correct class for this type of</span>
<span class="sd">        Table.  For a base Table this most commonly means setting to</span>
<span class="sd">        MaskedColumn if the table is masked.  Table subclasses like QTable</span>
<span class="sd">        override this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>  <span class="c1"># copy attributes and reference data</span>
        <span class="k">return</span> <span class="n">col</span>

    <span class="k">def</span> <span class="nf">_init_from_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize table from a list of Column or mixin objects&quot;&quot;&quot;</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inconsistent data column lengths: </span><span class="si">{0}</span><span class="s1">&#39;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lengths</span><span class="p">))</span>

        <span class="c1"># Set the table masking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked_from_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

        <span class="c1"># Make sure that all Column-based objects have correct class.  For</span>
        <span class="c1"># plain Table this is self.ColumnClass, but for instance QTable will</span>
        <span class="c1"># convert columns with units to a Quantity mixin.</span>
        <span class="n">newcols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_col_for_table</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_table_from_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcols</span><span class="p">)</span>

        <span class="c1"># Deduplicate indices.  It may happen that after pickling or when</span>
        <span class="c1"># initing from an existing table that column indices which had been</span>
        <span class="c1"># references to a single index object got *copied* into an independent</span>
        <span class="c1"># object.  This results in duplicates which will cause downstream problems.</span>
        <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itercols</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span> <span class="ow">or</span> <span class="p">[]):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ind_col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ind_col</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="p">:</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">names</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">index_dict</span><span class="p">[</span><span class="n">names</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">_new_from_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new table as a referenced slice from self.&quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="n">newcols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_copy_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_indices</span>
            <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">slice_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">slice_indices</span><span class="p">(</span><span class="n">newcol</span><span class="p">,</span> <span class="n">slice_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="n">newcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcol</span><span class="p">)</span>
            <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_copy_indices</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_make_table_from_cols</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">newcols</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_table_from_cols</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make ``table`` in-place so that it represents the given list of ``cols``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Cannot have None for column name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colnames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Duplicate column names&#39;</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">TableColumns</span><span class="p">((</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="o">=</span> <span class="n">table</span>
            <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">masked</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">):</span>
                <span class="n">col</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">FalseArray</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">def</span> <span class="nf">itercols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over the columns of this table.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        To iterate over the columns of a table::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1], [2]])</span>
<span class="sd">            &gt;&gt;&gt; for col in t.itercols():</span>
<span class="sd">            ...     print(col)</span>
<span class="sd">            col0</span>
<span class="sd">            ----</span>
<span class="sd">               1</span>
<span class="sd">            col1</span>
<span class="sd">            ----</span>
<span class="sd">               2</span>

<span class="sd">        Using ``itercols()`` is similar to  ``for col in t.columns.values()``</span>
<span class="sd">        but is syntactically preferred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_base_repr_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">descr_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">tableid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">tableclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">descr_vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">descr_vals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
                <span class="n">descr_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;masked=True&#39;</span><span class="p">)</span>
            <span class="n">descr_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;length=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">descr_vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..utils.xml.writer</span> <span class="k">import</span> <span class="n">xml_escape</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;&lt;i&gt;</span><span class="si">{0}</span><span class="s1">&lt;/i&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xml_escape</span><span class="p">(</span><span class="n">descr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1">&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tableid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tableid</span> <span class="o">=</span> <span class="s1">&#39;table</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">data_lines</span><span class="p">,</span> <span class="n">outs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_pformat_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">tableid</span><span class="o">=</span><span class="n">tableid</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="n">html</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
            <span class="n">show_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="n">show_dtype</span><span class="p">,</span>
            <span class="n">max_lines</span><span class="o">=</span><span class="n">max_lines</span><span class="p">,</span> <span class="n">tableclass</span><span class="o">=</span><span class="n">tableclass</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">descr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_repr_</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">tableclass</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_notebook_table_class</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_repr_</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pformat</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_mixin_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if table has any mixin columns (defined as columns that are not Column</span>
<span class="sd">        subclasses).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">has_info_class</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">MixinInfo</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_add_as_mixin_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if ``col`` should be added to the table directly as</span>
<span class="sd">        a mixin column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">BaseColumn</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Is it a mixin but not not Quantity (which gets converted to Column with</span>
        <span class="c1"># unit set).</span>
        <span class="k">return</span> <span class="n">has_info_class</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">MixinInfo</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_info_class</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">QuantityInfo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">show_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print a formatted string representation of the table.</span>

<span class="sd">        If no value of ``max_lines`` is supplied then the height of the</span>
<span class="sd">        screen terminal is used to set ``max_lines``.  If the terminal</span>
<span class="sd">        height cannot be determined then the default is taken from the</span>
<span class="sd">        configuration item ``astropy.conf.max_lines``.  If a negative</span>
<span class="sd">        value of ``max_lines`` is supplied then there is no line limit</span>
<span class="sd">        applied.</span>

<span class="sd">        The same applies for max_width except the configuration item is</span>
<span class="sd">        ``astropy.conf.max_width``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_lines : int</span>
<span class="sd">            Maximum number of lines in table output.</span>

<span class="sd">        max_width : int or `None`</span>
<span class="sd">            Maximum character width of output.</span>

<span class="sd">        show_name : bool</span>
<span class="sd">            Include a header row for column names. Default is True.</span>

<span class="sd">        show_unit : bool</span>
<span class="sd">            Include a header row for unit.  Default is to show a row</span>
<span class="sd">            for units only if one or more columns has a defined value</span>
<span class="sd">            for the unit.</span>

<span class="sd">        show_dtype : bool</span>
<span class="sd">            Include a header row for column dtypes. Default is True.</span>

<span class="sd">        align : str or list or tuple or `None`</span>
<span class="sd">            Left/right alignment of columns. Default is right (None) for all</span>
<span class="sd">            columns. Other allowed values are &#39;&gt;&#39;, &#39;&lt;&#39;, &#39;^&#39;, and &#39;0=&#39; for</span>
<span class="sd">            right, left, centered, and 0-padded, respectively. A list of</span>
<span class="sd">            strings can be provided for alignment of tables with multiple</span>
<span class="sd">            columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">outs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_pformat_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span>
                                                    <span class="n">show_name</span><span class="o">=</span><span class="n">show_name</span><span class="p">,</span> <span class="n">show_unit</span><span class="o">=</span><span class="n">show_unit</span><span class="p">,</span>
                                                    <span class="n">show_dtype</span><span class="o">=</span><span class="n">show_dtype</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outs</span><span class="p">[</span><span class="s1">&#39;show_length&#39;</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Length = </span><span class="si">{0}</span><span class="s1"> rows&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="n">n_header</span> <span class="o">=</span> <span class="n">outs</span><span class="p">[</span><span class="s1">&#39;n_header&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_header</span><span class="p">:</span>
                <span class="n">color_print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_index_row_display_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_row_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index_row_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">idx_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">index_row_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="n">idx_col</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                                           <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">show_in_notebook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                         <span class="n">table_class</span><span class="o">=</span><span class="s1">&#39;astropy-default&#39;</span><span class="p">,</span> <span class="n">show_row_index</span><span class="o">=</span><span class="s1">&#39;idx&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Render the table in HTML and show it in the IPython notebook.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tableid : str or `None`</span>
<span class="sd">            An html ID tag for the table.  Default is ``table{id}-XXX``, where</span>
<span class="sd">            id is the unique integer id of the table object, id(self), and XXX</span>
<span class="sd">            is a random number to avoid conflicts when printing the same table</span>
<span class="sd">            multiple times.</span>
<span class="sd">        table_class : str or `None`</span>
<span class="sd">            A string with a list of HTML classes used to style the table.</span>
<span class="sd">            The special default string (&#39;astropy-default&#39;) means that the string</span>
<span class="sd">            will be retrieved from the configuration item</span>
<span class="sd">            ``astropy.table.default_notebook_table_class``. Note that these</span>
<span class="sd">            table classes may make use of bootstrap, as this is loaded with the</span>
<span class="sd">            notebook.  See `this page &lt;http://getbootstrap.com/css/#tables&gt;`_</span>
<span class="sd">            for the list of classes.</span>
<span class="sd">        css : string</span>
<span class="sd">            A valid CSS string declaring the formatting for the table. Defaults</span>
<span class="sd">            to ``astropy.table.jsviewer.DEFAULT_CSS_NB``.</span>
<span class="sd">        display_length : int, optional</span>
<span class="sd">            Number or rows to show. Defaults to 50.</span>
<span class="sd">        show_row_index : str or False</span>
<span class="sd">            If this does not evaluate to False, a column with the given name</span>
<span class="sd">            will be added to the version of the table that gets displayed.</span>
<span class="sd">            This new column shows the index of the row in the table itself,</span>
<span class="sd">            even when the displayed table is re-sorted by another column. Note</span>
<span class="sd">            that if a column with this name already exists, this option will be</span>
<span class="sd">            ignored. Defaults to &quot;idx&quot;.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Currently, unlike `show_in_browser` (with ``jsviewer=True``), this</span>
<span class="sd">        method needs to access online javascript code repositories.  This is due</span>
<span class="sd">        to modern browsers&#39; limitations on accessing local files.  Hence, if you</span>
<span class="sd">        call this method while offline (and don&#39;t have a cached version of</span>
<span class="sd">        jquery and jquery.dataTables), you will not get the jsviewer features.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.jsviewer</span> <span class="k">import</span> <span class="n">JSViewer</span>
        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">HTML</span>

        <span class="k">if</span> <span class="n">tableid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tableid</span> <span class="o">=</span> <span class="s1">&#39;table</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>

        <span class="n">jsv</span> <span class="o">=</span> <span class="n">JSViewer</span><span class="p">(</span><span class="n">display_length</span><span class="o">=</span><span class="n">display_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_row_index</span><span class="p">:</span>
            <span class="n">display_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_index_row_display_table</span><span class="p">(</span><span class="n">show_row_index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">display_table</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">table_class</span> <span class="o">==</span> <span class="s1">&#39;astropy-default&#39;</span><span class="p">:</span>
            <span class="n">table_class</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">default_notebook_table_class</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">display_table</span><span class="o">.</span><span class="n">_base_repr_</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tableid</span><span class="o">=</span><span class="n">tableid</span><span class="p">,</span>
                                         <span class="n">max_lines</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">tableclass</span><span class="o">=</span><span class="n">table_class</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="n">display_table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">sortable_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="s1">&#39;iufc&#39;</span><span class="p">]</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="n">jsv</span><span class="o">.</span><span class="n">ipynb</span><span class="p">(</span><span class="n">tableid</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">sort_columns</span><span class="o">=</span><span class="n">sortable_columns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_in_browser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">jsviewer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">browser</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">jskwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;use_local_files&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                        <span class="n">tableid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_class</span><span class="o">=</span><span class="s2">&quot;display compact&quot;</span><span class="p">,</span>
                        <span class="n">css</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_row_index</span><span class="o">=</span><span class="s1">&#39;idx&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Render the table in HTML and show it in a web browser.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_lines : int</span>
<span class="sd">            Maximum number of rows to export to the table (set low by default</span>
<span class="sd">            to avoid memory issues, since the browser view requires duplicating</span>
<span class="sd">            the table in memory).  A negative value of ``max_lines`` indicates</span>
<span class="sd">            no row limit.</span>
<span class="sd">        jsviewer : bool</span>
<span class="sd">            If `True`, prepends some javascript headers so that the table is</span>
<span class="sd">            rendered as a `DataTables &lt;https://datatables.net&gt;`_ data table.</span>
<span class="sd">            This allows in-browser searching &amp; sorting.</span>
<span class="sd">        browser : str</span>
<span class="sd">            Any legal browser name, e.g. ``&#39;firefox&#39;``, ``&#39;chrome&#39;``,</span>
<span class="sd">            ``&#39;safari&#39;`` (for mac, you may need to use ``&#39;open -a</span>
<span class="sd">            &quot;/Applications/Google Chrome.app&quot; {}&#39;`` for Chrome).  If</span>
<span class="sd">            ``&#39;default&#39;``, will use the system default browser.</span>
<span class="sd">        jskwargs : dict</span>
<span class="sd">            Passed to the `astropy.table.JSViewer` init. Defaults to</span>
<span class="sd">            ``{&#39;use_local_files&#39;: True}`` which means that the JavaScript</span>
<span class="sd">            libraries will be served from local copies.</span>
<span class="sd">        tableid : str or `None`</span>
<span class="sd">            An html ID tag for the table.  Default is ``table{id}``, where id</span>
<span class="sd">            is the unique integer id of the table object, id(self).</span>
<span class="sd">        table_class : str or `None`</span>
<span class="sd">            A string with a list of HTML classes used to style the table.</span>
<span class="sd">            Default is &quot;display compact&quot;, and other possible values can be</span>
<span class="sd">            found in https://www.datatables.net/manual/styling/classes</span>
<span class="sd">        css : string</span>
<span class="sd">            A valid CSS string declaring the formatting for the table. Defaults</span>
<span class="sd">            to ``astropy.table.jsviewer.DEFAULT_CSS``.</span>
<span class="sd">        show_row_index : str or False</span>
<span class="sd">            If this does not evaluate to False, a column with the given name</span>
<span class="sd">            will be added to the version of the table that gets displayed.</span>
<span class="sd">            This new column shows the index of the row in the table itself,</span>
<span class="sd">            even when the displayed table is re-sorted by another column. Note</span>
<span class="sd">            that if a column with this name already exists, this option will be</span>
<span class="sd">            ignored. Defaults to &quot;idx&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">os</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="kn">from</span> <span class="nn">.jsviewer</span> <span class="k">import</span> <span class="n">DEFAULT_CSS</span>
        <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urljoin</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="k">import</span> <span class="n">pathname2url</span>

        <span class="k">if</span> <span class="n">css</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="n">DEFAULT_CSS</span>

        <span class="c1"># We can&#39;t use NamedTemporaryFile here because it gets deleted as</span>
        <span class="c1"># soon as it gets garbage collected.</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;table.html&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">jsviewer</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_row_index</span><span class="p">:</span>
                    <span class="n">display_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_index_row_display_table</span><span class="p">(</span><span class="n">show_row_index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">display_table</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">display_table</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jsviewer&#39;</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span>
                                    <span class="n">max_lines</span><span class="o">=</span><span class="n">max_lines</span><span class="p">,</span> <span class="n">jskwargs</span><span class="o">=</span><span class="n">jskwargs</span><span class="p">,</span>
                                    <span class="n">table_id</span><span class="o">=</span><span class="n">tableid</span><span class="p">,</span> <span class="n">table_class</span><span class="o">=</span><span class="n">table_class</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">browser</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span> <span class="k">else</span> <span class="n">browser</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Browser &#39;</span><span class="si">{}</span><span class="s2">&#39; not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">br</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">,</span> <span class="n">pathname2url</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">pformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">show_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tableid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tableclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of lines for the formatted string representation of</span>
<span class="sd">        the table.</span>

<span class="sd">        If no value of ``max_lines`` is supplied then the height of the</span>
<span class="sd">        screen terminal is used to set ``max_lines``.  If the terminal</span>
<span class="sd">        height cannot be determined then the default is taken from the</span>
<span class="sd">        configuration item ``astropy.conf.max_lines``.  If a negative</span>
<span class="sd">        value of ``max_lines`` is supplied then there is no line limit</span>
<span class="sd">        applied.</span>

<span class="sd">        The same applies for ``max_width`` except the configuration item  is</span>
<span class="sd">        ``astropy.conf.max_width``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_lines : int or `None`</span>
<span class="sd">            Maximum number of rows to output</span>

<span class="sd">        max_width : int or `None`</span>
<span class="sd">            Maximum character width of output</span>

<span class="sd">        show_name : bool</span>
<span class="sd">            Include a header row for column names. Default is True.</span>

<span class="sd">        show_unit : bool</span>
<span class="sd">            Include a header row for unit.  Default is to show a row</span>
<span class="sd">            for units only if one or more columns has a defined value</span>
<span class="sd">            for the unit.</span>

<span class="sd">        show_dtype : bool</span>
<span class="sd">            Include a header row for column dtypes. Default is True.</span>

<span class="sd">        html : bool</span>
<span class="sd">            Format the output as an HTML table. Default is False.</span>

<span class="sd">        tableid : str or `None`</span>
<span class="sd">            An ID tag for the table; only used if html is set.  Default is</span>
<span class="sd">            &quot;table{id}&quot;, where id is the unique integer id of the table object,</span>
<span class="sd">            id(self)</span>

<span class="sd">        align : str or list or tuple or `None`</span>
<span class="sd">            Left/right alignment of columns. Default is right (None) for all</span>
<span class="sd">            columns. Other allowed values are &#39;&gt;&#39;, &#39;&lt;&#39;, &#39;^&#39;, and &#39;0=&#39; for</span>
<span class="sd">            right, left, centered, and 0-padded, respectively. A list of</span>
<span class="sd">            strings can be provided for alignment of tables with multiple</span>
<span class="sd">            columns.</span>

<span class="sd">        tableclass : str or list of str or `None`</span>
<span class="sd">            CSS classes for the table; only used if html is set.  Default is</span>
<span class="sd">            None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Formatted table as a list of strings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lines</span><span class="p">,</span> <span class="n">outs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_pformat_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="n">show_name</span><span class="p">,</span>
            <span class="n">show_unit</span><span class="o">=</span><span class="n">show_unit</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="n">show_dtype</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="n">html</span><span class="p">,</span>
            <span class="n">tableid</span><span class="o">=</span><span class="n">tableid</span><span class="p">,</span> <span class="n">tableclass</span><span class="o">=</span><span class="n">tableclass</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outs</span><span class="p">[</span><span class="s1">&#39;show_length&#39;</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Length = </span><span class="si">{0}</span><span class="s1"> rows&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">more</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">show_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interactively browse table with a paging interface.</span>

<span class="sd">        Supported keys::</span>

<span class="sd">          f, &lt;space&gt; : forward one page</span>
<span class="sd">          b : back one page</span>
<span class="sd">          r : refresh same page</span>
<span class="sd">          n : next row</span>
<span class="sd">          p : previous row</span>
<span class="sd">          &lt; : go to beginning</span>
<span class="sd">          &gt; : go to end</span>
<span class="sd">          q : quit browsing</span>
<span class="sd">          h : print this help</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_lines : int</span>
<span class="sd">            Maximum number of lines in table output</span>

<span class="sd">        max_width : int or `None`</span>
<span class="sd">            Maximum character width of output</span>

<span class="sd">        show_name : bool</span>
<span class="sd">            Include a header row for column names. Default is True.</span>

<span class="sd">        show_unit : bool</span>
<span class="sd">            Include a header row for unit.  Default is to show a row</span>
<span class="sd">            for units only if one or more columns has a defined value</span>
<span class="sd">            for the unit.</span>

<span class="sd">        show_dtype : bool</span>
<span class="sd">            Include a header row for column dtypes. Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_more_tabcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_lines</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="n">show_name</span><span class="p">,</span>
                                    <span class="n">show_unit</span><span class="o">=</span><span class="n">show_unit</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="n">show_dtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_list_or_tuple_of_str</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">],</span>
                                 <span class="n">meta</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                                 <span class="n">copy_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_copy_indices</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">TableGroups</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span>
                                             <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">elif</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
              <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="p">)):</span>
            <span class="c1"># If item is an empty array/list/tuple then return the table with no rows</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_from_slice</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">or</span>
              <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span>
              <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span>
              <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                                              <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">)):</span>
            <span class="c1"># here for the many ways to give a slice; a tuple of ndarray</span>
            <span class="c1"># is produced by np.where, as in t[np.where(t[&#39;a&#39;] &gt; 2)]</span>
            <span class="c1"># For all, a new table is constructed with slice of all columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_from_slice</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal type </span><span class="si">{0}</span><span class="s1"> for table item access&#39;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># If the item is a string then it must be the name of a column.</span>
        <span class="c1"># If that column doesn&#39;t already exist then create it now.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
            <span class="n">NewColumn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaskedColumn</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Column</span>
            <span class="c1"># If value doesn&#39;t have a dtype and won&#39;t be added as a mixin then</span>
            <span class="c1"># convert to a numpy array.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_as_mixin_column</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Structured ndarray gets viewed as a mixin (unless already a valid</span>
            <span class="c1"># mixin class).</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_as_mixin_column</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NdarrayMixin</span><span class="p">)</span>

            <span class="c1"># Make new column and assign the value.  If the table currently</span>
            <span class="c1"># has no rows (len=0) of the value is already a Column then</span>
            <span class="c1"># define new column directly from value.  In the latter case</span>
            <span class="c1"># this allows for propagation of Column metadata.  Otherwise</span>
            <span class="c1"># define a new column with the right length and shape and then</span>
            <span class="c1"># set it from value.  This allows for broadcasting, e.g. t[&#39;a&#39;]</span>
            <span class="c1"># = 1.</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span>
            <span class="c1"># If this is a column-like object that could be added directly to table</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BaseColumn</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_as_mixin_column</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="c1"># If we&#39;re setting a new column to a scalar, broadcast it.</span>
                <span class="c1"># (things will fail in _init_from_cols if this doesn&#39;t work)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;isscalar&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span>
                                       <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span>
                                       <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">())[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                                <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ShapedLikeNDArray</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">new_column</span> <span class="o">=</span> <span class="n">col_copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">new_column</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_column</span> <span class="o">=</span> <span class="n">NewColumn</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_column</span> <span class="o">=</span> <span class="n">NewColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                                       <span class="n">shape</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                       <span class="n">unit</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">new_column</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Now add new column to the table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_columns</span><span class="p">([</span><span class="n">new_column</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Set an existing column by first trying to replace, and if</span>
                <span class="c1"># this fails do an in-place update.  See definition of mask</span>
                <span class="c1"># property for discussion of the _setitem_inplace attribute.</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_setitem_inplace&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">replace_inplace</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_column_warnings</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">item</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_row</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">colnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span>  <span class="c1"># output from np.where</span>
                   <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">))):</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="kn">import</span> <span class="nn">itertools</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Assume this is an iterable that will work</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_cols</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Right side value needs </span><span class="si">{0}</span><span class="s1"> elements (one for each column)&#39;</span>
                                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_cols</span><span class="p">))</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">value</span>

                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">vals</span><span class="p">):</span>
                    <span class="n">col</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal type </span><span class="si">{0}</span><span class="s1"> for table item access&#39;</span>
                                 <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_row</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span>
              <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span>
              <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;illegal key or index value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ipython_key_completions_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return column[item] for recarray compatibility.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">masked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span>

    <span class="nd">@masked</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">masked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">masked</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Masked attribute is read-only (use t = Table(t, masked=True)&#39;</span>
                        <span class="s1">&#39; to convert to a masked table)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_masked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">masked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the table masked property.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        masked : bool</span>
<span class="sd">            State of table masking (`True` or `False`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_masked&#39;</span><span class="p">):</span>
            <span class="c1"># The only allowed change is from None to False or True, or False to True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">masked</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="o">=</span> <span class="n">masked</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">masked</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Upgrading Table to masked Table. Use Table.filled() to convert to unmasked table.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="o">=</span> <span class="n">masked</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="ow">is</span> <span class="n">masked</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Masked attribute is already set to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">masked</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot change masked attribute to </span><span class="si">{0}</span><span class="s2"> once it is set to </span><span class="si">{1}</span><span class="s2">&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">masked</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span> <span class="o">=</span> <span class="n">masked</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;masked should be one of True, False, None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaskedColumn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Column</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ColumnClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_class</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([</span><span class="n">descr</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_list_or_tuple_of_str</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that ``names`` is a tuple or list of strings&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="n">names</span> <span class="ow">and</span>
                <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">len_strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1"> : </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Column length mismatch:</span><span class="se">\n</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">len_strs</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">lengths</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">index_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the positional index of column ``name``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            column name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index : int</span>
<span class="sd">            Positional index of column ``name``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Get index of column &#39;b&#39; of the table::</span>

<span class="sd">            &gt;&gt;&gt; t.index_column(&#39;b&#39;)</span>
<span class="sd">            1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rename_duplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new Column object ``col`` to the table.  If ``index``</span>
<span class="sd">        is supplied then insert column before ``index`` position</span>
<span class="sd">        in the list of columns, otherwise append column to the end</span>
<span class="sd">        of the list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        col : Column</span>
<span class="sd">            Column object to add.</span>
<span class="sd">        index : int or `None`</span>
<span class="sd">            Insert column before this position or at end (default).</span>
<span class="sd">        name : str</span>
<span class="sd">            Column name</span>
<span class="sd">        rename_duplicate : bool</span>
<span class="sd">            Uniquify column name if it already exist. Default is False.</span>
<span class="sd">        copy : bool</span>
<span class="sd">            Make a copy of the new column. Default is True.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with two columns &#39;a&#39; and &#39;b&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b</span>
<span class="sd">            --- ---</span>
<span class="sd">              1 0.1</span>
<span class="sd">              2 0.2</span>
<span class="sd">              3 0.3</span>

<span class="sd">        Create a third column &#39;c&#39; and append it to the end of the table::</span>

<span class="sd">            &gt;&gt;&gt; col_c = Column(name=&#39;c&#39;, data=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_c)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Add column &#39;d&#39; at position 1. Note that the column is inserted</span>
<span class="sd">        before the given index::</span>

<span class="sd">            &gt;&gt;&gt; col_d = Column(name=&#39;d&#39;, data=[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_d, 1)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   d   b   c</span>
<span class="sd">            --- --- --- ---</span>
<span class="sd">              1   a 0.1   x</span>
<span class="sd">              2   b 0.2   y</span>
<span class="sd">              3   c 0.3   z</span>

<span class="sd">        Add second column named &#39;b&#39; with rename_duplicate::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; col_b = Column(name=&#39;b&#39;, data=[1.1, 1.2, 1.3])</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_b, rename_duplicate=True)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b  b_1</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1 1.1</span>
<span class="sd">              2 0.2 1.2</span>
<span class="sd">              3 0.3 1.3</span>

<span class="sd">        Add an unnamed column or mixin object in the table using a default name</span>
<span class="sd">        or by specifying an explicit name with ``name``. Name can also be overridden::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2], [0.1, 0.2]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; col_c = Column(data=[&#39;x&#39;, &#39;y&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_c)</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_c, name=&#39;c&#39;)</span>
<span class="sd">            &gt;&gt;&gt; col_b = Column(name=&#39;b&#39;, data=[1.1, 1.2])</span>
<span class="sd">            &gt;&gt;&gt; t.add_column(col_b, name=&#39;d&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b  col2  c   d</span>
<span class="sd">            --- --- ---- --- ---</span>
<span class="sd">              1 0.1    x   x 1.1</span>
<span class="sd">              2 0.2    y   y 1.2</span>

<span class="sd">        To add several columns use add_columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_columns</span><span class="p">([</span><span class="n">col</span><span class="p">],</span> <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">rename_duplicate</span><span class="o">=</span><span class="n">rename_duplicate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rename_duplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a list of new Column objects ``cols`` to the table.  If a</span>
<span class="sd">        corresponding list of ``indexes`` is supplied then insert column</span>
<span class="sd">        before each ``index`` position in the *original* list of columns,</span>
<span class="sd">        otherwise append columns to the end of the list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cols : list of Columns</span>
<span class="sd">            Column objects to add.</span>
<span class="sd">        indexes : list of ints or `None`</span>
<span class="sd">            Insert column before this position or at end (default).</span>
<span class="sd">        names : list of str</span>
<span class="sd">            Column names</span>
<span class="sd">        copy : bool</span>
<span class="sd">            Make a copy of the new columns. Default is True.</span>
<span class="sd">        rename_duplicate : bool</span>
<span class="sd">            Uniquify new column names if they duplicate the existing ones.</span>
<span class="sd">            Default is False.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with two columns &#39;a&#39; and &#39;b&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b</span>
<span class="sd">            --- ---</span>
<span class="sd">              1 0.1</span>
<span class="sd">              2 0.2</span>
<span class="sd">              3 0.3</span>

<span class="sd">        Create column &#39;c&#39; and &#39;d&#39; and append them to the end of the table::</span>

<span class="sd">            &gt;&gt;&gt; col_c = Column(name=&#39;c&#39;, data=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])</span>
<span class="sd">            &gt;&gt;&gt; col_d = Column(name=&#39;d&#39;, data=[&#39;u&#39;, &#39;v&#39;, &#39;w&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_columns([col_c, col_d])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c   d</span>
<span class="sd">            --- --- --- ---</span>
<span class="sd">              1 0.1   x   u</span>
<span class="sd">              2 0.2   y   v</span>
<span class="sd">              3 0.3   z   w</span>

<span class="sd">        Add column &#39;c&#39; at position 0 and column &#39;d&#39; at position 1. Note that</span>
<span class="sd">        the columns are inserted before the given position::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; col_c = Column(name=&#39;c&#39;, data=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])</span>
<span class="sd">            &gt;&gt;&gt; col_d = Column(name=&#39;d&#39;, data=[&#39;u&#39;, &#39;v&#39;, &#39;w&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_columns([col_c, col_d], [0, 1])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             c   a   d   b</span>
<span class="sd">            --- --- --- ---</span>
<span class="sd">              x   1   u 0.1</span>
<span class="sd">              y   2   v 0.2</span>
<span class="sd">              z   3   w 0.3</span>

<span class="sd">        Add second column &#39;b&#39; and column &#39;c&#39; with ``rename_duplicate``::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; col_b = Column(name=&#39;b&#39;, data=[1.1, 1.2, 1.3])</span>
<span class="sd">            &gt;&gt;&gt; col_c = Column(name=&#39;c&#39;, data=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_columns([col_b, col_c], rename_duplicate=True)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b  b_1  c</span>
<span class="sd">            --- --- --- ---</span>
<span class="sd">              1 0.1 1.1  x</span>
<span class="sd">              2 0.2 1.2  y</span>
<span class="sd">              3 0.3 1.3  z</span>

<span class="sd">        Add unnamed columns or mixin objects in the table using default names</span>
<span class="sd">        or by specifying explicit names with ``names``. Names can also be overridden::</span>

<span class="sd">            &gt;&gt;&gt; t = Table()</span>
<span class="sd">            &gt;&gt;&gt; col_a = Column(data=[&#39;x&#39;, &#39;y&#39;])</span>
<span class="sd">            &gt;&gt;&gt; col_b = Column(name=&#39;b&#39;, data=[&#39;u&#39;, &#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; t.add_columns([col_a, col_b])</span>
<span class="sd">            &gt;&gt;&gt; t.add_columns([col_a, col_b], names=[&#39;c&#39;, &#39;d&#39;])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">            col0  b   c   d</span>
<span class="sd">            ---- --- --- ---</span>
<span class="sd">               x   u   x   u</span>
<span class="sd">               y   v   y   v</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of indexes must match number of cols&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_copy</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># No existing table data, init from cols</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">new_indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newcols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">indexes</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">new_indexes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">new_indexes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">newcols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of names must match number of cols&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">names</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;col</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">col_copy</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">if</span> <span class="n">rename_duplicate</span><span class="p">:</span>
            <span class="n">existing_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">orig_name</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span>
                <span class="k">while</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">existing_names</span><span class="p">:</span>
                    <span class="c1"># If the column belongs to another table then copy it</span>
                    <span class="c1"># before renaming</span>
                    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="n">col_copy</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">new_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orig_name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">existing_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_cols</span><span class="p">(</span><span class="n">newcols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_replace_column_warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as replace_column but issues warnings under various circumstances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warns</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">replace_warnings</span>

        <span class="k">if</span> <span class="s1">&#39;refcount&#39;</span> <span class="ow">in</span> <span class="n">warns</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
            <span class="n">refcount</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
            <span class="n">old_col</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># This may raise an exception (e.g. t[&#39;a&#39;] = 1) in which case none of</span>
        <span class="c1"># the downstream code runs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace_column</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;always&#39;</span> <span class="ow">in</span> <span class="n">warns</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;replaced column &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                          <span class="n">TableReplaceWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;slice&#39;</span> <span class="ow">in</span> <span class="n">warns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check for ndarray-subclass slice.  An unsliced instance</span>
                <span class="c1"># has an ndarray for the base while sliced has the same class</span>
                <span class="c1"># as parent.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_col</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">old_col</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;replaced column &#39;</span><span class="si">{}</span><span class="s2">&#39; which looks like an array slice. &quot;</span>
                           <span class="s2">&quot;The new column no longer shares memory with the &quot;</span>
                           <span class="s2">&quot;original array.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TableReplaceWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="s1">&#39;refcount&#39;</span> <span class="ow">in</span> <span class="n">warns</span><span class="p">:</span>
            <span class="c1"># Did reference count change?</span>
            <span class="n">new_refcount</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">refcount</span> <span class="o">!=</span> <span class="n">new_refcount</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;replaced column &#39;</span><span class="si">{}</span><span class="s2">&#39; and the number of references &quot;</span>
                       <span class="s2">&quot;to the column changed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TableReplaceWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;attributes&#39;</span> <span class="ow">in</span> <span class="n">warns</span><span class="p">:</span>
            <span class="c1"># Any of the standard column attributes changed?</span>
            <span class="n">changed_attrs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_col</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Check base DataInfo attributes that any column will have</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">DataInfo</span><span class="o">.</span><span class="n">attr_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_col</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_col</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                    <span class="n">changed_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">changed_attrs</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;replaced column &#39;</span><span class="si">{}</span><span class="s2">&#39; and column attributes </span><span class="si">{}</span><span class="s2"> changed.&quot;</span>
                       <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">changed_attrs</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TableReplaceWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">replace_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace column ``name`` with the new ``col`` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of column to replace</span>
<span class="sd">        col : column object (list, ndarray, Column, etc)</span>
<span class="sd">            New column object to replace the existing column</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Replace column &#39;a&#39; with a float version of itself::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">            &gt;&gt;&gt; float_a = t[&#39;a&#39;].astype(float)</span>
<span class="sd">            &gt;&gt;&gt; t.replace_column(&#39;a&#39;, float_a)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;column name </span><span class="si">{0}</span><span class="s1"> is not in the table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot replace a table index column&#39;</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="n">col</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_cols</span><span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">remove_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a row from the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of row to remove</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Remove row 1 from the table::</span>

<span class="sd">            &gt;&gt;&gt; t.remove_row(1)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        To remove several rows at the same time use remove_rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check the index against the types that work with np.delete</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Row index must be an integer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_specifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove rows from the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row_specifier : slice, int, or array of ints</span>
<span class="sd">            Specification for rows to remove</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Remove rows 0 and 2 from the table::</span>

<span class="sd">            &gt;&gt;&gt; t.remove_rows([0, 2])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              2 0.2   y</span>


<span class="sd">        Note that there are no warnings if the slice operator extends</span>
<span class="sd">        outside the data::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; t.remove_rows(slice(10, 20, 1))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update indices</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="n">index</span><span class="o">.</span><span class="n">remove_rows</span><span class="p">(</span><span class="n">row_specifier</span><span class="p">)</span>

        <span class="n">keep_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">keep_mask</span><span class="p">[</span><span class="n">row_specifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TableColumns</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
            <span class="n">newcol</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcol</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_cols</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># Revert groups to default (ungrouped) state</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_groups&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>

    <span class="k">def</span> <span class="nf">remove_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a column from the table.</span>

<span class="sd">        This can also be done with::</span>

<span class="sd">          del table[name]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of column to remove</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Remove column &#39;b&#39; from the table::</span>

<span class="sd">            &gt;&gt;&gt; t.remove_column(&#39;b&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   c</span>
<span class="sd">            --- ---</span>
<span class="sd">              1   x</span>
<span class="sd">              2   y</span>
<span class="sd">              3   z</span>

<span class="sd">        To remove several columns at the same time use remove_columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">([</span><span class="n">name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">remove_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove several columns from the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names : list</span>
<span class="sd">            A list containing the names of the columns to remove</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...     names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Remove columns &#39;b&#39; and &#39;c&#39; from the table::</span>

<span class="sd">            &gt;&gt;&gt; t.remove_columns([&#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a</span>
<span class="sd">            ---</span>
<span class="sd">              1</span>
<span class="sd">              2</span>
<span class="sd">              3</span>

<span class="sd">        Specifying only a single column also works. Remove column &#39;b&#39; from the table::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3], [0.1, 0.2, 0.3], [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...     names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; t.remove_columns(&#39;b&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   c</span>
<span class="sd">            --- ---</span>
<span class="sd">              1   x</span>
<span class="sd">              2   y</span>
<span class="sd">              3   z</span>

<span class="sd">        This gives the same as using remove_column.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_string_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_kind</span><span class="p">,</span> <span class="n">out_kind</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert string-like columns to/from bytestring and unicode (internal only).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        in_kind : str</span>
<span class="sd">            Input dtype.kind</span>
<span class="sd">        out_kind : str</span>
<span class="sd">            Output dtype.kind</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If there are no `in_kind` columns then do nothing</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">in_kind</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">newcols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">in_kind</span><span class="p">:</span>
                <span class="n">newdtype</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">in_kind</span><span class="p">,</span> <span class="n">out_kind</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
                <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">newdtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span>
            <span class="n">newcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_cols</span><span class="p">(</span><span class="n">newcols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert_bytestring_to_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python3_only</span><span class="o">=</span><span class="n">NoValue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert bytestring columns (dtype.kind=&#39;S&#39;) to unicode (dtype.kind=&#39;U&#39;) assuming</span>
<span class="sd">        ASCII encoding.</span>

<span class="sd">        Internally this changes string columns to represent each character</span>
<span class="sd">        in the string with a 4-byte UCS-4 equivalent, so it is inefficient</span>
<span class="sd">        for memory but allows scripts to manipulate string arrays with</span>
<span class="sd">        natural syntax.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">python3_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The &quot;python3_only&quot; keyword is now deprecated.&#39;</span><span class="p">,</span>
                          <span class="n">AstropyDeprecationWarning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_string_dtype</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert_unicode_to_bytestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python3_only</span><span class="o">=</span><span class="n">NoValue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert ASCII-only unicode columns (dtype.kind=&#39;U&#39;) to bytestring (dtype.kind=&#39;S&#39;).</span>

<span class="sd">        When exporting a unicode string array to a file, it may be desirable</span>
<span class="sd">        to encode unicode columns as bytestrings.  This routine takes</span>
<span class="sd">        advantage of numpy automated conversion which works for strings that</span>
<span class="sd">        are pure ASCII.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">python3_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The &quot;python3_only&quot; keyword is now deprecated.&#39;</span><span class="p">,</span>
                          <span class="n">AstropyDeprecationWarning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_string_dtype</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">keep_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Keep only the columns specified (remove the others).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names : list</span>
<span class="sd">            A list containing the names of the columns to keep. All other</span>
<span class="sd">            columns will be removed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3],[0.1, 0.2, 0.3],[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1 0.1   x</span>
<span class="sd">              2 0.2   y</span>
<span class="sd">              3 0.3   z</span>

<span class="sd">        Specifying only a single column name keeps only this column.</span>
<span class="sd">        Keep only column &#39;a&#39; of the table::</span>

<span class="sd">            &gt;&gt;&gt; t.keep_columns(&#39;a&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a</span>
<span class="sd">            ---</span>
<span class="sd">              1</span>
<span class="sd">              2</span>
<span class="sd">              3</span>

<span class="sd">        Specifying a list of column names is keeps is also possible.</span>
<span class="sd">        Keep columns &#39;a&#39; and &#39;c&#39; of the table::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1, 2, 3],[0.1, 0.2, 0.3],[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;]],</span>
<span class="sd">            ...           names=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; t.keep_columns([&#39;a&#39;, &#39;c&#39;])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   c</span>
<span class="sd">            --- ---</span>
<span class="sd">              1   x</span>
<span class="sd">              2   y</span>
<span class="sd">              3   z</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="n">remove</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">(</span><span class="n">remove</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rename_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Rename a column.</span>

<span class="sd">        This can also be done directly with by setting the ``name`` attribute</span>
<span class="sd">        for a column::</span>

<span class="sd">          table[name].name = new_name</span>

<span class="sd">        TODO: this won&#39;t work for mixins</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The current name of the column.</span>
<span class="sd">        new_name : str</span>
<span class="sd">            The new name for the column</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[1,2],[3,4],[5,6]], names=(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1   3   5</span>
<span class="sd">              2   4   6</span>

<span class="sd">        Renaming column &#39;a&#39; to &#39;aa&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t.rename_column(&#39;a&#39; , &#39;aa&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">             aa  b   c</span>
<span class="sd">            --- --- ---</span>
<span class="sd">              1   3   5</span>
<span class="sd">              2   4   6</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>

    <span class="k">def</span> <span class="nf">_set_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">colnames</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;right hand side must be a sequence of values with &#39;</span>
                             <span class="s1">&#39;the same length as the number of selected columns&#39;</span><span class="p">)</span>

        <span class="c1"># Keep track of original values before setting each column so that</span>
        <span class="c1"># setting row can be transactional.</span>
        <span class="n">orig_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
                <span class="n">orig_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If anything went wrong first revert the row update then raise</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">orig_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">cols</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new row to the end of the table.</span>

<span class="sd">        The ``vals`` argument can be:</span>

<span class="sd">        sequence (e.g. tuple or list)</span>
<span class="sd">            Column values in the same order as table columns.</span>
<span class="sd">        mapping (e.g. dict)</span>
<span class="sd">            Keys corresponding to column names.  Missing values will be</span>
<span class="sd">            filled with np.zeros for the column dtype.</span>
<span class="sd">        `None`</span>
<span class="sd">            All values filled with np.zeros for the column dtype.</span>

<span class="sd">        This method requires that the Table object &quot;owns&quot; the underlying array</span>
<span class="sd">        data.  In particular one cannot add a row to a Table that was</span>
<span class="sd">        initialized with copy=False from an existing array.</span>

<span class="sd">        The ``mask`` attribute should give (if desired) the mask for the</span>
<span class="sd">        values. The type of the mask should match that of the values, i.e. if</span>
<span class="sd">        ``vals`` is an iterable, then ``mask`` should also be an iterable</span>
<span class="sd">        with the same length, and if ``vals`` is a mapping, then ``mask``</span>
<span class="sd">        should be a dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vals : tuple, list, dict or `None`</span>
<span class="sd">            Use the specified values in the new row</span>
<span class="sd">        mask : tuple, list, dict or `None`</span>
<span class="sd">            Use the specified mask values in the new row</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns &#39;a&#39;, &#39;b&#39; and &#39;c&#39;::</span>

<span class="sd">           &gt;&gt;&gt; t = Table([[1,2],[4,5],[7,8]], names=(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;))</span>
<span class="sd">           &gt;&gt;&gt; print(t)</span>
<span class="sd">            a   b   c</span>
<span class="sd">           --- --- ---</span>
<span class="sd">             1   4   7</span>
<span class="sd">             2   5   8</span>

<span class="sd">        Adding a new row with entries &#39;3&#39; in &#39;a&#39;, &#39;6&#39; in &#39;b&#39; and &#39;9&#39; in &#39;c&#39;::</span>

<span class="sd">           &gt;&gt;&gt; t.add_row([3,6,9])</span>
<span class="sd">           &gt;&gt;&gt; print(t)</span>
<span class="sd">             a   b   c</span>
<span class="sd">             --- --- ---</span>
<span class="sd">             1   4   7</span>
<span class="sd">             2   5   8</span>
<span class="sd">             3   6   9</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_row</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new row before the given ``index`` position in the table.</span>

<span class="sd">        The ``vals`` argument can be:</span>

<span class="sd">        sequence (e.g. tuple or list)</span>
<span class="sd">            Column values in the same order as table columns.</span>
<span class="sd">        mapping (e.g. dict)</span>
<span class="sd">            Keys corresponding to column names.  Missing values will be</span>
<span class="sd">            filled with np.zeros for the column dtype.</span>
<span class="sd">        `None`</span>
<span class="sd">            All values filled with np.zeros for the column dtype.</span>

<span class="sd">        The ``mask`` attribute should give (if desired) the mask for the</span>
<span class="sd">        values. The type of the mask should match that of the values, i.e. if</span>
<span class="sd">        ``vals`` is an iterable, then ``mask`` should also be an iterable</span>
<span class="sd">        with the same length, and if ``vals`` is a mapping, then ``mask``</span>
<span class="sd">        should be a dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vals : tuple, list, dict or `None`</span>
<span class="sd">            Use the specified values in the new row</span>
<span class="sd">        mask : tuple, list, dict or `None`</span>
<span class="sd">            Use the specified mask values in the new row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">N</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Index </span><span class="si">{0}</span><span class="s2"> is out of bounds for table with length </span><span class="si">{1}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="n">N</span>

        <span class="k">def</span> <span class="nf">_is_mapping</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Minimal checker for mapping (dict-like) interface for obj&quot;&quot;&quot;</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
            <span class="c1"># Possibly issue upgrade warning and update self.ColumnClass.  This</span>
            <span class="c1"># does not change the existing columns.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_masked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_is_mapping</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="ow">or</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># From the vals and/or mask mappings create the corresponding lists</span>
            <span class="c1"># that have entries for each table column.</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_mapping</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Mismatch between type of vals and mask&quot;</span><span class="p">)</span>

            <span class="c1"># Now check that the mask is specified for the same keys as the</span>
            <span class="c1"># values, otherwise things get really confusing.</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keys in mask should match keys in vals&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vals</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colnames</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Keys in vals must all be valid column names&#39;</span><span class="p">)</span>

            <span class="n">vals_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mask_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vals</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">vals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">mask_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span> <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">):</span>
                        <span class="c1"># Make a placeholder zero element of the right type which is masked.</span>
                        <span class="c1"># This assumes the appropriate insert() method will broadcast a</span>
                        <span class="c1"># numpy scalar to the right shape.</span>
                        <span class="n">vals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

                        <span class="c1"># For masked table any unsupplied values are masked by default.</span>
                        <span class="n">mask_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">masked</span> <span class="ow">and</span> <span class="n">vals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value must be supplied for column &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals_list</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_list</span>

        <span class="k">if</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_mapping</span><span class="p">(</span><span class="n">mask</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Mismatch between type of vals and mask&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mismatch between number of vals and columns&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mismatch between number of masks and columns&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Vals must be an iterable or mapping or None&#39;</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TableColumns</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Insert val at index for each column</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">mask_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
                <span class="c1"># If the new row caused a change in self.ColumnClass then</span>
                <span class="c1"># Column-based classes need to be converted first.  This is</span>
                <span class="c1"># typical for adding a row with mask values to an unmasked table.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">):</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ColumnClass</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">newcol</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newcol</span><span class="p">,</span> <span class="n">BaseColumn</span><span class="p">):</span>
                    <span class="n">newcol</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
                        <span class="n">newcol</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">FalseArray</span><span class="p">(</span><span class="n">newcol</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newcol</span><span class="p">)</span> <span class="o">!=</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect length for column </span><span class="si">{0}</span><span class="s1"> after inserting </span><span class="si">{1}</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39; (expected </span><span class="si">{2}</span><span class="s1">, got </span><span class="si">{3}</span><span class="s1">)&#39;</span>
                                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newcol</span><span class="p">),</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">newcol</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">parent_table</span> <span class="o">=</span> <span class="bp">self</span>

                <span class="c1"># Set mask if needed</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
                    <span class="n">newcol</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_</span>

                <span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcol</span>

            <span class="c1"># insert row in indices</span>
            <span class="k">for</span> <span class="n">table_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="n">table_index</span><span class="o">.</span><span class="n">insert_row</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to insert row because of exception in column &#39;</span><span class="si">{0}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_cols</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

            <span class="c1"># Revert groups to default (ungrouped) state</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_groups&#39;</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>

    <span class="k">def</span> <span class="nf">_replace_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">new_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">new_col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">col_position</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_col</span>
                <span class="n">new_col</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indices which would sort the table according to one or</span>
<span class="sd">        more key columns.  This simply calls the `numpy.argsort` function on</span>
<span class="sd">        the table with the ``order`` parameter set to ``keys``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : str or list of str</span>
<span class="sd">            The column name(s) to order the table by</span>
<span class="sd">        kind : {&#39;quicksort&#39;, &#39;mergesort&#39;, &#39;heapsort&#39;}, optional</span>
<span class="sd">            Sorting algorithm.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index_array : ndarray, int</span>
<span class="sd">            Array of indices that sorts the table by the specified key</span>
<span class="sd">            column(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="c1"># use index sorted order if possible</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index</span><span class="o">.</span><span class="n">sorted_data</span><span class="p">()</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="k">if</span> <span class="n">kind</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kind</span>

        <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sort the table according to one or more keys. This operates</span>
<span class="sd">        on the existing table and does not return a new table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : str or list of str</span>
<span class="sd">            The key(s) to order the table by. If None, use the</span>
<span class="sd">            primary index of the Table.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with 3 columns::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[&#39;Max&#39;, &#39;Jo&#39;, &#39;John&#39;], [&#39;Miller&#39;,&#39;Miller&#39;,&#39;Jackson&#39;],</span>
<span class="sd">            ...         [12,15,18]], names=(&#39;firstname&#39;,&#39;name&#39;,&#39;tel&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">            firstname   name  tel</span>
<span class="sd">            --------- ------- ---</span>
<span class="sd">                  Max  Miller  12</span>
<span class="sd">                   Jo  Miller  15</span>
<span class="sd">                 John Jackson  18</span>

<span class="sd">        Sorting according to standard sorting rules, first &#39;name&#39; then &#39;firstname&#39;::</span>

<span class="sd">            &gt;&gt;&gt; t.sort([&#39;name&#39;,&#39;firstname&#39;])</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">            firstname   name  tel</span>
<span class="sd">            --------- ------- ---</span>
<span class="sd">                 John Jackson  18</span>
<span class="sd">                   Jo  Miller  15</span>
<span class="sd">                  Max  Miller  12</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Table sort requires input keys or a table index&quot;</span><span class="p">)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">sort_index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sort_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># avoid inefficient relabelling of sorted index</span>
            <span class="n">prev_frozen</span> <span class="o">=</span> <span class="n">sort_index</span><span class="o">.</span><span class="n">_frozen</span>
            <span class="n">sort_index</span><span class="o">.</span><span class="n">_frozen</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">col</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indexes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sort_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># undo index freeze</span>
            <span class="n">sort_index</span><span class="o">.</span><span class="n">_frozen</span> <span class="o">=</span> <span class="n">prev_frozen</span>
            <span class="c1"># now relabel the sort index appropriately</span>
            <span class="n">sort_index</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reverse the row order of table rows.  The table is reversed</span>
<span class="sd">        in place and there are no function arguments.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a table with three columns::</span>

<span class="sd">            &gt;&gt;&gt; t = Table([[&#39;Max&#39;, &#39;Jo&#39;, &#39;John&#39;], [&#39;Miller&#39;,&#39;Miller&#39;,&#39;Jackson&#39;],</span>
<span class="sd">            ...         [12,15,18]], names=(&#39;firstname&#39;,&#39;name&#39;,&#39;tel&#39;))</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">            firstname   name  tel</span>
<span class="sd">            --------- ------- ---</span>
<span class="sd">                  Max  Miller  12</span>
<span class="sd">                   Jo  Miller  15</span>
<span class="sd">                 John Jackson  18</span>

<span class="sd">        Reversing order::</span>

<span class="sd">            &gt;&gt;&gt; t.reverse()</span>
<span class="sd">            &gt;&gt;&gt; print(t)</span>
<span class="sd">            firstname   name  tel</span>
<span class="sd">            --------- ------- ---</span>
<span class="sd">                 John Jackson  18</span>
<span class="sd">                   Jo  Miller  15</span>
<span class="sd">                  Max  Miller  12</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">col</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="n">index</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read and parse a data table and return as a Table.</span>

<span class="sd">        This function provides the Table interface to the astropy unified I/O</span>
<span class="sd">        layer.  This allows easily reading a file in many supported data formats</span>
<span class="sd">        using syntax such as::</span>

<span class="sd">          &gt;&gt;&gt; from astropy.table import Table</span>
<span class="sd">          &gt;&gt;&gt; dat = Table.read(&#39;table.dat&#39;, format=&#39;ascii&#39;)</span>
<span class="sd">          &gt;&gt;&gt; events = Table.read(&#39;events.fits&#39;, format=&#39;fits&#39;)</span>

<span class="sd">        The arguments and keywords (other than ``format``) provided to this function are</span>
<span class="sd">        passed through to the underlying data reader (e.g. `~astropy.io.ascii.read`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">io_registry</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># For some readers (e.g., ascii.ecsv), the returned `out` class is not</span>
        <span class="c1"># guaranteed to be the same as the desired output `cls`.  If so,</span>
        <span class="c1"># try coercing to desired class without copying (io.registry.read</span>
        <span class="c1"># would normally do a copy).  The normal case here is swapping</span>
        <span class="c1"># Table &lt;=&gt; QTable.</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;could not convert reader output to </span><span class="si">{0}</span><span class="s1"> &#39;</span>
                                <span class="s1">&#39;class.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write this Table object out in the specified format.</span>

<span class="sd">        This function provides the Table interface to the astropy unified I/O</span>
<span class="sd">        layer.  This allows easily writing a file in many supported data formats</span>
<span class="sd">        using syntax such as::</span>

<span class="sd">          &gt;&gt;&gt; from astropy.table import Table</span>
<span class="sd">          &gt;&gt;&gt; dat = Table([[1, 2], [3, 4]], names=(&#39;a&#39;, &#39;b&#39;))</span>
<span class="sd">          &gt;&gt;&gt; dat.write(&#39;table.dat&#39;, format=&#39;ascii&#39;)</span>

<span class="sd">        The arguments and keywords (other than ``format``) provided to this function are</span>
<span class="sd">        passed through to the underlying data reader (e.g. `~astropy.io.ascii.write`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">io_registry</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a copy of the table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        copy_data : bool</span>
<span class="sd">            If `True` (the default), copy the underlying data array.</span>
<span class="sd">            Otherwise, use the same data array. The ``meta`` is always</span>
<span class="sd">            deepcopied regardless of the value for ``copy_data``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy_data</span><span class="p">)</span>

        <span class="c1"># If the current table is grouped then do the same in the copy</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_groups&#39;</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">TableGroups</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span>
                                             <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__gt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__ge__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If mask is True, then by definition the row doesn&#39;t match</span>
                <span class="c1"># because the other array is not masked.</span>
                <span class="n">false_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="n">false_mask</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                <span class="c1"># If mask is True, then by definition the row doesn&#39;t match</span>
                <span class="c1"># because the other array is not masked.</span>
                <span class="n">false_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="n">false_mask</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_groups&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">TableGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>

    <span class="k">def</span> <span class="nf">group_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group this table by the specified ``keys``</span>

<span class="sd">        This effectively splits the table into groups which correspond to</span>
<span class="sd">        unique values of the ``keys`` grouping object.  The output is a new</span>
<span class="sd">        `TableGroups` which contains a copy of this table but sorted by row</span>
<span class="sd">        according to ``keys``.</span>

<span class="sd">        The ``keys`` input to `group_by` can be specified in different ways:</span>

<span class="sd">          - String or list of strings corresponding to table column name(s)</span>
<span class="sd">          - Numpy array (homogeneous or structured) with same length as this table</span>
<span class="sd">          - `Table` with same length as this table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : str, list of str, numpy array, or `Table`</span>
<span class="sd">            Key grouping object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `Table`</span>
<span class="sd">            New table with groups set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mixin_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;group_by not available for tables with mixin columns&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">groups</span><span class="o">.</span><span class="n">table_group_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a :class:`pandas.DataFrame` instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataframe : :class:`pandas.DataFrame`</span>
<span class="sd">            A pandas :class:`pandas.DataFrame` instance</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ImportError</span>
<span class="sd">            If pandas is not installed</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the Table contains mixin or multi-dimensional columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mixin_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot convert a table with mixin columns to a pandas DataFrame&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot convert a table with multi-dimensional columns to a pandas DataFrame&quot;</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">MaskedColumn</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">]:</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]:</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span>

            <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pandas</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a `Table` from a :class:`pandas.DataFrame` instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataframe : :class:`pandas.DataFrame`</span>
<span class="sd">            The pandas :class:`pandas.DataFrame` instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : `Table`</span>
<span class="sd">            A `Table` (or subclass) instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
                <span class="c1"># If all elements of an object array are string-like or np.nan</span>
                <span class="c1"># then coerce back to a native numpy str/unicode array.</span>
                <span class="n">string_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
                <span class="n">nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">nan</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
                    <span class="c1"># Force any missing (null) values to b&#39;&#39;.  Numpy will</span>
                    <span class="c1"># upcast to str/unicode as needed.</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>

                    <span class="c1"># When the numpy object array is represented as a list then</span>
                    <span class="c1"># numpy initializes to the correct string or unicode type.</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaskedColumn</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">TableInfo</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">QTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to represent tables of heterogeneous data.</span>

<span class="sd">    `QTable` provides a class for heterogeneous tabular data which can be</span>
<span class="sd">    easily modified, for instance adding columns or new rows.</span>

<span class="sd">    The `QTable` class is identical to `Table` except that columns with an</span>
<span class="sd">    associated ``unit`` attribute are converted to `~astropy.units.Quantity`</span>
<span class="sd">    objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy ndarray, dict, list, Table, or table-like object, optional</span>
<span class="sd">        Data to initialize table.</span>
<span class="sd">    masked : bool, optional</span>
<span class="sd">        Specify whether the table is masked.</span>
<span class="sd">    names : list, optional</span>
<span class="sd">        Specify column names.</span>
<span class="sd">    dtype : list, optional</span>
<span class="sd">        Specify column data types.</span>
<span class="sd">    meta : dict, optional</span>
<span class="sd">        Metadata associated with the table.</span>
<span class="sd">    copy : bool, optional</span>
<span class="sd">        Copy the input data. Default is True.</span>
<span class="sd">    rows : numpy ndarray, list of lists, optional</span>
<span class="sd">        Row-oriented data for table instead of ``data`` argument.</span>
<span class="sd">    copy_indices : bool, optional</span>
<span class="sd">        Copy any indices in the input data. Default is True.</span>
<span class="sd">    **kwargs : dict, optional</span>
<span class="sd">        Additional keyword args when converting table-like object.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_add_as_mixin_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if ``col`` should be added to the table directly as</span>
<span class="sd">        a mixin column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">has_info_class</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">MixinInfo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_col_for_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># We need to turn the column into a quantity, or a subclass</span>
            <span class="c1"># identified in the unit (such as u.mag()).</span>
            <span class="n">q_cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;_quantity_class&#39;</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>
            <span class="n">qcol</span> <span class="o">=</span> <span class="n">q_cls</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">qcol</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">info</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">qcol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_convert_col_for_table</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">col</span>


<span class="k">class</span> <span class="nc">NdarrayMixin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixin column class to allow storage of arbitrary numpy</span>
<span class="sd">    ndarrays within a Table.  This is a subclass of numpy.ndarray</span>
<span class="sd">    and has the same initialization options as ndarray().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">ParentDtypeInfo</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;info&#39;</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__array_finalize__</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__array_finalize__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="c1"># Self was created from template (e.g. obj[slice] or (obj * 2))</span>
        <span class="c1"># or viewcast e.g. obj.view(Column).  In either case we want to</span>
        <span class="c1"># init Column attributes for self from obj if possible.</span>
        <span class="k">if</span> <span class="s1">&#39;info&#39;</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># patch to pickle Quantity objects (ndarray subclasses), see</span>
        <span class="c1"># http://www.mail-archive.com/numpy-discussion@scipy.org/msg02446.html</span>

        <span class="n">object_state</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">())</span>
        <span class="n">object_state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">object_state</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">object_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1"># patch to unpickle NdarrayMixin objects (ndarray subclasses), see</span>
        <span class="c1"># http://www.mail-archive.com/numpy-discussion@scipy.org/msg02446.html</span>

        <span class="n">nd_state</span><span class="p">,</span> <span class="n">own_state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">nd_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">own_state</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>