
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>gammapy.catalog.hess &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.catalog.hess</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;HESS Galactic plane survey (HGPS) catalog.</span>

<span class="sd">(Not released yet.)</span>

<span class="sd">TODO:</span>
<span class="sd">- [ ] Load HGPS maps</span>
<span class="sd">- [ ] Source object should contain info on components and associations</span>
<span class="sd">- [ ] Links to SNRCat</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">Angle</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="k">import</span> <span class="n">Gaussian2D</span>
<span class="kn">from</span> <span class="nn">..extern.pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">..utils.scripts</span> <span class="k">import</span> <span class="n">make_path</span>
<span class="kn">from</span> <span class="nn">..spectrum</span> <span class="k">import</span> <span class="n">FluxPoints</span>
<span class="kn">from</span> <span class="nn">..spectrum.models</span> <span class="k">import</span> <span class="n">PowerLaw</span><span class="p">,</span> <span class="n">ExponentialCutoffPowerLaw</span>
<span class="kn">from</span> <span class="nn">..image.models</span> <span class="k">import</span> <span class="n">Delta2D</span><span class="p">,</span> <span class="n">Shell2D</span>
<span class="kn">from</span> <span class="nn">..background.models</span> <span class="k">import</span> <span class="n">GaussianBand2D</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="k">import</span> <span class="n">SourceCatalog</span><span class="p">,</span> <span class="n">SourceCatalogObject</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;SourceCatalogHGPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SourceCatalogObjectHGPS&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Flux factor, used for printing</span>
<span class="n">FF</span> <span class="o">=</span> <span class="mf">1e-12</span>

<span class="c1"># Multiplicative factor to go from cm^-2 s^-1 to % Crab for integral flux &gt; 1 TeV</span>
<span class="c1"># Here we use the same Crab reference that&#39;s used in the HGPS paper</span>
<span class="c1"># CRAB = crab_integral_flux(energy_min=1, reference=&#39;hess_ecpl&#39;)</span>
<span class="n">FLUX_TO_CRAB</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mf">2.26e-11</span>
<span class="n">FLUX_TO_CRAB_DIFF</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mf">3.5060459323111307e-11</span>


<span class="k">class</span> <span class="nc">HGPSGaussComponent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;One Gaussian component from the HGPS catalog.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_source_name_key</span> <span class="o">=</span> <span class="s1">&#39;Source_Name&#39;</span>
    <span class="n">_source_index_key</span> <span class="o">=</span> <span class="s1">&#39;catalog_row_index&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty-print source data&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;Component </span><span class="si">{}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Component_ID&#39;</span><span class="p">])</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:8.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> deg</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;GLON&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;GLAT&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> deg</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Size&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) x 10^-12 cm^-2 s^-1 = (</span><span class="si">{:.1f}</span><span class="s1"> +/- </span><span class="si">{:.1f}</span><span class="s1">) % Crab&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Flux (&gt;1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ss</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Source name&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_name_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Row index of source in catalog&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_index_key</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Component spatial model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="c1"># At the moment spatial models are normalised by deg^2</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">glon</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span>
        <span class="n">glat</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Gaussian2D</span><span class="p">(</span>
            <span class="n">x_mean</span><span class="o">=</span><span class="n">glon</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">y_mean</span><span class="o">=</span><span class="n">glat</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">x_stddev</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">y_stddev</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="p">)</span>


<div class="viewcode-block" id="SourceCatalogObjectHGPS"><a class="viewcode-back" href="../../../api/gammapy.catalog.SourceCatalogObjectHGPS.html#gammapy.catalog.SourceCatalogObjectHGPS">[docs]</a><span class="k">class</span> <span class="nc">SourceCatalogObjectHGPS</span><span class="p">(</span><span class="n">SourceCatalogObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;One object from the HGPS catalog.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<div class="viewcode-block" id="SourceCatalogObjectHGPS.info"><a class="viewcode-back" href="../../../api/gammapy.catalog.SourceCatalogObjectHGPS.html#gammapy.catalog.SourceCatalogObjectHGPS.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Info string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        info : {&#39;all&#39;, &#39;basic&#39;, &#39;map&#39;, &#39;spec&#39;, &#39;flux_points&#39;, &#39;components&#39;, &#39;associations&#39;}</span>
<span class="sd">            Comma separated list of options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">info</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;basic,associations,map,spec,flux_points,components&#39;</span>

        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;basic&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_basic</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;map&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_map</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;spec&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_spec</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;flux_points&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_flux_points</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;components&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_components</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;associations&#39;</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_associations</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ss</span></div>

    <span class="k">def</span> <span class="nf">_info_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print basic info.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Basic info ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;Catalog row index (zero-based) : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;catalog_row_index&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Source name&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Source_Name&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Analysis reference&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Analysis_Reference&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Source class&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Source_Class&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Identified object&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Identified_Object&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Gamma-Cat id&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Gamma_Cat_Source_ID&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_associations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Source associations info ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;List of associated objects: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">associations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print info from map analysis.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Info from map analysis ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="n">ra_str</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">],</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dec_str</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;DEJ2000&#39;</span><span class="p">],</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:8.3f}</span><span class="s1"> = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">],</span> <span class="n">ra_str</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:8.3f}</span><span class="s1"> = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DEC&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DEJ2000&#39;</span><span class="p">],</span> <span class="n">dec_str</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:8.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;GLON&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:8.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;GLAT&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Position Error (68%)&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Pos_Err_68&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Position Error (95%)&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Pos_Err_95&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.0f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ROI number&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ROI_Number&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Spatial model&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Spatial_Model&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Spatial components&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TS&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Sqrt_TS&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;sqrt(TS)&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Sqrt_TS&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> (UL: </span><span class="si">{:.3f}</span><span class="s1">) deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Size&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size_UL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;R70&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;R70&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;RSpec&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;RSpec&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Total model excess&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Excess_Model_Total&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Excess in RSpec&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Excess_RSpec&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Excess in RSpec&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Excess_RSpec_Model&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Background in RSpec&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Background_RSpec&#39;</span><span class="p">])</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="s1"> hours</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Livetime&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Livetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Energy threshold&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Energy_Threshold&#39;</span><span class="p">])</span>

        <span class="n">val</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1 = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Source flux (&gt;1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fluxes in RSpec (&gt; 1 TeV):</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> x 10^-12 cm^-2 s^-1 = </span><span class="si">{:5.2f}</span><span class="s1"> % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Map measurement&#39;</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> x 10^-12 cm^-2 s^-1 = </span><span class="si">{:5.2f}</span><span class="s1"> % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Source model&#39;</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> x 10^-12 cm^-2 s^-1 = </span><span class="si">{:5.2f}</span><span class="s1"> % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Other component model&#39;</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> x 10^-12 cm^-2 s^-1 = </span><span class="si">{:5.2f}</span><span class="s1"> % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Large scale component model&#39;</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_LS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_LS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> x 10^-12 cm^-2 s^-1 = </span><span class="si">{:5.2f}</span><span class="s1"> % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Total model&#39;</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map_RSpec_Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;35s}</span><span class="s1"> : </span><span class="si">{:5.1f}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Containment in RSpec&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Containment_RSpec&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;35s}</span><span class="s1"> : </span><span class="si">{:5.1f}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Contamination in RSpec&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Contamination_RSpec&#39;</span><span class="p">])</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;Flux correction (RSpec -&gt; Total)&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Correction_RSpec_To_Total&#39;</span><span class="p">]</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;35s}</span><span class="s1"> : </span><span class="si">{:5.1f}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;Flux correction (Total -&gt; RSpec)&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Correction_RSpec_To_Total&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;35s}</span><span class="s1"> : </span><span class="si">{:5.1f}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print info from spectral analysis.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Info from spectral analysis ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="s1"> hours</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Livetime&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Livetime_Spec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">lo</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Energy_Range_Spec_Min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Energy_Range_Spec_Max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="s1"> to </span><span class="si">{:.2f}</span><span class="s1"> TeV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Energy range:&#39;</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Background&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Background_Spec&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Excess&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Excess_Spec&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Spectral model&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Spectral_Model&#39;</span><span class="p">])</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TS_ECPL_over_PL&#39;</span><span class="p">]</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TS ECPL over PL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_Int_1TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_Int_1TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Best-fit model flux(&gt; 1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_Energy_1_10_TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_Energy_1_10_TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 erg cm^-2 s^-1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Best-fit model energy flux(1 to 10 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">)</span>

        <span class="c1"># TODO: can we just use the Gammapy model classes here instead of duplicating the code?</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_spec_pl</span><span class="p">()</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_spec_ecpl</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_spec_pl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Pivot energy&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Energy_Spec_PL_Pivot&#39;</span><span class="p">])</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_Pivot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_Pivot_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1 TeV^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Flux at pivot energy&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB_DIFF</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Int_1TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Int_1TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;PL   Flux(&gt; 1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_1TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_1TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1 TeV^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;PL   Flux(@ 1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB_DIFF</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Index_Spec_PL&#39;</span><span class="p">]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Index_Spec_PL_Err&#39;</span><span class="p">]</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;PL   Index&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_spec_ecpl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># ss = &#39;{:&lt;20s} : {:.1f}\n&#39;.format(&#39;Pivot energy&#39;, d[&#39;Energy_Spec_ECPL_Pivot&#39;])</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Diff_1TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Diff_1TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1 TeV^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;ECPL   Flux(@ 1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB_DIFF</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Int_1TeV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Int_1TeV_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : (</span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1">) x 10^-12 cm^-2 s^-1  = (</span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1">) % Crab</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;ECPL   Flux(&gt; 1 TeV)&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">err</span> <span class="o">/</span> <span class="n">FF</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">,</span> <span class="n">err</span> <span class="o">*</span> <span class="n">FLUX_TO_CRAB</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Index_Spec_ECPL&#39;</span><span class="p">]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Index_Spec_ECPL_Err&#39;</span><span class="p">]</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ECPL Index&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Lambda_Spec_ECPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Lambda_Spec_ECPL_Err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> TeV^-1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ECPL Lambda&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="c1"># Use Gaussian analytical error propagation,</span>
        <span class="c1"># tested against the uncertainties package</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">err</span> <span class="o">/</span> <span class="n">val</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">val</span>

        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{:.2f}</span><span class="s1"> +/- </span><span class="si">{:.2f}</span><span class="s1"> TeV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ECPL E_cut&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ss</span>

    <span class="k">def</span> <span class="nf">_info_flux_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print flux point results&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Flux points info ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;Number of flux points: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;N_Flux_Points&#39;</span><span class="p">])</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;Flux points table: </span><span class="se">\n\n\t</span><span class="s1">&#39;</span>

        <span class="n">flux_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">energy_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;e_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;e_min&#39;</span><span class="p">,</span> <span class="s1">&#39;e_max&#39;</span><span class="p">]</span>
        <span class="n">flux_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dnde&#39;</span><span class="p">,</span> <span class="s1">&#39;dnde_errn&#39;</span><span class="p">,</span> <span class="s1">&#39;dnde_errp&#39;</span><span class="p">,</span> <span class="s1">&#39;dnde_ul&#39;</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">energy_cols</span> <span class="o">+</span> <span class="n">flux_cols</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;is_ul&#39;</span><span class="p">]</span>
        <span class="n">flux_points</span> <span class="o">=</span> <span class="n">flux_points</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">energy_cols</span><span class="p">:</span>
            <span class="n">flux_points</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;.3f&#39;</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">flux_cols</span><span class="p">:</span>
            <span class="n">flux_points</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;.3e&#39;</span>

        <span class="c1"># convert table to string</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">flux_points</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">max_width</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ss</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">_info_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print info about the components.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;components&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Gaussian component info ***</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;Number of components: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">))</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20s}</span><span class="s1"> : </span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Spatial components&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">ss</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">energy_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spectral model energy range (`~astropy.units.Quantity` with length 2).&quot;&quot;&quot;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Energy_Range_Spec_Min&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Energy_Range_Spec_Max&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="c1"># Some EXTERN sources have no energy range information.</span>
        <span class="c1"># In those cases, we put a default</span>
        <span class="n">use_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">e_default</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
        <span class="n">e</span><span class="p">[</span><span class="n">use_default</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_default</span><span class="p">[</span><span class="n">use_default</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spectral_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spectral model (`~gammapy.spectrum.models.SpectralModel`).</span>

<span class="sd">        One of the following models:</span>

<span class="sd">        - ``Spectral_Model=&quot;PL&quot;`` : `~gammapy.spectrum.models.PowerLaw`</span>
<span class="sd">        - ``Spectral_Model=&quot;ECPL&quot;`` : `~gammapy.spectrum.models.ExponentialCutoffPowerLaw`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">spec_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Spectral_Model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_model</span><span class="p">(</span><span class="n">spec_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_spectral_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create spectral model from source parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spec_type : str</span>
<span class="sd">            Spectral model type either &#39;PL&#39; or &#39;ECPL&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model : `~gammapy.spectrum.models.SpectralModel`</span>
<span class="sd">            Spectral model instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="n">pars</span><span class="p">,</span> <span class="n">errs</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">spec_type</span> <span class="o">==</span> <span class="s1">&#39;PL&#39;</span><span class="p">:</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Index_Spec_PL&#39;</span><span class="p">]</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_Pivot&#39;</span><span class="p">]</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Energy_Spec_PL_Pivot&#39;</span><span class="p">]</span>
            <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_PL_Diff_Pivot_Err&#39;</span><span class="p">]</span>
            <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Index_Spec_PL_Err&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">PowerLaw</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">spec_type</span> <span class="o">==</span> <span class="s1">&#39;ECPL&#39;</span><span class="p">:</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Index_Spec_ECPL&#39;</span><span class="p">]</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Diff_Pivot&#39;</span><span class="p">]</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Energy_Spec_ECPL_Pivot&#39;</span><span class="p">]</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;lambda_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Lambda_Spec_ECPL&#39;</span><span class="p">]</span>
            <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Index_Spec_ECPL_Err&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>
            <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Spec_ECPL_Diff_Pivot_Err&#39;</span><span class="p">]</span>
            <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;lambda_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Lambda_Spec_ECPL_Err&#39;</span><span class="p">]</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialCutoffPowerLaw</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid spectral model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec_type</span><span class="p">))</span>

        <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_parameter_errors</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

<div class="viewcode-block" id="SourceCatalogObjectHGPS.spatial_model"><a class="viewcode-back" href="../../../api/gammapy.catalog.SourceCatalogObjectHGPS.html#gammapy.catalog.SourceCatalogObjectHGPS.spatial_model">[docs]</a>    <span class="k">def</span> <span class="nf">spatial_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">1E5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Source spatial model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">emin</span><span class="p">,</span> <span class="n">emax</span><span class="p">)</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="n">pars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">glon</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLON&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span>
        <span class="n">glat</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;GLAT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span>

        <span class="n">spatial_model</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Spatial_Model&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pointlike</span><span class="p">:</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitude</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glon</span><span class="o">.</span><span class="n">value</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;y_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glat</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">Delta2D</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">spatial_model</span> <span class="o">==</span> <span class="s1">&#39;Shell&#39;</span><span class="p">:</span>
            <span class="c1"># HGPS contains no information on shell width</span>
            <span class="c1"># Here we assuma a 5% shell width for all shells.</span>
            <span class="n">shell_width_fraction</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glon</span><span class="o">.</span><span class="n">value</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;y_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glat</span><span class="o">.</span><span class="n">value</span>
            <span class="n">r_out</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_out</span> <span class="o">*</span> <span class="n">shell_width_fraction</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;r_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_out</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">shell_width_fraction</span><span class="p">)</span>
            <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitude</span>
            <span class="k">return</span> <span class="n">Shell2D</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">spatial_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;2-Gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;3-Gaussian&#39;</span><span class="p">]:</span>
            <span class="n">amplitude_total</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Flux_Map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">spatial_model</span> <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># there is one external source (HESS J1801-233) where there is no</span>
                <span class="c1"># component info available, so we create it here locally</span>
                <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">HGPSGaussComponent</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">spatial_model</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                <span class="c1"># weight total flux according to relative amplitude</span>
                <span class="n">model</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">/</span> <span class="n">amplitude_total</span> <span class="o">*</span> <span class="n">amplitude</span>

            <span class="k">if</span> <span class="n">spatial_model</span> <span class="o">==</span> <span class="s1">&#39;Gaussian&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">spatial_model</span> <span class="o">==</span> <span class="s1">&#39;2-Gaussian&#39;</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># use generic bounding box of 2 deg width and height</span>
                <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="p">((</span><span class="n">glat</span><span class="o">.</span><span class="n">deg</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">glat</span><span class="o">.</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                                      <span class="p">(</span><span class="n">glon</span><span class="o">.</span><span class="n">deg</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">glon</span><span class="o">.</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">model</span>

            <span class="k">elif</span> <span class="n">spatial_model</span> <span class="o">==</span> <span class="s1">&#39;3-Gaussian&#39;</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">models</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># use generic bounding box of 2 deg width and height</span>
                <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="p">((</span><span class="n">glat</span><span class="o">.</span><span class="n">deg</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">glat</span><span class="o">.</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                                      <span class="p">(</span><span class="n">glon</span><span class="o">.</span><span class="n">deg</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">glon</span><span class="o">.</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">model</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a valid spatial model</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spatial_model</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_pointlike</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Source is pointlike&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">has_size_ul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Size_UL&#39;</span><span class="p">])</span>
        <span class="n">pointlike</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Spatial_Model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Point-Like&#39;</span>
        <span class="k">return</span> <span class="n">pointlike</span> <span class="ow">or</span> <span class="n">has_size_ul</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flux_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flux points (`~gammapy.spectrum.FluxPoints`).&quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SED_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dnde&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Energy&#39;</span><span class="p">])</span>

        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;e_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Energy&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Energy_Min&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Energy_Max&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>

        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;dnde&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Flux&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;dnde_errn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Flux_Err_Lo&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;dnde_errp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Flux_Err_Hi&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;dnde_ul&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Flux_UL&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">table</span><span class="p">[</span><span class="s1">&#39;is_ul&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Flux_Points_Flux_Is_UL&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FluxPoints</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></div>


<div class="viewcode-block" id="SourceCatalogHGPS"><a class="viewcode-back" href="../../../api/gammapy.catalog.SourceCatalogHGPS.html#gammapy.catalog.SourceCatalogHGPS">[docs]</a><span class="k">class</span> <span class="nc">SourceCatalogHGPS</span><span class="p">(</span><span class="n">SourceCatalog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;HESS Galactic plane survey (HGPS) source catalog.</span>

<span class="sd">    Note: this catalog isn&#39;t publicly available yet.</span>
<span class="sd">    H.E.S.S. members have access and can use this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hgps&#39;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;H.E.S.S. Galactic plane survey (HGPS) source catalog&#39;</span>
    <span class="n">source_object_class</span> <span class="o">=</span> <span class="n">SourceCatalogObjectHGPS</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;HGPS_SOURCES&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HGPS_ANALYSIS&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;data/catalogs/HGPS3/release/HGPS_v0.4.fits&#39;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_path</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="n">hdu</span><span class="p">)</span>

        <span class="n">source_name_alias</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Identified_Object&#39;</span><span class="p">,)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SourceCatalogHGPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
            <span class="n">source_name_alias</span><span class="o">=</span><span class="n">source_name_alias</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;HGPS_GAUSS_COMPONENTS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associations</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;HGPS_ASSOCIATIONS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifications</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;HGPS_IDENTIFICATIONS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_large_scale_component</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;HGPS_LARGE_SCALE_COMPONENT&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">large_scale_component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Large sclae component model (`~gammapy.background.models.GaussianBand2D`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_large_scale_component</span>
        <span class="k">return</span> <span class="n">GaussianBand2D</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">spline_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_make_source_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make one source object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Row index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        source : `SourceCatalogObject`</span>
<span class="sd">            Source object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SourceCatalogHGPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_make_source_object</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;components&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_attach_component_info</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;associations&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attach_association_info</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="c1"># TODO: implement or remove:</span>
        <span class="c1"># if source.data[&#39;Source_Class&#39;] != &#39;Unid&#39;:</span>
        <span class="c1">#    self._attach_identification_info(source)</span>
        <span class="k">return</span> <span class="n">source</span>

    <span class="k">def</span> <span class="nf">_attach_component_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="n">source</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="n">SourceCatalog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="n">source_name_key</span><span class="o">=</span><span class="s1">&#39;Component_ID&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">):</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">HGPSGaussComponent</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lookup</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">source</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_association_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="n">source</span><span class="o">.</span><span class="n">associations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Source_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="p">[</span><span class="s1">&#39;Source_Name&#39;</span><span class="p">]</span>

        <span class="n">source</span><span class="o">.</span><span class="n">associations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="p">[</span><span class="s1">&#39;Association_Name&#39;</span><span class="p">][</span><span class="n">_</span><span class="p">])</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>