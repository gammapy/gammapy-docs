
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>gammapy.maps.base &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.maps.base</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">..extern</span> <span class="k">import</span> <span class="n">six</span>
<span class="kn">from</span> <span class="nn">astropy.utils.misc</span> <span class="k">import</span> <span class="n">InheritDocstrings</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">.geom</span> <span class="k">import</span> <span class="n">pix_tuple_to_idx</span><span class="p">,</span> <span class="n">MapCoord</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Map&#39;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">MapMeta</span><span class="p">(</span><span class="n">InheritDocstrings</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="Map"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">MapMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Map</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract map class.</span>

<span class="sd">    This can represent WCS- or HEALPIX-based maps</span>
<span class="sd">    with 2 spatial dimensions and N non-spatial dimensions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geom : `~gammapy.maps.MapGeom`</span>
<span class="sd">        Geometry</span>
<span class="sd">    data : `~numpy.ndarray`</span>
<span class="sd">        Data array</span>
<span class="sd">    meta : `~collections.OrderedDict`</span>
<span class="sd">        Dictionary to store meta data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span> <span class="o">=</span> <span class="n">geom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Data array (`~numpy.ndarray`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong shape.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Map geometry (`~gammapy.maps.MapGeom`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span>

<div class="viewcode-block" id="Map.create"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.create">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an empty map object.</span>

<span class="sd">        This method accepts generic options</span>
<span class="sd">        listed below as well as options for `~HpxMap` and `~WcsMap`</span>
<span class="sd">        objects (see `~HpxMap.create` and `~WcsMap.create` for WCS-</span>
<span class="sd">        and HPX-specific options).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordsys : str</span>
<span class="sd">            Coordinate system, either Galactic (&#39;GAL&#39;) or Equatorial</span>
<span class="sd">            (&#39;CEL&#39;).</span>
<span class="sd">        map_type : {&#39;wcs&#39;, &#39;wcs-sparse&#39;, &#39;hpx&#39;, &#39;hpx-sparse&#39;}</span>
<span class="sd">            Map type.  Selects the class that will be used to</span>
<span class="sd">            instantiate the map.</span>
<span class="sd">        binsz : float or `~numpy.ndarray`</span>
<span class="sd">            Pixel size in degrees.</span>
<span class="sd">        skydir : `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            Coordinate of map center.</span>
<span class="sd">        axes : list</span>
<span class="sd">            List of `~MapAxis` objects for each non-spatial dimension.</span>
<span class="sd">            If None then the map will be a 2D image.</span>
<span class="sd">        dtype : str</span>
<span class="sd">            Data type, default is ``float32``</span>
<span class="sd">        unit : str or `~astropy.units.Unit`</span>
<span class="sd">            Data unit.</span>
<span class="sd">        meta : `~collections.OrderedDict`</span>
<span class="sd">            Dictionary to store meta data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Empty map object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.hpxmap</span> <span class="k">import</span> <span class="n">HpxMap</span>
        <span class="kn">from</span> <span class="nn">.wcsmap</span> <span class="k">import</span> <span class="n">WcsMap</span>

        <span class="n">map_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;map_type&#39;</span><span class="p">,</span> <span class="s1">&#39;wcs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;wcs&#39;</span> <span class="ow">in</span> <span class="n">map_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">WcsMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;hpx&#39;</span> <span class="ow">in</span> <span class="n">map_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">HpxMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized map type: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.read"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.read">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read a map from a FITS file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the FITS file.</span>
<span class="sd">        hdu : str</span>
<span class="sd">            Name or index of the HDU with the map data.</span>
<span class="sd">        hdu_bands : str</span>
<span class="sd">            Name or index of the HDU with the BANDS table.  If not</span>
<span class="sd">            defined this will be inferred from the FITS header of the</span>
<span class="sd">            map HDU.</span>
<span class="sd">        map_type : {&#39;wcs&#39;, &#39;wcs-sparse&#39;, &#39;hpx&#39;, &#39;hpx-sparse&#39;, &#39;auto&#39;}</span>
<span class="sd">            Map type.  Selects the class that will be used to</span>
<span class="sd">            instantiate the map.  The map type should be consistent</span>
<span class="sd">            with the format of the input file.  If map_type is &#39;auto&#39;</span>
<span class="sd">            then an appropriate map type will be inferred from the</span>
<span class="sd">            input file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map_out : `~Map`</span>
<span class="sd">            Map object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
            <span class="n">map_out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_hdu_list</span><span class="p">(</span><span class="n">hdulist</span><span class="p">,</span> <span class="n">hdu</span><span class="p">,</span> <span class="n">hdu_bands</span><span class="p">,</span> <span class="n">map_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">map_out</span></div>

<div class="viewcode-block" id="Map.from_geom"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.from_geom">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_geom</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate an empty map from a `~Geom` instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geom : `~MapGeom`</span>
<span class="sd">            Map geometry.</span>

<span class="sd">        meta : `~collections.OrderedDict`</span>
<span class="sd">            Dictionary to store meta data.</span>

<span class="sd">        map_type : {&#39;wcs&#39;, &#39;wcs-sparse&#39;, &#39;hpx&#39;, &#39;hpx-sparse&#39;, &#39;auto&#39;}        </span>
<span class="sd">            Map type.  Selects the class that will be used to</span>
<span class="sd">            instantiate the map.  The map type should be consistent</span>
<span class="sd">            with the geometry.  If map_type is &#39;auto&#39; then an</span>
<span class="sd">            appropriate map type will be inferred from type of</span>
<span class="sd">            ``geom``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map_out : `~Map`</span>
<span class="sd">            Map object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">.hpx</span> <span class="k">import</span> <span class="n">HpxGeom</span>
            <span class="kn">from</span> <span class="nn">.wcs</span> <span class="k">import</span> <span class="n">WcsGeom</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">HpxGeom</span><span class="p">):</span>
                <span class="n">map_type</span> <span class="o">=</span> <span class="s1">&#39;hpx&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">WcsGeom</span><span class="p">):</span>
                <span class="n">map_type</span> <span class="o">=</span> <span class="s1">&#39;wcs&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized geom type.&#39;</span><span class="p">)</span>

        <span class="n">cls_out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_map_cls</span><span class="p">(</span><span class="n">map_type</span><span class="p">)</span>
        <span class="n">map_out</span> <span class="o">=</span> <span class="n">cls_out</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">map_out</span></div>

<div class="viewcode-block" id="Map.from_hdu_list"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.from_hdu_list">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdu_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdu_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">map_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_map_type</span><span class="p">(</span><span class="n">hdulist</span><span class="p">,</span> <span class="n">hdu</span><span class="p">)</span>
        <span class="n">cls_out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_map_cls</span><span class="p">(</span><span class="n">map_type</span><span class="p">)</span>
        <span class="n">map_out</span> <span class="o">=</span> <span class="n">cls_out</span><span class="o">.</span><span class="n">from_hdulist</span><span class="p">(</span><span class="n">hdulist</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="n">hdu</span><span class="p">,</span> <span class="n">hdu_bands</span><span class="o">=</span><span class="n">hdu_bands</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">map_out</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_meta_from_header</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load meta data from a FITS header.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;META&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;META&#39;</span><span class="p">],</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">meta</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_map_type</span><span class="p">(</span><span class="n">hdu_list</span><span class="p">,</span> <span class="n">hdu_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer map type from a FITS HDU.</span>

<span class="sd">        Only read header, never data, to have good performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hdu_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Find the header of the first non-empty HDU</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="n">hdu_name</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;PIXTYPE&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PIXTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HEALPIX&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;hpx&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;wcs&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_map_cls</span><span class="p">(</span><span class="n">map_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get map class for given `map_type` string.</span>

<span class="sd">        This should probably be a registry dict so that users</span>
<span class="sd">        can add supported map types to the `gammapy.maps` I/O</span>
<span class="sd">        (see e.g. the Astropy table format I/O registry),</span>
<span class="sd">        but that&#39;s non-trivial to implement without avoiding circular imports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;wcs&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.wcsnd</span> <span class="k">import</span> <span class="n">WcsNDMap</span>
            <span class="k">return</span> <span class="n">WcsNDMap</span>
        <span class="k">elif</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;wcs-sparse&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;hpx&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.hpxnd</span> <span class="k">import</span> <span class="n">HpxNDMap</span>
            <span class="k">return</span> <span class="n">HpxNDMap</span>
        <span class="k">elif</span> <span class="n">map_type</span> <span class="o">==</span> <span class="s1">&#39;hpx-sparse&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.hpxsparse</span> <span class="k">import</span> <span class="n">HpxSparseMap</span>
            <span class="k">return</span> <span class="n">HpxSparseMap</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized map type: </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_type</span><span class="p">))</span>

<div class="viewcode-block" id="Map.write"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write to a FITS file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Output file name.</span>
<span class="sd">        hdu : str</span>
<span class="sd">            Set the name of the image extension.  By default this will</span>
<span class="sd">            be set to SKYMAP (for BINTABLE HDU) or PRIMARY (for IMAGE</span>
<span class="sd">            HDU).</span>
<span class="sd">        hdu_bands : str</span>
<span class="sd">            Set the name of the bands table extension.  By default this will</span>
<span class="sd">            be set to BANDS.</span>
<span class="sd">        conv : str        </span>
<span class="sd">            FITS format convention.  By default files will be written</span>
<span class="sd">            to the gamma-astro-data-formats (GADF) format.  This</span>
<span class="sd">            option can be used to write files that are compliant with</span>
<span class="sd">            format conventions required by specific software (e.g. the</span>
<span class="sd">            Fermi Science Tools).  Supported conventions are &#39;gadf&#39;,</span>
<span class="sd">            &#39;fgst-ccube&#39;, &#39;fgst-ltcube&#39;, &#39;fgst-bexpcube&#39;,</span>
<span class="sd">            &#39;fgst-template&#39;, &#39;fgst-srcmap&#39;, &#39;fgst-srcmap-sparse&#39;,</span>
<span class="sd">            &#39;galprop&#39;, and &#39;galprop2&#39;.            </span>
<span class="sd">        sparse : bool        </span>
<span class="sd">            Sparsify the map by dropping pixels with zero amplitude.</span>
<span class="sd">            This option is only compatible with the &#39;gadf&#39; format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hdulist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_hdulist</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">overwrite</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">hdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.iter_by_image"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.iter_by_image">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">iter_by_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate over image planes of the map returning a tuple with the image</span>
<span class="sd">        array and image plane index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        val : `~numpy.ndarray`</span>
<span class="sd">            Array of image plane values.</span>
<span class="sd">        idx : tuple</span>
<span class="sd">            Index of image plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.iter_by_pix"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.iter_by_pix">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">iter_by_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffersize</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate over elements of the map returning a tuple with values and</span>
<span class="sd">        pixel coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        buffersize : int</span>
<span class="sd">            Set the size of the buffer.  The map will be returned in</span>
<span class="sd">            chunks of the given size.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        val : `~numpy.ndarray`</span>
<span class="sd">            Map values.</span>
<span class="sd">        pix : tuple</span>
<span class="sd">            Tuple of pixel coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.iter_by_coord"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.iter_by_coord">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">iter_by_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffersize</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate over elements of the map returning a tuple with values and</span>
<span class="sd">        map coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        buffersize : int</span>
<span class="sd">            Set the size of the buffer.  The map will be returned in</span>
<span class="sd">            chunks of the given size.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        val : `~numpy.ndarray`</span>
<span class="sd">            Map values.</span>
<span class="sd">        coords : tuple</span>
<span class="sd">            Tuple of map coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.sum_over_axes"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.sum_over_axes">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sum_over_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reduce to a 2D image by summing over non-spatial dimensions.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.coadd"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.coadd">[docs]</a>    <span class="k">def</span> <span class="nf">coadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_in</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the contents of ``map_in`` to this map.  This method can be</span>
<span class="sd">        used to combine maps containing integral quantities (e.g. counts)</span>
<span class="sd">        or differential quantities if the maps have the same binning.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map_in : `~Map`</span>
<span class="sd">            Input map.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Check whether geometries are aligned and if so sum the</span>
        <span class="c1"># data vectors directly</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">get_idx</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">()</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_by_coord</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.reproject"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.reproject">[docs]</a>    <span class="k">def</span> <span class="nf">reproject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;interp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reproject this map to a different geometry.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geom : `~MapGeom`</span>
<span class="sd">            Geometry of projection.</span>
<span class="sd">        mode : {&#39;interp&#39;, &#39;exact&#39;}</span>
<span class="sd">            Method for reprojection.  &#39;interp&#39; method interpolates at pixel</span>
<span class="sd">            centers.  &#39;exact&#39; method integrates over intersection of pixels.</span>
<span class="sd">        order : int or str</span>
<span class="sd">            Order of interpolating polynomial (0 = nearest-neighbor, 1 =</span>
<span class="sd">            linear, 2 = quadratic, 3 = cubic).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Reprojected map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_cube</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">geom</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Projection geometry must be 2D or have the &#39;</span>
                             <span class="s1">&#39;same number of dimensions as the map.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;HPX&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reproject_hpx</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reproject_wcs</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.pad"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.pad">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_width</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pad the spatial dimension of the map by extending the edge of the</span>
<span class="sd">        map by the given number of pixels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pad_width : {sequence, array_like, int}</span>
<span class="sd">            Number of pixels padded to the edges of each axis.</span>
<span class="sd">        mode : {&#39;edge&#39;, &#39;constant&#39;, &#39;interp&#39;}</span>
<span class="sd">            Padding mode.  &#39;edge&#39; pads with the closest edge value.</span>
<span class="sd">            &#39;constant&#39; pads with a constant value. &#39;interp&#39; pads with</span>
<span class="sd">            an extrapolated value.</span>
<span class="sd">        cval : float</span>
<span class="sd">            Padding value when mode=&#39;consant&#39;.</span>
<span class="sd">        order : int</span>
<span class="sd">            Order of interpolation when mode=&#39;constant&#39; (0 =</span>
<span class="sd">            nearest-neighbor, 1 = linear, 2 = quadratic, 3 = cubic).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Padded map.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.crop"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.crop">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crop_width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Crop the spatial dimension of the map by removing a number of</span>
<span class="sd">        pixels from the edge of the map.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crop_width : {sequence, array_like, int}</span>
<span class="sd">            Number of pixels cropped from the edges of each axis.</span>
<span class="sd">            Defined analogously to `pad_with` from `~numpy.pad`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Cropped map.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.downsample"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.downsample">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">preserve_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Downsample the spatial dimension of the map by a given factor. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor : int</span>
<span class="sd">            Downsampling factor.</span>
<span class="sd">        preserve_counts : bool</span>
<span class="sd">            Preserve the integral over each bin.  This should be true</span>
<span class="sd">            if the map is an integral quantity (e.g. counts) and false if</span>
<span class="sd">            the map is a differential quantity (e.g. intensity).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Downsampled map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.upsample"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.upsample">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">upsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">preserve_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Upsample the spatial dimension of the map by a given factor. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor : int</span>
<span class="sd">            Upsampling factor.</span>
<span class="sd">        order : int</span>
<span class="sd">            Order of the interpolation used for upsampling.</span>
<span class="sd">        preserve_counts : bool</span>
<span class="sd">            Preserve the integral over each bin.  This should be true</span>
<span class="sd">            if the map is an integral quantity (e.g. counts) and false if</span>
<span class="sd">            the map is a differential quantity (e.g. intensity).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : `~Map`</span>
<span class="sd">            Upsampled map.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.get_by_coord"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_by_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return map values at the given map coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : tuple or `~gammapy.maps.MapCoord`</span>
<span class="sd">            `~gammapy.maps.MapCoord` object or tuple of</span>
<span class="sd">            coordinate arrays for each dimension of the map.  Tuple</span>
<span class="sd">            should be ordered as (lon, lat, x_0, ..., x_n) where x_i</span>
<span class="sd">            are coordinates for non-spatial dimensions of the map.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">           Values of pixels in the map.  np.nan used to flag coords</span>
<span class="sd">           outside of map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">MapCoord</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coordsys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">coordsys</span><span class="p">)</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">coord_to_idx</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[</span><span class="o">~</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">vals</span></div>

<div class="viewcode-block" id="Map.get_by_pix"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_by_pix">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return map values at the given pixel coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pix : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>
<span class="sd">            Pixel indices can be either float or integer type. </span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">           Array of pixel values.  np.nan used to flag coordinates</span>
<span class="sd">           outside of map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># FIXME: Support local indexing here?</span>
        <span class="c1"># FIXME: Support slicing?</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pix</span><span class="p">]</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="o">*</span><span class="n">pix</span><span class="p">)</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">contains_pix</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pix</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">pix_to_idx</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[</span><span class="o">~</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">vals</span></div>

<div class="viewcode-block" id="Map.get_by_idx"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_by_idx">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_by_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return map values at the given pixel indices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idx : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">           Array of pixel values.</span>
<span class="sd">           np.nan used to flag coordinate outside of map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.interp_by_coord"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.interp_by_coord">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">interp_by_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate map values at the given map coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : tuple or `~gammapy.maps.MapCoord`</span>
<span class="sd">            `~gammapy.maps.MapCoord` object or tuple of</span>
<span class="sd">            coordinate arrays for each dimension of the map.  Tuple</span>
<span class="sd">            should be ordered as (lon, lat, x_0, ..., x_n) where x_i</span>
<span class="sd">            are coordinates for non-spatial dimensions of the map.</span>

<span class="sd">        interp : {None, &#39;nearest&#39;, &#39;linear&#39;, &#39;cubic&#39;, 0, 1, 2, 3}</span>
<span class="sd">            Method to interpolate data values.  By default no</span>
<span class="sd">            interpolation is performed and the return value will be</span>
<span class="sd">            the amplitude of the pixel encompassing the given</span>
<span class="sd">            coordinate.  Integer values can be used in lieu of strings</span>
<span class="sd">            to choose the interpolation method of the given order</span>
<span class="sd">            (0=&#39;nearest&#39;, 1=&#39;linear&#39;, 2=&#39;quadratic&#39;, 3=&#39;cubic&#39;).  Note</span>
<span class="sd">            that only &#39;nearest&#39; and &#39;linear&#39; methods are supported for</span>
<span class="sd">            all map types.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">            Interpolated pixel values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.interp_by_pix"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.interp_by_pix">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">interp_by_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate map values at the given pixel coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pix : tuple</span>
<span class="sd">            Tuple of pixel coordinate arrays for each dimension of the</span>
<span class="sd">            map.  Tuple should be ordered as (p_lon, p_lat, p_0, ...,</span>
<span class="sd">            p_n) where p_i are pixel coordinates for non-spatial</span>
<span class="sd">            dimensions of the map.</span>

<span class="sd">        interp : {None, &#39;nearest&#39;, &#39;linear&#39;, &#39;cubic&#39;, 0, 1, 2, 3}</span>
<span class="sd">            Method to interpolate data values.  By default no</span>
<span class="sd">            interpolation is performed and the return value will be</span>
<span class="sd">            the amplitude of the pixel encompassing the given</span>
<span class="sd">            coordinate.  Integer values can be used in lieu of strings</span>
<span class="sd">            to choose the interpolation method of the given order</span>
<span class="sd">            (0=&#39;nearest&#39;, 1=&#39;linear&#39;, 2=&#39;quadratic&#39;, 3=&#39;cubic&#39;).  Note</span>
<span class="sd">            that only &#39;nearest&#39; and &#39;linear&#39; methods are supported for</span>
<span class="sd">            all map types.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">            Interpolated pixel values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.fill_by_coord"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.fill_by_coord">[docs]</a>    <span class="k">def</span> <span class="nf">fill_by_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill pixels at the given map coordinates with values in `weights`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : tuple or `~gammapy.maps.MapCoord`</span>
<span class="sd">            `~gammapy.maps.MapCoord` object or tuple of</span>
<span class="sd">            coordinate arrays for each dimension of the map.  Tuple</span>
<span class="sd">            should be ordered as (lon, lat, x_0, ..., x_n) where x_i</span>
<span class="sd">            are coordinates for non-spatial dimensions of the map.</span>

<span class="sd">        weights : `~numpy.ndarray`</span>
<span class="sd">            Weights vector. If None then a unit weight will be assumed</span>
<span class="sd">            for each element in `coords`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">coord_to_idx</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.fill_by_pix"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.fill_by_pix">[docs]</a>    <span class="k">def</span> <span class="nf">fill_by_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill pixels at the given pixel coordinates with values in `weights`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pix : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>
<span class="sd">            Pixel indices can be either float or integer type.  Float</span>
<span class="sd">            indices will be rounded to the nearest integer.</span>

<span class="sd">        weights : `~numpy.ndarray`</span>
<span class="sd">            Weights vector. If None then a unit weight will be assumed</span>
<span class="sd">            for each element in `pix`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pix_tuple_to_idx</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.fill_by_idx"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.fill_by_idx">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">fill_by_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill pixels at the given pixel indices with values in `weights`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idx : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>

<span class="sd">        weights : `~numpy.ndarray`</span>
<span class="sd">            Weights vector. If None then a unit weight will be assumed</span>
<span class="sd">            for each element in `idx`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Map.set_by_coord"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.set_by_coord">[docs]</a>    <span class="k">def</span> <span class="nf">set_by_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set pixels at the given map coordinates to the values in `vals`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : tuple or `~gammapy.maps.MapCoord`</span>
<span class="sd">            `~gammapy.maps.MapCoord` object or tuple of</span>
<span class="sd">            coordinate arrays for each dimension of the map.  Tuple</span>
<span class="sd">            should be ordered as (lon, lat, x_0, ..., x_n) where x_i</span>
<span class="sd">            are coordinates for non-spatial dimensions of the map.</span>

<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">            Values vector.  Pixels at `coords` will be set to these values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">coord_to_pix</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_by_pix</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.set_by_pix"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.set_by_pix">[docs]</a>    <span class="k">def</span> <span class="nf">set_by_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set pixels at the given pixel coordinates to the values in `vals`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pix : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>
<span class="sd">            Pixel indices can be either float or integer type.  Float</span>
<span class="sd">            indices will be rounded to the nearest integer.</span>

<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">            Values vector. Pixels at `pix` will be set to these values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pix_tuple_to_idx</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.set_by_idx"><a class="viewcode-back" href="../../../api/gammapy.maps.Map.html#gammapy.maps.Map.set_by_idx">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_by_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set pixels at the given pixel indices to the values in `vals`</span>
<span class="sd">        vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idx : tuple</span>
<span class="sd">            Tuple of pixel index arrays for each dimension of the map.</span>
<span class="sd">            Tuple should be ordered as (I_lon, I_lat, I_0, ..., I_n)</span>
<span class="sd">            for WCS maps and (I_hpx, I_0, ..., I_n) for HEALPix maps.</span>

<span class="sd">        vals : `~numpy.ndarray`</span>
<span class="sd">            Values vector. Pixels at `idx` will be set to these values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>