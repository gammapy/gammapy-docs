
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Make background models &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EnergyOffset Array" href="energy_offset_array.html" />
    <link rel="prev" title="Background models" href="models.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="energy_offset_array.html" title="EnergyOffset Array">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="models.html" title="Background models">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Background estimation and modeling  (<code class="docutils literal"><span class="pre">gammapy.background</span></code>)</a> &#187;</li>
      
      <li>Make background models</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="make-background-models">
<span id="background-make-background-models"></span><h1>Make background models<a class="headerlink" href="#make-background-models" title="Permalink to this headline">¶</a></h1>
<p>Gammapy tools to produce background models.</p>
<div class="section" id="make-cube-background-models">
<h2>Make cube background models<a class="headerlink" href="#make-cube-background-models" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">gammapy-make-bg-cube-models</span></code> command line tool can be used to produce
background cube models from the data files at a given path location.</p>
<p>For more details, please refer to <a class="reference internal" href="../api/gammapy.scripts.make_bg_cube_models.html#gammapy.scripts.make_bg_cube_models" title="gammapy.scripts.make_bg_cube_models"><code class="xref py py-obj docutils literal"><span class="pre">make_bg_cube_models</span></code></a>.</p>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">gammapy-make-bg-cube-models</span></code> tool has a few options. For a full list of options, please use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gammapy-make-bg-cube-models --help
</pre></div>
</div>
<p>at the command line.</p>
<p>Command examples:</p>
<ul>
<li><p class="first">Create background models using a H.E.S.S. or H.E.S.S.-like dataset
(can take a few minutes):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gammapy-make-bg-cube-models /path/to/fits/event_lists/base/dir <span class="se">\</span>
                              HESS bg_cube_models
</pre></div>
</div>
</li>
<li><p class="first">Run a quick test using only a few runs:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gammapy-make-bg-cube-models /path/to/fits/event_lists/base/dir <span class="se">\</span>
                              HESS bg_cube_models --test
</pre></div>
</div>
</li>
<li><p class="first">Create background models using the method developped in
<a class="reference internal" href="../references.html#mayer2015" id="id1">[Mayer2015]</a> (almost equal to the default case for now):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gammapy-make-bg-cube-models /path/to/fits/event_lists/base/dir <span class="se">\</span>
                              HESS bg_cube_models --method michi
</pre></div>
</div>
</li>
</ul>
<p>The output files are created in the output directory:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bg_observation_table.fits.gz</span></code>: total observation table used for
the models. The list has been filtered from observations taken at
or nearby known sources.</li>
<li><code class="docutils literal"><span class="pre">bg_observation_table_grouped.fits.gz</span></code>: observation table grouped
according to the selected binning for the background observations.</li>
<li><code class="docutils literal"><span class="pre">bg_observation_groups.ecsv</span></code>: table describing the observation
groups.</li>
<li><code class="docutils literal"><span class="pre">bg_cube_model_group&lt;ID&gt;_&lt;format&gt;.fits.gz</span></code>: files containing the
background models for each group <strong>ID</strong> in 2 different <strong>format</strong>
kinds: <em>table</em>, for data analysis and <em>image</em> for a quick
visualization using eg. <code class="docutils literal"><span class="pre">DS9</span></code>. The table files contain also a
counts (a.k.a. events) and a livetime correction data cubes.</li>
</ul>
<p>In order to compare 2 sets of background cube models,
the <code class="docutils literal"><span class="pre">examples/wip_bg_cube_model_comparison.py</span></code> can be used.</p>
</div>
<div class="section" id="datasets-for-testing">
<span id="background-make-background-models-datasets-for-testing"></span><h3>Datasets for testing<a class="headerlink" href="#datasets-for-testing" title="Permalink to this headline">¶</a></h3>
<p>In order to test the background model generation tools, real
data from existing experiments such as H.E.S.S. can be used.
Since the data of current experiments is not public, tools to
simulate datasets are described in <a class="reference internal" href="../datasets/make_datasets.html#datasets-obssim"><span class="std std-ref">Simulate event lists</span></a>.</p>
<p>There is also a tool in Gammapy to simulate background cube models:
<a class="reference internal" href="../api/gammapy.datasets.make_test_bg_cube_model.html#gammapy.datasets.make_test_bg_cube_model" title="gammapy.datasets.make_test_bg_cube_model"><code class="xref py py-obj docutils literal"><span class="pre">make_test_bg_cube_model</span></code></a>.
It can be used to produce true background cube models to use to
compare to the reconstructed ones produced with the machinery
described above, using a simulated dataset using the tools from
<a class="reference internal" href="../datasets/make_datasets.html#datasets-obssim"><span class="std std-ref">Simulate event lists</span></a>. If using the same model
for producing the simulated dataset and the true background cube
models, the reconstructed ones produced with
<code class="docutils literal"><span class="pre">gammapy-make-bg-cube-models</span></code> should match the true ones.</p>
<p>The example script <a class="reference download internal" href="../_downloads/wip_bg_cube_models_true_reco.py" download=""><code class="xref download docutils literal"><span class="pre">wip_bg_cube_models_true_reco.py</span></code></a> can be used
to produce a true cube bg model and a reco cube bg model using the
same model (except for absolute normalization). The models can be
used to test the cube bg model production and can be compared to each
other using the <a class="reference download internal" href="../_downloads/wip_bg_cube_model_comparison.py" download=""><code class="xref download docutils literal"><span class="pre">wip_bg_cube_model_comparison.py</span></code></a> example script.</p>
<div class="section" id="comparing-true-reco-models">
<h4>Comparing true-reco models<a class="headerlink" href="#comparing-true-reco-models" title="Permalink to this headline">¶</a></h4>
<p>Two model files located in the <code class="docutils literal"><span class="pre">gammapy-extra</span></code> repository have been
produced using the example script <a class="reference download internal" href="../_downloads/wip_bg_cube_models_true_reco.py" download=""><code class="xref download docutils literal"><span class="pre">wip_bg_cube_models_true_reco.py</span></code></a>:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gammapy/gammapy-extra/blob/master/test_datasets/background/bg_cube_model_true.fits.gz">bg_cube_model_true.fits.gz</a>
is a true bg cube model produced with
<a class="reference internal" href="../api/gammapy.datasets.make_test_bg_cube_model.html#gammapy.datasets.make_test_bg_cube_model" title="gammapy.datasets.make_test_bg_cube_model"><code class="xref py py-obj docutils literal"><span class="pre">make_test_bg_cube_model</span></code></a>.</li>
<li><a class="reference external" href="https://github.com/gammapy/gammapy-extra/blob/master/test_datasets/background/bg_cube_model_reco.fits.gz">bg_cube_model_reco.fits.gz</a>
is a reco bg cube model produced with
<code class="xref py py-obj docutils literal"><span class="pre">make_bg_cube_model</span></code>, using dummy data produced
with <a class="reference internal" href="../api/gammapy.datasets.make_test_dataset.html#gammapy.datasets.make_test_dataset" title="gammapy.datasets.make_test_dataset"><code class="xref py py-obj docutils literal"><span class="pre">make_test_dataset</span></code></a>.</li>
</ul>
<p>The following plots are produced with a modified version of the
<a class="reference download internal" href="../_downloads/wip_bg_cube_model_comparison.py" download=""><code class="xref download docutils literal"><span class="pre">wip_bg_cube_model_comparison.py</span></code></a> example script:</p>
<p>TODO: remove or fix these examples</p>
<p>The input counts spectrum is a power-law with an index of 1.5, in
order to have some counts at high energies with a reasonable amount
of simulated data. In reality the background spectrum has a spectral
index close to 2.7.</p>
<p>The bg rate appears as a spectrum of <strong>index + 1</strong> (2.5 in this
example).
The reason being that, in order to produce the bg model, the
contents of the cube (counts per unit time) have to be divided by the
bin volume (delta x * delta y * delta E). When computing
counts/delta E, the index of the bg rate increases by 1 w.r.t. the
index of the power-law spectrum used to sample (or model) the counts.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Make background models</a><ul>
<li><a class="reference internal" href="#make-cube-background-models">Make cube background models</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#datasets-for-testing">Datasets for testing</a><ul>
<li><a class="reference internal" href="#comparing-true-reco-models">Comparing true-reco models</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/background/make_models.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>