
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Observation grouping &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DataManager" href="../api/gammapy.data.DataManager.html" />
    <link rel="prev" title="Data Management" href="dm.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../api/gammapy.data.DataManager.html" title="DataManager">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="dm.html" title="Data Management">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Data and observation handling (<code class="docutils literal"><span class="pre">gammapy.data</span></code>)</a> &#187;</li>
      
      <li>Observation grouping</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="observation-grouping">
<span id="obs-observation-grouping"></span><h1>Observation grouping<a class="headerlink" href="#observation-grouping" title="Permalink to this headline">¶</a></h1>
<p>Observation grouping can be very helpful to speed the analysis of
data with similar characteristics. It is also essential in some cases,
like the production of background models. In this case, the scarce
statistic forces the grouping of observations taken under similar
conditions in order to produce reliable models.</p>
<p>There are 2 classes in Gammapy that handle observation groups:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/gammapy.data.ObservationGroupAxis.html#gammapy.data.ObservationGroupAxis" title="gammapy.data.ObservationGroupAxis"><code class="xref py py-obj docutils literal"><span class="pre">ObservationGroupAxis</span></code></a> is a class to define an axis
along which to define bins for creating observation groups. The
class offers support for dimensionless or
<a class="reference external" href="http://docs.astropy.org/en/latest/api/astropy.units.Quantity.html#astropy.units.Quantity" title="(in Astropy v3.1.dev21536)"><code class="xref py py-obj docutils literal"><span class="pre">Quantity</span></code></a>-like parameter axes. In both cases, both,
continuous and discrete variables can be used.</li>
<li><a class="reference internal" href="../api/gammapy.data.ObservationGroups.html#gammapy.data.ObservationGroups" title="gammapy.data.ObservationGroups"><code class="xref py py-obj docutils literal"><span class="pre">ObservationGroups</span></code></a> is a class that takes a list of
axes (<a class="reference internal" href="../api/gammapy.data.ObservationGroupAxis.html#gammapy.data.ObservationGroupAxis" title="gammapy.data.ObservationGroupAxis"><code class="xref py py-obj docutils literal"><span class="pre">ObservationGroupAxis</span></code></a>) and defines groups
based on the cartesian product of the bins on each axis. The group
definitions are internally stored as a <a class="reference external" href="http://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v3.1.dev21536)"><code class="xref py py-obj docutils literal"><span class="pre">Table</span></code></a>
object. This class has also methods to group the observations of a
given ‘ObservationTable’ following the defined grouping.</li>
</ul>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Create an <a class="reference internal" href="../api/gammapy.data.ObservationGroups.html#gammapy.data.ObservationGroups" title="gammapy.data.ObservationGroups"><code class="xref py py-obj docutils literal"><span class="pre">ObservationGroups</span></code></a> object with three axes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">ObservationGroups</span><span class="p">,</span> <span class="n">ObservationGroupAxis</span>
<span class="n">zenith</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">ntels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">obs_groups</span> <span class="o">=</span> <span class="n">ObservationGroups</span><span class="p">([</span>
    <span class="n">ObservationGroupAxis</span><span class="p">(</span><span class="s1">&#39;ZENITH&#39;</span><span class="p">,</span> <span class="n">zenith</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;edges&#39;</span><span class="p">),</span>
    <span class="n">ObservationGroupAxis</span><span class="p">(</span><span class="s1">&#39;N_TELS&#39;</span><span class="p">,</span> <span class="n">ntels</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The axes info is stored:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">obs_groups</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="go">ZENITH edges [  0.  30.  40.  50.] deg</span>
<span class="go">N_TELS values [3 4]</span>
</pre></div>
</div>
<p>The observation groups are stored as a table (computed once on <code class="docutils literal"><span class="pre">ObservationGroups</span></code> object construction):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">obs_groups</span><span class="o">.</span><span class="n">obs_groups_table</span><span class="p">)</span>
<span class="go">GROUP_ID ZENITH_MIN ZENITH_MAX N_TELS</span>
<span class="go">            deg        deg</span>
<span class="go">-------- ---------- ---------- ------</span>
<span class="go">       0        0.0       30.0      3</span>
<span class="go">       1        0.0       30.0      4</span>
<span class="go">       2       30.0       40.0      3</span>
<span class="go">       3       30.0       40.0      4</span>
<span class="go">       4       40.0       50.0      3</span>
<span class="go">       5       40.0       50.0      4</span>
</pre></div>
</div>
<p>TODO: make this a real example … use the four Crab runs!</p>
<p>Apply the observation grouping to an observation list:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obs_table</span> <span class="o">=</span> <span class="n">obs_groups</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>
</pre></div>
</div>
<p>This would print an observation table with the format described in
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/en/latest/data_storage/obs_index/index.html#obs-index" title="(in Data formats for gamma-ray astronomy v0.1)"><span>Observation index table</span></a> and an extra-column at the beginning specifying the ID
of the group to which each observation belongs.</p>
<p>Get the observations of a particular group and print them:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obs_table_group2</span> <span class="o">=</span> <span class="n">obs_groups</span><span class="o">.</span><span class="n">get_group_of_observations</span><span class="p">(</span><span class="n">obs_table</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">obs_table_group2</span><span class="p">)</span>
</pre></div>
</div>
<p>This would print the observation table corresponding to the group
with ID 8.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Observation grouping</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/data/obs_group.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>