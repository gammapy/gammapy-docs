
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Check the pointing positions &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/cta_1dc_analysis_msh15-52.ipynb">cta_1dc_analysis_msh15-52.ipynb</a>
|
<a class="reference external" href="../_static/notebooks/cta_1dc_analysis_msh15-52.py">cta_1dc_analysis_msh15-52.py</a></p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<p>Set up data directory, target coordinates and max FoV offset. In this
example we take 1DC from MSH 15-52</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">DataStore</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="n">data_store</span> <span class="o">=</span> <span class="n">DataStore</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="s1">&#39;$CTADATA/index/gps&#39;</span><span class="p">)</span>
<span class="n">glat_target</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.19304588</span>
<span class="n">glon_target</span> <span class="o">=</span> <span class="mf">320.33033806</span>
<span class="n">max_offset</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
</pre></div>
</div>
</div>
<p>you can retrieve the coordinates of your source from the web, if you are
connected</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1">#pos_target = SkyCoord.from_name(&#39;MSH 15-52&#39;)</span>
<span class="c1">#pos_target.galactic</span>
</pre></div>
</div>
</div>
<p>With data_store.obs_table you have a table with the most common
per-observation parameters that are used for observation selection.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">table</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span>
</pre></div>
</div>
</div>
<p>Data selection Using Python / Table methods it is easy to apply any
selection you like, always with the goal of making a list or array of
OBS_ID, which is then the input to analysis. For the current 1DC
dataset it is pretty simple, because the only quantities useful for
selection are: * pointing position * which irf (i.e. array / zenith
angle)</p>
<p>With real data, there will be more parameters of interest, such as data
quality, observation duration, zenith angle, time of observation, …
Let’s look at one example: select observations that are at offset up to
3 deg from our target</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">pos_obs</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLON_PNT&#39;</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;galactic&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">pos_target</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">glon_target</span><span class="p">,</span> <span class="n">glat_target</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;galactic&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">pos_target</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos_obs</span><span class="p">)</span><span class="o">.</span><span class="n">deg</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="n">max_offset</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of selected observations: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of selected observations:  57
</pre></div></div>
</div>
<p>How to list the OBS_ID</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">obs_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[110114, 110115, 110116, 110117, 110118, 110119, 110120, 110121, 110122, 110123, 110124, 110125, 110126, 110127, 110128, 110129, 110130, 110131, 110132, 110133, 110134, 110135, 110136, 110137, 110138, 110139, 110140, 110141, 110142, 110143, 110144, 110145, 110146, 110147, 110148, 110149, 110150, 110151, 110893, 110894, 110895, 110896, 110897, 110898, 110899, 110900, 110901, 110902, 110903, 110904, 110905, 110906, 110907, 110908, 110909, 110910, 110911]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_list</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_list</span><span class="p">(</span><span class="n">obs_ids</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">obs_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ObservationList
Number of observations: 57
Info for OBS_ID = 110114
- Start time: 59221.50
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110115
- Start time: 59221.52
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110116
- Start time: 59221.54
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110117
- Start time: 59221.57
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110118
- Start time: 59221.59
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110119
- Start time: 59221.61
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110120
- Start time: 59221.63
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110121
- Start time: 59221.66
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110122
- Start time: 59221.68
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110123
- Start time: 59221.70
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110124
- Start time: 59221.72
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110125
- Start time: 59221.74
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110126
- Start time: 59221.77
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110127
- Start time: 59221.79
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110128
- Start time: 59221.81
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110129
- Start time: 59221.83
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110130
- Start time: 59221.86
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110131
- Start time: 59221.88
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110132
- Start time: 59221.90
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110133
- Start time: 59222.50
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110134
- Start time: 59222.52
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110135
- Start time: 59222.54
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110136
- Start time: 59222.57
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110137
- Start time: 59222.59
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110138
- Start time: 59222.61
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110139
- Start time: 59222.63
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110140
- Start time: 59222.66
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110141
- Start time: 59222.68
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110142
- Start time: 59222.70
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110143
- Start time: 59222.72
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110144
- Start time: 59222.74
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110145
- Start time: 59222.77
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110146
- Start time: 59222.79
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110147
- Start time: 59222.81
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110148
- Start time: 59222.83
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110149
- Start time: 59222.86
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110150
- Start time: 59222.88
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110151
- Start time: 59222.90
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110893
- Start time: 59262.50
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110894
- Start time: 59262.52
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110895
- Start time: 59262.54
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110896
- Start time: 59262.57
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110897
- Start time: 59262.59
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110898
- Start time: 59262.61
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110899
- Start time: 59262.63
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110900
- Start time: 59262.66
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110901
- Start time: 59262.68
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110902
- Start time: 59262.70
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110903
- Start time: 59262.72
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110904
- Start time: 59262.74
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110905
- Start time: 59262.77
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110906
- Start time: 59262.79
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110907
- Start time: 59262.81
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110908
- Start time: 59262.83
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110909
- Start time: 59262.86
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110910
- Start time: 59262.88
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110911
- Start time: 59262.90
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

</pre></div></div>
</div>
<p>you can visualize the obtained table in your browser</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1">#table.show_in_browser(jsviewer=True)</span>
</pre></div>
</div>
</div>
<p>We pick just three runs to speed this notebook up</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_ids_now</span> <span class="o">=</span> <span class="p">[</span><span class="mi">110114</span><span class="p">,</span> <span class="mi">110140</span><span class="p">,</span> <span class="mi">110893</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">obs_ids_now</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[110114, 110140, 110893]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_list</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_list</span><span class="p">(</span><span class="n">obs_ids_now</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">obs_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ObservationList
Number of observations: 3
Info for OBS_ID = 110114
- Start time: 59221.50
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110140
- Start time: 59222.66
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %
Info for OBS_ID = 110893
- Start time: 59262.50
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

</pre></div></div>
</div>
<div class="section" id="Check-the-pointing-positions">
<h1>Check the pointing positions<a class="headerlink" href="#Check-the-pointing-positions" title="Permalink to this headline">¶</a></h1>
<p>The grid pointing positions at GLAT = +- 1.2 deg are visible</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Angle</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLON_PNT&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Galactic longitude (deg)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Galactic latitude (deg)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x110166518&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_19_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_19_1.png" />
</div>
</div>
</div>
<div class="section" id="MAKE-SKYMAP">
<h1>MAKE SKYMAP<a class="headerlink" href="#MAKE-SKYMAP" title="Permalink to this headline">¶</a></h1>
<p>Define map geometry and an ON region for the image analysis. We use a
circle of 0.3deg radius as ON region, knowing that the source is seen as
mildly extended (0.12deg) by HESS.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">CircleSkyRegion</span>
<span class="n">on_radius</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">on_region</span> <span class="o">=</span> <span class="n">CircleSkyRegion</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">pos_target</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">on_radius</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define reference image centered on the target</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.image</span> <span class="kn">import</span> <span class="n">SkyImage</span>
<span class="n">xref</span> <span class="o">=</span> <span class="n">pos_target</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">value</span>
<span class="n">yref</span> <span class="o">=</span> <span class="n">pos_target</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">binsz</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># degree per pixel</span>
<span class="n">npix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span> <span class="o">/</span> <span class="n">binsz</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">npix</span><span class="p">)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
    <span class="n">nxpix</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">nypix</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="n">binsz</span><span class="p">,</span>
    <span class="n">xref</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="n">yref</span><span class="p">,</span>
    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;CAR&#39;</span><span class="p">,</span> <span class="n">coordsys</span><span class="o">=</span><span class="s1">&#39;GAL&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
500
Name: None
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 0.000e+00
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

</pre></div></div>
</div>
<p>We use the ring background estimation method, and an exclusion mask that
excludes the bright source at the Galactic center.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">exclusion_mask</span> <span class="o">=</span> <span class="n">ref_image</span><span class="o">.</span><span class="n">region_mask</span><span class="p">(</span><span class="n">on_region</span><span class="p">)</span>
<span class="n">exclusion_mask</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">exclusion_mask</span><span class="o">.</span><span class="n">data</span>
<span class="n">exclusion_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.figure.Figure at 0x1100f7eb8&gt;,
 &lt;matplotlib.axes._subplots.WCSAxesSubplot at 0x1106c3828&gt;,
 None)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_25_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_25_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.background</span> <span class="kn">import</span> <span class="n">RingBackgroundEstimator</span>
<span class="n">bkg_estimator</span> <span class="o">=</span> <span class="n">RingBackgroundEstimator</span><span class="p">(</span>
    <span class="n">r_in</span><span class="o">=</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.image</span> <span class="kn">import</span> <span class="n">IACTBasicImageEstimator</span>
<span class="n">image_estimator</span> <span class="o">=</span> <span class="n">IACTBasicImageEstimator</span><span class="p">(</span>
    <span class="n">reference</span><span class="o">=</span><span class="n">ref_image</span><span class="p">,</span>
    <span class="n">emin</span><span class="o">=</span><span class="mi">200</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span><span class="p">,</span>
    <span class="n">emax</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">offset_max</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">background_estimator</span><span class="o">=</span><span class="n">bkg_estimator</span><span class="p">,</span>
    <span class="n">exclusion_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The image_estimator contains 6 images. How to know which images it
contains</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">images</span> <span class="o">=</span> <span class="n">image_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">obs_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/gammapy/gammapy/cube/core.py:76: RuntimeWarning: divide by zero encountered in log
  log_data = np.log(self.data.value)
/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/scipy/interpolate/interpolate.py:2382: RuntimeWarning: invalid value encountered in multiply
  values += np.asarray(self.values[edge_indices]) * weight[vslice]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SkyImageList:
Number of images: 6

Image(index=0, name=counts) properties:
Name: counts
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 2.237e-01
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

Image(index=1, name=exposure) properties:
Name: exposure
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 8.641e+08
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

Image(index=2, name=background) properties:
Name: background
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 2.218e-01
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

Image(index=3, name=excess) properties:
Name: excess
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 1.929e-03
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

Image(index=4, name=flux) properties:
Name: flux
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 8.912e-13
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]

Image(index=5, name=psf) properties:
Name: psf
Data shape: (500, 500)
Data type: float64
Data unit:
Data mean: 4.000e-06
WCS type: [&#39;GLON-CAR&#39;, &#39;GLAT-CAR&#39;]


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;counts&#39;, &#39;exposure&#39;, &#39;background&#39;, &#39;excess&#39;, &#39;flux&#39;, &#39;psf&#39;]
</pre></div></div>
</div>
<p>How to show the images. The counts map</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">cts_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span>
<span class="n">cts_image</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_33_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_33_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">cts_image_cutoff</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_target</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">cts_image_cutoff</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_35_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_35_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">cts_image_cutoff</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#shift tab for documentation</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_36_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_36_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">bkg_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span>
<span class="n">bkg_image</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_37_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_37_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">excess_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;excess&#39;</span><span class="p">]</span>
<span class="n">excess_image</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_38_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_38_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">excess_image</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_39_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_39_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">excess_image_cutoff</span> <span class="o">=</span> <span class="n">excess_image</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_target</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">excess_image_cutoff</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_41_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_41_0.png" />
</div>
</div>
<p>Save the images in fits files to be used later on for an eventual sherpa
fitting</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;../datasets/images/MSH15-52_counts.fits.gz&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">images</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;../datasets/images/MSH15-52_background.fits.gz&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">images</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;../datasets/images/MSH15-52_exposure.fits.gz&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#As psf is an array of quantities we cannot use the images[&#39;psf&#39;].write() function</span>
<span class="n">fits</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s2">&quot;../datasets/images/MSH15-52_psf.fits.gz&quot;</span><span class="p">,</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
WARNING: AstropyDeprecationWarning: &#34;clobber&#34; was deprecated in version 2.0 and will be removed in a future version. Use argument &#34;overwrite&#34; instead. [gammapy.image.core]
</pre></div></div>
</div>
<p>Let’s compute the significance map by using the Li&amp;Ma significance
definition</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">Tophat2DKernel</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">Tophat2DKernel</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">gammapy.detect</span> <span class="kn">import</span> <span class="n">compute_lima_image</span>
<span class="n">lima_image</span> <span class="o">=</span> <span class="n">compute_lima_image</span><span class="p">(</span><span class="n">cts_image</span><span class="p">,</span><span class="n">bkg_image</span><span class="p">,</span><span class="n">kernel</span><span class="p">)[</span><span class="s1">&#39;significance&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/gammapy/gammapy/stats/poisson.py:237: RuntimeWarning: invalid value encountered in greater_equal
  mask = (n_on &gt;= n_on_min)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">lima_image</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_46_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_46_0.png" />
</div>
</div>
<p>Let’s compute a TS image instead (1D likelihood fit of the source
amplitude)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># cut out smaller piece of the PSF image to save computing time</span>
<span class="c1"># for covenience we&#39;re &quot;misusing&quot; the SkyImage class represent the PSF on the sky.</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span><span class="n">pos_target</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">kernel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_48_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_48_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.detect</span> <span class="kn">import</span> <span class="n">TSImageEstimator</span>
<span class="n">ts_image_estimator</span> <span class="o">=</span> <span class="n">TSImageEstimator</span><span class="p">()</span>
<span class="n">images_ts</span> <span class="o">=</span> <span class="n">ts_image_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">kernel</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">images_ts</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;ts&#39;, &#39;sqrt_ts&#39;, &#39;flux&#39;, &#39;flux_err&#39;, &#39;flux_ul&#39;, &#39;niter&#39;]
</pre></div></div>
</div>
<p>We run a peak finder on the sqrt_ts image to get a list of sources
(positions and peak sqrt_ts values).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">photutils.detection</span> <span class="kn">import</span> <span class="n">find_peaks</span>
<span class="n">sources</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">images_ts</span><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">images_ts</span><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">sources</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/photutils/detection/core.py:241: RuntimeWarning: invalid value encountered in greater
  peak_goodmask = np.logical_and(peak_goodmask, (data &gt; threshold))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[34]:
</pre></div>
</div>
<div class="output_area docutils container">
&lt;Table length=7&gt;
<table id="table4621343712" class="table-striped table-bordered table-condensed">
<thead><tr><th>x_peak</th><th>y_peak</th><th>icrs_ra_peak</th><th>icrs_dec_peak</th><th>peak_value</th></tr></thead>
<thead><tr><th></th><th></th><th>deg</th><th>deg</th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>365</td><td>129</td><td>226.971161208</td><td>-62.4077864573</td><td>7.48916286777</td></tr>
<tr><td>376</td><td>129</td><td>226.558518122</td><td>-62.5169585343</td><td>5.07489212548</td></tr>
<tr><td>360</td><td>136</td><td>227.006927211</td><td>-62.2365926311</td><td>5.56084742384</td></tr>
<tr><td>252</td><td>256</td><td>228.314721012</td><td>-59.0721619013</td><td>32.8441797147</td></tr>
<tr><td>250</td><td>297</td><td>227.5731937</td><td>-58.3471146655</td><td>7.22951662732</td></tr>
<tr><td>279</td><td>318</td><td>226.21779484</td><td>-58.2717112907</td><td>5.5170977991</td></tr>
<tr><td>306</td><td>324</td><td>225.206363333</td><td>-58.4270947083</td><td>6.63222821571</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">images_ts</span><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">pos_target</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;galactic&#39;</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_52_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_52_0.png" />
</div>
</div>
</div>
<div class="section" id="Spectral-analysis">
<h1>Spectral analysis<a class="headerlink" href="#Spectral-analysis" title="Permalink to this headline">¶</a></h1>
<p>We’ll run a spectral analysis using the classical reflected regions
background estimation method, and using the on-off (often called WSTAT)
likelihood function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.spectrum</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SpectrumExtraction</span><span class="p">,</span>
    <span class="n">SpectrumFit</span><span class="p">,</span>
    <span class="n">SpectrumResult</span><span class="p">,</span>
    <span class="n">models</span><span class="p">,</span>
    <span class="n">SpectrumEnergyGroupMaker</span><span class="p">,</span>
    <span class="n">FluxPointEstimator</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we will manually perform a background estimate by placing reflected
regions around the pointing position and looking at the source
statistics. This will result in a gammapy.background.BackgroundEstimate
that serves as input for other classes in gammapy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.background</span> <span class="kn">import</span> <span class="n">ReflectedRegionsBackgroundEstimator</span>
<span class="n">bkg_estimator</span> <span class="o">=</span> <span class="n">ReflectedRegionsBackgroundEstimator</span><span class="p">(</span>
    <span class="n">obs_list</span><span class="o">=</span><span class="n">obs_list</span><span class="p">,</span>
    <span class="n">on_region</span><span class="o">=</span><span class="n">on_region</span><span class="p">,</span>
    <span class="n">exclusion_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">bkg_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">bkg_estimate</span> <span class="o">=</span> <span class="n">bkg_estimator</span><span class="o">.</span><span class="n">result</span>
<span class="k">print</span><span class="p">(</span><span class="n">bkg_estimate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BackgroundEstimate
 Method: Reflected Regions
 on region
 Region: CircleSkyRegion
center: &lt;SkyCoord (Galactic): (l, b) in deg
    ( 320.33033806, -1.19304588)&gt;
radius: 0.3 deg
 EventList info:
- Number of events: 1092
- Median energy: 0.17698659002780914 TeV

 off region
 [&lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 320.14483723, -0.38358564)&gt;, radius=0.300000000000158 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 319.83994042,  0.13314066)&gt;, radius=0.2999999999970307 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 319.41345451,  0.55502371)&gt;, radius=0.299999999984854 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 318.89360504,  0.8541904)&gt;, radius=0.2999999999488278 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 318.31474854,  1.01088285)&gt;, radius=0.2999999998796625 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 317.71511156,  1.01475509)&gt;, radius=0.2999999997979047 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 317.13428278,  0.86555142)&gt;, radius=0.29999999973886843 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 316.61061838,  0.57312319)&gt;, radius=0.29999999973964403 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 316.17872574,  0.15678295)&gt;, radius=0.299999999811158 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 315.86718603, -0.35596294)&gt;, radius=0.2999999999160156 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 315.69666339, -0.93122209)&gt;, radius=0.29999999999079113 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 315.67852548, -1.530948)&gt;, radius=0.2999999999852151 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 315.81407001, -2.1154512)&gt;, radius=0.2999999998946337 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 316.09441377, -2.6460253)&gt;, radius=0.29999999977035724 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 316.50105777, -3.08751426)&gt;, radius=0.2999999996809835 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 317.0070971, -3.4106497)&gt;, radius=0.29999999966973817 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 317.57899916, -3.59400069)&gt;, radius=0.29999999973528474 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 318.17883339, -3.6254037)&gt;, radius=0.2999999998336704 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 318.7668025, -3.50277517)&gt;, radius=0.2999999999203383 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 319.30390196, -3.23425076)&gt;, radius=0.29999999997266896 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 319.75452527, -2.83764179)&gt;, radius=0.2999999999941856 deg)&gt;, &lt;CircleSkyRegion(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 320.08883587, -2.33924614)&gt;, radius=0.2999999999985438 deg)&gt;]
 EventList info:
- Number of events: 15015
- Median energy: 0.14029255509376526 TeV

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">bkg_estimator</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[39]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.figure.Figure at 0x113741828&gt;,
 &lt;matplotlib.axes._subplots.WCSAxesSubplot at 0x117e9c550&gt;,
 None)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_58_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_58_1.png" />
</div>
</div>
<p>we’re going to look at the overall source statistics in our signal
region.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">ObservationStats</span><span class="p">,</span> <span class="n">ObservationSummary</span>
<span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">obs</span><span class="p">,</span> <span class="n">bkg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obs_list</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">.</span><span class="n">result</span><span class="p">):</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObservationStats</span><span class="o">.</span><span class="n">from_obs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">bkg</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Observation summary report ***
Observation Id: 110114
Livetime: 0.490 h
On events: 1092
Off events: 15015
Alpha: 0.045
Bkg events in On region: 682.50
Excess: 409.50
Excess / Background: 0.60
Gamma rate: 37.14 1 / min
Bkg rate: 23.21 1 / min
Sigma: 14.03
 *** Observation summary report ***
Observation Id: 110140
Livetime: 0.490 h
On events: 2182
Off events: 7576
Alpha: 0.200
Bkg events in On region: 1515.20
Excess: 666.80
Excess / Background: 0.44
Gamma rate: 74.22 1 / min
Bkg rate: 51.54 1 / min
Sigma: 14.50
 *** Observation summary report ***
Observation Id: 110893
Livetime: 0.490 h
On events: 941
Off events: 12849
Alpha: 0.040
Bkg events in On region: 513.96
Excess: 427.04
Excess / Background: 0.83
Gamma rate: 32.01 1 / min
Bkg rate: 17.48 1 / min
Sigma: 16.45

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_summary</span> <span class="o">=</span> <span class="n">ObservationSummary</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<span class="n">obs_summary</span><span class="o">.</span><span class="n">plot_excess_vs_livetime</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[41]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x113d63710&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_61_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_61_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs_summary</span><span class="o">.</span><span class="n">plot_significance_vs_livetime</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[42]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x113a9d3c8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_62_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_62_1.png" />
</div>
</div>
<p>Now, we’re going to extract a spectrum using the SpectrumExtraction
class. Thus, we instantiate a SpectrumExtraction object that will do the
extraction.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">extract</span> <span class="o">=</span> <span class="n">SpectrumExtraction</span><span class="p">(</span>
    <span class="n">obs_list</span><span class="o">=</span><span class="n">obs_list</span><span class="p">,</span>
    <span class="n">bkg_estimate</span><span class="o">=</span><span class="n">bkg_estimate</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">extract</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/astropy/units/quantity.py:1059: RuntimeWarning: invalid value encountered in true_divide
  return super(Quantity, self).__truediv__(other)
No thresholds defined for obs Info for OBS_ID = 110114
- Start time: 59221.50
- Pointing pos: RA 224.61 deg / Dec -60.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

No thresholds defined for obs Info for OBS_ID = 110140
- Start time: 59222.66
- Pointing pos: RA 229.74 deg / Dec -58.90 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

No thresholds defined for obs Info for OBS_ID = 110893
- Start time: 59262.50
- Pointing pos: RA 224.81 deg / Dec -57.40 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

</pre></div></div>
</div>
<p>Now we will look at the files we just created. We will use the
SpectrumObservation object that are still in memory from the extraction
step. Note, however, that you could also read them from disk if you have
written them in the step above . The ANALYSIS_DIR folder contains 4
FITS files for each observation. These files are described in detail at
<a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/ogip/index.html">https://gamma-astro-data-formats.readthedocs.io/en/latest/ogip/index.html</a>.
In short they correspond to the on vector, the off vector, the effectie
area, and the energy dispersion.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">extract</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_66_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_66_0.png" />
</div>
</div>
<p>Now we’ll fit a global model to the spectrum. First we do a joint
likelihood fit to all observations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PowerLaw</span><span class="p">(</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">1e-11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 TeV-1&#39;</span><span class="p">),</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fit</span> <span class="o">=</span> <span class="n">SpectrumFit</span><span class="p">(</span><span class="n">extract</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
                 <span class="n">fit_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">))</span>
<span class="c1">#probably not working</span>
<span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">fit</span><span class="o">.</span><span class="n">est_errors</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:161: RuntimeWarning: divide by zero encountered in log
  term2_ = - n_on * np.log(mu_sig + alpha * mu_bkg)
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:166: RuntimeWarning: divide by zero encountered in log
  term3_ = - n_off * np.log(mu_bkg)
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:203: RuntimeWarning: divide by zero encountered in log
  term1 = - n_on * (1 - np.log(n_on))
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:204: RuntimeWarning: divide by zero encountered in log
  term2 = - n_off * (1 - np.log(n_off))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Fit result info
---------------
Model: PowerLaw

Parameters:

           name     value     error         unit      min max frozen
        --------- --------- --------- --------------- --- --- ------
            index 2.281e+00 9.212e-02                 nan nan  False
        amplitude 5.251e-12 5.185e-13 1 / (cm2 s TeV) nan nan  False
        reference 1.000e+00 0.000e+00             TeV nan nan   True

Covariance:

        name/name  index   amplitude
        --------- -------- ---------
            index  0.00849  3.97e-14
        amplitude 3.97e-14  2.69e-25

Statistic: 25.469 (wstat)
Fit Range: [  1.  10.] TeV

</pre></div></div>
</div>
<p>We will also produce a debug plot in order to show how the global fit
matches one of the individual observations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[46]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.axes._subplots.AxesSubplot at 0x110fef278&gt;,
 &lt;matplotlib.axes._subplots.AxesSubplot at 0x1135c4eb8&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_70_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_70_1.png" />
</div>
</div>
<p>we can compute flux points by fitting the norm of the global model in
energy bands. We’ll use a fixed energy binning for now.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.utils.energy</span> <span class="kn">import</span> <span class="n">EnergyBounds</span>
<span class="c1"># Flux points are computed on stacked observation</span>
<span class="n">stacked_obs</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">stacked_obs</span><span class="p">)</span>

<span class="n">ebounds</span> <span class="o">=</span> <span class="n">EnergyBounds</span><span class="o">.</span><span class="n">equal_log_spacing</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>

<span class="n">seg</span> <span class="o">=</span> <span class="n">SpectrumEnergyGroupMaker</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">stacked_obs</span><span class="p">)</span>
<span class="n">seg</span><span class="o">.</span><span class="n">compute_range_safe</span><span class="p">()</span>
<span class="n">seg</span><span class="o">.</span><span class="n">compute_groups_fixed</span><span class="p">(</span><span class="n">ebounds</span><span class="o">=</span><span class="n">ebounds</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Observation summary report ***
Observation Id: [110114-110893]
Livetime: 1.470 h
On events: 4215
Off events: 35437
Alpha: 0.077
Bkg events in On region: 2711.53
Excess: 1503.47
Excess / Background: 0.55
Gamma rate: 0.24 1 / min
Bkg rate: 0.43 1 / min
Sigma: 25.56
energy range: 0.01 TeV - 100.00 TeV
SpectrumEnergyGroups:
energy_group_idx bin_idx_min bin_idx_max  bin_type   energy_min     energy_max
                                                        TeV            TeV
---------------- ----------- ----------- --------- -------------- --------------
               0           0          17 underflow           0.01            0.1
               1          18          20    normal            0.1 0.146779926762
               2          21          23    normal 0.146779926762 0.215443469003
               3          24          26    normal 0.215443469003 0.316227766017
               4          27          29    normal 0.316227766017 0.464158883361
               5          30          32    normal 0.464158883361 0.681292069058
               6          33          35    normal 0.681292069058            1.0
               7          36          38    normal            1.0  1.46779926762
               8          39          41    normal  1.46779926762  2.15443469003
               9          42          45    normal  2.15443469003   3.5938136638
              10          46          48    normal   3.5938136638   5.2749970637
              11          49          51    normal   5.2749970637  7.74263682681
              12          52          54    normal  7.74263682681  11.3646366639
              13          55          57    normal  11.3646366639   16.681005372
              14          58          60    normal   16.681005372  24.4843674682
              15          61          63    normal  24.4843674682   35.938136638
              16          64          71  overflow   35.938136638          100.0

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/gammapy/gammapy/stats/poisson.py:383: RuntimeWarning: divide by zero encountered in double_scalars
  temp = (alpha + 1) / (n_on + n_off)
/Users/roberta/gammapy/gammapy/stats/poisson.py:384: RuntimeWarning: divide by zero encountered in log
  l = n_on * log(n_on * temp / alpha)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">fpe</span> <span class="o">=</span> <span class="n">FluxPointEstimator</span><span class="p">(</span>
    <span class="n">obs</span><span class="o">=</span><span class="n">stacked_obs</span><span class="p">,</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">seg</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fpe</span><span class="o">.</span><span class="n">compute_points</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">fpe</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:161: RuntimeWarning: divide by zero encountered in log
  term2_ = - n_on * np.log(mu_sig + alpha * mu_bkg)
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:166: RuntimeWarning: divide by zero encountered in log
  term3_ = - n_off * np.log(mu_bkg)
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:203: RuntimeWarning: divide by zero encountered in log
  term1 = - n_on * (1 - np.log(n_on))
/Users/roberta/gammapy/gammapy/stats/fit_statistics.py:204: RuntimeWarning: divide by zero encountered in log
  term2 = - n_off * (1 - np.log(n_off))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    e_ref          e_min      ...     dnde_errp         dnde_errn
     TeV            TeV       ...  1 / (cm2 s TeV)   1 / (cm2 s TeV)
-------------- -------------- ... ----------------- -----------------
0.121152765863            0.1 ... 8.72061666943e-11 8.42434331388e-11
0.177827941004 0.146779926762 ... 2.91860616342e-11 2.83960429739e-11
0.261015721568 0.215443469003 ... 1.21733786947e-11 1.14997707384e-11
0.383118684956 0.316227766017 ... 5.08208959507e-12 4.93903292311e-12
 0.56234132519 0.464158883361 ... 2.18838444717e-12  2.1044215593e-12
0.825404185268 0.681292069058 ... 8.10530110328e-13 7.62724353178e-13
 1.21152765863            1.0 ... 4.06653805218e-13 3.83733214894e-13
 1.77827941004  1.46779926762 ... 1.47908265419e-13 1.37715246213e-13
 2.78255940221  2.15443469003 ... 5.92433151674e-14 5.54375924633e-14
 4.35400465366   3.5938136638 ... 2.80538814458e-14 2.51206919417e-14
 6.39080484186   5.2749970637 ...  1.4722911577e-14 1.32728898473e-14
  9.3804186664  7.74263682681 ... 7.27843397814e-15 6.25807554327e-15
 13.7685716485  11.3646366639 ...  3.3849616992e-15 2.78918345438e-15
 20.2094993819   16.681005372 ... 1.94238921402e-15 1.56751144592e-15
 29.6634883918  24.4843674682 ... 1.21352111074e-15 9.82886013884e-16
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">fpe</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[49]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x114a02ba8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_74_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_74_1.png" />
</div>
</div>
<p>We try to compare the obtained spectral points and spectral results with
the input model in the xml file. So far there is no possibility to read
xml files from gammapy</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>  grep <span class="s1">&#39;MSH&#39;</span> <span class="nv">$CTADATA</span>/models/models_gps.xml -A10

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  &lt;source name=&#34;MSH 15-5-02&#34; type=&#34;ExtendedSource&#34;&gt;
    &lt;spectrum type=&#34;PowerLaw&#34;&gt;
      &lt;parameter name=&#34;Prefactor&#34; value=&#34;569.999993385584&#34; error=&#34;0&#34; scale=&#34;1e-20&#34; min=&#34;0&#34; free=&#34;1&#34; /&gt;
      &lt;parameter name=&#34;Index&#34; value=&#34;2.26999998092651&#34; error=&#34;-0&#34; scale=&#34;-1&#34; min=&#34;-10&#34; max=&#34;10&#34; free=&#34;1&#34; /&gt;
      &lt;parameter name=&#34;PivotEnergy&#34; value=&#34;1&#34; scale=&#34;1000000&#34; free=&#34;0&#34; /&gt;
    &lt;/spectrum&gt;
    &lt;spatialModel type=&#34;RadialGaussian&#34;&gt;
      &lt;parameter name=&#34;RA&#34; value=&#34;228.3208083735&#34; scale=&#34;1&#34; free=&#34;0&#34; /&gt;
      &lt;parameter name=&#34;DEC&#34; value=&#34;-59.0817007878937&#34; scale=&#34;1&#34; free=&#34;0&#34; /&gt;
      &lt;parameter name=&#34;Sigma&#34; value=&#34;0.106666669249535&#34; error=&#34;0&#34; scale=&#34;1&#34; min=&#34;0.0002778&#34; free=&#34;1&#34; /&gt;
    &lt;/spatialModel&gt;
</pre></div></div>
</div>
<p>We plug in the spectral parameters of the input model in a gammapy
spectral function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">spec_true</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PowerLaw</span><span class="p">(</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mf">2.2699</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">569.99999e-20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 MeV-1&#39;</span><span class="p">),</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>we plot the obtained spectrum with the one in input together</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">energy_range</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">flux_unit</span><span class="o">=</span><span class="s1">&#39;erg-1 cm-2 s-1&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">total_result</span> <span class="o">=</span> <span class="n">SpectrumResult</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
    <span class="n">points</span><span class="o">=</span><span class="n">fpe</span><span class="o">.</span><span class="n">flux_points</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">ax_sed</span><span class="p">,</span> <span class="n">ax_resid</span> <span class="o">=</span> <span class="n">total_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fig_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span>
    <span class="n">point_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Measured&#39;</span><span class="p">),</span>
    <span class="o">**</span><span class="n">opts</span>
<span class="p">)</span>

<span class="n">spec_true</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax_sed</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">opts</span>
<span class="p">)</span>
<span class="n">ax_sed</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[52]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1151a0c50&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_80_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_80_1.png" />
</div>
</div>
</div>
<div class="section" id="Sherpa-Morphological-fit">
<h1>Sherpa Morphological fit<a class="headerlink" href="#Sherpa-Morphological-fit" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sherpa.astro.ui</span> <span class="kn">as</span> <span class="nn">sh</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_stat</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_method</span><span class="p">(</span><span class="s2">&quot;simplex&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="s1">&#39;../datasets/images/MSH15-52_counts.fits.gz&#39;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_coord</span><span class="p">(</span><span class="s2">&quot;logical&quot;</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">load_table_model</span><span class="p">(</span><span class="s2">&quot;expo&quot;</span><span class="p">,</span> <span class="s2">&quot;../datasets/images/MSH15-52_exposure.fits.gz&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_table_model</span><span class="p">(</span><span class="s2">&quot;bkg&quot;</span><span class="p">,</span> <span class="s2">&quot;../datasets/images/MSH15-52_background.fits.gz&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_psf</span><span class="p">(</span><span class="s2">&quot;psf&quot;</span><span class="p">,</span> <span class="s2">&quot;../datasets/images/MSH15-52_psf.fits.gz&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: failed to import sherpa.astro.xspec; XSPEC models will not be available
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sh</span><span class="o">.</span><span class="n">set_full_model</span><span class="p">(</span><span class="n">bkg</span><span class="p">)</span>
<span class="n">bkg</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">bkg</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_data_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span>  <span class="n">sh</span><span class="o">.</span><span class="n">get_model_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">ref_image</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

<span class="n">resid_table</span><span class="o">=</span><span class="p">[]</span>  <span class="c1">#Keep residual images in a list to show them later</span>
<span class="n">resid_smo6</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">resid_smo6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">resid_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid_smo6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_83_0.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_83_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">maxcoord</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">lookup_max</span><span class="p">()</span>
<span class="n">maxpix</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">wcs_skycoord_to_pixel</span><span class="p">(</span><span class="n">maxcoord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">maxcoord</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">maxpix</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_full_model</span><span class="p">(</span><span class="n">bkg</span> <span class="o">+</span> <span class="n">psf</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">gauss2d</span><span class="o">.</span><span class="n">g0</span><span class="p">)</span> <span class="o">*</span> <span class="n">expo</span><span class="p">)</span> <span class="c1"># creates g0 as a gauss2d instance</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;SkyCoord (Galactic): (l, b) in deg
    ( 320.30033297, -1.06304572)&gt;, 4.4984089588222815)
(array(250.99999999999864), array(256.0))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g0</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
<span class="n">expo</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">expo</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ampl</span><span class="p">)</span>
<span class="n">g0</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">g0</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">maxcoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 198875
Final fit statistic   = 198607 at function evaluation 194
Data points           = 250000
Degrees of freedom    = 249998
Change in statistic   = 267.173
   g0.fwhm        12.3647
   g0.ampl        1.9694
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">sh</span><span class="o">.</span><span class="n">covar</span><span class="p">()</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">g0</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_data_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span>  <span class="n">sh</span><span class="o">.</span><span class="n">get_model_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">ref_image</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

<span class="n">resid_smo6</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">resid_smo6</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">add_cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">resid_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid_smo6</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 198607
Final fit statistic   = 198502 at function evaluation 290
Data points           = 250000
Degrees of freedom    = 249996
Change in statistic   = 105.338
   g0.fwhm        11.8251
   g0.xpos        253.412
   g0.ypos        256.329
   g0.ampl        2.16619
Dataset               = 1
Confidence Method     = covariance
Iterative Fit Method  = None
Fitting Method        = neldermead
Statistic             = cash
covariance 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   g0.fwhm           11.8251    -0.387663     0.387663
   g0.xpos           253.412    -0.233414     0.233414
   g0.ypos           256.329     -0.23392      0.23392
   g0.ampl           2.16619    -0.134857     0.134857
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_analysis_msh15-52_86_1.png" src="../_images/notebooks_cta_1dc_analysis_msh15-52_86_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">gaussian_fwhm_to_sigma</span>
<span class="n">coord</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">wcs_pixel_to_skycoord</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ypos</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">pix_scale</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">wcs_pixel_scale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deg</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">g0</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">val</span> <span class="o">*</span> <span class="n">pix_scale</span> <span class="o">*</span> <span class="n">gaussian_fwhm_to_sigma</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;the Sigma is: &#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="s1">&#39; deg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
the Sigma is:  0.100432938964  deg
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;SkyCoord (Galactic): (l, b) in deg
    ( 320.25209212, -1.05646917)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sh</span><span class="o">.</span><span class="n">covar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FitErr</span>                                    Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-60-f0bf266a394b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sh<span class="ansi-blue-fg">.</span>covar<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;string&gt;</span> in <span class="ansi-cyan-fg">covar</span><span class="ansi-blue-fg">(*args)</span>

<span class="ansi-green-fg">/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/sherpa/ui/utils.py</span> in <span class="ansi-cyan-fg">covar</span><span class="ansi-blue-fg">(self, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">   9355</span>
<span class="ansi-green-intense-fg ansi-bold">   9356</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">-&gt; 9357</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_covariance_results <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_est_errors<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;covariance&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   9358</span>
<span class="ansi-green-intense-fg ansi-bold">   9359</span>     <span class="ansi-red-fg"># DOC-TODO: include screen output of conf() ?</span>

<span class="ansi-green-fg">/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/sherpa/ui/utils.py</span> in <span class="ansi-cyan-fg">_est_errors</span><span class="ansi-blue-fg">(self, args, methodname)</span>
<span class="ansi-green-intense-fg ansi-bold">   9227</span>             parlist <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">   9228</span>         ids<span class="ansi-blue-fg">,</span> f <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get_fit<span class="ansi-blue-fg">(</span>id<span class="ansi-blue-fg">,</span> otherids<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_estmethods<span class="ansi-blue-fg">[</span>methodname<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 9229</span><span class="ansi-red-fg">         </span>res <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">.</span>est_errors<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_methods<span class="ansi-blue-fg">,</span> parlist<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   9230</span>         res<span class="ansi-blue-fg">.</span>datasets <span class="ansi-blue-fg">=</span> ids
<span class="ansi-green-intense-fg ansi-bold">   9231</span>         info<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/sherpa/fit.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(fit, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>     <span class="ansi-green-fg">def</span> run<span class="ansi-blue-fg">(</span>fit<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     50</span>         fit<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>startup<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 51</span><span class="ansi-red-fg">         </span>result <span class="ansi-blue-fg">=</span> func<span class="ansi-blue-fg">(</span>fit<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span>         fit<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>teardown<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     53</span>         <span class="ansi-green-fg">return</span> result

<span class="ansi-green-fg">/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/sherpa/fit.py</span> in <span class="ansi-cyan-fg">est_errors</span><span class="ansi-blue-fg">(self, methoddict, parlist)</span>
<span class="ansi-green-intense-fg ansi-bold">   1290</span>             oldremin <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>estmethod<span class="ansi-blue-fg">.</span>remin
<span class="ansi-green-intense-fg ansi-bold">   1291</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1292</span><span class="ansi-red-fg">             output = self.estmethod.compute(self._iterfit._get_callback(),
</span><span class="ansi-green-intense-fg ansi-bold">   1293</span>                                             self<span class="ansi-blue-fg">.</span>_iterfit<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1294</span>                                             self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>thawedpars<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">/Users/roberta/anaconda2/envs/cta/lib/python3.5/site-packages/sherpa/fit.py</span> in <span class="ansi-cyan-fg">_get_callback</span><span class="ansi-blue-fg">(self, outfile, clobber)</span>
<span class="ansi-green-intense-fg ansi-bold">    527</span>     <span class="ansi-green-fg">def</span> _get_callback<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> outfile<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> clobber<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    528</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">.</span>thawedpars<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 529</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> FitErr<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;nothawedpar&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span>
<span class="ansi-green-intense-fg ansi-bold">    531</span>         <span class="ansi-red-fg"># support Sherpa use with SAMP</span>

<span class="ansi-red-fg">FitErr</span>: model has no thawed parameters
</pre></div></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Check the pointing positions</a></li>
<li><a class="reference internal" href="#MAKE-SKYMAP">MAKE SKYMAP</a></li>
<li><a class="reference internal" href="#Spectral-analysis">Spectral analysis</a></li>
<li><a class="reference internal" href="#Sherpa-Morphological-fit">Sherpa Morphological fit</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/cta_1dc_analysis_msh15-52.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>