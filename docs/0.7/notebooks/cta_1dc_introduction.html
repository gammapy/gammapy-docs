
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CTA first data challenge (1DC) with Gammapy &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/cta_1dc_introduction.ipynb">cta_1dc_introduction.ipynb</a>
|
<a class="reference external" href="../_static/notebooks/cta_1dc_introduction.py">cta_1dc_introduction.py</a></p>
</div>
<div class="figure" id="id1">
<img alt="CTA first data challenge logo" src="../_images/cta-1dc.png" />
<p class="caption"><span class="caption-text">CTA first data challenge logo</span></p>
</div>
<div class="section" id="CTA-first-data-challenge-(1DC)-with-Gammapy">
<h1>CTA first data challenge (1DC) with Gammapy<a class="headerlink" href="#CTA-first-data-challenge-(1DC)-with-Gammapy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.cta-observatory.org/">CTA observatory</a> has started a
first data challenge (“CTA 1DC”), focusing on high-level data analysis.
Gammapy is a prototype for the CTA science tools (see <a class="reference external" href="https://github.com/gammapy/icrc2017-gammapy-poster/blob/master/proceeding/gammapy-icrc2017.pdf">Gammapy
proceeding from ICRC
2017</a>),
and while many things are work in progress (most importantly: source and
background modeling and cube analysis), you can use it already to
analyse the simulated CTA data.</p>
<p>The main page for CTA 1DC is here:
<a class="reference external" href="https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki">https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki</a> (CTA
internal)</p>
<p>There you will find information on 1DC sky models, data access, data
organisation, simulation and analysis tools, simulated observations, as
well as contact information if you have any questions or comments.</p>
<div class="section" id="This-tutorial-notebook">
<h3>This tutorial notebook<a class="headerlink" href="#This-tutorial-notebook" title="Permalink to this headline">¶</a></h3>
<p>This notebook shows you how to get started with CTA 1DC data and what it
contains.</p>
<p>You will learn how to use Astropy and Gammapy to:</p>
<ul class="simple">
<li>access event data</li>
<li>access instrument response functions (IRFs)</li>
<li>use index files and the <code class="docutils literal"><span class="pre">gammapy.data.DataStore</span></code> to access all data</li>
<li>use the observation index file to select the observations you’re
interested in</li>
<li>read model XML files from Python (not integrated in Gammapy yet)</li>
</ul>
<p>This is to familiarise ourselves with the data files and to get an
overview.</p>
</div>
<div class="section" id="Further-information">
<h3>Further information<a class="headerlink" href="#Further-information" title="Permalink to this headline">¶</a></h3>
<p>How to analyse the CTA 1DC data with Gammapy (make an image and
spectrum) is shown in a second notebook
<a class="reference internal" href="cta_data_analysis.html"><span class="doc">cta_data_analysis.ipynb</span></a>. If you prefer,
you can of course just skim or skip this notebook and go straight to
second one.</p>
<p>More tutorial notebooks for Gammapy are <a class="reference internal" href="../index.html"><span class="doc">here</span></a>, the
Gammapy Sphinx docs are at at <a class="reference external" href="http://docs.gammapy.org">http://docs.gammapy.org</a> If you have a
Gammapy-related question, please send an email to to Gammapy mailing
list at <a class="reference external" href="http://groups.google.com/group/gammapy">http://groups.google.com/group/gammapy</a> (registration required)
or if you have an issue or feature request, file an issue here:
<a class="reference external" href="https://github.com/gammapy/gammapy/issues/new">https://github.com/gammapy/gammapy/issues/new</a> (free Github account
required, takes 1 min to set up).</p>
<p>Please note that the 1DC data isn’t public and results should be shared
on CTA Redmine, as described here:
<a class="reference external" href="https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki#Sharing-of-analysis-results">https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki#Sharing-of-analysis-results</a>.
Unfortunately there’s no good way yet to share Jupyter notebooks in CTA,
as there is e.g. on Github and nbviewer which can show any public
noteook.</p>
</div>
</div>
<div class="section" id="Notebook-and-Gammapy-Setup">
<h2>Notebook and Gammapy Setup<a class="headerlink" href="#Notebook-and-Gammapy-Setup" title="Permalink to this headline">¶</a></h2>
<p>Before we get started, please execcute the following code cells.</p>
<p>The first one configures the notebooks so that plots are shown inline
(if you don’t do this, separate windows will pop up). The second cell
imports and checks the version of the packages we will use below. If
you’re missing some packages, install them and then select “Kernel -&gt;
Restart” above to restart this notebook.</p>
<p>In case you’re new to Jupyter notebooks: to execute a cell, select it,
then type “SHIFT” + “ENTER”.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy</span>
<span class="kn">import</span> <span class="nn">gammapy</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;numpy:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;astropy:&#39;</span><span class="p">,</span> <span class="n">astropy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;gammapy:&#39;</span><span class="p">,</span> <span class="n">gammapy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy: 1.13.3
astropy: 3.0.dev20763
gammapy: 0.7.dev5344
</pre></div></div>
</div>
</div>
<div class="section" id="Getting-the-1DC-data">
<h2>Getting the 1DC data<a class="headerlink" href="#Getting-the-1DC-data" title="Permalink to this headline">¶</a></h2>
<p>You can find infos how to download the 1DC data here:
<a class="reference external" href="https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki#Data-access">https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki#Data-access</a></p>
<p>Overall it’s quite large (20 GB) and will take a while to download. You
can just download a subset of the “gps”, “gc”, “egal” or “agn” datasets,
the ones you’re interested in.</p>
<p><strong>In this tutorial, we will only use the “gps” (Galactic center survey)
dataset, so maybe you could start by downloading that first.</strong></p>
<p>While you wait, we strongly recommend you go over some <a class="reference external" href="https://www.youtube.com/playlist?list=PLq3ItKoU0hy7ED6m1eve6WIFs7ibcv3YR">CTA
basics</a>
as well as some <a class="reference external" href="https://www.youtube.com/playlist?list=PL-Qryc-SVnnu0tPV623TFnrAEQLykkZF5">Python
basics</a>
to prepare yourself for this tutorial.</p>
<p>Got the data?</p>
<p>Assuming you’ve followed the instructions, you should have the
<code class="docutils literal"><span class="pre">CTADATA</span></code> environment variable pointing to the folder where all data
is located. (Gammapy doesn’t need or use the <code class="docutils literal"><span class="pre">CALDB</span></code> environment
variable.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span><span class="nb">echo</span> <span class="nv">$CTADATA</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/deil/work/cta-dc/data/1dc/1dc
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls <span class="nv">$CTADATA</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-fg">caldb</span>  <span class="ansi-blue-fg">data</span>   <span class="ansi-blue-fg">index</span>  <span class="ansi-blue-fg">models</span> <span class="ansi-blue-fg">obs</span>
</pre></div></div>
</div>
<p>You can find a description of the directories and files here:
<a class="reference external" href="https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki/Data_organisation">https://forge.in2p3.fr/projects/data-challenge-1-dc-1/wiki/Data_organisation</a></p>
<p>A very detailed specification of the data formats is here:
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/">http://gamma-astro-data-formats.readthedocs.io/</a></p>
<p>But actually, instead of reading those pages, let’s just explore the
data and see how to load it with Gammapy …</p>
<p>Before we start, just in case the commands above show that you don’t
have <code class="docutils literal"><span class="pre">CTADATA</span></code> set:</p>
<ul class="simple">
<li>you either have to exit the “jupyter notebook” command on your
terminal, set the environment variable (I’m using bash and added the
command <code class="docutils literal"><span class="pre">export</span> <span class="pre">CTADATA=/Users/deil/work/cta-dc/data/1dc/1dc</span></code> to my
<code class="docutils literal"><span class="pre">~/.profile</span></code> file and then did <code class="docutils literal"><span class="pre">source</span> <span class="pre">~/.profile</span></code>), then
re-start Jupyter and this notebook.</li>
<li>or you can set the environment variable by uncommentting the code in
the following cell, setting the correct path, then executing it.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># import os</span>
<span class="c1"># os.environ[&#39;CTADATA&#39;] = &#39;/Users/deil/work/cta-dc/data/1dc/1dc&#39;</span>
<span class="c1"># !echo $CTADATA</span>
<span class="c1"># !ls $CTADATA</span>
</pre></div>
</div>
</div>
<p>Let’s have a look around at the directories and files in <code class="docutils literal"><span class="pre">$CTADATA</span></code>.</p>
<p>We will look at the <code class="docutils literal"><span class="pre">data</span></code> folder with events, the <code class="docutils literal"><span class="pre">caldb</span></code> folder
with the IRFs and the <code class="docutils literal"><span class="pre">index</span></code> folder with the index files. At the end,
we will also mention what the <code class="docutils literal"><span class="pre">model</span></code> and <code class="docutils literal"><span class="pre">obs</span></code> folder contains, but
they aren’t used with Gammapy, at least not at the moment.</p>
</div>
<div class="section" id="EVENT-data">
<h2>EVENT data<a class="headerlink" href="#EVENT-data" title="Permalink to this headline">¶</a></h2>
<p>First, the EVENT data (RA, DEC, ENERGY, TIME of each photon or hadronic
background event) is in the <code class="docutils literal"><span class="pre">data/baseline</span></code> folder, with one
observation per file. The “baseline” refers to the assumed CTA array
that was used to simulate the observations. The number in the filename
is the observation identifier <code class="docutils literal"><span class="pre">OBS_ID</span></code> of the observation.
Observations are ~ 30 minutes, pointing at a fixed location on the sky.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls <span class="nv">$CTADATA</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-fg">caldb</span>  <span class="ansi-blue-fg">data</span>   <span class="ansi-blue-fg">index</span>  <span class="ansi-blue-fg">models</span> <span class="ansi-blue-fg">obs</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls <span class="nv">$CTADATA</span>/data/baseline
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-fg">agn</span>  <span class="ansi-blue-fg">egal</span> <span class="ansi-blue-fg">gc</span>   <span class="ansi-blue-fg">gps</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls <span class="nv">$CTADATA</span>/data/baseline/gps <span class="p">|</span> head -n3
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gps_baseline_110000.fits
gps_baseline_110001.fits
gps_baseline_110002.fits
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># There&#39;s 3270 observations and 11 GB of event data for the gps dataset</span>
<span class="o">!</span>ls <span class="nv">$CTADATA</span>/data/baseline/gps <span class="p">|</span> wc -l
<span class="o">!</span>du -hs <span class="nv">$CTADATA</span>/data/baseline/gps
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    3270
 11G    /Users/deil/work/cta-dc/data/1dc/1dc/data/baseline/gps
</pre></div></div>
</div>
<p>Let’s open up the first event list using the Gammapy <code class="docutils literal"><span class="pre">EventList</span></code>
class, which contains the <code class="docutils literal"><span class="pre">EVENTS</span></code> table data via the <code class="docutils literal"><span class="pre">table</span></code>
attribute as an Astropy <code class="docutils literal"><span class="pre">Table</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">EventList</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;$CTADATA/data/baseline/gps/gps_baseline_110000.fits&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">events</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;gammapy.data.event_list.EventList&#39;&gt;
&lt;class &#39;astropy.table.table.Table&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># First event (using [] for &quot;indexing&quot;)</span>
<span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>Row index=0</i>
<table id="table4664112352">
<thead><tr><th>EVENT_ID</th><th>TIME</th><th>RA</th><th>DEC</th><th>ENERGY</th><th>DETX</th><th>DETY</th><th>MC_ID</th></tr></thead>
<thead><tr><th></th><th>s</th><th>deg</th><th>deg</th><th>TeV</th><th>deg</th><th>deg</th><th></th></tr></thead>
<thead><tr><th>uint32</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>int32</th></tr></thead>
<tr><td>1</td><td>662774403.255</td><td>-173.287</td><td>-62.4099</td><td>0.0486149</td><td>1.60795</td><td>0.258016</td><td>2</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># First few events (using [] for &quot;slicing&quot;)</span>
<span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>Table length=2</i>
<table id="table4611945864" class="table-striped table-bordered table-condensed">
<thead><tr><th>EVENT_ID</th><th>TIME</th><th>RA</th><th>DEC</th><th>ENERGY</th><th>DETX</th><th>DETY</th><th>MC_ID</th></tr></thead>
<thead><tr><th></th><th>s</th><th>deg</th><th>deg</th><th>TeV</th><th>deg</th><th>deg</th><th></th></tr></thead>
<thead><tr><th>uint32</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>int32</th></tr></thead>
<tr><td>1</td><td>662774403.255</td><td>-173.287</td><td>-62.4099</td><td>0.0486149</td><td>1.60795</td><td>0.258016</td><td>2</td></tr>
<tr><td>2</td><td>662774459.184</td><td>-172.62</td><td>-63.0346</td><td>0.0611035</td><td>0.979058</td><td>0.555166</td><td>2</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Event times can be accessed as Astropy Time objects</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;astropy.time.core.Time&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">events</span><span class="o">.</span><span class="n">time</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;Time object: scale=&#39;tt&#39; format=&#39;mjd&#39; value=[ 59215.50003767  59215.500685  ]&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Convert event time to more human-readable format</span>
<span class="k">print</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">time</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;2021-01-01T12:00:03.255(TT)&#39; &#39;2021-01-01T12:00:59.184(TT)&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Event positions can be accessed as Astropy SkyCoord objects</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">radec</span><span class="p">))</span>
<span class="n">events</span><span class="o">.</span><span class="n">radec</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;astropy.coordinates.sky_coordinate.SkyCoord&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[16]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    [( 186.71313477, -62.40993118), ( 187.38043213, -63.03462601)]&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">events</span><span class="o">.</span><span class="n">galactic</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[17]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;SkyCoord (Galactic): (l, b) in deg
    [( 300.08953957,  0.32605543), ( 300.45042443, -0.26852334)]&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># The event header information is stored</span>
<span class="c1"># in the `events.table.meta` dictionary</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;collections.OrderedDict&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># E.g. to get the observation pointing position in degrees:</span>
<span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;RA_PNT&#39;</span><span class="p">],</span> <span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DEC_PNT&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(186.15609741, -64.019)
</pre></div>
</div>
</div>
</div>
<div class="section" id="EVENT-analysis-example">
<h2>EVENT analysis example<a class="headerlink" href="#EVENT-analysis-example" title="Permalink to this headline">¶</a></h2>
<p>As an example how to work with EVENT data, let’s look at the spatial and
energy distribution of the events for a single run.</p>
<p>Note that EVENT data in Gammapy is just stored in an Astropy Table,
which is basically a dictionary mapping column names to column data,
where the column data is a Numpy array. This means you can efficienly
process it from Python using any of the scientific Python tools you like
(e.g. Numpy, Scipy, scikit-image, scikit-learn, …)</p>
<div class="section" id="EVENT-spatial-distribution">
<h3>EVENT spatial distribution<a class="headerlink" href="#EVENT-spatial-distribution" title="Permalink to this headline">¶</a></h3>
<p>To illustrate a bit how to work with EVENT table an header data, let’s
plot the event positions as well as the pointing position.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Event positions</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">galactic</span><span class="p">[::</span><span class="mi">300</span><span class="p">]</span> <span class="c1"># sub-sample every 100th event</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180 deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Pointing position</span>
<span class="n">pos_pnt</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">pointing_radec</span><span class="o">.</span><span class="n">galactic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos_pnt</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180 deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">pos_pnt</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Galactic longitude (deg)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Galactic latitude (deg)&#39;</span><span class="p">)</span>
<span class="n">pos_pnt</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;SkyCoord (Galactic): (l, b) in deg
    ( 300.00001584, -1.29999832)&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_28_1.png" src="../_images/notebooks_cta_1dc_introduction_28_1.png" />
</div>
</div>
</div>
<div class="section" id="EVENT-energy-distribution">
<h3>EVENT energy distribution<a class="headerlink" href="#EVENT-energy-distribution" title="Permalink to this headline">¶</a></h3>
<p>Let’s have a look at the event energy distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energy</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">energy_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">energy_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Event energy (TeV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of events&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Text(0,0.5,&#39;Number of events&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_30_1.png" src="../_images/notebooks_cta_1dc_introduction_30_1.png" />
</div>
</div>
<p>A double-peak, at ~ 30 GeV and ~ 100 GeV? …. let’s try to find out
what’s going on …</p>
</div>
<div class="section" id="EVENT-MC_ID">
<h3>EVENT MC_ID<a class="headerlink" href="#EVENT-MC_ID" title="Permalink to this headline">¶</a></h3>
<p>One idea could be to split the data into gamma-ray and hadronic
background events. Now from looking at the FITS header, one can see that
<code class="docutils literal"><span class="pre">MC_ID</span> <span class="pre">==</span> <span class="pre">1</span></code> is the hadronic background, and the other values are for
different gamma-ray emission components.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">is_gamma</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of events: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of gammas: &#39;</span><span class="p">,</span> <span class="n">is_gamma</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of hadrons: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">)</span> <span class="o">-</span> <span class="n">is_gamma</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of events:  107301
Number of gammas:  1112
Number of hadrons:  106189
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energy</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">energy_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">energy_bins</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="o">~</span><span class="n">is_gamma</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;hadron&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="n">is_gamma</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Event energy (TeV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of events&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[23]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x117b49588&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_33_1.png" src="../_images/notebooks_cta_1dc_introduction_33_1.png" />
</div>
</div>
<p>As expected, the energy spectra are roughly power-laws. When plotting in
log-log, one can see that the spectra are roughly power-laws (as
expected), and the “double peak” we saw before looks more like a “double
energy threshold” pattern. It’s there for gammas and background, and
below 100 GeV the signal to background ratio is lower.</p>
<p>What we’re seeing here is the result of a mixed-array in CTA with LSTs,
MSTs and SSTs, which have different energy thresholds:</p>
<ul class="simple">
<li>~ 30 GeV is the energy threshold of the LSTs</li>
<li>~ 100 GeV is the energy threshold of the MSTs</li>
<li>the energy threshold of the SSTs is at a few TeV and doesn’t show up
as a clear feature in the gamma and background energy distribution
(probably the rise in slope in gamma in the 1-10 TeV range is due to
the SSTs).</li>
</ul>
<p>Let’s look a little deeper and also check the event offset distribution
in the field of view …</p>
</div>
<div class="section" id="EVENT-FOV-offset">
<h3>EVENT FOV offset<a class="headerlink" href="#EVENT-FOV-offset" title="Permalink to this headline">¶</a></h3>
<p>The event position and offset in the field of view (FOV) can be computed
from the event RA, DEC position and the observation pointing RA, DEC
position.</p>
<p>But actually, the field of view position is stored as extra columns in
the EVENT list: <code class="docutils literal"><span class="pre">DETX</span></code> and <code class="docutils literal"><span class="pre">DETY</span></code> (angles in degree, I think RA /
DEC aligned field of view system).</p>
<p>I presume (hope) this unnecessary information will be dropped from the
CTA event lists in the future to save some space (make the CTA DL3 data
~25% smaller), but for now, let’s use those columns to compute the field
of view offset and look at the offset-energy distribution of the events.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energy_bins</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">offset_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">table</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;DETX&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;DETY&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">,</span> <span class="n">offset_bins</span><span class="p">),</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">,</span> <span class="n">offset_bins</span><span class="p">,</span>
               <span class="n">hist</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Energy (TeV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Offset (deg)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[24]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Text(0,0.5,&#39;Offset (deg)&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_35_1.png" src="../_images/notebooks_cta_1dc_introduction_35_1.png" />
</div>
</div>
<p>So the CTA field of view increases with energy in steps. The energy
distribution we saw before was the combination of the energy
distribution at all offsets. Even at a single offset, the double
energy-threshold at ~ 30 GeV and ~ 100 GeV is present.</p>
</div>
<div class="section" id="Stacking-EVENTS-tables">
<h3>Stacking EVENTS tables<a class="headerlink" href="#Stacking-EVENTS-tables" title="Permalink to this headline">¶</a></h3>
<p>As a final example of how to work with event lists, here’s now to apply
arbitrary event selections and how to stack events tables from several
observations into a single event list.</p>
<p>We will just use <code class="docutils literal"><span class="pre">astropy.table.Table</span></code> directly, not go via the
<code class="docutils literal"><span class="pre">gammapy.data.EventList</span></code> class. Note that you can always make an
<code class="docutils literal"><span class="pre">EventList</span></code> object from a <code class="docutils literal"><span class="pre">Table</span></code> object via
<code class="docutils literal"><span class="pre">event_list</span> <span class="pre">=</span> <span class="pre">EventList(table)</span></code>. One point to keep in mind is that
<code class="docutils literal"><span class="pre">Table.read</span></code> doesn’t resolve environment variables in filenames, so
we’ll use the Python standard library <code class="docutils literal"><span class="pre">os</span></code> package to construct the
filenames.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">vstack</span> <span class="k">as</span> <span class="n">table_vstack</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CTADATA&#39;</span><span class="p">],</span> <span class="s1">&#39;data/baseline/gps/gps_baseline_110000.fits&#39;</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;EVENTS&#39;</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CTADATA&#39;</span><span class="p">],</span> <span class="s1">&#39;data/baseline/gps/gps_baseline_110001.fits&#39;</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;EVENTS&#39;</span><span class="p">)</span>
<span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table_vstack</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s1">&#39;silent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of events: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of events:  214675
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Let&#39;s select gamma rays with energy above 10 TeV</span>
<span class="n">mask_mc_id</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span>
<span class="n">mask_energy</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">mask_mc_id</span> <span class="o">&amp;</span> <span class="n">mask_energy</span>
<span class="n">table2</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of events after selection:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of events after selection: 45
</pre></div></div>
</div>
<p>When processing a lot or all of the 1DC events, you would write a for
loop, and apply the event selection before putting the table in the list
of tables, or you might run out of memory. An example is
<a class="reference external" href="https://github.com/gammasky/cta-dc/blob/master/data/cta_1dc_make_allsky_images.py">here</a>.</p>
<p>That’s all for <code class="docutils literal"><span class="pre">EVENTS</span></code>. You now know what every column in the event
table contains, and how to work with event list tables using
<code class="docutils literal"><span class="pre">gammapy.data.EventList</span></code> and <code class="docutils literal"><span class="pre">astropy.table.Table</span></code>.</p>
<p>Just in case that there is some observation parameter in the FITS EVENTS
header that you’re interested in, you can find the full description of
the keys you can access via the <code class="docutils literal"><span class="pre">events.table.meta</span></code> dictionary
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/en/latest/events/events.html">here</a>.</p>
</div>
</div>
<div class="section" id="IRFs">
<h2>IRFs<a class="headerlink" href="#IRFs" title="Permalink to this headline">¶</a></h2>
<p>The CTA instrument reponse functions (IRFs) are given as FITS files in
the <code class="docutils literal"><span class="pre">caldb</span></code> folder.</p>
<p>Note that this is not realistic. Real CTA data at the DL3 level (what we
have here, what users get) will mostly likely have per-observation or
per-time interval IRFs, and the IRFs will not be stored in a separate
CALDB folder, but distributed with the EVENTS (probably in the same
file, or at least in the same folder, so that it’s together).</p>
<p>For now, the EVENT to IRF association (i.e. which IRF is the right one
for given EVENTS) is done by index files. We will discuss those in the
next section, but before we do, let’s look at the CTA IRFs for one given
configuration: <code class="docutils literal"><span class="pre">South_z20_50h</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!(</span><span class="nb">cd</span> <span class="nv">$CTADATA</span> <span class="o">&amp;&amp;</span> tree caldb<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
caldb
└── data
    └── cta
        └── 1dc
            ├── bcf
            │   ├── North_z20_50h
            │   │   └── irf_file.fits
            │   ├── North_z40_50h
            │   │   └── irf_file.fits
            │   ├── South_z20_50h
            │   │   └── irf_file.fits
            │   └── South_z40_50h
            │       └── irf_file.fits
            └── caldb.indx

8 directories, 5 files
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Let&#39;s look at the content of one of the IRF FITS files.</span>
<span class="c1"># IRFs are stored in `BinTable` HDUs in a weird format</span>
<span class="c1"># that you don&#39;t need to care about because it&#39;s implemented in Gammapy</span>
<span class="n">irf_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CTADATA&#39;</span><span class="p">],</span> <span class="s1">&#39;caldb/data/cta/1dc/bcf/South_z20_50h/irf_file.fits&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="n">hdu_list</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">irf_filename</span><span class="p">)</span>
<span class="n">hdu_list</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filename: /Users/deil/work/cta-dc/data/1dc/1dc/caldb/data/cta/1dc/bcf/South_z20_50h/irf_file.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU       8   ()
  1  EFFECTIVE AREA    1 BinTableHDU     53   1R x 5C   [42E, 42E, 6E, 6E, 252E]
  2  POINT SPREAD FUNCTION    1 BinTableHDU     70   1R x 10C   [25E, 25E, 6E, 6E, 150E, 150E, 150E, 150E, 150E, 150E]
  3  ENERGY DISPERSION    1 BinTableHDU     56   1R x 7C   [500E, 500E, 300E, 300E, 6E, 6E, 900000E]
  4  BACKGROUND    1 BinTableHDU     59   1R x 7C   [36E, 36E, 36E, 36E, 21E, 21E, 27216E]
</pre></div></div>
</div>
<div class="section" id="Effective-area">
<h3>Effective area<a class="headerlink" href="#Effective-area" title="Permalink to this headline">¶</a></h3>
<p>The effective area is given as a 2-dim array with energy and field of
view offset axes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.irf</span> <span class="kn">import</span> <span class="n">EffectiveAreaTable2D</span>
<span class="n">aeff</span> <span class="o">=</span> <span class="n">EffectiveAreaTable2D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">irf_filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;EFFECTIVE AREA&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">aeff</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">aeff</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;gammapy.irf.effective_area.EffectiveAreaTable2D&#39;&gt;
&lt;class &#39;gammapy.utils.nddata.NDDataArray&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">aeff</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NDDataArray summary info
energy         : size =    42, min =  0.014 TeV, max = 177.828 TeV
offset         : size =     6, min =  0.500 deg, max =  5.500 deg
Data           : size =   252, min =  0.000 m2, max = 5371581.000 m2

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">aeff</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_47_0.png" src="../_images/notebooks_cta_1dc_introduction_47_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># What is the on-axis effective area at 10 TeV?</span>
<span class="n">aeff</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="s1">&#39;10 TeV&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s1">&#39;0 deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math">
$3.7835869 \; \mathrm{km^{2}}$</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># This is how you slice out an `EffectiveAreaTable` object</span>
<span class="c1"># at a given field of view offset for analysis</span>
<span class="n">aeff</span><span class="o">.</span><span class="n">to_effective_area_table</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="s1">&#39;1 deg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[34]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.effective_area.EffectiveAreaTable at 0x11910aba8&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Energy-dispersion">
<h3>Energy dispersion<a class="headerlink" href="#Energy-dispersion" title="Permalink to this headline">¶</a></h3>
<p>Let’s have a look at the CTA energy dispersion with three axes: true
energy, fov offset and migra = e_reco / e_true and has dP / dmigra as
value.</p>
<p>Similar to the event energy distribution above, we can see the
mixed-telescope array reflected in the EDISP. At low energies the events
are only detected and reconstructed by the LSTs. At ~100 GeV, the MSTs
take over and EDISP is chaotic in the ~ 50 GeV to 100 GeV energy range.
So it can be useful to have quick access to IRFs like with Gammapy (e.g.
for spectral line searches in this case), even if for 95% of science
analyses users later won’t have to look at the IRFs and just trust that
everything is working.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.irf</span> <span class="kn">import</span> <span class="n">EnergyDispersion2D</span>
<span class="n">edisp</span> <span class="o">=</span> <span class="n">EnergyDispersion2D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">irf_filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;ENERGY DISPERSION&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">edisp</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">edisp</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;gammapy.irf.energy_dispersion.EnergyDispersion2D&#39;&gt;
&lt;class &#39;gammapy.utils.nddata.NDDataArray&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">edisp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NDDataArray summary info
e_true         : size =   500, min =  0.005 TeV, max = 495.450 TeV
migra          : size =   300, min =  0.005, max =  2.995
offset         : size =     6, min =  0.500 deg, max =  5.500 deg
Data           : size = 900000, min =  0.000, max = 10595.855

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">edisp</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/deil/Library/Python/3.6/lib/python/site-packages/astropy/units/quantity.py:635: RuntimeWarning: invalid value encountered in true_divide
  result = super().__array_ufunc__(function, method, *arrays, **kwargs)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_53_1.png" src="../_images/notebooks_cta_1dc_introduction_53_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># This is how for analysis you could slice out an `EnergyDispersion`</span>
<span class="c1"># object at a given offset:</span>
<span class="n">edisp</span><span class="o">.</span><span class="n">to_energy_dispersion</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="s1">&#39;0 deg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/deil/Library/Python/3.6/lib/python/site-packages/astropy/units/quantity.py:635: RuntimeWarning: invalid value encountered in true_divide
  result = super().__array_ufunc__(function, method, *arrays, **kwargs)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[38]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.energy_dispersion.EnergyDispersion at 0x119581dd8&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Point-spread-function">
<h3>Point spread function<a class="headerlink" href="#Point-spread-function" title="Permalink to this headline">¶</a></h3>
<p>The point spread function (PSF) in this case is given as an analytical
Gaussian model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.irf</span> <span class="kn">import</span> <span class="n">EnergyDependentMultiGaussPSF</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">EnergyDependentMultiGaussPSF</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">irf_filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;POINT SPREAD FUNCTION&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Summary PSF info
----------------
Theta          : size =     6, min =  0.000 deg, max =  5.000 deg
Energy hi      : size =    25, min =  0.020 TeV, max = 1258.925 TeV
Energy lo      : size =    25, min =  0.013 TeV, max = 794.328 TeV
Safe energy threshold lo:  0.100 TeV
Safe energy threshold hi: 100.000 TeV
68% containment radius at theta = 0.0 deg and E =  1.0 TeV: 0.05099999 deg
68% containment radius at theta = 0.0 deg and E = 10.0 TeV: 0.03700000 deg
95% containment radius at theta = 0.0 deg and E =  1.0 TeV: 0.08269457 deg
95% containment radius at theta = 0.0 deg and E = 10.0 TeV: 0.05999410 deg

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">psf</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_57_0.png" src="../_images/notebooks_cta_1dc_introduction_57_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># This is how for analysis you could slice out the PSF</span>
<span class="c1"># at a given field of view offset</span>
<span class="n">psf</span><span class="o">.</span><span class="n">to_energy_dependent_table_psf</span><span class="p">(</span><span class="s1">&#39;1 deg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[41]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.psf_table.EnergyDependentTablePSF at 0x11a7aa908&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Background">
<h3>Background<a class="headerlink" href="#Background" title="Permalink to this headline">¶</a></h3>
<p>The hadronic background for CTA DC-1 is given as a template model with
an absolute rate that depends on <code class="docutils literal"><span class="pre">energy</span></code>, <code class="docutils literal"><span class="pre">detx</span></code> and <code class="docutils literal"><span class="pre">dety</span></code>. The
coordinates <code class="docutils literal"><span class="pre">detx</span></code> and <code class="docutils literal"><span class="pre">dety</span></code> are angles in the “field of view”
coordinate frame.</p>
<p>Note that really the background model for DC-1 and most CTA IRFs
produced so far are radially symmetric, i.e. only depend on the FOV
offset. The background model here was rotated to fill the FOV in a
rotationally symmetric way, for no good reason.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.irf</span> <span class="kn">import</span> <span class="n">Background3D</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">Background3D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">irf_filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">bkg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Background3D
NDDataArray summary info
energy         : size =    21, min =  0.016 TeV, max = 158.489 TeV
detx           : size =    36, min = -5.833 deg, max =  5.833 deg
dety           : size =    36, min = -5.833 deg, max =  5.833 deg
Data           : size = 27216, min =  0.000 1 / (MeV s sr), max =  0.421 1 / (MeV s sr)

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># TODO: implement a peek method for Background3D</span>
<span class="c1"># bkg.peek()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">bkg</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="s1">&#39;3 TeV&#39;</span><span class="p">,</span> <span class="n">detx</span><span class="o">=</span><span class="s1">&#39;1 deg&#39;</span><span class="p">,</span> <span class="n">dety</span><span class="o">=</span><span class="s1">&#39;0 deg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math">
$1.3316669 \times 10^{-5} \; \mathrm{\frac{1}{MeV\,s\,sr}}$</div></div>
</div>
</div>
</div>
<div class="section" id="Index-files-and-DataStore">
<h2>Index files and DataStore<a class="headerlink" href="#Index-files-and-DataStore" title="Permalink to this headline">¶</a></h2>
<p>As we saw, you can access all of the CTA data using Astropy and Gammapy.</p>
<p>But wouldn’t it be nice if there were a better, simpler way?</p>
<p>Imagine what life could be like if you had a butler that knows where all
the files and HDUs are, and hands you the 1DC data on a silver platter,
you just have to ask for it.</p>
<div class="figure" id="id2">
<img alt="gammapy.data.DataStore - your butler for CTA data" src="../_images/gammapy_datastore_butler.png" />
<p class="caption"><span class="caption-text">gammapy.data.DataStore - your butler for CTA data</span></p>
</div>
<p>Well, the butler exists. He’s called <code class="docutils literal"><span class="pre">gammapy.data.DataStore</span></code> and he
keeps track of the data using index files.</p>
<div class="section" id="Index-files">
<h3>Index files<a class="headerlink" href="#Index-files" title="Permalink to this headline">¶</a></h3>
<p>The files with in the <code class="docutils literal"><span class="pre">index</span></code> folder with names <code class="docutils literal"><span class="pre">obs-index.fits.gz</span></code>
and <code class="docutils literal"><span class="pre">hdu-index.fits.gz</span></code> are so called “observation index files” and
“HDU index files”.</p>
<ul class="simple">
<li>The purpose of observation index files is to get a table of available
observations, with the most relevant parameters commonly used for
observation selection (e.g. pointing position or observation time).
Their format is described in detail
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/en/latest/data_storage/obs_index/index.html">here</a>.</li>
<li>The purpose of HDU index files is to locate all FITS header data
units (HDUs) for a given observation. At the moment, for each
observation, there are six relevant HDUs: EVENTS, GTI, AEFF, EDISP,
PSF and BKG. The format is described in detail
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/en/latest/data_storage/hdu_index/index.html">here</a>.</li>
</ul>
<p>For 1DC there is one set of index files per simulated dataset, as well
as a set of index files listing all available data in the all directory.</p>
<p>Side comment: if you have data, but no index files, you should write a
Python script to make the index files. As an example, the one I used to
make the index files for 1DC is
<a class="reference external" href="https://github.com/gammasky/cta-dc/blob/master/data/cta_1dc_make_data_index_files.py">here</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!(</span><span class="nb">cd</span> <span class="nv">$CTADATA</span> <span class="o">&amp;&amp;</span> tree index<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
index
├── README.md
├── agn
│   ├── hdu-index.fits.gz
│   └── obs-index.fits.gz
├── all
│   ├── hdu-index.fits.gz
│   └── obs-index.fits.gz
├── egal
│   ├── hdu-index.fits.gz
│   └── obs-index.fits.gz
├── gc
│   ├── hdu-index.fits.gz
│   └── obs-index.fits.gz
└── gps
    ├── hdu-index.fits.gz
    └── obs-index.fits.gz

5 directories, 11 files
</pre></div></div>
</div>
</div>
<div class="section" id="Gammapy-DataStore">
<h3>Gammapy DataStore<a class="headerlink" href="#Gammapy-DataStore" title="Permalink to this headline">¶</a></h3>
<p>If you want to access data and IRFs from the CTA 1DC GPS dataset, just
create a <code class="docutils literal"><span class="pre">DataStore</span></code> by pointing at a folder where the index files are
located.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">DataStore</span>
<span class="n">data_store</span> <span class="o">=</span> <span class="n">DataStore</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="s1">&#39;$CTADATA/index/gps&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Print out some basic information about the available data:</span>
<span class="n">data_store</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Data store summary info:
name: noname

HDU index table:
BASE_DIR: /Users/deil/work/cta-dc/data/1dc/1dc/index/gps
Rows: 19620
OBS_ID: 110000 -- 113269
HDU_TYPE: [&#39;aeff&#39;, &#39;bkg&#39;, &#39;edisp&#39;, &#39;events&#39;, &#39;gti&#39;, &#39;psf&#39;]
HDU_CLASS: [&#39;aeff_2d&#39;, &#39;bkg_3d&#39;, &#39;edisp_2d&#39;, &#39;events&#39;, &#39;gti&#39;, &#39;psf_3gauss&#39;]

Observation table:
Number of observations: 3270
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># The observation index is loaded as a table</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of observations: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total observation time (hours): &#39;</span><span class="p">,</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;ONTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of observations:  3270
[&#39;OBS_ID&#39;, &#39;RA_PNT&#39;, &#39;DEC_PNT&#39;, &#39;GLON_PNT&#39;, &#39;GLAT_PNT&#39;, &#39;ZEN_PNT&#39;, &#39;ALT_PNT&#39;, &#39;AZ_PNT&#39;, &#39;ONTIME&#39;, &#39;LIVETIME&#39;, &#39;DEADC&#39;, &#39;TSTART&#39;, &#39;TSTOP&#39;, &#39;DATE_OBS&#39;, &#39;TIME_OBS&#39;, &#39;DATE_END&#39;, &#39;TIME_END&#39;, &#39;N_TELS&#39;, &#39;OBJECT&#39;, &#39;CALDB&#39;, &#39;IRF&#39;, &#39;EVENTS_FILENAME&#39;, &#39;EVENT_COUNT&#39;]
Total observation time (hours):  1635.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># The HDU index is loaded as a table</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
19620
[&#39;OBS_ID&#39;, &#39;HDU_TYPE&#39;, &#39;HDU_CLASS&#39;, &#39;FILE_DIR&#39;, &#39;FILE_NAME&#39;, &#39;HDU_NAME&#39;]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Of course, you can look at the tables if you like</span>
<span class="c1"># data_store.obs_table[:10].show_in_browser(jsviewer=True)</span>
<span class="c1"># data_store.hdu_table[:10].show_in_browser(jsviewer=True)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Select-observations">
<h2>Select observations<a class="headerlink" href="#Select-observations" title="Permalink to this headline">¶</a></h2>
<p>With <code class="docutils literal"><span class="pre">data_store.obs_table</span></code> you have a table with the most common
per-observation parameters that are used for observation selection.
Using Python / Table methods it’s easy to apply any selection you like,
always with the goal of making a list or array of <code class="docutils literal"><span class="pre">OBS_ID</span></code>, which is
then the input to analysis.</p>
<p>For the current 1DC dataset it’s pretty simple, because the only
quantities useful for selection are: * pointing position * which irf
(i.e. array / zenith angle)</p>
<p>With real data, there will be more parameters of interest, such as data
quality, observation duration, zenith angle, time of observation, …</p>
<p>Let’s look at one example: select observations that are at offset 1 to 2
deg from the Galactic center.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span>
<span class="n">pos_obs</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLON_PNT&#39;</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;galactic&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">pos_target</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;galactic&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">pos_target</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos_obs</span><span class="p">)</span><span class="o">.</span><span class="n">deg</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Number of selected observations: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of selected observations:  57
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Look at the first few</span>
<span class="n">table</span><span class="p">[[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;GLON_PNT&#39;</span><span class="p">,</span> <span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">,</span> <span class="s1">&#39;IRF&#39;</span><span class="p">]][:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>ObservationTable length=5</i>
<table id="table4717155608" class="table-striped table-bordered table-condensed">
<thead><tr><th>OBS_ID</th><th>GLON_PNT</th><th>GLAT_PNT</th><th>IRF</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>bytes13</th></tr></thead>
<tr><td>110380</td><td>359.999991204</td><td>-1.29999593791</td><td>South_z20_50h</td></tr>
<tr><td>110381</td><td>359.999991204</td><td>-1.29999593791</td><td>South_z20_50h</td></tr>
<tr><td>110382</td><td>359.999991204</td><td>-1.29999593791</td><td>South_z20_50h</td></tr>
<tr><td>110383</td><td>359.999991204</td><td>-1.29999593791</td><td>South_z20_50h</td></tr>
<tr><td>110384</td><td>359.999991204</td><td>-1.29999593791</td><td>South_z20_50h</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Check which IRFs were used ... it&#39;s all south and 20 deg zenith angle</span>
<span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;IRF&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[53]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{&#39;South_z20_50h&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Check the pointing positions</span>
<span class="c1"># The grid pointing positions at GLAT = +- 1.2 deg are visible</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Angle</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLON_PNT&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180 deg&#39;</span><span class="p">),</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Galactic longitude (deg)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Galactic latitude (deg)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[54]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Text(0,0.5,&#39;Galactic latitude (deg)&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_cta_1dc_introduction_75_1.png" src="../_images/notebooks_cta_1dc_introduction_75_1.png" />
</div>
</div>
</div>
<div class="section" id="Load-data">
<h2>Load data<a class="headerlink" href="#Load-data" title="Permalink to this headline">¶</a></h2>
<p>Once you have selected the observations of interest, use the
<code class="docutils literal"><span class="pre">DataStore</span></code> to load the data and IRF for those observations. Let’s say
we’re interested in <code class="docutils literal"><span class="pre">OBS_ID=110000</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="mi">110000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Info for OBS_ID = 110000
- Start time: 59215.50
- Pointing pos: RA 186.16 deg / Dec -64.02 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 2.000 %

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span><span class="o">.</span><span class="n">events</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[57]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.data.event_list.EventList at 0x119182b00&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>Table length=5</i>
<table id="table4701071288" class="table-striped table-bordered table-condensed">
<thead><tr><th>EVENT_ID</th><th>TIME</th><th>RA</th><th>DEC</th><th>ENERGY</th><th>DETX</th><th>DETY</th><th>MC_ID</th></tr></thead>
<thead><tr><th></th><th>s</th><th>deg</th><th>deg</th><th>TeV</th><th>deg</th><th>deg</th><th></th></tr></thead>
<thead><tr><th>uint32</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>int32</th></tr></thead>
<tr><td>1</td><td>662774403.255</td><td>-173.287</td><td>-62.4099</td><td>0.0486149</td><td>1.60795</td><td>0.258016</td><td>2</td></tr>
<tr><td>2</td><td>662774459.184</td><td>-172.62</td><td>-63.0346</td><td>0.0611035</td><td>0.979058</td><td>0.555166</td><td>2</td></tr>
<tr><td>3</td><td>662774479.309</td><td>-170.593</td><td>-63.4715</td><td>0.046142</td><td>0.510549</td><td>1.45144</td><td>2</td></tr>
<tr><td>4</td><td>662774490.724</td><td>-175.637</td><td>-63.6409</td><td>0.0493567</td><td>0.36688</td><td>-0.795908</td><td>2</td></tr>
<tr><td>5</td><td>662774506.865</td><td>-172.124</td><td>-63.4013</td><td>0.0505401</td><td>0.607364</td><td>0.7702</td><td>2</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span><span class="o">.</span><span class="n">aeff</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[59]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.effective_area.EffectiveAreaTable2D at 0x1190c6a58&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span><span class="o">.</span><span class="n">edisp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[60]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.energy_dispersion.EnergyDispersion2D at 0x119225898&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">obs</span><span class="o">.</span><span class="n">psf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[61]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;gammapy.irf.psf_analytical.EnergyDependentMultiGaussPSF at 0x1190cae10&gt;
</pre></div>
</div>
</div>
<p>Here’s an example how to loop over many observations and analyse them:
<a class="reference external" href="https://github.com/gammasky/cta-dc/blob/master/data/cta_1dc_make_allsky_images.py">cta_1dc_make_allsky_images.py</a></p>
</div>
<div class="section" id="Model-XML-files">
<h2>Model XML files<a class="headerlink" href="#Model-XML-files" title="Permalink to this headline">¶</a></h2>
<p>The 1DC sky model is distributed as a set of XML files, which in turn
link to a ton of other FITS and text files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls <span class="nv">$CTADATA</span>/models/*.xml <span class="p">|</span> xargs -n <span class="m">1</span> basename
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
model_Arp220.xml
model_agn.xml
model_bkg.xml
model_dm_dSphs.xml
model_dm_gc.xml
model_fermi_bubbles.xml
model_galactic_binaries.xml
model_galactic_bright.xml
model_galactic_composite.xml
model_galactic_extended.xml
model_galactic_pulsars.xml
model_galactic_pwn.xml
model_galactic_snr.xml
model_iem.xml
models_agn.xml
models_egal.xml
models_gc.xml
models_gps.xml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># This is what the XML file looks like</span>
<span class="o">!</span>tail -n <span class="m">20</span> <span class="nv">$CTADATA</span>/models/models_gps.xml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
      &lt;parameter name=&#34;Index&#34; value=&#34;4.58&#34; error=&#34;0&#34; scale=&#34;-1&#34; min=&#34;0&#34; max=&#34;10&#34; free=&#34;1&#34; /&gt;
      &lt;parameter name=&#34;Scale&#34; value=&#34;500000&#34; scale=&#34;1&#34; min=&#34;0&#34; max=&#34;10000000&#34; free=&#34;0&#34; /&gt;
    &lt;/spectrum&gt;
    &lt;spatialModel type=&#34;SkyDirFunction&#34;&gt;
      &lt;parameter name=&#34;RA&#34; value=&#34;350.69792&#34; scale=&#34;1&#34; min=&#34;-360&#34; max=&#34;360&#34; free=&#34;0&#34; /&gt;
      &lt;parameter name=&#34;DEC&#34; value=&#34;-49.27058&#34; scale=&#34;1&#34; min=&#34;-90&#34; max=&#34;90&#34; free=&#34;0&#34; /&gt;
    &lt;/spatialModel&gt;
  &lt;/source&gt;
  &lt;source name=&#34;Arp220&#34; type=&#34;PointSource&#34; tscalc=&#34;1&#34;&gt;
    &lt;spectrum type=&#34;PowerLaw&#34;&gt;
      &lt;parameter name=&#34;Prefactor&#34; value=&#34;6&#34; error=&#34;0&#34; scale=&#34;1e-20&#34; min=&#34;0&#34; free=&#34;1&#34; /&gt;
      &lt;parameter name=&#34;Index&#34; value=&#34;2.2&#34; error=&#34;-0&#34; scale=&#34;-1&#34; min=&#34;-4.54545&#34; max=&#34;4.54545&#34; free=&#34;1&#34; /&gt;
      &lt;parameter name=&#34;Scale&#34; value=&#34;1&#34; scale=&#34;1000000&#34; free=&#34;0&#34; /&gt;
    &lt;/spectrum&gt;
    &lt;spatialModel type=&#34;SkyDirFunction&#34;&gt;
      &lt;parameter name=&#34;RA&#34; value=&#34;233.738&#34; scale=&#34;1&#34; free=&#34;0&#34; /&gt;
      &lt;parameter name=&#34;DEC&#34; value=&#34;23.503&#34; scale=&#34;1&#34; free=&#34;0&#34; /&gt;
    &lt;/spatialModel&gt;
  &lt;/source&gt;
&lt;/source_library&gt;
</pre></div></div>
</div>
<p>At the moment, you cannot read and write these sky model XML files with
Gammapy.</p>
<p>There are multiple reasons why this XML serialisation format isn’t
implemented in Gammapy yet (all variants of “it sucks”):</p>
<ul class="simple">
<li>XML is tedious to read and write for humans.</li>
<li>The format is too strict in places: there are many use cases where
“min”, “max”, “free” and “error” aren’t needed, so it should be
possible to omit them (see e.g. dummy values above)</li>
<li>The parameter “scale” is an implementation detail that very few
optimisers need. There’s no reason to bother all gamma-ray
astronomers with separating value and scale in model input and result
files.</li>
<li>The “unit” is missing. Pretty important piece of information, no? All
people working on IACTs use “TeV”, why should CTA be forced to use
“MeV”?</li>
<li>Ad-hoc extensions that keep being added and many models can’t be put
in one file (see extra ASCII and FITS files with tables or other
info, e.g. pulsar models added for CTA 1DC). Admittedly complex model
serialisation is an intrinsically hard problem, there is not simple
and flexible solution.</li>
</ul>
<p>Also, to be honest, I also want to say / admit:</p>
<ul class="simple">
<li>A model serialisation format is useful, even if it will never cover
all use cases (e.g. energy-dependent morphology or an AGN with a
variable spectrum, or complex FOV background models).</li>
<li>The Gammapy model package isn’t well-implemented or well-developed
yet.</li>
<li>So far users were happy to write a few lines of Python to define a
model instead of XML.</li>
<li>Clearly with CTA 1DC now using the XML format there’s an important
reason to support it, there is the legacy of Fermi-LAT using it and
ctools using / extending it for CTA.</li>
</ul>
<p>So what now?</p>
<ul class="simple">
<li>In Gammapy, we have started to implement a modeling package in
<code class="docutils literal"><span class="pre">gammapy.utils.modeling</span></code>, with the goal of supporting this XML
format as one of the serialisation formats. It’s not very far along,
will be a main focus for us, help is welcome.</li>
<li>In addition we would like to support a second more human-friendly
model format that looks something like
<a class="reference external" href="https://github.com/gammapy/gamma-cat/blob/b651de8d1d793e924764ffb13c8ec189bce9ea7d/input/data/2006/2006A%2526A...457..899A/tev-000025.yaml#L11">this</a></li>
<li>For now, you could use Gammalib to read the XML files, or you could
read them directly with Python. The Python standard library contains
<a class="reference external" href="https://docs.python.org/3/library/xml.etree.elementtree.html">ElementTree</a>
and there’s <a class="reference external" href="https://github.com/martinblech/xmltodict">xmltodict</a>
which simply hands you back the XML file contents as a Python
dictionary (containing a very nested hierarchical structure of Python
dict and list objects and strings and numbers.</li>
</ul>
<p>As an example, here’s how you can read an XML sky model and access the
spectral parameters of one source (the last, “Arp200” visible above in
the XML printout) and create a
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.spectrum.models.PowerLaw.html">gammapy.spectrum.models.PowerLaw</a>
object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Read XML file and access spectrum parameters</span>
<span class="kn">from</span> <span class="nn">gammapy.extern</span> <span class="kn">import</span> <span class="n">xmltodict</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CTADATA&#39;</span><span class="p">],</span> <span class="s1">&#39;models/models_gps.xml&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;source_library&#39;</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">][</span><span class="s1">&#39;parameter&#39;</span><span class="p">]</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[64]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[OrderedDict([(&#39;@name&#39;, &#39;Prefactor&#39;),
              (&#39;@value&#39;, &#39;6&#39;),
              (&#39;@error&#39;, &#39;0&#39;),
              (&#39;@scale&#39;, &#39;1e-20&#39;),
              (&#39;@min&#39;, &#39;0&#39;),
              (&#39;@free&#39;, &#39;1&#39;)]),
 OrderedDict([(&#39;@name&#39;, &#39;Index&#39;),
              (&#39;@value&#39;, &#39;2.2&#39;),
              (&#39;@error&#39;, &#39;-0&#39;),
              (&#39;@scale&#39;, &#39;-1&#39;),
              (&#39;@min&#39;, &#39;-4.54545&#39;),
              (&#39;@max&#39;, &#39;4.54545&#39;),
              (&#39;@free&#39;, &#39;1&#39;)]),
 OrderedDict([(&#39;@name&#39;, &#39;Scale&#39;),
              (&#39;@value&#39;, &#39;1&#39;),
              (&#39;@scale&#39;, &#39;1000000&#39;),
              (&#39;@free&#39;, &#39;0&#39;)])]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Create a spectral model the the right units</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">gammapy.spectrum.models</span> <span class="kn">import</span> <span class="n">PowerLaw</span>
<span class="n">par_to_val</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">par</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;@value&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;@scale&#39;</span><span class="p">])</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">PowerLaw</span><span class="p">(</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="n">par_to_val</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 MeV-1&#39;</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">par_to_val</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">reference</span><span class="o">=</span><span class="n">par_to_val</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;MeV&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PowerLaw

Parameters:

           name     value    error       unit      min max frozen
        --------- ---------- ----- --------------- --- --- ------
            index -2.200e+00   nan                 nan nan  False
        amplitude  6.000e-20   nan 1 / (cm2 MeV s) nan nan  False
        reference  1.000e+06   nan             MeV nan nan   True
</pre></div></div>
</div>
</div>
<div class="section" id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Easy: Go over this notebook again, and change the data / code a
little bit:<ul>
<li>Pick another run (any run you like)</li>
<li>Plot the energy-offset histogram of the events separately for
gammas and background</li>
</ul>
</li>
<li>Medium difficulty: Find all runs within 1 deg of the Crab nebula.<ul>
<li>Load the “all” index file via the <code class="docutils literal"><span class="pre">DataStore</span></code>, then access the
<code class="docutils literal"><span class="pre">.obs_table</span></code>, then get an array-valued <code class="docutils literal"><span class="pre">SkyCoord</span></code> with all the
observation pointing positions.</li>
<li>You can get the Crab nebula position with
<code class="docutils literal"><span class="pre">astropy.coordinates.SkyCoord</span></code> via
<code class="docutils literal"><span class="pre">SkyCoord.from_name('crab')</span></code></li>
<li>Note that to compute the angular separation between two
<code class="docutils literal"><span class="pre">SkyCoord</span></code> objects can be computed via
<code class="docutils literal"><span class="pre">separation</span> <span class="pre">=</span> <span class="pre">coord1.separation(coord2)</span></code>.</li>
</ul>
</li>
<li>Hard: Find the PeVatrons in the 1DC data, i.e. the ~ 10 sources that
are brightest at high energies (e.g. above 10 TeV).<ul>
<li>This is difficult, because it’s note clear how to best do this,
and also because it’s time-consuming to crunch through all
relevant data for any given method.</li>
<li>One idea could be to go brute-force through <strong>all</strong> events, select
the ones above 10 TeV and stack them all into one table. Then make
an all-sky image and run a peak finder, or use an event
cluster-finding method e.g. from scikit-learn.</li>
<li>Another idea could be to first make a list of targets of interest,
either from the CTA 1DC sky model or from gamma-cat, compute the
model integral flux above 10 TeV and pick candidates that way,
then run analyses.</li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># start typing here ...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="What-next?">
<h2>What next?<a class="headerlink" href="#What-next?" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>This notebook gave you an overview of the 1DC files and showed you
have to access and work with them using Gammapy.</li>
<li>To see how to do analysis, i.e. make a sky image and spectrum, see
<a class="reference internal" href="cta_data_analysis.html"><span class="doc">cta_data_analysis.ipynb</span></a> next.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">CTA first data challenge (1DC) with Gammapy</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a><ul>
<li><a class="reference internal" href="#This-tutorial-notebook">This tutorial notebook</a></li>
<li><a class="reference internal" href="#Further-information">Further information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Notebook-and-Gammapy-Setup">Notebook and Gammapy Setup</a></li>
<li><a class="reference internal" href="#Getting-the-1DC-data">Getting the 1DC data</a></li>
<li><a class="reference internal" href="#EVENT-data">EVENT data</a></li>
<li><a class="reference internal" href="#EVENT-analysis-example">EVENT analysis example</a><ul>
<li><a class="reference internal" href="#EVENT-spatial-distribution">EVENT spatial distribution</a></li>
<li><a class="reference internal" href="#EVENT-energy-distribution">EVENT energy distribution</a></li>
<li><a class="reference internal" href="#EVENT-MC_ID">EVENT MC_ID</a></li>
<li><a class="reference internal" href="#EVENT-FOV-offset">EVENT FOV offset</a></li>
<li><a class="reference internal" href="#Stacking-EVENTS-tables">Stacking EVENTS tables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#IRFs">IRFs</a><ul>
<li><a class="reference internal" href="#Effective-area">Effective area</a></li>
<li><a class="reference internal" href="#Energy-dispersion">Energy dispersion</a></li>
<li><a class="reference internal" href="#Point-spread-function">Point spread function</a></li>
<li><a class="reference internal" href="#Background">Background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Index-files-and-DataStore">Index files and DataStore</a><ul>
<li><a class="reference internal" href="#Index-files">Index files</a></li>
<li><a class="reference internal" href="#Gammapy-DataStore">Gammapy DataStore</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Select-observations">Select observations</a></li>
<li><a class="reference internal" href="#Load-data">Load data</a></li>
<li><a class="reference internal" href="#Model-XML-files">Model XML files</a></li>
<li><a class="reference internal" href="#Exercises">Exercises</a></li>
<li><a class="reference internal" href="#What-next?">What next?</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/cta_1dc_introduction.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>