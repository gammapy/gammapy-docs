
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Fermi-LAT data with Gammapy &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/data_fermi_lat.ipynb">data_fermi_lat.ipynb</a>
| <a class="reference external" href="../_static/notebooks/data_fermi_lat.py">data_fermi_lat.py</a></p>
</div>
<div class="section" id="Fermi-LAT-data-with-Gammapy">
<h1>Fermi-LAT data with Gammapy<a class="headerlink" href="#Fermi-LAT-data-with-Gammapy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will show you how to work with pepared Fermi-LAT datasets.</p>
<p>The main class to load and handle the data is:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.datasets.FermiLATDataset.html">gammapy.dataset.FermiLATDataset</a></li>
</ul>
<p>Additionally we will use objects of these types:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.EventList.html">gammapy.data.EventList</a>
for event lists.</li>
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDependentTablePSF.html">gammapy.irf.EnergyDependentTablePSF</a>
for the point spread function.</li>
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.cube.SkyCube.html">gammapy.cube.SkyCube</a>
for the galactic diffuse background model.</li>
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.cube.SkyCubeHPX.html">gammapy.cube.SkyCubeHPX</a>
for the exposure.</li>
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.spectrum.models.TableModel.html#gammapy.spectrum.models.TableModel">gammapy.spectrum.models.TableModel</a>
for the isotropic diffuse model.</li>
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.image.FermiLATBasicImageEstimator.html">gammapy.image.FermiLATBasicImageEstimator</a>
for generating a full WCS dataset, that can be used as an input for
image based analyses.</li>
</ul>
</div>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<p><strong>IMPORTANT</strong>: For this notebook you have to get the prepared datasets
provided in the
<a class="reference external" href="https://github.com/gammapy/gammapy-fermi-lat-data">gammapy-fermi-lat-data</a>
repository. Please follow the instructions
<a class="reference external" href="https://github.com/gammapy/gammapy-fermi-lat-data#get-the-data">here</a>
to download the data and setup your environment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">from</span> <span class="nn">gammapy.datasets</span> <span class="kn">import</span> <span class="n">FermiLATDataset</span>
<span class="kn">from</span> <span class="nn">gammapy.image</span> <span class="kn">import</span> <span class="n">SkyImage</span><span class="p">,</span> <span class="n">FermiLATBasicImageEstimator</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="FermiLATDataset-class">
<h2>FermiLATDataset class<a class="headerlink" href="#FermiLATDataset-class" title="Permalink to this headline">¶</a></h2>
<p>To access the prepared Fermi-LAT datasets Gammapy provides a convenience
class called
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.datasets.FermiLATDataset.html#gammapy.datasets.FermiLATDataset">FermiLATDataset</a>.
It is initialized with a path to an index configuration file, which
tells the dataset class where to find the data. Once the object is
initialized the data can be accessed as properties of this object, which
return the corresponding Gammapy data objects for event lists, sky
images and point spread functions (PSF).</p>
<p>So let’s start with exploring the Fermi-LAT 2FHL dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># initialize dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">FermiLATDataset</span><span class="p">(</span><span class="s1">&#39;$GAMMAPY_FERMI_LAT_DATA/2fhl/fermi_2fhl_data_config.yaml&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fermi-LAT 2FHL dataset
======================
Filenames:
  counts  : fermi_2fhl_counts_cube_hpx.fits.gz
  events  : fermi_2fhl_events.fits.gz
  exposure: fermi_2fhl_exposure_cube_hpx.fits.gz
  isodiff : ../isodiff/iso_P8R2_SOURCE_V6_v06.txt
  livetime: fermi_2fhl_livetime_cube.fits.gz
  psf     : fermi_2fhl_psf_gc.fits.gz

</pre></div></div>
</div>
</div>
<div class="section" id="Events">
<h2>Events<a class="headerlink" href="#Events" title="Permalink to this headline">¶</a></h2>
<p>The first data member we will inspect in more detail is the event list.
It can be accessed by the <code class="docutils literal"><span class="pre">dataset.events</span></code> property and returns an
instance of the Gammapy
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.EventList.html">gammapy.data.EventList</a>
class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># access events data member</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">events</span>
<span class="k">print</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EventList info:
- Number of events: 60275
- Median energy: 80340.5078125 MeV

</pre></div></div>
</div>
<p>The full event data is available via the <code class="docutils literal"><span class="pre">EventList.table</span></code> property,
which returns an
<a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table">astropy.table.Table</a>
instance. In case of the Fermi-LAT event list this contains all the
additional information on positon, zenith angle, earth azimuth angle,
event class, event type etc. Execute the following cell to take a look
at the event list table:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">events</span><span class="o">.</span><span class="n">table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area docutils container">
&lt;Table length=60275&gt;
<table id="table4628651928" class="table-striped table-bordered table-condensed">
<thead><tr><th>ENERGY</th><th>RA</th><th>DEC</th><th>L</th><th>B</th><th>THETA</th><th>PHI</th><th>ZENITH_ANGLE</th><th>EARTH_AZIMUTH_ANGLE</th><th>TIME</th><th>EVENT_ID</th><th>RUN_ID</th><th>RECON_VERSION</th><th>CALIB_VERSION [3]</th><th>EVENT_CLASS [32]</th><th>EVENT_TYPE [32]</th><th>CONVERSION_TYPE</th><th>LIVETIME</th><th>DIFRSP0</th><th>DIFRSP1</th><th>DIFRSP2</th><th>DIFRSP3</th><th>DIFRSP4</th></tr></thead>
<thead><tr><th>MeV</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>s</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>s</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float64</th><th>int32</th><th>int32</th><th>int16</th><th>int16</th><th>bool</th><th>bool</th><th>int16</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>145927.0</td><td>291.662</td><td>42.2341</td><td>74.5437</td><td>11.8678</td><td>38.0455</td><td>83.5358</td><td>55.6387</td><td>314.034</td><td>239561457.866</td><td>4851437</td><td>239559565</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>275.698088974</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>221273.0</td><td>46.9858</td><td>-40.6389</td><td>247.489</td><td>-58.8739</td><td>34.1051</td><td>224.209</td><td>68.2524</td><td>198.319</td><td>239562739.085</td><td>7521432</td><td>239559565</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>64.7974931598</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>57709.2</td><td>121.841</td><td>49.2288</td><td>169.868</td><td>32.3017</td><td>71.5636</td><td>34.2925</td><td>36.7173</td><td>25.5439</td><td>239563180.302</td><td>8690693</td><td>239559565</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>30.57218647</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>221224.0</td><td>83.5626</td><td>-4.21744</td><td>207.783</td><td>-19.0771</td><td>20.5089</td><td>92.1605</td><td>32.3033</td><td>239.141</td><td>239563382.213</td><td>9208424</td><td>239559565</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>27.4125095904</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>698997.0</td><td>320.895</td><td>-1.32789</td><td>51.2218</td><td>-33.9718</td><td>35.3621</td><td>158.741</td><td>12.0867</td><td>72.2029</td><td>239566572.951</td><td>2480483</td><td>239565645</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>106.475481123</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>119159.0</td><td>318.811</td><td>12.3028</td><td>62.6361</td><td>-24.416</td><td>26.5896</td><td>213.894</td><td>17.7156</td><td>23.9409</td><td>239572348.06</td><td>1725276</td><td>239571670</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>185.346427292</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>56175.6</td><td>279.251</td><td>47.8835</td><td>76.6915</td><td>22.0739</td><td>29.1034</td><td>61.0048</td><td>62.1731</td><td>321.104</td><td>239572763.431</td><td>76017</td><td>239572736</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>24.4507339597</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>1.41812e+06</td><td>100.311</td><td>-47.4481</td><td>256.468</td><td>-21.2641</td><td>61.2256</td><td>294.18</td><td>90.4753</td><td>144.149</td><td>239573788.813</td><td>1781569</td><td>239572736</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>68.271614641</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>62164.9</td><td>331.492</td><td>-41.2264</td><td>359.42</td><td>-53.4049</td><td>28.1408</td><td>229.927</td><td>52.0142</td><td>189.054</td><td>239578601.168</td><td>2000700</td><td>239577663</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>90.332262665</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>51296.8</td><td>79.0311</td><td>78.9327</td><td>133.868</td><td>22.2399</td><td>51.1726</td><td>267.814</td><td>99.7602</td><td>357.79</td><td>444418973.822</td><td>1284853</td><td>444418590</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>181.6889835</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>60315.7</td><td>243.681</td><td>-50.5669</td><td>332.43</td><td>0.28268</td><td>24.8501</td><td>255.683</td><td>74.8804</td><td>195.14</td><td>444421777.761</td><td>6582949</td><td>444418590</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. False</td><td>1</td><td>57.3358902931</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>90000.1</td><td>282.698</td><td>-33.1987</td><td>2.66219</td><td>-14.3339</td><td>8.49144</td><td>343.559</td><td>47.3965</td><td>191.033</td><td>444422182.738</td><td>7507466</td><td>444418590</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>187.602469146</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>61988.7</td><td>247.98</td><td>-48.1091</td><td>336.146</td><td>0.0220339</td><td>33.6499</td><td>144.271</td><td>80.3966</td><td>221.396</td><td>444422758.145</td><td>8699147</td><td>444418590</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>39.2098327279</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>54282.9</td><td>159.924</td><td>-58.3628</td><td>286.362</td><td>0.205554</td><td>24.1196</td><td>287.138</td><td>65.0847</td><td>177.524</td><td>444425794.794</td><td>2522237</td><td>444424619</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>196.209668875</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>146728.0</td><td>244.848</td><td>-46.5876</td><td>335.754</td><td>2.60326</td><td>45.2539</td><td>5.33644</td><td>91.871</td><td>137.032</td><td>444425911.819</td><td>2705210</td><td>444424619</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. False</td><td>1</td><td>65.6327857375</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>135433.0</td><td>83.5278</td><td>27.9053</td><td>179.529</td><td>-2.69106</td><td>17.4911</td><td>52.0858</td><td>53.306</td><td>313.822</td><td>444430968.968</td><td>939188</td><td>444430599</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. False</td><td>1</td><td>97.6446831226</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>61592.1</td><td>231.214</td><td>-5.45521</td><td>357.435</td><td>40.6473</td><td>46.6356</td><td>141.047</td><td>62.7584</td><td>256.631</td><td>444433607.906</td><td>5443944</td><td>444430599</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. False</td><td>1</td><td>28.7290657759</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>80480.8</td><td>228.244</td><td>-45.044</td><td>327.561</td><td>10.9528</td><td>37.3149</td><td>193.714</td><td>83.3882</td><td>221.57</td><td>444433702.069</td><td>5612443</td><td>444430599</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. False</td><td>1</td><td>122.891819298</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
<tr><td>124449.0</td><td>238.008</td><td>-51.0371</td><td>329.429</td><td>2.3006</td><td>32.4522</td><td>199.504</td><td>80.9768</td><td>214.48</td><td>444433764.433</td><td>5723361</td><td>444430599</td><td>0</td><td>0 .. 0</td><td>False .. True</td><td>False .. True</td><td>0</td><td>185.255487204</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr>
</table></div>
</div>
<p>As a short analysis example we will count the number of events above a
certain minimum energy:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># define energy thresholds</span>
<span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1600</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span>

<span class="n">n_events_above_energy</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energies</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="n">energy</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n_events_above_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of events above {0:4.0f}: {1:5.0f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of events above   50 GeV: 60275
Number of events above  100 GeV: 21874
Number of events above  200 GeV:  8028
Number of events above  400 GeV:  2884
Number of events above  800 GeV:   821
Number of events above 1600 GeV:   113
</pre></div></div>
</div>
<p>And plot it against energy:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">events_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">n_events_above_energy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fermi 2FHL events&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">energies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">n_events_above_energy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">events_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Min. energy (GeV)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts above min. energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">4E1</span><span class="p">,</span> <span class="mf">3E3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1E2</span><span class="p">,</span> <span class="mf">1E5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x113e3cb38&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_13_1.png" src="../_images/notebooks_data_fermi_lat_13_1.png" />
</div>
</div>
</div>
<div class="section" id="PSF">
<h2>PSF<a class="headerlink" href="#PSF" title="Permalink to this headline">¶</a></h2>
<p>Next we will tke a closer look at the PSF. The dataset contains a
precomputed PSF model for one position of the sky (in this case the
Galactic center). It can be accessed by the <code class="docutils literal"><span class="pre">dataset.psf</span></code> property and
returns an instance of the Gammapy
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDependentTablePSF.html">gammapy.irf.EnergyDependentTablePSF</a>
class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">psf</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">psf</span>
<span class="k">print</span><span class="p">(</span><span class="n">psf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EnergyDependentTablePSF
-----------------------

Axis info:
  offset         : size =   300, min =  0.000 deg, max =  9.933 deg
  energy         : size =    17, min = 50.000 GeV, max = 2000.000 GeV
  exposure       : size =    17, min = 184244434125.149 cm2 s, max = 308160738535.443 cm2 s

Containment info:
  68.0% containment radius at  10 GeV: 0.10 deg
  68.0% containment radius at 100 GeV: 0.10 deg
  95.0% containment radius at  10 GeV: 0.52 deg
  95.0% containment radius at 100 GeV: 0.43 deg

</pre></div></div>
</div>
<p>To get an idea of the size of the PSF we check how the containment radii
of the Fermi-LAT PSF vari with energy and different containment
fractions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">psf</span><span class="o">.</span><span class="n">plot_containment_vs_energy</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_17_0.png" src="../_images/notebooks_data_fermi_lat_17_0.png" />
</div>
</div>
<p>In addition we can check how the actual shape of the PSF varies with
energy and compare it against the mean PSF between 50 GeV and 2000 GeV:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energies</span><span class="p">:</span>
    <span class="n">psf_at_energy</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">table_psf_at_energy</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
    <span class="n">psf_at_energy</span><span class="o">.</span><span class="n">plot_psf_vs_theta</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PSF @ {:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">erange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span>
<span class="n">psf_mean</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">table_psf_in_energy_band</span><span class="p">(</span><span class="n">energy_band</span><span class="o">=</span><span class="n">erange</span><span class="p">,</span> <span class="n">spectral_index</span><span class="o">=</span><span class="mf">2.3</span><span class="p">)</span>
<span class="n">psf_mean</span><span class="o">.</span><span class="n">plot_psf_vs_theta</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PSF Mean&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1E-3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1E2</span><span class="p">,</span> <span class="mf">1E7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[10]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x114256390&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_19_1.png" src="../_images/notebooks_data_fermi_lat_19_1.png" />
</div>
</div>
</div>
<div class="section" id="Exposure">
<h2>Exposure<a class="headerlink" href="#Exposure" title="Permalink to this headline">¶</a></h2>
<p>The Fermi-LAT datatset contains the energy-dependent exposure for the
whole sky stored using a HEALPIX pixelisation of the sphere. It can be
accessed by the <code class="docutils literal"><span class="pre">dataset.exposure</span></code> property and returns an instance of
the Gammapy <code class="docutils literal"><span class="pre">gammapy.cube.SkyCubeHPX</span></code> class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">exposure</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">exposure</span>
<span class="k">print</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Healpix sky cube exposure with shape=(18, 12288) and unit=cm2 s:
 n_pix:    12288  coord_type:    galactic         coord_unit:    deg
 n_energy:    18  unit_energy: MeV

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># define reference image using a cartesian projection</span>
<span class="n">image_ref</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nxpix</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">nypix</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;CAR&#39;</span><span class="p">)</span>

<span class="c1"># reproject HEALPIC sky cube</span>
<span class="n">exposure_reprojected</span> <span class="o">=</span> <span class="n">exposure</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span><span class="n">image_ref</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">exposure_reprojected</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_23_0.png" src="../_images/notebooks_data_fermi_lat_23_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;function gammapy.cube.core.SkyCube.show.&lt;locals&gt;.show_image&gt;
</pre></div>
</div>
</div>
<p>You can use the slider to slide through the different energy bands.</p>
</div>
<div class="section" id="Galactic-diffuse-background">
<h2>Galactic diffuse background<a class="headerlink" href="#Galactic-diffuse-background" title="Permalink to this headline">¶</a></h2>
<p>The Fermi-LAT collaboration provides a galactic diffuse emission model,
that can be used as a background model for Fermi-LAT data analysis.
Currently Gammapy only supports the latest model (<code class="docutils literal"><span class="pre">gll_iem_v06.fits</span></code>).
It can be accessed by the <code class="docutils literal"><span class="pre">dataset.galactic_diffuse</span></code> property and
returns an instance of the Gammapy
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.cube.SkyCube.html">gammapy.cube.SkyCube</a>
class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">galactic_diffuse</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">galactic_diffuse</span>
<span class="k">print</span><span class="p">(</span><span class="n">galactic_diffuse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sky cube galactic diffuse with shape=(30, 1441, 2880) and unit=1 / (cm2 MeV s sr):
 n_lon:     2880  type_lon:    GLON-CAR         unit_lon:    deg
 n_lat:     1441  type_lat:    GLAT-CAR         unit_lat:    deg
 n_energy:    30  unit_energy: MeV

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">image_ref</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">galactic_diffuse</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_28_0.png" src="../_images/notebooks_data_fermi_lat_28_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[15]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;function gammapy.cube.core.SkyCube.show.&lt;locals&gt;.show_image&gt;
</pre></div>
</div>
</div>
<p>Again you can use the slider to slide through the different energy
bands. E.g. note how the Fermi-Bubbles become more present at higher
energies (higher value of idx).</p>
</div>
<div class="section" id="Isotropic-diffuse-background">
<h2>Isotropic diffuse background<a class="headerlink" href="#Isotropic-diffuse-background" title="Permalink to this headline">¶</a></h2>
<p>Additionally to the galactic diffuse model, there is an isotropic
diffuse component. It can be accessed by the
<code class="docutils literal"><span class="pre">dataset.isotropic_diffuse</span></code> property and returns an instance of the
Gammapy
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.spectrum.models.TableModel.html#gammapy.spectrum.models.TableModel">gammapy.spectrum.models.TableModel</a>
class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">isotropic_diffuse</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">isotropic_diffuse</span>
<span class="k">print</span><span class="p">(</span><span class="n">isotropic_diffuse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
TableModel
ParameterList
Parameter(name=&#39;amplitude&#39;, value=1, unit=&#39;&#39;, min=0, max=None, frozen=False)

Covariance: None
</pre></div></div>
</div>
<p>We can plot the model in the energy range between 50 GeV and 2000 GeV:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">erange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span>
<span class="n">isotropic_diffuse</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">erange</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[17]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x114e08be0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_33_1.png" src="../_images/notebooks_data_fermi_lat_33_1.png" />
</div>
</div>
</div>
<div class="section" id="Estimating-basic-input-sky-images-for-high-level-analyses">
<h2>Estimating basic input sky images for high level analyses<a class="headerlink" href="#Estimating-basic-input-sky-images-for-high-level-analyses" title="Permalink to this headline">¶</a></h2>
<p>Finally we’d like to use the prepared 2FHL dataset to generate a set of
basic sky images, that a can be used as input for high level analyses,
e.g. morphology fits, region based flux measurements, computation of
significance images etc. For this purpose Gammapy provides a convenience
class called
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.image.FermiLATBasicImageEstimator.html">gammapy.image.FermiLATBasicImageEstimator</a>.
First we define a reference image, that specifies the region we’d like
to analyse. In this case we choose the Vela region.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">image_ref</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
    <span class="n">nxpix</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">nypix</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">xref</span><span class="o">=</span><span class="mi">265</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we choose the energy range and initialize the
<code class="docutils literal"><span class="pre">FermiLATBasicImageEstimator</span></code> object:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">emin</span><span class="p">,</span> <span class="n">emax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span>
<span class="n">image_estimator</span> <span class="o">=</span> <span class="n">FermiLATBasicImageEstimator</span><span class="p">(</span>
    <span class="n">reference</span><span class="o">=</span><span class="n">image_ref</span><span class="p">,</span>
    <span class="n">emin</span><span class="o">=</span><span class="n">emin</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="n">emax</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally we run the image estimation by calling <code class="docutils literal"><span class="pre">.run()</span></code> and parsing
the dataset object:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">images_basic</span> <span class="o">=</span> <span class="n">image_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The image estimator now computes a set of sky images for the reference
region and energy range we defined above. The result <code class="docutils literal"><span class="pre">images_basic</span></code> is
a
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.image.SkyImageList.html">gammapy.image.SkyImageList</a>
object containing the following images:</p>
<ul class="simple">
<li><strong>counts</strong>: counts image containing the binned event list</li>
<li><strong>background</strong>: predicted number of background counts computed from
the sum of the galactic and isotropic diffuse model, given the
exposure.</li>
<li><strong>exposure</strong>: integrated exposure assuming a powerlaw with spectral
index 2.3 in the given energy range</li>
<li><strong>excess</strong>: backround substracted counts image</li>
<li><strong>flux</strong>: measured flux, computed from excess divided by exposure</li>
<li><strong>psf</strong>: sky image of the exposure weighted mean PSF in the given
energy range</li>
</ul>
<p>You can check the contained images as following:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">images_basic</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&#39;counts&#39;, &#39;background&#39;, &#39;exposure&#39;, &#39;excess&#39;, &#39;flux&#39;, &#39;psf&#39;]
</pre></div>
</div>
</div>
<p>To check whether the image estimation was succesfull we’ll take a look
at the flux image, smoothing it in advance with a Gaussian kernel of 0.2
deg:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">smoothed_flux</span> <span class="o">=</span> <span class="n">images_basic</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">smoothed_flux</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_fermi_lat_43_0.png" src="../_images/notebooks_data_fermi_lat_43_0.png" />
</div>
</div>
</div>
<div class="section" id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Try to reproject the exposure using an <code class="docutils literal"><span class="pre">AIT</span></code> projection.</li>
<li>Try to find the spectral index of the isotropic diffuse model using a
method off the <code class="docutils literal"><span class="pre">TableModel</span></code> instance.</li>
<li>Compute basic sky images for different regions (e.g. Galactic Center)
and energy ranges</li>
</ul>
</div>
<div class="section" id="What-next?">
<h2>What next?<a class="headerlink" href="#What-next?" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we have learned how to access and check Fermi-LAT data.</p>
<p>Next you could do: * image analysis * spectral analysis * cube
analysis * time analysis * source detection</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Fermi-LAT data with Gammapy</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#FermiLATDataset-class">FermiLATDataset class</a></li>
<li><a class="reference internal" href="#Events">Events</a></li>
<li><a class="reference internal" href="#PSF">PSF</a></li>
<li><a class="reference internal" href="#Exposure">Exposure</a></li>
<li><a class="reference internal" href="#Galactic-diffuse-background">Galactic diffuse background</a></li>
<li><a class="reference internal" href="#Isotropic-diffuse-background">Isotropic diffuse background</a></li>
<li><a class="reference internal" href="#Estimating-basic-input-sky-images-for-high-level-analyses">Estimating basic input sky images for high level analyses</a></li>
<li><a class="reference internal" href="#Exercises">Exercises</a></li>
<li><a class="reference internal" href="#What-next?">What next?</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/data_fermi_lat.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>