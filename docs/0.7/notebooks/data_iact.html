
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>IACT DL3 data with Gammapy &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/data_iact.ipynb">data_iact.ipynb</a> |
<a class="reference external" href="../_static/notebooks/data_iact.py">data_iact.py</a></p>
</div>
<div class="section" id="IACT-DL3-data-with-Gammapy">
<h1>IACT DL3 data with Gammapy<a class="headerlink" href="#IACT-DL3-data-with-Gammapy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will show you how to work with IACT (Imaging Atmospheric
Cherenkov Telescope) DL3 (“data level 3”).</p>
<p>We will work with event data and instrument response functions (IRFs),
mainly using
<a class="reference external" href="http://docs.gammapy.org/0.7/data/index.html">gammapy.data</a> and
<a class="reference external" href="http://docs.gammapy.org/0.7/irf/index.html">gammapy.irf</a>.</p>
<p>This notebook uses a preliminary small test dataset from the CTA first
data challenge (1DC).</p>
<p>The main class to load data is</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.DataStore.html">gammapy.data.DataStore</a></li>
</ul>
<p>The <code class="docutils literal"><span class="pre">DataStore</span></code> has two index tables:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">DataStore.obs_table</span></code>
(<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.ObservationTable.html">gammapy.data.ObservationTable</a>)
to list and select available observations.</li>
<li><code class="docutils literal"><span class="pre">DataStore.hdu_table</span></code>
(<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.HDUIndexTable.html">gammapy.data.HDUIndexTable</a>)
to locate data for a given observation.</li>
</ul>
<p>Data loading is done via the <code class="docutils literal"><span class="pre">DataStore.obs</span></code> method which returns a</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.DataStoreObservation.html">gammapy.data.DataStoreObservation</a></li>
</ul>
<p>object, which on property access loads the data and IRFs and returns
them as Gammapy objects.</p>
<p>We support the common IACT DL3 data formats:
<a class="reference external" href="http://gamma-astro-data-formats.readthedocs.io/">http://gamma-astro-data-formats.readthedocs.io/</a> .</p>
<p>In this tutorial we will use objects of these types:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.data.EventList.html">gammapy.data.EventList</a></li>
<li>Load
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EffectiveAreaTable2D.html">gammapy.irf.EffectiveAreaTable2D</a>,
which has AEFF info for the whole field of view (FOV).</li>
<li>For the given source offset in the FOV, slice out
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EffectiveAreaTable.html">gammapy.irf.EffectiveAreaTable</a></li>
<li>Load
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDispersion2D.html">gammapy.irf.EnergyDispersion2D</a>,
which has EDISP info for the whole FOV.</li>
<li>For a given source offset in the FOV, slice out
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDispersion.html">gammapy.irf.EnergyDispersion</a></li>
<li>Load
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDependentMultiGaussPSF.html">gammapy.irf.EnergyDependentMultiGaussPSF</a>,
which has PSF info for the whole FOV using an analytical PSF model.</li>
<li>For a given source offset in the FOV, slice out
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.EnergyDependentTablePSF.html">gammapy.irf.EnergyDependentTablePSF</a>.</li>
<li>For a given energy or energy band, compute
<a class="reference external" href="http://docs.gammapy.org/0.7/api/gammapy.irf.TablePSF.html">gammapy.irf.TablePSF</a>.</li>
</ul>
</div>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;numpy : {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;matplotlib : {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy : 1.12.0
matplotlib : 2.0.0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We only need to import the `DataStore`,</span>
<span class="c1"># all other data objects can be loaded via the data store.</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">DataStore</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Data-store">
<h2>Data store<a class="headerlink" href="#Data-store" title="Permalink to this headline">¶</a></h2>
<p>First, we need to select some observations for our spectral analysis. To
this end we use the <a class="reference external" href="http://docs.gammapy.org/0.7/data/dm.html">data
management</a> functionality
in gammapy. The following example uses a simulated crab dataset in
<a class="reference external" href="https://github.com/gammapy/gammapy-extra">gammapy-extra</a>. Ideally,
we’d use crabs runs from the H.E.S.S. public data release, so if you
have the released files just change the <code class="docutils literal"><span class="pre">DATA_DIR</span></code> variable to the
corresponding folder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># data_store = DataStore.from_dir(&#39;$GAMMAPY_EXTRA/datasets/hess-crab4-hd-hap-prod2/&#39;)</span>
<span class="n">data_store</span> <span class="o">=</span> <span class="n">DataStore</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="s1">&#39;$GAMMAPY_EXTRA/test_datasets/cta_1dc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">data_store</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Data store summary info:
name: noname

HDU index table:
BASE_DIR: /Users/deil/code/gammapy-extra/test_datasets/cta_1dc
Rows: 10038
OBS_ID: 1 -- 1673
HDU_TYPE: [&#39;aeff&#39;, &#39;bkg&#39;, &#39;edisp&#39;, &#39;events&#39;, &#39;gti&#39;, &#39;psf&#39;]
HDU_CLASS: [&#39;aeff_2d&#39;, &#39;bkg_3d&#39;, &#39;edisp_2d&#39;, &#39;events&#39;, &#39;gti&#39;, &#39;psf_3gauss&#39;]

Observation table:
Number of observations: 1673
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
<span class="n">data_store</span><span class="o">.</span><span class="n">hdu_table</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;OBS_ID&#39;, &#39;HDU_TYPE&#39;, &#39;HDU_CLASS&#39;, &#39;FILE_DIR&#39;, &#39;FILE_NAME&#39;, &#39;HDU_NAME&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[6]:
</pre></div>
</div>
<div class="output_area docutils container">
&lt;HDUIndexTable length=7&gt;
<table id="table4563551512" class="table-striped table-bordered table-condensed">
<thead><tr><th>OBS_ID</th><th>HDU_TYPE</th><th>HDU_CLASS</th><th>FILE_DIR</th><th>FILE_NAME</th><th>HDU_NAME</th></tr></thead>
<thead><tr><th>int64</th><th>str6</th><th>str10</th><th>str39</th><th>str26</th><th>str21</th></tr></thead>
<tr><td>1</td><td>events</td><td>events</td><td>data/baseline/gc</td><td>gc_baseline_000001.fits.gz</td><td>EVENTS</td></tr>
<tr><td>1</td><td>gti</td><td>gti</td><td>data/baseline/gc</td><td>gc_baseline_000001.fits.gz</td><td>EVENTS</td></tr>
<tr><td>1</td><td>aeff</td><td>aeff_2d</td><td>caldb/data/cta/prod3b/bcf/South_z20_50h</td><td>irf_file.fits</td><td>EFFECTIVE AREA</td></tr>
<tr><td>1</td><td>edisp</td><td>edisp_2d</td><td>caldb/data/cta/prod3b/bcf/South_z20_50h</td><td>irf_file.fits</td><td>ENERGY DISPERSION</td></tr>
<tr><td>1</td><td>psf</td><td>psf_3gauss</td><td>caldb/data/cta/prod3b/bcf/South_z20_50h</td><td>irf_file.fits</td><td>POINT SPREAD FUNCTION</td></tr>
<tr><td>1</td><td>bkg</td><td>bkg_3d</td><td>caldb/data/cta/prod3b/bcf/South_z20_50h</td><td>irf_file.fits</td><td>BACKGROUND</td></tr>
<tr><td>2</td><td>events</td><td>events</td><td>data/baseline/gc</td><td>gc_baseline_000002.fits.gz</td><td>EVENTS</td></tr>
</table></div>
</div>
</div>
<div class="section" id="Observation-selection">
<h2>Observation selection<a class="headerlink" href="#Observation-selection" title="Permalink to this headline">¶</a></h2>
<p>Select observations using the observation table</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">table</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>

<span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;LIVETIME&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">)</span>
<span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Found {} runs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subtable</span><span class="p">)))</span>
<span class="n">subtable</span><span class="p">[::</span><span class="mi">100</span><span class="p">][[</span><span class="s1">&#39;OBS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;GLON_PNT&#39;</span><span class="p">,</span> <span class="s1">&#39;GLAT_PNT&#39;</span><span class="p">,</span> <span class="s1">&#39;LIVETIME&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;OBS_ID&#39;, &#39;RA_PNT&#39;, &#39;DEC_PNT&#39;, &#39;GLON_PNT&#39;, &#39;GLAT_PNT&#39;, &#39;ZEN_PNT&#39;, &#39;ALT_PNT&#39;, &#39;AZ_PNT&#39;, &#39;ONTIME&#39;, &#39;LIVETIME&#39;, &#39;DEADC&#39;, &#39;TSTART&#39;, &#39;TSTOP&#39;, &#39;DATE_OBS&#39;, &#39;TIME_OBS&#39;, &#39;DATE_END&#39;, &#39;TIME_END&#39;, &#39;EVENTS_FILENAME&#39;, &#39;EVENT_COUNT&#39;, &#39;EVENT_TIME_MIN&#39;, &#39;EVENT_TIME_MAX&#39;, &#39;EVENT_ENERGY_MIN&#39;, &#39;EVENT_ENERGY_MAX&#39;]
Found 385 runs
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area docutils container">
&lt;ObservationTable length=4&gt;
<table id="table4565947112" class="table-striped table-bordered table-condensed">
<thead><tr><th>OBS_ID</th><th>GLON_PNT</th><th>GLAT_PNT</th><th>LIVETIME</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>309</td><td>359.500018539</td><td>-0.166664271339</td><td>1710.0</td></tr>
<tr><td>409</td><td>359.85004914</td><td>-0.0833612254625</td><td>1710.0</td></tr>
<tr><td>509</td><td>0.10002443619</td><td>-1.92849400882e-05</td><td>1710.0</td></tr>
<tr><td>609</td><td>0.450057219696</td><td>0.0833132821052</td><td>1710.0</td></tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># In the following examples we&#39;ll just use this one observation</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="mi">659</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Info for OBS_ID = 659
- Start time: 665735040.00
- Pointing pos: RA 266.30 deg / Dec -28.76 deg
- Observation duration: 1800.0 s
- Dead-time fraction: 5.000 %

</pre></div></div>
</div>
</div>
<div class="section" id="Events">
<h2>Events<a class="headerlink" href="#Events" title="Permalink to this headline">¶</a></h2>
<p>Explore the <code class="docutils literal"><span class="pre">EventList</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">events</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">events</span>
<span class="n">events</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[:</span><span class="mi">5</span><span class="p">][[</span><span class="s1">&#39;EVENT_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME&#39;</span><span class="p">,</span> <span class="s1">&#39;ENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[9]:
</pre></div>
</div>
<div class="output_area docutils container">
&lt;Table length=5&gt;
<table id="table4592048280" class="table-striped table-bordered table-condensed">
<thead><tr><th>EVENT_ID</th><th>TIME</th><th>ENERGY</th><th>RA</th><th>DEC</th></tr></thead>
<thead><tr><th></th><th>s</th><th>TeV</th><th>deg</th><th>deg</th></tr></thead>
<thead><tr><th>uint32</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>1</td><td>665735041.7</td><td>0.0384564</td><td>-92.6261</td><td>-28.4639</td></tr>
<tr><td>2</td><td>665735042.72</td><td>0.0407098</td><td>-92.307</td><td>-27.1749</td></tr>
<tr><td>3</td><td>665735042.878</td><td>0.0429804</td><td>-93.4977</td><td>-28.7857</td></tr>
<tr><td>4</td><td>665735045.849</td><td>0.0411471</td><td>-92.9102</td><td>-27.9038</td></tr>
<tr><td>5</td><td>665735057.423</td><td>0.0347661</td><td>-94.1769</td><td>-29.147</td></tr>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_13_1.png" src="../_images/notebooks_data_iact_13_1.png" />
</div>
</div>
</div>
<div class="section" id="Effective-area">
<h2>Effective area<a class="headerlink" href="#Effective-area" title="Permalink to this headline">¶</a></h2>
<p>Explore <code class="docutils literal"><span class="pre">EffectiveAreaTable2d</span></code> and <code class="docutils literal"><span class="pre">EffectiveAreaTable</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">aeff</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">aeff</span>
<span class="n">aeff</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">aeff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gammapy.irf.effective_area.EffectiveAreaTable2D object at 0x111bc5160&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_15_1.png" src="../_images/notebooks_data_iact_15_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Slice out effective area at a given offset</span>
<span class="n">effarea</span> <span class="o">=</span> <span class="n">aeff</span><span class="o">.</span><span class="n">to_effective_area_table</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">effarea</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x110418048&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_16_1.png" src="../_images/notebooks_data_iact_16_1.png" />
</div>
</div>
</div>
<div class="section" id="Energy-dispersion">
<h2>Energy dispersion<a class="headerlink" href="#Energy-dispersion" title="Permalink to this headline">¶</a></h2>
<p>Explore <code class="docutils literal"><span class="pre">EnergyDispersion2d</span></code> and <code class="docutils literal"><span class="pre">EnergyDispersion</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">edisp</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">edisp</span>
<span class="n">edisp</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">edisp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/opt/local/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages/matplotlib/colors.py:1152: UserWarning: Power-law scaling on negative values is ill-defined, clamping to 0.
  warnings.warn(&#34;Power-law scaling on negative values is &#34;
/Users/deil/Library/Python/3.5/lib/python/site-packages/astropy/units/quantity.py:951: RuntimeWarning: invalid value encountered in true_divide
  return super(Quantity, self).__truediv__(other)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EnergyDispersion2D
NDDataArray summary info
e_true         : size =    60, min =  0.011 TeV, max = 8912.510 TeV
migra          : size =   300, min =  0.005, max =  2.995
offset         : size =     6, min =  0.500 deg, max =  5.500 deg
Data           : size = 108000, min =  0.000, max = 913.000

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/opt/local/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages/matplotlib/colors.py:1113: RuntimeWarning: invalid value encountered in power
  np.power(resdat, gamma, resdat)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_18_3.png" src="../_images/notebooks_data_iact_18_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate energy dispersion matrix at a given offset</span>
<span class="n">response_matrix</span> <span class="o">=</span> <span class="n">edisp</span><span class="o">.</span><span class="n">to_energy_dispersion</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">response_matrix</span><span class="o">.</span><span class="n">plot_bias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/deil/Library/Python/3.5/lib/python/site-packages/astropy/units/quantity.py:951: RuntimeWarning: invalid value encountered in true_divide
  return super(Quantity, self).__truediv__(other)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x11040bb38&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_19_2.png" src="../_images/notebooks_data_iact_19_2.png" />
</div>
</div>
</div>
<div class="section" id="PSF">
<h2>PSF<a class="headerlink" href="#PSF" title="Permalink to this headline">¶</a></h2>
<p>TODO: examples for point spread function (PSF)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">psf</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">psf</span>
<span class="n">psf</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">psf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
No safe energy thresholds found. Setting to default
/Users/deil/Library/Python/3.5/lib/python/site-packages/gammapy/image/models/gauss.py:254: RuntimeWarning: invalid value encountered in true_divide
  self.norms /= self.integral
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gammapy.irf.psf_analytical.EnergyDependentMultiGaussPSF object at 0x10de9bfd0&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/opt/local/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages/matplotlib/colors.py:494: RuntimeWarning: invalid value encountered in less
  cbook._putmask(xa, xa &lt; 0.0, -1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_iact_21_3.png" src="../_images/notebooks_data_iact_21_3.png" />
</div>
</div>
</div>
<div class="section" id="Background-model">
<h2>Background model<a class="headerlink" href="#Background-model" title="Permalink to this headline">¶</a></h2>
<p>TODO: example how to load and plot
<code class="docutils literal"><span class="pre">gammapy.background.FOVBackgroundModel</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># TODO: doesn&#39;t work yet</span>
<span class="c1"># bkg = obs.bkg</span>
<span class="c1"># bkg.peek()</span>
<span class="c1"># print(bkg)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>TODO</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Start the exercises here!</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="What-next?">
<h2>What next?<a class="headerlink" href="#What-next?" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we have learned how to access and check IACT DL3 data.</p>
<p>Usually for a science analysis, if others have checked the data and IRF
quality for you and you trust it’s good, you don’t need to do that.
Instead, you’ll just run an analysis and look at higher-level results,
like images or spectra.</p>
<p>Next you could do:</p>
<ul class="simple">
<li>image analysis</li>
<li>spectral analysis</li>
<li>cube analysis</li>
<li>time analysis</li>
<li>source detection</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">IACT DL3 data with Gammapy</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#Data-store">Data store</a></li>
<li><a class="reference internal" href="#Observation-selection">Observation selection</a></li>
<li><a class="reference internal" href="#Events">Events</a></li>
<li><a class="reference internal" href="#Effective-area">Effective area</a></li>
<li><a class="reference internal" href="#Energy-dispersion">Energy dispersion</a></li>
<li><a class="reference internal" href="#PSF">PSF</a></li>
<li><a class="reference internal" href="#Background-model">Background model</a></li>
<li><a class="reference internal" href="#Exercises">Exercises</a></li>
<li><a class="reference internal" href="#What-next?">What next?</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/data_iact.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>