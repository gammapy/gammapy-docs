
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CTA 2D source fitting with Sherpa &#8212; gammapy v0.7</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/image_fitting_with_sherpa.ipynb">image_fitting_with_sherpa.ipynb</a>
|
<a class="reference external" href="../_static/notebooks/image_fitting_with_sherpa.py">image_fitting_with_sherpa.py</a></p>
</div>
<div class="section" id="CTA-2D-source-fitting-with-Sherpa">
<h1>CTA 2D source fitting with Sherpa<a class="headerlink" href="#CTA-2D-source-fitting-with-Sherpa" title="Permalink to this headline">¶</a></h1>
<ol class="upperalpha simple" start="6">
<li>Acero &amp; Y. Gallant October 2017</li>
</ol>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Sherpa is the X-ray satellite Chandra modeling and fitting application.
It enables the user to construct complex models from simple definitions
and fit those models to data, using a variety of statistics and
optimization methods. The issues of constraining the source position and
morphology are common in X- and Gamma-ray astronomy. This notebook will
show you how to apply Sherpa to CTA data.</p>
<p>Here we will set up Sherpa to fit the counts map and loading the
ancillary images for subsequent use. A relevant test statistic for data
with Poisson fluctuations is the one proposed by Cash (1979). The
simplex (or Nelder-Mead) fitting algorithm is a good compromise between
efficiency and robustness. The source fit is best performed in pixel
coordinates.</p>
</div>
<div class="section" id="Read-sky-images">
<h2>Read sky images<a class="headerlink" href="#Read-sky-images" title="Permalink to this headline">¶</a></h2>
<p>The sky image that are loaded here have been prepared in a separated
notebook. Here we start from those fits file and focus on the source
fitting aspect.</p>
<p>The info needed for sherpa are: - Count map - Background map - Exposure
map - PSF map</p>
<p>For info, the fits file are written in the following way in the Sky map
generation notebook:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span>    <span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;G300-0_test_counts.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">images</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span>  <span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;G300-0_test_exposure.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">images</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;G300-0_test_background.fits&quot;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">##As psf is an array of quantities we cannot use the images[&#39;psf&#39;].write() function</span>
<span class="c1">##all the other arrays do not have quantities.</span>
<span class="n">fits</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s2">&quot;G300-0_test_psf.fits&quot;</span><span class="p">,</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">gammapy.image</span> <span class="kn">import</span> <span class="n">SkyImage</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>

<span class="c1"># You may see a Warning concerning XSPEC</span>
<span class="c1"># As we will note use Xspec spectral models this warning is not important</span>
<span class="kn">import</span> <span class="nn">sherpa.astro.ui</span> <span class="kn">as</span> <span class="nn">sh</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: imaging routines will not be available,
failed to import sherpa.image.ds9_backend due to
&#39;RuntimeErr: DS9Win unusable: Could not find xpaget on your PATH&#39;
WARNING: failed to import WCS module; WCS routines will not be available
WARNING: failed to import sherpa.astro.xspec; XSPEC models will not be available
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Read the fits file to load them in a sherpa model</span>
<span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s2">&quot;G300-0_test_counts.fits&quot;</span><span class="p">)</span>
<span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">set_stat</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_method</span><span class="p">(</span><span class="s2">&quot;simplex&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="s2">&quot;G300-0_test_counts.fits&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_coord</span><span class="p">(</span><span class="s2">&quot;logical&quot;</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">load_table_model</span><span class="p">(</span><span class="s2">&quot;expo&quot;</span><span class="p">,</span> <span class="s2">&quot;G300-0_test_exposure.fits&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_table_model</span><span class="p">(</span><span class="s2">&quot;bkg&quot;</span><span class="p">,</span> <span class="s2">&quot;G300-0_test_background.fits&quot;</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">load_psf</span><span class="p">(</span><span class="s2">&quot;psf&quot;</span><span class="p">,</span> <span class="s2">&quot;G300-0_test_psf.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In principle one might first want to fit the background amplitude.
However the background estimation method already yields the correct
normalization, so we freeze the background amplitude to unity instead of
adjusting it. The (smoothed) residuals from this background model are
then computed and shown.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sh</span><span class="o">.</span><span class="n">set_full_model</span><span class="p">(</span><span class="n">bkg</span><span class="p">)</span>
<span class="n">bkg</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">bkg</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_data_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span>  <span class="n">sh</span><span class="o">.</span><span class="n">get_model_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>

<span class="n">resid_table</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Keep residual images in a list to show them later</span>
<span class="n">resid_smo6</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">resid_smo6</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">resid_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid_smo6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_7_0.png" src="../_images/notebooks_image_fitting_with_sherpa_7_0.png" />
</div>
</div>
<div class="section" id="Find-and-fit-the-brightest-source">
<h3>Find and fit the brightest source<a class="headerlink" href="#Find-and-fit-the-brightest-source" title="Permalink to this headline">¶</a></h3>
<p>We then find the position of the maximum in the (smoothed) residuals
map, and fit a (symmetrical) Gaussian source with that initial position:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">maxcoord</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">lookup_max</span><span class="p">()</span>
<span class="n">maxpix</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">wcs_skycoord_to_pixel</span><span class="p">(</span><span class="n">maxcoord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_full_model</span><span class="p">(</span><span class="n">bkg</span> <span class="o">+</span> <span class="n">psf</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">gauss2d</span><span class="o">.</span><span class="n">g0</span><span class="p">)</span> <span class="o">*</span> <span class="n">expo</span><span class="p">)</span> <span class="c1"># creates g0 as a gauss2d instance</span>
<span class="n">g0</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g0</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span> <span class="c1"># fix the position in the initial fitting step</span>

<span class="n">expo</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mf">1e-9</span> <span class="c1"># fix exposure amplitude so that typical exposure is of order unity</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">expo</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ampl</span><span class="p">)</span> <span class="c1"># in case frozen in a previous iteration</span>

<span class="n">g0</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># give some reasonable initial values</span>
<span class="n">g0</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">maxcoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># Performs the fit; this takes a little time.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47907.2
Final fit statistic   = 47503 at function evaluation 234
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 404.211
   g0.fwhm        6.43418
   g0.ampl        0.400131
</pre></div></div>
</div>
<p>Fit all parameters of this Gaussian component, fix them and re-compute
the residuals map.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">g0</span><span class="o">.</span><span class="n">xpos</span><span class="p">,</span> <span class="n">g0</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">g0</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_data_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span>  <span class="n">sh</span><span class="o">.</span><span class="n">get_model_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>

<span class="n">resid_smo6</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">resid_smo6</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">resid_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid_smo6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47503
Final fit statistic   = 47498.4 at function evaluation 354
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 4.57486
   g0.fwhm        6.33581
   g0.xpos        41.9218
   g0.ypos        81.3048
   g0.ampl        0.417545
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_11_1.png" src="../_images/notebooks_image_fitting_with_sherpa_11_1.png" />
</div>
</div>
</div>
<div class="section" id="Iteratively-find-and-fit-additional-sources">
<h3>Iteratively find and fit additional sources<a class="headerlink" href="#Iteratively-find-and-fit-additional-sources" title="Permalink to this headline">¶</a></h3>
<p>Instantiate additional Gaussian components, and use them to iteratively
fit sources, repeating the steps performed above for component g0. (The
residuals map is shown after each additional source included in the
model.) This takes some time…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">create_model_component</span><span class="p">(</span><span class="s1">&#39;gauss2d&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">gs</span> <span class="o">=</span> <span class="p">[</span><span class="n">g0</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g5</span><span class="p">]</span>
<span class="n">sh</span><span class="o">.</span><span class="n">set_full_model</span><span class="p">(</span><span class="n">bkg</span> <span class="o">+</span> <span class="n">psf</span><span class="p">(</span><span class="n">g0</span><span class="o">+</span><span class="n">g1</span><span class="o">+</span><span class="n">g2</span><span class="o">+</span><span class="n">g3</span><span class="o">+</span><span class="n">g4</span><span class="o">+</span><span class="n">g5</span><span class="p">)</span> <span class="o">*</span> <span class="n">expo</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs</span><span class="p">))</span> <span class="p">:</span>
    <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># initialize components with fixed, zero amplitude</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs</span><span class="p">))</span> <span class="p">:</span>
    <span class="n">maxcoord</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">lookup_max</span><span class="p">()</span>
    <span class="n">maxpix</span> <span class="o">=</span> <span class="n">resid_smo6</span><span class="o">.</span><span class="n">wcs_skycoord_to_pixel</span><span class="p">(</span><span class="n">maxcoord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xpos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ypos</span> <span class="o">=</span> <span class="n">maxpix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">maxcoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ampl</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">thaw</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ypos</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_data_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span>  <span class="n">sh</span><span class="o">.</span><span class="n">get_model_image</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="c1"># estimate residual map = data - model</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">SkyImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>

    <span class="n">resid_smo6</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">resid_smo6</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">resid_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid_smo6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47498.4
Final fit statistic   = 47335 at function evaluation 269
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 163.402
   g1.fwhm        19.8613
   g1.ampl        0.100529
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47335
Final fit statistic   = 47293.7 at function evaluation 394
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 41.3431
   g1.fwhm        19.9265
   g1.xpos        67.2544
   g1.ypos        69.3013
   g1.ampl        0.116012
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_13_1.png" src="../_images/notebooks_image_fitting_with_sherpa_13_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47293.7
Final fit statistic   = 47185.5 at function evaluation 264
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 108.124
   g2.fwhm        6.20212
   g2.ampl        0.393345
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47185.5
Final fit statistic   = 47182.5 at function evaluation 342
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 3.05173
   g2.fwhm        6.19309
   g2.xpos        20.8274
   g2.ypos        81.6413
   g2.ampl        0.40001
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_13_3.png" src="../_images/notebooks_image_fitting_with_sherpa_13_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47182.5
Final fit statistic   = 47115 at function evaluation 275
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 67.4731
   g3.fwhm        6.43218
   g3.ampl        0.235481
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47115
Final fit statistic   = 47114.3 at function evaluation 303
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 0.728928
   g3.fwhm        6.38175
   g3.xpos        177.458
   g3.ypos        80.2233
   g3.ampl        0.239637
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_13_5.png" src="../_images/notebooks_image_fitting_with_sherpa_13_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47114.3
Final fit statistic   = 47086.6 at function evaluation 277
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 27.7341
   g4.fwhm        5.70151
   g4.ampl        0.162191
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47086.6
Final fit statistic   = 47085.7 at function evaluation 304
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 0.898776
   g4.fwhm        5.94179
   g4.xpos        135.942
   g4.ypos        59.5875
   g4.ampl        0.156213
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_13_7.png" src="../_images/notebooks_image_fitting_with_sherpa_13_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47085.7
Final fit statistic   = 47069 at function evaluation 262
Data points           = 30000
Degrees of freedom    = 29998
Change in statistic   = 16.6424
   g5.fwhm        2.82885
   g5.ampl        0.52359
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 47069
Final fit statistic   = 47068.9 at function evaluation 328
Data points           = 30000
Degrees of freedom    = 29996
Change in statistic   = 0.0749129
   g5.fwhm        2.82317
   g5.xpos        76.1381
   g5.ypos        73.1869
   g5.ampl        0.524268
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_image_fitting_with_sherpa_13_9.png" src="../_images/notebooks_image_fitting_with_sherpa_13_9.png" />
</div>
</div>
</div>
<div class="section" id="Generating-output-table-and-Test-Statistics-estimation">
<h3>Generating output table and Test Statistics estimation<a class="headerlink" href="#Generating-output-table-and-Test-Statistics-estimation" title="Permalink to this headline">¶</a></h3>
<p>When adding a new source, one need to check the significance of this new
source. A frequently used method is the Test Statistics (TS). This is
done by comparing the change of statistics when the source is included
compared to the null hypothesis (no source ; in practice here we fix the
amplitude to zero).</p>
<p><span class="math">\(TS = Cstat(source) - Cstat(no source)\)</span></p>
<p>The criterion for a significant source detection is typically that it
should improve the test statistic by at least 25 or 30. The last excess
fitted (g5) thus not a significant source:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">gaussian_fwhm_to_sigma</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gs</span><span class="p">):</span>
    <span class="n">ampl</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">val</span>
    <span class="n">g</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stati</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_stat_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">statval</span>
    <span class="n">g</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">ampl</span>
    <span class="n">statf</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">get_stat_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">statval</span>
    <span class="n">delstat</span> <span class="o">=</span> <span class="n">stati</span> <span class="o">-</span> <span class="n">statf</span>

    <span class="n">coord</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">wcs_pixel_to_skycoord</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">xpos</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ypos</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
    <span class="n">pix_scale</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">wcs_pixel_scale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deg</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">val</span> <span class="o">*</span> <span class="n">pix_scale</span> <span class="o">*</span> <span class="n">gaussian_fwhm_to_sigma</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
        <span class="n">delstat</span><span class="o">=</span><span class="n">delstat</span><span class="p">,</span>
        <span class="n">glon</span><span class="o">=</span><span class="n">coord</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
        <span class="n">glat</span><span class="o">=</span><span class="n">coord</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
        <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span> <span class="p">,</span>
    <span class="p">))</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;delstat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>Table length=5</i>
<table id="table4484671864" class="table-striped table-bordered table-condensed">
<thead><tr><th>idx</th><th>delstat</th><th>glon</th><th>glat</th><th>sigma</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>0</td><td>136.582187364</td><td>300.151408614</td><td>0.136068174452</td><td>0.0538113987742</td></tr>
<tr><td>1</td><td>158.744570772</td><td>299.644884821</td><td>-0.103966965279</td><td>0.169240266293</td></tr>
<tr><td>2</td><td>111.176173057</td><td>300.57305638</td><td>0.142771893381</td><td>0.0525992264273</td></tr>
<tr><td>3</td><td>68.2020558775</td><td>297.441233657</td><td>0.114422638212</td><td>0.0542015591058</td></tr>
<tr><td>4</td><td>28.632872396</td><td>298.27120691</td><td>-0.298223927544</td><td>0.0504649169514</td></tr>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Small animation to show the source detection at each iteration</span>
<span class="kn">from</span> <span class="nn">ipywidgets.widgets.interaction</span> <span class="kn">import</span> <span class="n">interact</span>

<span class="k">def</span> <span class="nf">plot_resid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span><span class="n">cbar</span> <span class="o">=</span> <span class="n">resid_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;CMRmap&#39;</span><span class="p">)</span>
<span class="c1">#    ax=plt.gca()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CStat=</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;delstat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;glon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;glat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;galactic&#39;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;azure&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="c1">#    plt.savefig(&#39;source_%i.png&#39;%(i))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">interact</span><span class="p">(</span><span class="n">plot_resid</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If you look back to the original image: there’s one source that looks
like a shell-type supernova remnant.<ul>
<li>Try to fit is with a shell morphology model (use
<code class="docutils literal"><span class="pre">sh.shell2d('shell')</span></code> to create such a model).</li>
<li>Try to evaluate the <code class="docutils literal"><span class="pre">TS</span></code> and probability of the shell model
compared to a Gaussian model hypothesis</li>
<li>You could also try a disk model (use <code class="docutils literal"><span class="pre">sh.disk2d('disk')</span></code> to
create one)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="What-next?">
<h2>What next?<a class="headerlink" href="#What-next?" title="Permalink to this headline">¶</a></h2>
<p>These are good resources to learn more about Sherpa:</p>
<ul class="simple">
<li><a class="reference external" href="https://python4astronomers.github.io/fitting/fitting.html">https://python4astronomers.github.io/fitting/fitting.html</a></li>
<li><a class="reference external" href="https://github.com/DougBurke/sherpa-standalone-notebooks">https://github.com/DougBurke/sherpa-standalone-notebooks</a></li>
</ul>
<p>You could read over the examples there, and try to apply a similar
analysis to this dataset here to practice.</p>
<p>If you want a deeper understanding of how Sherpa works, then these
proceedings are good introductions:</p>
<ul class="simple">
<li><a class="reference external" href="http://conference.scipy.org/proceedings/scipy2009/paper_8/full_text.pdf">http://conference.scipy.org/proceedings/scipy2009/paper_8/full_text.pdf</a></li>
<li><a class="reference external" href="http://conference.scipy.org/proceedings/scipy2011/pdfs/brefsdal.pdf">http://conference.scipy.org/proceedings/scipy2011/pdfs/brefsdal.pdf</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">CTA 2D source fitting with Sherpa</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Read-sky-images">Read sky images</a><ul>
<li><a class="reference internal" href="#Find-and-fit-the-brightest-source">Find and fit the brightest source</a></li>
<li><a class="reference internal" href="#Iteratively-find-and-fit-additional-sources">Iteratively find and fit additional sources</a></li>
<li><a class="reference internal" href="#Generating-output-table-and-Test-Statistics-estimation">Generating output table and Test Statistics estimation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Exercises">Exercises</a></li>
<li><a class="reference internal" href="#What-next?">What next?</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/image_fitting_with_sherpa.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7. &nbsp;
    Last built 01 Mar 2018. <br/>
  </p>
</footer>
  </body>
</html>