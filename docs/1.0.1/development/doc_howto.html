
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Documentation How To &#8212; gammapy v1.0.1</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer How To" href="dev_howto.html" />
    <link rel="prev" title="How to make a Gammapy release" href="release.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user-guide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        1.0.1  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables development/doc_howto and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': '1.0.1'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "development/doc_howto.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "development/doc_howto.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.0.1 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "1.0.1") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Project setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dependencies.html">
   Dependencies
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   How to contribute to Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="release.html">
   How to make a Gammapy release
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Documentation How To
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dev_howto.html">
   Developer How To
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pigs/index.html">
   PIGs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-001.html">
     PIG 1 - PIG purpose and guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-002.html">
     PIG 2 - Organization of low level analysis code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-003.html">
     PIG 3 - Plan for dropping Python 2.7 support
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-004.html">
     PIG 4 - Setup for tutorial notebooks and data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-005.html">
     PIG 5 - Gammapy 1.0 roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-006.html">
     PIG 6 - CTA observation handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-007.html">
     PIG 7 - Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-008.html">
     PIG 8 - Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-009.html">
     PIG 9 - Event sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-010.html">
     PIG 10 - Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-011.html">
     PIG 11 - Light curves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-012.html">
     PIG 12 - High level interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-013.html">
     PIG 13 - Gammapy dependencies and distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-014.html">
     PIG 14 - Uncertainty estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-016.html">
     PIG 16 - Gammapy package structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-018.html">
     PIG 18 - Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-019.html">
     PIG 19 - Gammapy package structure follow up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-020.html">
     PIG 20 - Global Model API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-021.html">
     PIG 21 - Models improvements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-022.html">
     PIG 22 - Unified flux estimators API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-023.html">
     PIG 23 - Gammapy release cycle and version numbering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pigs/pig-024.html">
     PIG 24 - Authorship policy
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#documentation-building">
   Documentation building
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-python-code">
   Check Python code
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-in-rst-files">
     Code in RST files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-in-docstrings-in-python-files">
     Code in docstrings in Python files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sphinx-gallery-extension">
   Sphinx gallery extension
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#working-with-notebooks">
   Working with notebooks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-tasks">
     Common tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-a-notebook-into-a-folder-other-than-tutorials-folder">
     Add a notebook into a folder other than tutorials folder
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skip-notebooks-from-being-executed">
     Skip notebooks from being executed
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-a-thumbnail-and-tooltip-for-the-tutorial-gallery">
     Choose a thumbnail and tooltip for the tutorial gallery
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dealing-with-links">
   Dealing with links
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#links-to-notebooks">
     Links to notebooks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#links-within-notebooks">
     Links within notebooks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-broken-links">
     Check broken links
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#include-png-files-as-images">
   Include png files as images
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-jupyter-notebooks">
     In Jupyter notebooks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-the-rst-files">
     In the RST files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#documentation-guidelines">
   Documentation guidelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions-or-class-methods-that-return-a-single-object">
     Functions or class methods that return a single object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-attributes">
     Class attributes
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="documentation-how-to">
<span id="doc-howto"></span><h1>Documentation How To<a class="headerlink" href="#documentation-how-to" title="Permalink to this headline">#</a></h1>
<section id="documentation-building">
<h2>Documentation building<a class="headerlink" href="#documentation-building" title="Permalink to this headline">#</a></h2>
<p>Generating the HTML docs for Gammapy is straight-forward:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">docs</span><span class="o">-</span><span class="n">sphinx</span>
<span class="n">make</span> <span class="n">docs</span><span class="o">-</span><span class="n">show</span>
</pre></div>
</div>
<p>Or one can equivalently use tox:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">build_docs</span>
</pre></div>
</div>
<p>Generating the PDF docs is more complex.
This should work:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># build the notebooks</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">gammapy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">notebooks_process</span>
<span class="c1"># build the latex file</span>
<span class="n">cd</span> <span class="n">docs</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sphinx</span> <span class="o">.</span> <span class="n">_build</span><span class="o">/</span><span class="n">latex</span> <span class="o">-</span><span class="n">b</span> <span class="n">latex</span> <span class="o">-</span><span class="n">j</span> <span class="n">auto</span>
<span class="c1"># first generation of pdf file</span>
<span class="n">cd</span> <span class="n">_build</span><span class="o">/</span><span class="n">latex</span>
<span class="n">pdflatex</span> <span class="o">-</span><span class="n">interaction</span><span class="o">=</span><span class="n">nonstopmode</span> <span class="n">gammapy</span><span class="o">.</span><span class="n">tex</span>
<span class="c1"># final generation of pdf file</span>
<span class="n">pdflatex</span> <span class="o">-</span><span class="n">interaction</span><span class="o">=</span><span class="n">nonstopmode</span> <span class="n">gammapy</span><span class="o">.</span><span class="n">tex</span>
<span class="c1"># clean the git repo</span>
<span class="n">git</span> <span class="n">reset</span> <span class="o">--</span><span class="n">hard</span>
<span class="c1"># open the pdf file</span>
<span class="nb">open</span> <span class="n">gammapy</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>You need a bunch or LaTeX stuff, specifically <code class="docutils literal notranslate"><span class="pre">texlive-fonts-extra</span></code> is needed.</p>
<p>Jupyter notebooks present in <code class="docutils literal notranslate"><span class="pre">docs/tutorials</span></code> folder have stripped output cells.
Although notebooks are code clean formatted, tested, and filled during the process of documentation
building, where they are also converted to Sphinx formatted HTML files and <code class="docutils literal notranslate"><span class="pre">.py</span></code> scripts,
<strong>you must always use stripped and clean formatted notebooks in your pull requests</strong>.
See <a class="reference internal" href="#common-taks-notebooks"><span class="std std-ref">Common tasks</span></a> for the commands used for these tasks.</p>
<p>The Sphinx formatted versions of the notebooks provide links to the raw <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> Jupyter
files and <code class="docutils literal notranslate"><span class="pre">.py</span></code> script versions stored in <code class="docutils literal notranslate"><span class="pre">docs/_static/notebooks</span></code> folder, as well as
a link pointing to its specific Binder space in the
<a class="reference external" href="https://github.com/gammapy/gammapy-webpage">gammapy-webpage</a> repository (not for
the deve version of the docs). Since notebooks are evolving with Gammapy features and documentation,
the different versions of the notebooks are linked to versioned Binder environments.</p>
<p>Once the documentation is built you can optimize the speed of eventual re-building,
for example in case you are modifying or adding new text, and you would like to check
these changes are displayed nicely. For that purpose, you may run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">docs-sphinx</span></code> so
that notebooks are not executed during the docs build.</p>
<p>In the case one single notebook is modified or added to the documentation, you can
execute the build doc process with the <code class="docutils literal notranslate"><span class="pre">src</span></code> parameter with value the name of the
considered notebook. i.e. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">docs-all</span> <span class="pre">src=docs/tutorials/my-notebook.ipynb</span></code></p>
</section>
<section id="check-python-code">
<h2>Check Python code<a class="headerlink" href="#check-python-code" title="Permalink to this headline">#</a></h2>
<section id="code-in-rst-files">
<h3>Code in RST files<a class="headerlink" href="#code-in-rst-files" title="Permalink to this headline">#</a></h3>
<p>Most of the documentation of Gammapy is present in RST files that are converted into HTML pages using
Sphinx during the build documentation process. You may include snippets of Python code in these RST files
within blocks labelled with <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">code-block::</span> <span class="pre">python</span></code> Sphinx directive. However, this code could not be
tested, and it will not be possible to know if it fails in following versions of Gammapy. That’s why we
recommend using the <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testcode::</span></code> directive to enclose code that will be tested against the results
present in a block labelled with <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testoutput::</span></code> directive. If not <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testoutput::</span></code> directive is provided,
only execution tests will be performed.</p>
<p>For example, we could check that the code below does not fail, since it does not provide any output.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.. testcode::

    from gammapy.astro import source
    from gammapy.astro import population
    from gammapy.astro import darkmatter
</pre></div>
</div>
<p>On the contrary, we could check the execution of the following code as well as the output values produced.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.. testcode::

    from astropy.time import Time
    time = Time([&#39;1999-01-01T00:00:00.123456789&#39;, &#39;2010-01-01T00:00:00&#39;])
    print(time.mjd)

.. testoutput::

    [51179.00000143 55197.        ]
</pre></div>
</div>
<p>In order to perform tests of these snippets of code present in RST files, you may run the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-glob<span class="o">=</span><span class="s2">&quot;*.rst&quot;</span><span class="w"> </span>docs/
</pre></div>
</div>
</section>
<section id="code-in-docstrings-in-python-files">
<h3>Code in docstrings in Python files<a class="headerlink" href="#code-in-docstrings-in-python-files" title="Permalink to this headline">#</a></h3>
<p>It is also advisable to add code snippets within the docstrings of the classes and functions present in Python files.
These snippets show how to use the function or class that is documented, and are written in the docstrings using the
following syntax.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Examples
--------
&gt;&gt;&gt; from astropy.units import Quantity
&gt;&gt;&gt; from gammapy.data import EventList
&gt;&gt;&gt; event_list = EventList.read(&#39;events.fits&#39;) # doctest: +SKIP
</pre></div>
</div>
<p>In the case above, we could check the execution of the first two lines importing the <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> and <code class="docutils literal notranslate"><span class="pre">EventList</span></code>
modules, whilst the third line will be skipped. On the contrary, in the example below we could check the execution of
the code as well as the output value produced.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Examples
--------
&gt;&gt;&gt; from regions import Regions
&gt;&gt;&gt; regions = Regions.parse(&quot;galactic;circle(10,20,3)&quot;, format=&quot;ds9&quot;)
&gt;&gt;&gt; print(regions[0])
Region: CircleSkyRegion
center: &lt;SkyCoord (Galactic): (l, b) in deg
    (10., 20.)&gt;
radius: 3.0 deg
</pre></div>
</div>
<p>In order to perform tests of these snippets of code present in the docstrings of the Python files, you may run the
following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--ignore-glob<span class="o">=</span>*/tests<span class="w"> </span>gammapy
</pre></div>
</div>
<p>If you get a zsh error try using putting to ignore block inside quotes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span><span class="s2">&quot;--ignore-glob=*/tests&quot;</span><span class="w"> </span>gammapy
</pre></div>
</div>
</section>
</section>
<section id="sphinx-gallery-extension">
<h2>Sphinx gallery extension<a class="headerlink" href="#sphinx-gallery-extension" title="Permalink to this headline">#</a></h2>
<p>The documentation built-in process uses the <a class="reference external" href="https://sphinx-gallery.github.io/stable/">sphinx-gallery</a>
extension to build galleries of illustrated examples on how to use Gammapy (i.e.
<a class="reference internal" href="../user-guide/model-gallery/index.html#model-gallery"><span class="std std-ref">Model gallery</span></a>). The Python scripts used to produce the model gallery are placed in
<code class="docutils literal notranslate"><span class="pre">examples/models</span></code> and the configuration of the <code class="docutils literal notranslate"><span class="pre">sphinx-gallery</span></code> module is done in <code class="docutils literal notranslate"><span class="pre">docs/conf.py</span></code>.</p>
</section>
<section id="working-with-notebooks">
<h2>Working with notebooks<a class="headerlink" href="#working-with-notebooks" title="Permalink to this headline">#</a></h2>
<section id="common-tasks">
<span id="common-taks-notebooks"></span><h3>Common tasks<a class="headerlink" href="#common-tasks" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>test with tutorials env: <code class="docutils literal notranslate"><span class="pre">gammapy</span> <span class="pre">jupyter</span> <span class="pre">--src</span> <span class="pre">mynotebook.ipynb</span> <span class="pre">test</span> <span class="pre">--tutor</span></code></p></li>
<li><p>strip the output cells: <code class="docutils literal notranslate"><span class="pre">gammapy</span> <span class="pre">jupyter</span> <span class="pre">--src</span> <span class="pre">mynotebook.ipynb</span> <span class="pre">strip</span></code></p></li>
<li><p>clean format code cells: <code class="docutils literal notranslate"><span class="pre">gammapy</span> <span class="pre">jupyter</span> <span class="pre">--src</span> <span class="pre">mynotebook.ipynb</span>&#160; <span class="pre">black</span></code></p></li>
<li><p>diff stripped notebooks: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">mynotbook.pynb</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="add-a-notebook-into-a-folder-other-than-tutorials-folder">
<h3>Add a notebook into a folder other than tutorials folder<a class="headerlink" href="#add-a-notebook-into-a-folder-other-than-tutorials-folder" title="Permalink to this headline">#</a></h3>
<p>Most of the Gammapy notebooks are placed in the <code class="docutils literal notranslate"><span class="pre">tutorials</span></code> folder, and are displayed in a
<a class="reference internal" href="../tutorials/index.html#tutorials"><span class="std std-ref">Tutorials</span></a> Gallery. However, we can choose to place a notebook in a different folder of the
documentation folder structure. In this way we can write some parts of the documentation as notebooks
instead of RST files. Once we have placed the notebook in the folder we choose we can link it from the
<code class="docutils literal notranslate"><span class="pre">index.rst</span></code> file using the name of the notebook filename <strong>without the extension</strong> and the Sphinx
<code class="docutils literal notranslate"><span class="pre">toctree</span></code> directive as shown below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.. toctree::

    mynotebook
</pre></div>
</div>
</section>
<section id="skip-notebooks-from-being-executed">
<span id="skip-nb-execution"></span><h3>Skip notebooks from being executed<a class="headerlink" href="#skip-notebooks-from-being-executed" title="Permalink to this headline">#</a></h3>
<p>You may choose if a notebook is not executed during the documentation building process, and hence
it will be published without the output cells in its static HTML version. To do this you may add
the following code to the notebook metadata:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;gammapy&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;skip_run&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="choose-a-thumbnail-and-tooltip-for-the-tutorial-gallery">
<h3>Choose a thumbnail and tooltip for the tutorial gallery<a class="headerlink" href="#choose-a-thumbnail-and-tooltip-for-the-tutorial-gallery" title="Permalink to this headline">#</a></h3>
<p>The Gammapy <a class="reference internal" href="../tutorials/index.html#tutorials"><span class="std std-ref">Tutorials</span></a> are Jupyter notebooks that are displayed as a gallery with picture thumbnails and tooltips.
You can choose the thumbnail for the tutorial and add the tooltip editing the metadata of the code cell that produces
the picture that you’ve chosen. You can open the notebook in a text editor, and edit the internal code there. It may
sound risky, but it is much simpler. Then, find the code cell that produces the figure that you would like for the
gallery, and then replace the <code class="docutils literal notranslate"><span class="pre">&quot;metadata&quot;:</span> <span class="pre">{},</span></code> bit above the code cell with the snippet below:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="s2">&quot;nbsphinx-thumbnail&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;tooltip&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Learn how to do perform a Fit in gammapy.&quot;</span>
<span class="w"> </span><span class="p">}},</span>
</pre></div>
</div>
<p>Note that you may write whatever you like after “tooltip”.</p>
</section>
</section>
<section id="dealing-with-links">
<h2>Dealing with links<a class="headerlink" href="#dealing-with-links" title="Permalink to this headline">#</a></h2>
<p>All Jupyter notebooks in Gammpay documentation are converted to HTML files using
<a class="reference external" href="http://nbsphinx.readthedocs.io/">nb_sphinx</a> Sphinx extension which provides a source parser
for <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> files.</p>
<section id="links-to-notebooks">
<h3>Links to notebooks<a class="headerlink" href="#links-to-notebooks" title="Permalink to this headline">#</a></h3>
<p>From docstrings and RST documentation files in Gammapy you can link to the built fixed-text HTML formatted
versions of the notebooks and subsections providing its filename with the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file extension
and the relative path to the folder where they are placed:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>`Maps section in Gammapy overview tutorial &lt;../tutorials/overview.ipynb#Maps&gt;`__
</pre></div>
</div>
</section>
<section id="links-within-notebooks">
<h3>Links within notebooks<a class="headerlink" href="#links-within-notebooks" title="Permalink to this headline">#</a></h3>
<p>From MD cells in notebooks you can link to other notebooks, as well as to RST documentation files,
and subsections using the Markdown syntax to declare links to resources, as shown in the examples below:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="m">-</span> [Maps section in Gammapy overview tutorial](overview.ipynb#Maps)
<span class="m">-</span> [Help!](../getting-started.rst#help)
</pre></div>
</div>
<p>You can also link to the Gammapy API reference documentation using the same Sphinx syntax that is used
when writing RST files. All links to the API reference classes and methods should start with <code class="docutils literal notranslate"><span class="pre">~gammapy.</span></code>
and enclosed within quotation marks. This syntax will be translated into relative links to the API in the
HTML formatted versions of the notebooks, and to absolute links pointing to the online Gammapy documentation
in the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> notebook files available to download. During the documentation building process a warning
will be raised for each detected broken link to the API.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api-reference/maps.html#module-gammapy.maps" title="gammapy.maps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/gammapy.maps.Geom.html#gammapy.maps.Geom" title="gammapy.maps.Geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps.Geom</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/gammapy.maps.Geom.html#gammapy.maps.Geom.is_image" title="gammapy.maps.Geom.is_image"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps.Geom.is_image</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/gammapy.maps.Geom.html#gammapy.maps.Geom.is_image" title="gammapy.maps.Geom.is_image"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps.Geom.is_image()</span></code></a></p></li>
</ul>
<p>The example links above could be created within MD cells in notebooks with the syntax below:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="m">-</span> <span class="nv">`~gammapy.maps`</span>
<span class="m">-</span> <span class="nv">`~gammapy.maps.Geom`</span>
<span class="m">-</span> <span class="nv">`~gammapy.maps.Geom.is_image`</span>
<span class="m">-</span> <span class="nv">`~gammapy.maps.Geom.is_image()`</span>
</pre></div>
</div>
<p>When building the documentation of a release, the links declared in the MD cells as absolute links pointing
to the <code class="docutils literal notranslate"><span class="pre">dev</span></code> version of the online Gammapy documentation will be transformed to relative links in the built
HTML formatted notebooks and to absolute links pointing to that specific released version of the online docs
in the downloadable <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> files.</p>
</section>
<section id="check-broken-links">
<span id="dev-check-html-links"></span><h3>Check broken links<a class="headerlink" href="#check-broken-links" title="Permalink to this headline">#</a></h3>
<p>To check for broken external links from the Sphinx documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>docs<span class="p">;</span><span class="w"> </span>make<span class="w"> </span>linkcheck
</pre></div>
</div>
<p>You may also use <a class="reference external" href="https://github.com/smallhadroncollider/brok">brök</a> software, which will also check
the links present in the notebooks files.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>brok<span class="w"> </span>docs/tutorials/*.ipynb<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Failed|Could&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="include-png-files-as-images">
<h2>Include png files as images<a class="headerlink" href="#include-png-files-as-images" title="Permalink to this headline">#</a></h2>
<section id="in-jupyter-notebooks">
<h3>In Jupyter notebooks<a class="headerlink" href="#in-jupyter-notebooks" title="Permalink to this headline">#</a></h3>
<p>You may include static images in notebooks using the following markdown directive:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>![](images/my_static_image.png)
</pre></div>
</div>
<p>Please note that your images should be placed inside a <code class="xref py py-obj docutils literal notranslate"><span class="pre">images</span></code> folder, accessed with that relative
path from your notebook.</p>
</section>
<section id="in-the-rst-files">
<h3>In the RST files<a class="headerlink" href="#in-the-rst-files" title="Permalink to this headline">#</a></h3>
<p>Gammapy has a <code class="docutils literal notranslate"><span class="pre">gp-image</span></code> directive to include an image from <code class="docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/figures/</span></code>,
use the <code class="docutils literal notranslate"><span class="pre">gp-image</span></code> directive instead of the usual Sphinx <code class="docutils literal notranslate"><span class="pre">image</span></code> directive like this:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">gp-image</span><span class="p">::</span> detect/fermi_ts_image.png
    <span class="nc">:scale:</span> 100%
</pre></div>
</div>
<p>More info on the <a class="reference external" href="http://www.sphinx-doc.org/en/stable/rest.html#images">image directive</a>.</p>
</section>
</section>
<section id="documentation-guidelines">
<h2>Documentation guidelines<a class="headerlink" href="#documentation-guidelines" title="Permalink to this headline">#</a></h2>
<p>Like almost all Python projects, the Gammapy documentation is written in a format called
<a class="reference external" href="http://sphinx-doc.org/rest.html">restructured text (RST)</a> and built using <a class="reference external" href="http://sphinx-doc.org/">Sphinx</a>.
We mostly follow the <a class="reference external" href="https://docs.astropy.org/en/latest/development/docguide.html#documentation-guidelines" title="(in Astropy v5.3)"><span class="xref std std-ref">Astropy documentation guidelines</span></a>,
which are based on the <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html#docstring-standard">Numpy docstring standard</a>,
which is what most scientific Python packages use.</p>
<p>There’s a few details that are not easy to figure out by browsing the Numpy or Astropy
documentation guidelines, or that we actually do differently in Gammapy.
These are listed here so that Gammapy developers have a reference.</p>
<p>Usually the quickest way to figure out how something should be done is to browse the Astropy
or Gammapy code a bit (either locally with your editor or online on GitHub or via the HTML docs),
or search the Numpy or Astropy documentation guidelines mentioned above.
If that doesn’t quickly turn up something useful, please ask by putting a comment on the issue or
pull request you’re working on GitHub, or email the Gammapy mailing list.</p>
<section id="functions-or-class-methods-that-return-a-single-object">
<h3>Functions or class methods that return a single object<a class="headerlink" href="#functions-or-class-methods-that-return-a-single-object" title="Permalink to this headline">#</a></h3>
<p>For functions or class methods that return a single object, following the
Numpy docstring standard and adding a <em>Returns</em> section usually means
that you duplicate the one-line description and repeat the function name as
return variable name.
See <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.cosmology.LambdaCDM.html#astropy.cosmology.LambdaCDM.w" title="(in Astropy v5.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">w</span></code></a> or <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.time.Time.html#astropy.time.Time.sidereal_time" title="(in Astropy v5.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sidereal_time</span></code></a>
as examples in the Astropy codebase. Here’s a simple example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">circle_area</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circle area.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    radius : `~astropy.units.Quantity`</span>
<span class="sd">        Circle radius</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    area : `~astropy.units.Quantity`</span>
<span class="sd">        Circle area</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">3.14</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>In these cases, the following shorter format omitting the <em>Returns</em> section is recommended:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">circle_area</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circle area (`~astropy.units.Quantity`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    radius : `~astropy.units.Quantity`</span>
<span class="sd">        Circle radius</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">3.14</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Usually the parameter description doesn’t fit on the one line, so it’s
recommended to always keep this in the <em>Parameters</em> section.</p>
<p>A common case where the short format is appropriate are class properties,
because they always return a single object.
As an example see <a class="reference internal" href="../api/gammapy.data.EventList.html#gammapy.data.EventList.radec" title="gammapy.data.EventList.radec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">radec</span></code></a>, which is reproduced here:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">radec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Event RA / DEC sky coordinates (`~astropy.coordinates.SkyCoord`).&quot;&quot;&quot;</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RA&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;DEC&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="class-attributes">
<h3>Class attributes<a class="headerlink" href="#class-attributes" title="Permalink to this headline">#</a></h3>
<p>Class attributes (data members) and properties are currently a bit of a mess.
Attributes are listed in an <em>Attributes</em> section because I’ve listed them in a class-level
docstring attributes section as recommended
<a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html#docstring-standard">here</a>.
Properties are listed in separate <em>Attributes summary</em> and <em>Attributes Documentation</em>
sections, which is confusing to users (“what’s the difference between attributes and properties?”).</p>
<p>One solution is to always use properties, but that can get very verbose if we have to write
so many getters and setters. We could start using descriptors.</p>
<p>TODO: make a decision on this and describe the issue / solution here.</p>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>