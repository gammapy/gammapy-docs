
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Spectral analysis with the HLI &#8212; gammapy v1.3rc1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=203afaf9" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=e3e1e26b"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/analysis-1d/spectral_analysis_hli';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.3rc1';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="../../_static/matomo.js?v=52704cab"></script>
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Spectral analysis with energy-dependent directional cuts" href="spectral_analysis_rad_max.html" />
    <link rel="prev" title="Spectral analysis" href="spectral_analysis.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.3rc1" />
    <meta name="docbuild:last-update" content="15 Nov 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/gammapy_logo_nav.png" class="logo__image only-light" alt="gammapy v1.3rc1 - Home"/>
    <img src="../../_static/gammapy_logo_nav.png" class="logo__image only-dark pst-js-only" alt="gammapy v1.3rc1 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../development/index.html">
    Developer guide
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-square-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../development/index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-square-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../starting/overview.html">Data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_1.html">High level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_2.html">Low level API</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data/hess.html">H.E.S.S. with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/cta.html">CTAO with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/fermi_lat.html">Fermi-LAT with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/hawc.html">HAWC with Gammapy</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cta_sensitivity.html">Point source sensitivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectral_analysis.html">Spectral analysis</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Spectral analysis with the HLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectral_analysis_rad_max.html">Spectral analysis with energy-dependent directional cuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="extended_source_spectral_analysis.html">Spectral analysis of extended sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectrum_simulation.html">1D spectrum simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sed_fitting.html">Flux point fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="ebl.html">Account for spectral absorption due to the EBL</a></li>

</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/detect.html">Source detection and significance maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/ring_background.html">Ring background map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/modeling_2D.html">2D map fitting</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/analysis_3d.html">3D detailed analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/cta_data_analysis.html">Basic image exploration and fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/energy_dependent_estimation.html">Morphological energy dependence estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/analysis_mwl.html">Multi instrument joint 3D and 1D analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/simulate_3d.html">3D map simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/event_sampling.html">Event sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/event_sampling_nrg_depend_models.html">Sample a source with energy-dependent temporal evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/flux_profiles.html">Flux Profile Estimation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve.html">Light curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_flare.html">Light curves for flares</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/variability_estimation.html">Estimation of time variability in a lightcurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/time_resolved_spectroscopy.html">Time resolved spectroscopy estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_simulation.html">Simulating and fitting a time varying source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/pulsar_analysis.html">Pulsar analysis</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api/irfs.html">Using Gammapy IRFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/priors.html">Priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/astro_dark_matter.html">Dark matter spatial and spectral models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/maps.html">Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mask_maps.html">Mask maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/datasets.html">Datasets - Reduced data, IRFs, models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/makers.html">Makers - Data reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/catalog.html">Source catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/observation_clustering.html">Observational clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/model_management.html">Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/estimators.html">Estimators</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scripts/survey_map.html">Survey Map Script</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Spectral analysis with the HLI</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-analysis-1d-spectral-analysis-hli-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code. or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="spectral-analysis-with-the-hli">
<span id="sphx-glr-tutorials-analysis-1d-spectral-analysis-hli-py"></span><h1>Spectral analysis with the HLI<a class="headerlink" href="#spectral-analysis-with-the-hli" title="Link to this heading">#</a></h1>
<p>Introduction to 1D analysis using the Gammapy high level interface.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Understanding the gammapy data workflow, in particular what are DL3
events and instrument response functions (IRF).</p></li>
</ul>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading">#</a></h2>
<p>This notebook is an introduction to gammapy analysis using the high
level interface.</p>
<p>Gammapy analysis consists of two main steps.</p>
<p>The first one is data reduction: user selected observations are reduced
to a geometry defined by the user. It can be 1D (spectrum from a given
extraction region) or 3D (with a sky projection and an energy axis). The
resulting reduced data and instrument response functions (IRF) are
called datasets in Gammapy.</p>
<p>The second step consists of setting a physical model on the datasets and
fitting it to obtain relevant physical information.</p>
<p><strong>Objective: Create a 1D dataset of the Crab using the H.E.S.S. DL3 data
release 1 and perform a simple model fitting of the Crab nebula.</strong></p>
</section>
<section id="proposed-approach">
<h2>Proposed approach<a class="headerlink" href="#proposed-approach" title="Link to this heading">#</a></h2>
<p>This notebook uses the high level <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> class to orchestrate data
reduction and run the data fits. In its current state, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code>
supports the standard analysis cases of joint or stacked 3D and 1D
analyses. It is instantiated with an <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> object that
gives access to analysis parameters either directly or via a YAML config
file.</p>
<p>To see what is happening under-the-hood and to get an idea of the
internal API, a second notebook performs the same analysis without using
the <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> class.</p>
<p>In summary, we have to:</p>
<ul class="simple">
<li><p>Create an <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> object and the
analysis configuration:</p>
<ul>
<li><p>Define what observations to use</p></li>
<li><p>Define the geometry of the dataset (data and IRFs)</p></li>
<li><p>Define the model we want to fit on the dataset.</p></li>
</ul>
</li>
<li><p>Instantiate a <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> from this configuration
and run the different analysis steps</p>
<ul>
<li><p>Observation selection</p></li>
<li><p>Data reduction</p></li>
<li><p>Model fitting</p></li>
<li><p>Estimating flux points</p></li>
</ul>
</li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a>

<span class="c1"># %matplotlib inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">gammapy.analysis</span> <span class="kn">import</span> <a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class"><span class="n">Analysis</span></a><span class="p">,</span> <span class="n">AnalysisConfig</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">Models</span>
</pre></div>
</div>
</section>
<section id="check-setup">
<h2>Check setup<a class="headerlink" href="#check-setup" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.utils.check</span> <span class="kn">import</span> <span class="n">check_tutorials_setup</span>

<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/bin/python
        python_version         : 3.9.20
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 1.3rc1
        path                   : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy


Other packages:

        numpy                  : 1.26.4
        scipy                  : 1.13.1
        astropy                : 5.2.2
        regions                : 0.8
        click                  : 8.1.7
        yaml                   : 6.0.2
        IPython                : 8.18.1
        jupyterlab             : not installed
        matplotlib             : 3.9.2
        pandas                 : not installed
        healpy                 : 1.17.3
        iminuit                : 2.30.1
        sherpa                 : 4.16.1
        naima                  : 0.10.0
        emcee                  : 3.1.6
        corner                 : 2.2.2
        ray                    : 2.39.0


Gammapy environment variables:

        GAMMAPY_DATA           : /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/1.3rc1
</pre></div>
</div>
</section>
<section id="analysis-configuration">
<h2>Analysis configuration<a class="headerlink" href="#analysis-configuration" title="Link to this heading">#</a></h2>
<p>For configuration of the analysis we use the
<a class="reference external" href="https://en.wikipedia.org/wiki/YAML">YAML</a> data format. YAML is a
machine-readable serialisation format, that is also friendly for humans
to read. In this tutorial we will write the configuration file just
using Python strings, but of course the file can be created and modified
with any text editor of your choice.</p>
<p>Here is what the configuration for our analysis looks like:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">yaml_str</span></a> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">observations:</span>
<span class="s2">    datastore: $GAMMAPY_DATA/hess-dl3-dr1</span>
<span class="s2">    obs_cone: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 5 deg}</span>

<span class="s2">datasets:</span>
<span class="s2">    type: 1d</span>
<span class="s2">    stack: true</span>
<span class="s2">    geom:</span>
<span class="s2">        axes:</span>
<span class="s2">            energy: {min: 0.5 TeV, max: 30 TeV, nbins: 20}</span>
<span class="s2">            energy_true: {min: 0.1 TeV, max: 50 TeV, nbins: 40}</span>
<span class="s2">    on_region: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 0.11 deg}</span>
<span class="s2">    containment_correction: true</span>
<span class="s2">    safe_mask:</span>
<span class="s2">       methods: [&#39;aeff-default&#39;, &#39;aeff-max&#39;]</span>
<span class="s2">       parameters: </span><span class="si">{aeff_percent: 0.1}</span>
<span class="s2">    background:</span>
<span class="s2">        method: reflected</span>
<span class="s2">fit:</span>
<span class="s2">    fit_range: {min: 1 TeV, max: 20 TeV}</span>

<span class="s2">flux_points:</span>
<span class="s2">    energy: {min: 1 TeV, max: 20 TeV, nbins: 8}</span>
<span class="s2">    source: &#39;crab&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.from_yaml" title="gammapy.analysis.AnalysisConfig.from_yaml" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">AnalysisConfig</span><span class="o">.</span><span class="n">from_yaml</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">yaml_str</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>AnalysisConfig

    general:
        log:
            level: info
            filename: null
            filemode: null
            format: null
            datefmt: null
        outdir: .
        n_jobs: 1
        datasets_file: null
        models_file: null
    observations:
        datastore: /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/1.3rc1/hess-dl3-dr1
        obs_ids: []
        obs_file: null
        obs_cone:
            frame: icrs
            lon: 83.633 deg
            lat: 22.014 deg
            radius: 5.0 deg
        obs_time:
            start: null
            stop: null
        required_irf:
        - aeff
        - edisp
        - psf
        - bkg
    datasets:
        type: 1d
        stack: true
        geom:
            wcs:
                skydir:
                    frame: null
                    lon: null
                    lat: null
                binsize: 0.02 deg
                width:
                    width: 5.0 deg
                    height: 5.0 deg
                binsize_irf: 0.2 deg
            selection:
                offset_max: 2.5 deg
            axes:
                energy:
                    min: 0.5 TeV
                    max: 30.0 TeV
                    nbins: 20
                energy_true:
                    min: 0.1 TeV
                    max: 50.0 TeV
                    nbins: 40
        map_selection:
        - counts
        - exposure
        - background
        - psf
        - edisp
        background:
            method: reflected
            exclusion: null
            parameters: {}
        safe_mask:
            methods:
            - aeff-default
            - aeff-max
            parameters:
                aeff_percent: 0.1
        on_region:
            frame: icrs
            lon: 83.633 deg
            lat: 22.014 deg
            radius: 0.11 deg
        containment_correction: true
    fit:
        fit_range:
            min: 1.0 TeV
            max: 20.0 TeV
    flux_points:
        energy:
            min: 1.0 TeV
            max: 20.0 TeV
            nbins: 8
        source: crab
        parameters:
            selection_optional: all
    excess_map:
        correlation_radius: 0.1 deg
        parameters: {}
        energy_edges:
            min: null
            max: null
            nbins: null
    light_curve:
        time_intervals:
            start: null
            stop: null
        energy_edges:
            min: null
            max: null
            nbins: null
        source: source
        parameters:
            selection_optional: all
    metadata:
        creator: Gammapy 1.3rc1
        date: &#39;2024-11-15T15:54:57.860352&#39;
        origin: null
</pre></div>
</div>
<p>Note that you can save this string into a yaml file and load it as
follow:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># config = AnalysisConfig.read(&quot;config-1d.yaml&quot;)</span>
<span class="c1"># # the AnalysisConfig gives access to the various parameters used from logging to reduced dataset geometries</span>
<span class="c1"># print(config)</span>
</pre></div>
</div>
<section id="using-data-stored-into-your-computer">
<h3>Using data stored into your computer<a class="headerlink" href="#using-data-stored-into-your-computer" title="Link to this heading">#</a></h3>
<p>Here, we want to use Crab runs from the H.E.S.S. DL3-DR1. We have
defined the datastore and a cone search of observations pointing with 5
degrees of the Crab nebula. Parameters can be set directly or as a
python dict.</p>
<p>PS: do not forget to set up your environment variable <code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA</span></code> to
your local directory containing the H.E.S.S. DL3-DR1 as described in
<a class="reference internal" href="../../getting-started/quickstart.html#quickstart-setup"><span class="std std-ref">Recommended Setup</span></a>.</p>
</section>
<section id="setting-the-exclusion-mask">
<h3>Setting the exclusion mask<a class="headerlink" href="#setting-the-exclusion-mask" title="Link to this heading">#</a></h3>
<p>In order to properly adjust the background normalisation on regions
without gamma-ray signal, one needs to define an exclusion mask for the
background normalisation. For this tutorial, we use the following one
<code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/joint-crab/exclusion/exclusion_mask_crab.fits.gz</span></code></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">exclusion</span></a> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/joint-crab/exclusion/exclusion_mask_crab.fits.gz&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We’re all set. But before we go on let’s see how to save or import
<a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> objects though YAML files.</p>
</section>
<section id="using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters">
<h3>Using YAML configuration files for setting/writing the Data Reduction parameters<a class="headerlink" href="#using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters" title="Link to this heading">#</a></h3>
<p>One can export/import the <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> to/from a YAML file.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.write" title="gammapy.analysis.AnalysisConfig.write" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">config</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.read" title="gammapy.analysis.AnalysisConfig.read" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">AnalysisConfig</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>AnalysisConfig

    general:
        log:
            level: info
            filename: null
            filemode: null
            format: null
            datefmt: null
        outdir: .
        n_jobs: 1
        datasets_file: null
        models_file: null
    observations:
        datastore: /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/1.3rc1/hess-dl3-dr1
        obs_ids: []
        obs_file: null
        obs_cone:
            frame: icrs
            lon: 83.633 deg
            lat: 22.014 deg
            radius: 5.0 deg
        obs_time:
            start: null
            stop: null
        required_irf:
        - aeff
        - edisp
        - psf
        - bkg
    datasets:
        type: 1d
        stack: true
        geom:
            wcs:
                skydir:
                    frame: null
                    lon: null
                    lat: null
                binsize: 0.02 deg
                width:
                    width: 5.0 deg
                    height: 5.0 deg
                binsize_irf: 0.2 deg
            selection:
                offset_max: 2.5 deg
            axes:
                energy:
                    min: 0.5 TeV
                    max: 30.0 TeV
                    nbins: 20
                energy_true:
                    min: 0.1 TeV
                    max: 50.0 TeV
                    nbins: 40
        map_selection:
        - counts
        - exposure
        - background
        - psf
        - edisp
        background:
            method: reflected
            exclusion: /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/1.3rc1/joint-crab/exclusion/exclusion_mask_crab.fits.gz
            parameters: {}
        safe_mask:
            methods:
            - aeff-default
            - aeff-max
            parameters:
                aeff_percent: 0.1
        on_region:
            frame: icrs
            lon: 83.633 deg
            lat: 22.014 deg
            radius: 0.11 deg
        containment_correction: true
    fit:
        fit_range:
            min: 1.0 TeV
            max: 20.0 TeV
    flux_points:
        energy:
            min: 1.0 TeV
            max: 20.0 TeV
            nbins: 8
        source: crab
        parameters:
            selection_optional: all
    excess_map:
        correlation_radius: 0.1 deg
        parameters: {}
        energy_edges:
            min: null
            max: null
            nbins: null
    light_curve:
        time_intervals:
            start: null
            stop: null
        energy_edges:
            min: null
            max: null
            nbins: null
        source: source
        parameters:
            selection_optional: all
    metadata:
        creator: Gammapy 1.3rc1
        date: &#39;2024-11-15T15:54:57.884238&#39;
        origin: null
</pre></div>
</div>
</section>
</section>
<section id="running-the-first-step-of-the-analysis-the-data-reduction">
<h2>Running the first step of the analysis: the Data Reduction<a class="headerlink" href="#running-the-first-step-of-the-analysis-the-data-reduction" title="Link to this heading">#</a></h2>
<section id="configuration-of-the-analysis">
<h3>Configuration of the analysis<a class="headerlink" href="#configuration-of-the-analysis" title="Link to this heading">#</a></h3>
<p>We first create an <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> object from our
configuration.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class"><span class="n">Analysis</span></a><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="observation-selection">
<h3>Observation selection<a class="headerlink" href="#observation-selection" title="Link to this heading">#</a></h3>
<p>We can directly select and load the observations from disk using
<a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_observations" title="gammapy.analysis.Analysis.get_observations"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_observations()</span></code></a>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_observations" title="gammapy.analysis.Analysis.get_observations" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_observations</span></a><span class="p">()</span>
</pre></div>
</div>
<p>The observations are now available on the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code> object. The
selection corresponds to the following ids:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.data.Observations.html#gammapy.data.Observations.ids" title="gammapy.data.Observations.ids" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-attribute"><span class="n">analysis</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">ids</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;23523&#39;, &#39;23526&#39;, &#39;23559&#39;, &#39;23592&#39;]
</pre></div>
</div>
<p>To see how to explore observations, please refer to the following
notebook: <a class="reference internal" href="../data/cta.html"><span class="doc">CTAO with Gammapy</span></a> or <a class="reference internal" href="../data/hess.html"><span class="doc">H.E.S.S. with Gammapy</span></a></p>
</section>
<section id="running-the-data-reduction">
<h3>Running the Data Reduction<a class="headerlink" href="#running-the-data-reduction" title="Link to this heading">#</a></h3>
<p>Now we proceed to the data reduction. In the config file we have chosen
a WCS map geometry, energy axis and decided to stack the maps. We can
run the reduction using <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_datasets" title="gammapy.analysis.Analysis.get_datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_datasets()</span></code></a>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_datasets" title="gammapy.analysis.Analysis.get_datasets" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_datasets</span></a><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="results-exploration">
<h3>Results exploration<a class="headerlink" href="#results-exploration" title="Link to this heading">#</a></h3>
<p>As we have chosen to stack the data, one can print what contains the
unique entry of the datasets:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SpectrumDatasetOnOff
--------------------

  Name                            : stacked

  Total counts                    : 427
  Total background counts         : 25.86
  Total excess counts             : 401.14

  Predicted counts                : 43.14
  Predicted background counts     : 43.14
  Predicted excess counts         : nan

  Exposure min                    : 2.90e+07 m2 s
  Exposure max                    : 2.64e+09 m2 s

  Number of total bins            : 20
  Number of fit bins              : 18

  Fit statistic type              : wstat
  Fit statistic value (-2 log(L)) : 1396.10

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0

  Total counts_off                : 581
  Acceptance                      : 70
  Acceptance off                  : 1756
</pre></div>
</div>
<p>As you can see the dataset uses WStat with the background computed with
the Reflected Background method during the data reduction, but no source
model has been set yet.</p>
<p>The counts, exposure and background, etc are directly available on the
dataset and can be printed:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.info_table" title="gammapy.datasets.Datasets.info_table" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">info_table</span></a><span class="p">()</span>
<a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Tobs=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;livetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Excess=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;excess&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">Significance=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Tobs=1.8 h Excess=401.1 Significance=37.04
</pre></div>
</div>
</section>
<section id="save-dataset-to-disk">
<h3>Save dataset to disk<a class="headerlink" href="#save-dataset-to-disk" title="Link to this heading">#</a></h3>
<p>It is common to run the preparation step independent of the likelihood
fit, because often the preparation of counts, collection are and energy
dispersion is slow if you have a lot of data. We first create a folder:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a><span class="p">(</span><span class="s2">&quot;hli_spectrum_analysis&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir" title="pathlib.Path.mkdir" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-method"><span class="n">path</span><span class="o">.</span><span class="n">mkdir</span></a><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>And then write the stacked dataset to disk by calling the dedicated
<code class="xref py py-obj docutils literal notranslate"><span class="pre">write()</span></code> method:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;crab-stacked-dataset.fits.gz&quot;</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.write" title="gammapy.datasets.Datasets.write" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="model-fitting">
<h2>Model fitting<a class="headerlink" href="#model-fitting" title="Link to this heading">#</a></h2>
<section id="creation-of-the-model">
<h3>Creation of the model<a class="headerlink" href="#creation-of-the-model" title="Link to this heading">#</a></h3>
<p>First, let’s create a model to be adjusted. As we are performing a 1D
Analysis, only a spectral model is needed within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code>
object. Here is a pre-defined YAML configuration file created for this
1D analysis:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_str</span></a> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">components:</span>
<span class="s2">- name: crab</span>
<span class="s2">  type: SkyModel</span>
<span class="s2">  spectral:</span>
<span class="s2">    type: PowerLawSpectralModel</span>
<span class="s2">    parameters:</span>
<span class="s2">      - name: index</span>
<span class="s2">        frozen: false</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: &#39;&#39;</span>
<span class="s2">        value: 2.6</span>
<span class="s2">      - name: amplitude</span>
<span class="s2">        frozen: false</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: cm-2 s-1 TeV-1</span>
<span class="s2">        value: 5.0e-11</span>
<span class="s2">      - name: reference</span>
<span class="s2">        frozen: true</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: TeV</span>
<span class="s2">        value: 1.0</span>
<span class="s2">&quot;&quot;&quot;</span>
<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.from_yaml" title="gammapy.modeling.models.Models.from_yaml" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">Models</span><span class="o">.</span><span class="n">from_yaml</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_str</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Models

Component 0: SkyModel

  Name                      : crab
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       :
  Temporal model type       :
  Parameters:
    index                         :      2.600   +/-    0.00
    amplitude                     :   5.00e-11   +/- 0.0e+00 1 / (cm2 s TeV)
    reference             (frozen):      1.000       TeV
</pre></div>
</div>
<p>Or from a yaml file, e.g.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># model_1d = Models.read(&quot;model-1d.yaml&quot;)</span>
<span class="c1"># print(model_1d)</span>
</pre></div>
</div>
<p>Now we set the model on the analysis object:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.set_models" title="gammapy.analysis.Analysis.set_models" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">set_models</span></a><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setting-fitting-parameters">
<h3>Setting fitting parameters<a class="headerlink" href="#setting-fitting-parameters" title="Link to this heading">#</a></h3>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code> can perform a few modeling and fitting tasks besides data
reduction. Parameters have then to be passed to the configuration
object.</p>
</section>
<section id="running-the-fit">
<h3>Running the fit<a class="headerlink" href="#running-the-fit" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.run_fit" title="gammapy.analysis.Analysis.run_fit" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">run_fit</span></a><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="exploration-of-the-fit-results">
<h3>Exploration of the fit results<a class="headerlink" href="#exploration-of-the-fit-results" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.FitResult.html#gammapy.modeling.FitResult" title="gammapy.modeling.FitResult" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">fit_result</span></a><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.to_parameters_table" title="gammapy.modeling.models.Models.to_parameters_table" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">model_1d</span><span class="o">.</span><span class="n">to_parameters_table</span></a><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>OptimizeResult

        backend    : minuit
        method     : migrad
        success    : True
        message    : Optimization terminated successfully.
        nfev       : 37
        total stat : 10.29

CovarianceResult

        backend    : minuit
        method     : hesse
        success    : True
        message    : Hesse terminated successfully.

model type    name     value         unit      ... min max frozen link prior
----- ---- --------- ---------- -------------- ... --- --- ------ ---- -----
 crab          index 2.6768e+00                ... nan nan  False
 crab      amplitude 4.6795e-11 cm-2 s-1 TeV-1 ... nan nan  False
 crab      reference 1.0000e+00            TeV ... nan nan   True
</pre></div>
</div>
<p>To check the fit is correct, we compute the excess spectrum with the
predicted counts.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_spectrum</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_residuals</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_spectrum</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_spectrum</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_residuals</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_001.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_001.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="serialisation-of-the-fit-result">
<h3>Serialisation of the fit result<a class="headerlink" href="#serialisation-of-the-fit-result" title="Link to this heading">#</a></h3>
<p>This is how we can write the model back to file again:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;model-best-fit.yaml&quot;</span>
<a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.models" title="gammapy.analysis.Analysis.models" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-attribute"><span class="n">analysis</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.open" title="pathlib.Path.open" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-method"><span class="n">filename</span><span class="o">.</span><span class="n">open</span></a><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="io.TextIOWrapper" class="sphx-glr-backref-module-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">f</span></a><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="io.TextIOWrapper" class="sphx-glr-backref-module-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">f</span></a><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>components:
-   name: crab
    type: SkyModel
    spectral:
        type: PowerLawSpectralModel
        parameters:
        -   name: index
            value: 2.6768369882260035
            error: 0.1035002116788955
        -   name: amplitude
            value: 4.679478008080033e-11
            unit: cm-2 s-1 TeV-1
            error: 4.678683717532289e-12
        -   name: reference
            value: 1.0
            unit: TeV
covariance: model-best-fit_covariance.dat
metadata:
    creator: Gammapy 1.3rc1
    date: &#39;2024-11-15T15:55:01.300000&#39;
    origin: null
</pre></div>
</div>
</section>
</section>
<section id="creation-of-the-flux-points">
<h2>Creation of the Flux points<a class="headerlink" href="#creation-of-the-flux-points" title="Link to this heading">#</a></h2>
<section id="running-the-estimation">
<h3>Running the estimation<a class="headerlink" href="#running-the-estimation" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_flux_points" title="gammapy.analysis.Analysis.get_flux_points" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_flux_points</span></a><span class="p">()</span>

<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">data</span></a>
<a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp_table</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.to_table" title="gammapy.estimators.FluxPoints.to_table" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">to_table</span></a><span class="p">(</span><span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;dnde&quot;</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp_table</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>e_ref  e_min  e_max        dnde      ... is_ul counts success   norm_scan
 TeV    TeV    TeV   1 / (cm2 s TeV) ...
------ ------ ------ --------------- ... ----- ------ ------- --------------
 1.134  0.924  1.392       2.835e-11 ... False   56.0    True 0.200 .. 5.000
 1.708  1.392  2.096       1.193e-11 ... False  102.0    True 0.200 .. 5.000
 2.572  2.096  3.156       4.325e-12 ... False   71.0    True 0.200 .. 5.000
 3.873  3.156  4.753       1.002e-12 ... False   31.0    True 0.200 .. 5.000
 5.833  4.753  7.158       4.655e-13 ... False   24.0    True 0.200 .. 5.000
 7.929  7.158  8.784       1.527e-13 ... False    6.0    True 0.200 .. 5.000
10.779  8.784 13.228       9.692e-14 ... False   11.0    True 0.200 .. 5.000
16.233 13.228 19.921       1.523e-14 ... False    3.0    True 0.200 .. 5.000
</pre></div>
</div>
<p>Let’s plot the flux points with their likelihood profile</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">()</span>
<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.plot" title="gammapy.estimators.FluxPoints.plot" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;e2dnde&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">1.0e-12</span><span class="p">,</span> <span class="mf">2.0e-10</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.plot_ts_profiles" title="gammapy.estimators.FluxPoints.plot_ts_profiles" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">plot_ts_profiles</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;e2dnde&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_002.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_002.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="serialisation-of-the-results">
<h3>Serialisation of the results<a class="headerlink" href="#serialisation-of-the-results" title="Link to this heading">#</a></h3>
<p>The flux points can be exported to a fits table following the format
defined
<a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/spectra/flux_points/index.html">here</a></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;flux-points.fits&quot;</span>
<a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.write" title="gammapy.datasets.FluxPointsDataset.write" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="plotting-the-final-results-of-the-1d-analysis">
<h2>Plotting the final results of the 1D Analysis<a class="headerlink" href="#plotting-the-final-results-of-the-1d-analysis" title="Link to this heading">#</a></h2>
<p>We can plot of the spectral fit with its error band overlaid with the
flux points:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_residuals</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.plot_fit" title="gammapy.datasets.FluxPointsDataset.plot_fit" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">plot_fit</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">1.0e-12</span><span class="p">,</span> <span class="mf">1.0e-9</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_003.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_003.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="whats-next">
<h2>What’s next?<a class="headerlink" href="#whats-next" title="Link to this heading">#</a></h2>
<p>You can look at the same analysis without the high level interface in
<a class="reference internal" href="spectral_analysis.html"><span class="doc">Spectral analysis</span></a></p>
<p>As we can store the best model fit, you can overlay the fit results of
both methods on a unique plot.</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-analysis-1d-spectral-analysis-hli-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/v1.3rc1?urlpath=lab/tree/notebooks/1.3rc1/tutorials/analysis-1d/spectral_analysis_hli.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo.svg" style="width: 150px;" />
</a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9881fc418a8ff65abb21b42cdd40a75d/spectral_analysis_hli.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">spectral_analysis_hli.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/409b56028ef9cfd36f43c590e76e483f/spectral_analysis_hli.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">spectral_analysis_hli.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/cbf21326239e0fa794d51e4515e770f5/spectral_analysis_hli.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">spectral_analysis_hli.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-approach">Proposed approach</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-setup">Check setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-configuration">Analysis configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-data-stored-into-your-computer">Using data stored into your computer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-the-exclusion-mask">Setting the exclusion mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters">Using YAML configuration files for setting/writing the Data Reduction parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-first-step-of-the-analysis-the-data-reduction">Running the first step of the analysis: the Data Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-of-the-analysis">Configuration of the analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observation-selection">Observation selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-data-reduction">Running the Data Reduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-exploration">Results exploration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-dataset-to-disk">Save dataset to disk</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-fitting">Model fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-of-the-model">Creation of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-fitting-parameters">Setting fitting parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-fit">Running the fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-the-fit-results">Exploration of the fit results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serialisation-of-the-fit-result">Serialisation of the fit result</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-of-the-flux-points">Creation of the Flux points</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-estimation">Running the estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serialisation-of-the-results">Serialisation of the results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-final-results-of-the-1d-analysis">Plotting the final results of the 1D Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#whats-next">What’s next?</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/tutorials/analysis-1d/spectral_analysis_hli.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
    
     <a href="https://gammapy.org/DataPrivacy.html">Data Privacy.</a>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item"><p class="last-updated">
  Last updated on 15 Nov 2024.
  <br/>
</p></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>