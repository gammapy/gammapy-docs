
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PIG 14 - Uncertainty estimation &#8212; gammapy vX.Y.Z</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PIG 16 - Gammapy package structure" href="pig-016.html" />
    <link rel="prev" title="PIG 13 - Gammapy dependencies and distribution" href="pig-013.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user-guide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables development/pigs/pig-014 and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "development/pigs/pig-014.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "development/pigs/pig-014.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.2.dev237+gee7eb2837 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../setup.html">
   Project setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dependencies.html">
   Dependencies
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   How to contribute to Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../release.html">
   How to make a Gammapy release
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../doc_howto.html">
   Documentation How To
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dev_howto.html">
   Developer How To
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   PIGs
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pig-001.html">
     PIG 1 - PIG purpose and guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-002.html">
     PIG 2 - Organization of low level analysis code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-003.html">
     PIG 3 - Plan for dropping Python 2.7 support
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-004.html">
     PIG 4 - Setup for tutorial notebooks and data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-005.html">
     PIG 5 - Gammapy 1.0 roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-006.html">
     PIG 6 - CTA observation handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-007.html">
     PIG 7 - Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-008.html">
     PIG 8 - Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-009.html">
     PIG 9 - Event sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-010.html">
     PIG 10 - Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-011.html">
     PIG 11 - Light curves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-012.html">
     PIG 12 - High level interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-013.html">
     PIG 13 - Gammapy dependencies and distribution
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     PIG 14 - Uncertainty estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-016.html">
     PIG 16 - Gammapy package structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-018.html">
     PIG 18 - Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-019.html">
     PIG 19 - Gammapy package structure follow up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-020.html">
     PIG 20 - Global Model API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-021.html">
     PIG 21 - Models improvements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-022.html">
     PIG 22 - Unified flux estimators API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-023.html">
     PIG 23 - Gammapy release cycle and version numbering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-024.html">
     PIG 24 - Authorship policy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-025.html">
     PIG 25 - Metadata container for Gammapy
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#abstract">
   Abstract
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#proposal">
   Proposal
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#alternatives">
   Alternatives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decision">
   Decision
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="pig-14-uncertainty-estimation">
<span id="pig-014"></span><h1>PIG 14 - Uncertainty estimation<a class="headerlink" href="#pig-14-uncertainty-estimation" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Author: Christoph Deil, Axel Donath, Quentin Rémy, Fabio Acero</p></li>
<li><p>Created: June 20, 2019</p></li>
<li><p>Accepted: Nov 19, 2019</p></li>
<li><p>Status: accepted</p></li>
<li><p>Discussion: <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2255">GH 2255</a></p></li>
</ul>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">#</a></h2>
<p>Currently Gammapy uses the <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a> package to do error propagation for
differential and integral flux of spectral models, e.g. to compute spectral
model error bands. This is cumbersome since <code class="docutils literal notranslate"><span class="pre">uncertainties</span></code> doesn’t support
<code class="docutils literal notranslate"><span class="pre">astropy.units.Quantity</span></code> (which we currently use in spectral model
evaluation), and doesn’t work at all for some spectral models (e.g. EBL
absorption and Naima), since <code class="docutils literal notranslate"><span class="pre">uncertainties</span></code> uses autodiff and needs explicit
support for any Numpy, Scipy, Astropy, … function involved.</p>
<p>We propose to replace this with a custom uncertainty propagation implementation
using finite differences. This will be less precise and slower than
<code class="docutils literal notranslate"><span class="pre">uncertainties</span></code>, but it will work for any derived quantity and code that we
call, and any spectral model.</p>
<p>We also propose to add support for a second method to propagate uncertainty from
fit parameters to derived quantities, based on parameter samples. This is the
standard technique in MCMC Bayesian analyses, but it can be used as well for
normal likelihood analyses.</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>In Gammapy, <code class="docutils literal notranslate"><span class="pre">gammapy.modeling</span></code> and specifically the <code class="docutils literal notranslate"><span class="pre">gammapy.modeling.Fit</span></code>
class support likelihood fitting to determine best-fit parameters, and to obtain
a covariance matrix that represents parameter uncertainties and correlations.
Parameter standard errors are obtained as the square root of the elements on the
diagonal of the covariance matrix (see e.g. <a class="reference external" href="http://lmu.web.psi.ch/docu/manuals/software_manuals/minuit2/mnerror.pdf">The interpretation of errors</a>).
Asymmetric errors and confidence intervals can be obtained via likelihood
profile shape analysis, using methods on the <code class="docutils literal notranslate"><span class="pre">gammapy.modeling.Fit</span></code> class,
partially re-implementing, partially calling the methods available in Minuit or
Sherpa (see e.g. <a class="reference external" href="http://conference.scipy.org/proceedings/scipy2011/pdfs/brefsdal.pdf">Fitting and Estimating Parameter Confidence Limits with
Sherpa</a>).</p>
<p>However, often one is interested not directly in a model parameter, but instead
in a derived quantity that depends on multiple model parameters. Typical
examples are that users want to compute errors or confidence intervals on
quantities like differential or integral flux at or above certain energies, or
location or extension of sources, from spectral and spatial model fits.</p>
<p>Here we will discuss two standard techniques to compute such uncertaintes:</p>
<ol class="arabic simple">
<li><p>Differentials (see <a class="reference external" href="https://en.wikipedia.org/wiki/Propagation_of_uncertainty">Wikipedia - Propagation of uncertainty</a> or <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a>)</p></li>
<li><p>Monte carlo (MC) samples (see <a class="reference external" href="https://pypi.org/project/mcerp/">mcerp</a> or <a class="reference external" href="https://docs.astropy.org/en/stable/uncertainty/index.html">astropy.uncertainty</a>)</p></li>
</ol>
<p>If you’re not familiar with the techniques, here’s a few references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/pdf/1009.2755.pdf">Error estimation in astronomy - A guide</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/pdf/1411.5018.pdf">Frequentism and Bayesianism - A Python-driven Primer</a></p></li>
</ul>
<p>In Gammapy we currently use the <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a> package to propagate errors to
differential fluxes <code class="docutils literal notranslate"><span class="pre">spectral_model.evaluate_error</span></code> and integral fluxes
<code class="docutils literal notranslate"><span class="pre">spectral_model.integral_error</span></code>. The <code class="docutils literal notranslate"><span class="pre">evaluate_error</span></code> method is called for
an array of energies in <code class="docutils literal notranslate"><span class="pre">plot_error</span></code>, which is used to compute and plot
spectral model error bands (see e.g. the <a class="reference external" href="https://docs.gammapy.org/0.14/notebooks/sed_fitting_gammacat_fermi.html">SED fitting tutorial</a>) It is using
autodiff to compute differentials of derived quantities wrt. model parameters,
which is accurate and fast where it works. However, <code class="docutils literal notranslate"><span class="pre">uncertainties</span></code> doesn’t
support <code class="docutils literal notranslate"><span class="pre">astropy.units.Quantity</span></code>, making the current spectral model flux
evaluation very convoluted, and it doesn’t work at all for some spectral models,
namely non-analytical models like EBL absoption or Naima cosmic ray spectral
models, which has been a frequent complaint by users (see <a class="reference external" href="https://github.com/gammapy/gammapy/issues/1046">GH 1046</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/2007">GH
2007</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/2190">GH 2190</a>).</p>
<p>The MC sample method is most commonly used for Bayesian analysis, where the
model fit directly results in a sample set that represents the parameter
posterior probability distribution. A prototype example for that kind of
analysis has been implemented in the <a class="reference external" href="https://docs.gammapy.org/0.12/notebooks/mcmc_sampling.html">MCMC Gammapy tutorial</a> notebook. However,
the MC sample error propagation technique can be applied in classical
frequentist statistical analysis as well, if one considers it a numerical
technique to avoid having to compute differentials, and instead samples a
multivariate normal according to the best-fit parameters and covariance matrix,
and then propagates the samples. One can scale the covariance matrix to only
sample near the best-fit parameters and thus should be able to reproduce the
differential method (within sampling noise).</p>
</section>
<section id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline">#</a></h2>
<p>We propose to change the <code class="docutils literal notranslate"><span class="pre">SpectralModel.evaluate_error</span></code> implementation to a
custom differential based error propagation, as shown in the  <a class="reference external" href="https://github.com/gammapy/gammapy-extra/blob/master/experiments/uncertainty_estimation_prototype.ipynb">Gammapy
uncertainty propagation prototype notebook</a>. This allows us to completely
remove the use of <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a> within Gammapy, and to simplify the spectral
model evaluation code. This will be a bit slower and less accurate than the
current method, but it is a “black box” technique that will work for any
spectral method or code that we call.</p>
<p>In the future we think that using an autodiff solution could be useful, not just
for error propagation, but also for likelihood optimisation. It’s unlikely that
we’d use <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a> though, rather we’d probably use <a class="reference external" href="https://github.com/HIPS/autograd">autograd</a> or <a class="reference external" href="https://github.com/google/jax">jax</a>
or even Tensorflow or PyTorch or Chainer or some other modern array computing
package that supports autograd. So we think removing <code class="docutils literal notranslate"><span class="pre">uncertainties</span></code> now and
cleaning up or model evaluation code is a good step, even if we want to change
to some other framework later.</p>
<p>We also propose to add a method to generate parameter samples from the best-fit
parameters and covariance, and to support MC error propagation. See  <a class="reference external" href="https://github.com/gammapy/gammapy-extra/blob/master/experiments/uncertainty_estimation_prototype.ipynb">Gammapy
uncertainty propagation prototype notebook</a>. This second part could be done
before or after the v1.0 release, it’s independent of the first proposed change.
The first step would be to add a test and improve the code of MC sampling
interface (see <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2304">GH 2304</a>). Then probably we should add a <code class="docutils literal notranslate"><span class="pre">Distribution</span></code>
object from <a class="reference external" href="https://docs.astropy.org/en/stable/uncertainty/index.html">astropy.uncertainty</a> to <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> or to a new <code class="docutils literal notranslate"><span class="pre">FitMC</span></code> class
to store samples from MC analysis, or multinormal samples from the covariance
matrix. And then possibly support for such objects in model evaluation and
derived quantities. Another option could be to add support for “model sets” as
in <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> to support arrays of parameter values within one model
object, or to directly change <code class="docutils literal notranslate"><span class="pre">gammapy.modeling</span></code> to be based on
<code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code>. As you can see, this second part of the proposal is a wish
that Gammapy support MC sample based error propagation, the implementation is
something to be prototyped and worked out in the future (could be now and for
v1.0, or any time later).</p>
</section>
<section id="alternatives">
<h2>Alternatives<a class="headerlink" href="#alternatives" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Support only sample-based uncertainty propagation (like e.g. PyMC or 3ML)</p></li>
<li><p>Support only differential uncertainty propagation (like e.g. Minuit)</p></li>
<li><p>Keep everything as-is, use <a class="reference external" href="http://pythonhosted.org/uncertainties/">uncertainties</a></p></li>
<li><p>Change to another autograd package like <code class="docutils literal notranslate"><span class="pre">autograd</span></code> or <code class="docutils literal notranslate"><span class="pre">jax</span></code></p></li>
</ul>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">#</a></h2>
<p>This proposal was discussed extensively on GitHub (<a class="reference external" href="https://github.com/gammapy/gammapy/pull/2255">GH 2255</a>), and also
in-person at the Gammapy coding sprint in Nov 2019. The exact mechanism and
implementation for uncertainty propagation needs to be worked out (see the
prototype notebook), this will happen at the coding sprint later this week.
There were no objections to this proposal received, so it’s accepted.</p>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>