
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PIG 16 - Gammapy package structure &#8212; gammapy vX.Y.Z</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PIG 18 - Documentation" href="pig-018.html" />
    <link rel="prev" title="PIG 14 - Uncertainty estimation" href="pig-014.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user-guide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables development/pigs/pig-016 and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "development/pigs/pig-016.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "development/pigs/pig-016.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.1.dev1020+gb1b9a4a52 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../setup.html">
   Project setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dependencies.html">
   Dependencies
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   How to contribute to Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../release.html">
   How to make a Gammapy release
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../doc_howto.html">
   Documentation How To
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dev_howto.html">
   Developer How To
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   PIGs
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pig-001.html">
     PIG 1 - PIG purpose and guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-002.html">
     PIG 2 - Organization of low level analysis code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-003.html">
     PIG 3 - Plan for dropping Python 2.7 support
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-004.html">
     PIG 4 - Setup for tutorial notebooks and data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-005.html">
     PIG 5 - Gammapy 1.0 roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-006.html">
     PIG 6 - CTA observation handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-007.html">
     PIG 7 - Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-008.html">
     PIG 8 - Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-009.html">
     PIG 9 - Event sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-010.html">
     PIG 10 - Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-011.html">
     PIG 11 - Light curves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-012.html">
     PIG 12 - High level interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-013.html">
     PIG 13 - Gammapy dependencies and distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-014.html">
     PIG 14 - Uncertainty estimation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     PIG 16 - Gammapy package structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-018.html">
     PIG 18 - Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-019.html">
     PIG 19 - Gammapy package structure follow up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-020.html">
     PIG 20 - Global Model API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-021.html">
     PIG 21 - Models improvements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-022.html">
     PIG 22 - Unified flux estimators API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-023.html">
     PIG 23 - Gammapy release cycle and version numbering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pig-024.html">
     PIG 24 - Authorship policy
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#abstract">
   Abstract
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#status">
   Status
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#proposal">
   Proposal
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduce-gammapy-modeling">
     Introduce gammapy.modeling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dissolve-gammapy-background">
     Dissolve gammapy.background
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dissolve-gammapy-image">
     Dissolve gammapy.image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clean-up-gammapy-utils">
     Clean up gammapy.utils
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outlook">
   Outlook
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decision">
   Decision
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="pig-16-gammapy-package-structure">
<span id="pig-016"></span><h1>PIG 16 - Gammapy package structure<a class="headerlink" href="#pig-16-gammapy-package-structure" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Author: Christoph Deil, Axel Donath, Régis Terrier</p></li>
<li><p>Created: Jul 5, 2019</p></li>
<li><p>Accepted: Aug 18, 2019</p></li>
<li><p>Status: accepted</p></li>
<li><p>Discussion: <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2274">GH 2274</a></p></li>
</ul>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">#</a></h2>
<p>Gammapy is currently (as of v0.13 in July 2019) structured into 14 sub-packages.
Six of those are further structured into sub-sub-packages: utils, spectrum,
image, cube, astro, time. Here we show the structure of the Gammapy package and
consider possible changes to improve it.</p>
<p>For Gammapy v0.14 in September 2019 (and same for v1.0), we propose the
following changes:</p>
<ul class="simple">
<li><p>move gammapy.utils.fitting to gammapy.modeling, and to move all models from
spectrum, image, cube and time to gammapy.modeling.models</p></li>
<li><p>dissolve gammapy.background, moving its code into gammapy.spectrum
and gammapy.cube</p></li>
<li><p>dissolve gammapy.image, moving the useful functionality to gammapy.maps and
gammapy.cube.</p></li>
<li><p>Clean up gammapy.utils sub-packages</p></li>
</ul>
<p>After Gammapy v1.0, we propose to continue discussion on other changes
considered while writing this PIG, described in the outlook section.</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">#</a></h2>
<p>The current Gammapy package structure (as of v0.13):</p>
<img alt="Gammapy package structure status (v0.13)" src="../../_images/pig-016-gammapy-package-organisation-status.png" />
<p>This illustrates the namespaces where the Gammapy API is exposed. The number of
Python files is much larger (about 100) and not important for the end-user API.</p>
</section>
<section id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline">#</a></h2>
<p>We propose to introduce gammapy.modeling and gammapy.modeling.models, to
dissolve gammapy.background and gammapy.image in the v0.14 development cycle,
resulting in the following package structure for Gammapy v0.14 and v1.0:</p>
<img alt="Gammapy package structure proposal (v0.14)" src="../../_images/pig-016-gammapy-package-organisation-proposal.png" />
<p>The following sections explain and motivate the proposed changes.</p>
<section id="introduce-gammapy-modeling">
<h3>Introduce gammapy.modeling<a class="headerlink" href="#introduce-gammapy-modeling" title="Permalink to this headline">#</a></h3>
<p>Currently our fitting and modeling framework is in gammapy.utils.fitting,
and the built-in models in Gammapy are distributed like this:</p>
<ul class="simple">
<li><p>gammapy.modeling.models – 1D spectral models</p></li>
<li><p>gammapy.image.models – 2D spatial models</p></li>
<li><p>gammapy.cube.models – 3D cube models</p></li>
<li><p>gammapy.time.models – 1D time models</p></li>
</ul>
<p>Our proposal is to create a new sub-package gammapy.modeling and
gammapy.modeling.models following the organisation chosen for models in Astropy and
restructure code like this:</p>
<ul class="simple">
<li><p>gammapy/utils/fitting -&gt; gammapy/modeling/fitting</p></li>
<li><p>gammapy/utils/serialisation -&gt; gammapy/modeling/serialisation</p></li>
<li><p>gammapy/spectrum/models – gammapy/modeling/models/spectrum</p></li>
<li><p>gammapy/image/models – gammapy/modeling/models/image</p></li>
<li><p>gammapy/cube/models – gammapy/modeling/models/cube</p></li>
<li><p>gammapy/time/models – gammapy/modeling/models/time</p></li>
</ul>
<p>Since it is very inconvenient for users to have to type sub-sub-sub-package
names, we propose to expose the end-user API direction in gammapy.modeling for
general classes (Parameter, Parameters, Model, Fit, Dataset). For the models, we
propose to expose them in gammapy.modeling.models (same as Astropy), and to
introduce a factory function to make it easy to make models that is easy to
import and use. E.g. it could be gammapy.modeling.make_model and take a model
specification string or dictionary. Developing the syntax and schema for this
“model specification language” isn’t in scope for this PIG. It will be done as
part of the effort on model serialisation in Gammapy in the coming months.</p>
<p>We propose to add “Source” to all (currently 3D) source models, and to add
“Spectral”, “Spatial” and “Time” for the spectral, spatial and time models. This
avoids user confusion concerning the type of model, which currently exists in
v0.13, because for some models (Gaussian, diffuse, table, constant) it isn’t
obvious what kind they are. The drawback is that this generates very long class
names, such as e.g. SpectralExponentialCutoffPowerLaw3FGL.</p>
<p>The motivation for this change is weak, but in discussions at the Erlangen
coding sprint most Gammapy developers preferred it. The reasoning was that it’s
a bit easier to find and maintain models if they are all in one place.</p>
<p>There was a concern that this might introduce circular dependencies between
gammapy.modeling.models and e.g. gammapy.spectrum, gammapy.image, gammapy.cube
or gammapy.time. But in <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2290">GH 2290</a> it was shown that this is not the case, the
proposed change works well.</p>
<p>There is still the open question whether models will keep this simple interface,
or if we will add an evaluation caching layer, or whether eventually reduced
IRFs will become models. So it is very much possible that there will be other
changes concerning the Gammapy package structure in the future.</p>
</section>
<section id="dissolve-gammapy-background">
<h3>Dissolve gammapy.background<a class="headerlink" href="#dissolve-gammapy-background" title="Permalink to this headline">#</a></h3>
<p>We propose to dissolve gammapy.background, and move the code like this:</p>
<ul class="simple">
<li><p>background_estimate.py, reflected.py, phase.py -&gt; gammapy/spectrum</p></li>
<li><p>ring.py -&gt; gammapy/cube/background_ring.py</p></li>
</ul>
<p>The motivation for this change is that currently map-related background
estimation code is split into gammapy/background and gammapy/cube without a
clear separation what goes where. So the choice was either to move everything to
dissolve gammapy.background or to move all background-related code to
gammapy.background.</p>
<p>Looking at the package structure illustration above, it’s clear that
gammapy.background is problematic, because it is lower level than
gammapy.spectrum and gammapy.maps, so moving background estimation classes from
gammapy.cube down to gammapy.background would likely lead to circular
dependencies, because they rely on the map dataset class in gammapy.cube.</p>
<p>The reflected region background code is not a great fit in gammapy/spectrum or
anywhere in Gammapy except for gammapy.background, but moving it there does make
sense if we say that all 1D spectrum code goes in gammapy.spectrum and all
map-related analysis code goes in gammapy.cube. Scalar background statistics,
i.e. for a given region and energy band, can be created via methods on the 1D
and 3D dataset classes.</p>
</section>
<section id="dissolve-gammapy-image">
<h3>Dissolve gammapy.image<a class="headerlink" href="#dissolve-gammapy-image" title="Permalink to this headline">#</a></h3>
<p>The gammapy.image package was introduced early and contained a SkyImage class
for 2D sky images, and 2D image models, and some image analysis helper functions
such as code to make a radial profile from an image. Much later gammapy.maps was
introduced and we managed to support 2D and 3D maps with one container instead
of separate gammapy.image.SkyImage and gammapy.cube.SkyCube.</p>
<p>Now, if we move gammapy.image.models to gammapy.modeling as proposed above, and
that SkyImage has been removed in 2018, there is very little functionality left
in gammapy.image, and it’s not clear what its scope is.</p>
<p>So we propose to clean this up, roughly like this:</p>
<ul class="simple">
<li><p>utils.py -&gt; one helper function, move to gammapy/maps/utils.py</p></li>
<li><p>asmooth.py -&gt; move to gammapy.detect</p></li>
<li><p>measure.py and profile.py -&gt; move to gammapy.maps (and clean up)</p></li>
<li><p>plotting.py -&gt; move to gammapy/maps/plotting.py (remove illustrate_colormap
and grayify_colormap)</p></li>
</ul>
</section>
<section id="clean-up-gammapy-utils">
<h3>Clean up gammapy.utils<a class="headerlink" href="#clean-up-gammapy-utils" title="Permalink to this headline">#</a></h3>
<p>Above we propose to move gammapy.utils.fitting, the biggest piece of
gammapy.utils to gammapy.modeling. We still need and want to keep gammapy.utils,
as a lowest level layer in Gammapy where we write adapters and helpers for
functionality e.g. from Numpy and Astropy. Mostly this is for usage within
Gammapy, users very rarely need to import from gammapy.utils. Currently only
energy_logspace, sqrt_space, sample_powerlaw and SphericalCircleSkyRegion are
used from end-user documentation, i.e. very little.</p>
<p>We propose to clean up gammapy.utils, e.g. gammapy/utils/coordinates.py still
contains coordinate helper functions that were added before astropy.coordinates
existed. We do not detail the cleanup here, this will be discussed on a
case-by-case basis. After that we will review what is left and decide which
parts do mention in the public API docs and which to keep as purely internal code.</p>
</section>
</section>
<section id="outlook">
<h2>Outlook<a class="headerlink" href="#outlook" title="Permalink to this headline">#</a></h2>
<p>During discussion of this PIG, several other ideas surfaced and were considered.
The following ideas could be considered and evaluated for feasibility (as done
in <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2290">GH 2290</a> for gammapy.modeling) in the future.</p>
<ul class="simple">
<li><p>Generalising maps to allow maps without a WCS and spatial axes, and / or using
it everywhere in Gammapy (for IRFs, spectra, lightcurves) could be nice.
Possibly ALMA does this, all their data is in 4D containers with lon, lat,
wavelength, time, and e.g. a 1D spectrum would have only one bin in lon, lat,
time. It’s not clear if and what changes this would imply for the Gammapy
package structure.</p></li>
<li><p>CTA IRFs and other CTA data level 3 classes might be maintained in ctapipe or
somehow shared between Gammapy and ctapipe.</p></li>
<li><p>gammapy.spectrum will likely become higher level than gammapy.cube, i.e. 1D
spectral analysis will be based on 3D maps analysis more.</p></li>
<li><p>gammapy.detect will likely grow map analysis and modeling based algorithms,
i.e. depend on gammapy.cube and the rest of the Gammapy package</p></li>
<li><p>gammapy.astro could grow (merge in Naima) or be split out from Gammapy.</p></li>
<li><p>gammapy.cube could be renamed to gammapy.map_analysis. gammapy.scripts could
be renamed to gammapy.analysis. Or similar changes to better names could be
made, depending on how the purpose and scope change of sub-packages changes.</p></li>
<li><p>Datasets could be grouped in gammapy.datasets, if they are simple container
objects (like models) that aren’t tightly coupled with analysis code in
gammapy.spectrum and gammapy.maps.</p></li>
</ul>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">#</a></h2>
<p>The PIG was extensively discussed at the Gammapy coding sprint in July 2019 and
in <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2274">GH 2274</a>. A final review announced on the Gammapy and CC mailing list did
not yield any additional comments. Therefore the PIG was accepted on August 18,
2019.</p>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>