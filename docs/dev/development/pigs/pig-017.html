
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PIG 17 - Provenance capture &#8212; gammapy vX.Y.Z</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=35abb870" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=1f75dfce"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'development/pigs/pig-017';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script src="../../_static/matomo.js?v=52704cab"></script>
    <link rel="canonical" href="https://docs.gammapy.org/stable/development/pigs/pig-017.html" />
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PIG 18 - Documentation" href="pig-018.html" />
    <link rel="prev" title="PIG 16 - Gammapy package structure" href="pig-016.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.0.dev1764+g0b2c8b52e" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/gammapy_logo.png" class="logo__image only-light" alt="gammapy vX.Y.Z - Home"/>
    <img src="../../_static/gammapy_logo.png" class="logo__image only-dark pst-js-only" alt="gammapy vX.Y.Z - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Project setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">How to contribute to Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">How to make a Gammapy release</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../doc_howto.html">Documentation How To</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_howto.html">Developer How To</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">PIGs</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pig-001.html">PIG 1 - PIG purpose and guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-002.html">PIG 2 - Organization of low level analysis code</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-003.html">PIG 3 - Plan for dropping Python 2.7 support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-004.html">PIG 4 - Setup for tutorial notebooks and data</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-005.html">PIG 5 - Gammapy 1.0 roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-006.html">PIG 6 - CTA observation handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-007.html">PIG 7 - Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-008.html">PIG 8 - Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-009.html">PIG 9 - Event sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-010.html">PIG 10 - Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-011.html">PIG 11 - Light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-012.html">PIG 12 - High level interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-013.html">PIG 13 - Gammapy dependencies and distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-014.html">PIG 14 - Uncertainty estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-016.html">PIG 16 - Gammapy package structure</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">PIG 17 - Provenance capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-018.html">PIG 18 - Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-019.html">PIG 19 - Gammapy package structure follow up</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-020.html">PIG 20 - Global Model API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-021.html">PIG 21 - Models improvements</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-022.html">PIG 22 - Unified flux estimators API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-023.html">PIG 23 - Gammapy release cycle and version numbering</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-024.html">PIG 24 - Authorship policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-025.html">PIG 25 - Metadata container for Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-026.html">PIG 26 - Model Priors API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-027.html">PIG 27 - Bayesian Inference using Nested Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-028.html">PIG 28 - Gammapy version 2.0 Roadmap</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Developer guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">PIGs</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">PIG 17 - Provenance capture</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="pig-17-provenance-capture">
<span id="pig-017"></span><h1>PIG 17 - Provenance capture<a class="headerlink" href="#pig-17-provenance-capture" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Author: José Enrique Ruiz, Mathieu Servillat</p></li>
<li><p>Created: October 15, 2019</p></li>
<li><p>Accepted: Withdrawn May 23rd, 2025</p></li>
<li><p>Status: Withdrawn</p></li>
<li><p>Discussion: <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2458">GH 2458</a></p></li>
</ul>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">#</a></h2>
<p>Gammapy v0.14 has delivered a first version of a <a class="reference external" href="https://docs.gammapy.org/0.14/scripts/index.html">High-level interface</a> that intends to provide the
main basic features proposed in <a class="reference internal" href="pig-012.html#pig-012"><span class="std std-ref">PIG 12 - High level interface</span></a>. It is expected that all of these features will be addressed in
the coming releases. Having this well defined high-level interface Python API allow us to think on
procuring a way to automatically record a structured provenance of the data analysis processes undertaken
with the high-level interface in IPython working sessions (shell and notebooks) or in Python scripts.</p>
<p>We propose to develop a solution for an automatic and seamless capture of a structured provenance using a
standard provenance model. This will open the door to provide the means to perform comparisons and forensic
studies of different analysis processes, extracting relevant information to trace back the origin of results,
which in turn should improve reproducibility and reuse by the community. The proposed contribution described
in this PIG is a necessary first step to accomplish that ultimate goal, which would only be achieved with
tools for provenance inspection and filtering. Those could be found as standard tools developed outside
Gammapy or, in the worst of the cases, as a custom tool for provenance extraction and analysis proposed
for development in a future PIG.</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Link to this heading">#</a></h2>
<p>Gammapy uses the standard Python <code class="docutils literal notranslate"><span class="pre">logging</span></code> library mixed with <code class="docutils literal notranslate"><span class="pre">print()</span></code> functions for logging and
printing information related with the execution of its classes and methods. Ideally there should not be
<code class="docutils literal notranslate"><span class="pre">print()</span></code> functions in a Python library like Gammapy, since this does not allow for a flexible
configuration of the output format, nor the severity level used neither the place where these logs are
recorded. There has been some discussion about logging in Gammapy in the past (see <a class="reference external" href="https://github.com/gammapy/gammapy/issues/315">GH 315</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/318">GH 318</a>,
<a class="reference external" href="https://github.com/gammapy/gammapy/issues/320">GH 320</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/346">GH 346</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/2216">GH 2216</a> as the most relevant examples). How we should do logging now is documented
in the <a class="reference external" href="https://docs.gammapy.org/0.14/development/howto.html#logging">Logging</a> section of the Developer HowTo in the Gammapy documentation. Though there is always room
for improvement (i.e. modular configuration of loggers, handlers and formatters, addition of custom
severity levels, colored output, etc), we consider that capturing structured and modeled provenance needs a
different answer than fine-tuning the configuration of the Python <code class="docutils literal notranslate"><span class="pre">logging</span></code> mechanism.</p>
<p>The International Virtual Observatory Alliance (IVOA) has been working in the elaboration of a provenance
model for astrophysics data. It is expected that this model will be accepted as a standard recommendation
very soon. This <a class="reference external" href="http://www.ivoa.net/documents/ProvenanceDM/20190719/index.html">IVOA Provenance Data Model</a> adapts many concepts described in <a class="reference external" href="https://www.w3.org/TR/prov-overview/">PROV-Overview</a> and
<a class="reference external" href="https://www.w3.org/TR/2013/REC-prov-dm-20130430/">PROV-DM</a> W3C provenance standards to the astronomy data processing context. The IVOA Provenance Data
Model has been successfully implemented in several prototypes for provenance capture (i.e. <a class="reference external" href="http://pollux.graal.univ-montp2.fr">Pollux</a>,
<a class="reference external" href="https://github.com/mservillat/OPUS">OPUS</a>, <a class="reference external" href="https://www.rave-survey.org/project">RAVE</a>, and for automatic generation of HiPS data collections at CDS). At this moment there are
no solutions or libraries that allow, in a straight-forward way, for the implementation of a generic
provenance capture mechanism using this model, hence custom coding is needed.</p>
<p>The prototype for CTA pipeline framework <em>ctapipe</em> provides a small <a class="reference external" href="https://cta-observatory.github.io/ctapipe/api/ctapipe.core.Provenance.html">ctapipe.core.provenance</a>
Python API to code the implementation of a custom provenance capture. The general functioning of the API
is described in the <a class="reference external" href="https://cta-observatory.github.io/ctapipe/examples/provenance.html">ctapipe provenance service</a> documentation. The API procures a seamless capture of
the execution environment, and provides methods to register start/end of processes as well as related
input/output datasets. For this it uses the concepts provided in the IVOA and W3C provenance models
(i.e. activities, entities, roles, etc.) also capturing additional information on execution environment.
It also provides the means to serialize the provenance capture into flat files, exposing the provenance
information as a Python dictionary or in JSON format.</p>
<p>The <a class="reference external" href="http://prov.readthedocs.io">prov package</a> is a free Python library providing methods to build and read provenance information
using the concepts and semantics of the standard W3C Provenance Data Model. It supports the most common
provenance serialisation formats (i.e. PROV-O RDF, PROV-XML and PROV-JSON), as well as graph generation
of the process workflow (i.e. PDF, PNG, SVG). Since the IVOA Provenance Data Model shares the same
conceptual modelling with W3C, a custom log file built using the model could be easily translated into
those standard-formatted files and graphs using the <em>prov package</em>.</p>
</section>
<section id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Link to this heading">#</a></h2>
<p>We propose to develop a set of classes and methods that will automatically capture the provenance of a
data analysis process undertaken with Gammapy high-level interface tasks. This provenance information
will be captured seamlessly only when expressly declared as a configuration parameter of the high-level
interface.</p>
<p>It will be structured using the <a class="reference external" href="http://www.ivoa.net/documents/ProvenanceDM/20190719/index.html">IVOA Provenance Data Model</a> and recorded in the same output stream used
for the standard logging, but with a different severity level. The choice of the IVOA Provenance
Data Model allows for interoperability with provenance information captured from <em>ctapipe</em> as well
as with other astronomical archive services or software providing provenance information in the Virtual
Observatory framework and with the W3C provenance models. In this optic, the development will be done on
top of <a class="reference external" href="https://cta-observatory.github.io/ctapipe/api/ctapipe.core.Provenance.html">ctapipe.core.provenance</a>, re-using its present capabilities when possible and extending it. The
information captured will relate to the execution environment, the overall high-level interface configuration,
the workflow execution process (i.e the relationships among datasets and processes and the parameter values
used in each process step), and the serialisations of the intermediate and final datasets or objects produced.</p>
<p>A simple and non-intrusive implementation strategy should be considered, with minor modifications in the
code-base of Gammapy. Metaclass inheritance, class decoration and subclassing mechanisms applied to the
<code class="docutils literal notranslate"><span class="pre">Analysis</span></code> class of the high-level interface will be explored. The code will be placed in one or a few
python scripts inside a new folder <code class="docutils literal notranslate"><span class="pre">provenance</span></code> at the <code class="docutils literal notranslate"><span class="pre">gammapy.utils</span></code> level. The whole solution will
be mainly based on a provenance description YAML file that will bind tasks of the high-level interface,
their parameters, datasets used and generated, etc. with the provenance model, its specific semantics and
the desired provenance capture granularity. In order to procure an accurate provenance description file, a
good knowledge and understanding of the high-level interface code-base is needed. Needless to say that a
well established and defined behaviour of the of the high-level interface tasks and configuration settings
would be desirable before developers actually define the provenance description YAML file.</p>
<p>Serialisation of the captured provenance into log files will be done according to the logging configuration
settings defined in the high-level interface. A structured format will be defined to record objects used
and produced, tasks execution, parameters used and relationships among the whole, as time-stamped log
messages. We will also provide a small set of tools developed with <a class="reference external" href="http://prov.readthedocs.io">prov package</a> that will extract the
provenance information from log files and translate it into standard W3C file formats (i.e. PROV-O RDF,
PROV-XML and PROV-JSON), as well as to provenance graphs (i.e. PDF, PNG, SVG). The use of a custom
structured log format allows us to record additional information other than the strictly permitted by
W3C standards.</p>
<p>All the configuration settings and parameter values may be accessed via the <code class="docutils literal notranslate"><span class="pre">Analysis</span></code> class at the very
moment of the execution of each task. Captured tasks, datasets and hashable objects in general need a unique
identifier that could be generated with MD5 hashing. The intermediate and final datasets and objects produced
will be saved into the local disk if this option is enabled as a configuration parameter, and links to the
serialisations of these objects will be recorded accordingly in the provenance log file.</p>
</section>
<section id="outlook">
<h2>Outlook<a class="headerlink" href="#outlook" title="Link to this heading">#</a></h2>
<p>The scope of this PIG is provenance capture. The analysis and extraction of the recorded information
with filtering options, comparison among different provenance extractions or the exposing format issued
from those queries is left for other tools or another PIG. Though it is proposed to develop tools for
extracting provenance information from log files and translate it to W3C syntax, the only filtering option
that it is foreseen to use for this extraction is a value range for the time-stamp.</p>
<p>The choice of a lightweight solution as plain text log files for provenance storage could be different
if up-scaling is really needed to solve performance issues (i.e. due to a high volume of information
captured) or if additional relationships are needed to address provenance extraction and inspection features.
In that case the information could be kept into a relational database (i.e. SQLite, MySQL, MongoDB, PostgreSQL,
etc.) using a specific database schema and an Object Relational Mapper (ORM) Python library like SQLAlchemy.</p>
<p>Most of the design work will be focused on the provenance description YAML file linking the behaviour of
the high-level interface and the actual provenance model according to an agreed level of granularity.
At the same time, the perimeter of the configuration parameters used in the high-level interface is
also described in a YAML file using the <a class="reference external" href="https://json-schema.org">JSON Schema</a> standard. This could open the possibility to
automatically generate most of the content of the provenance description file from the JSON schema file
used to validate the configuration parameters of the high-level interface.</p>
<p>The developments proposed in this PIG are tightly-coupled to the specific functioning of the Gammapy
high-level interface. They take advantage of the fact that the <code class="docutils literal notranslate"><span class="pre">Analysis</span></code> class has a straight-forward
access to all the tasks and objects involved in the analysis process, as well as to all the configuration
settings of the high-level interface. The development of a generic independent Python package that could
be used for any other Python command-line-tool software and/or API could be explored taking a different
approach for the capture provenance values but keeping the provenance description file.</p>
<p>There may be some provenance information that could be good to have stuck to the datasets or to other
objects produced in the data analysis process (i.e. see related discussion in <a class="reference external" href="https://github.com/gammapy/gammapy/pull/2447">GH 2447</a>, <a class="reference external" href="https://github.com/gammapy/gammapy/issues/2452">GH 2452</a>
on accessing and serialising a table of observations metadata and selection cuts together with the derived
datasets) In those cases the provenance capture and extraction is part of the I/O methods of the object
where it is linked, and those potential features do not replace the proposal of this PIG.</p>
</section>
<section id="alternatives">
<h2>Alternatives<a class="headerlink" href="#alternatives" title="Link to this heading">#</a></h2>
<p>The are other technical solutions that could be used to capture provenance or perform a structured logging
in the context of Python scripting executions. The <a class="reference external" href="https://cta-observatory.github.io/ctapipe/ctapipe_api/tools/index.html">ctapipe tools</a> come with provenance capture features
implemented by <a class="reference external" href="https://cta-observatory.github.io/ctapipe/api/ctapipe.core.Provenance.html">ctapipe.core.provenance</a>, which capture the execution environment and input/output files.
Other Python packages that provide provenance capture are <a class="reference external" href="https://github.com/recipy/recipy">Recipy</a> and <a class="reference external" href="http://gems-uff.github.io/noworkflow/">noWorkflow</a>. Both provide non-intrusive
implementation mechanisms and provenance inspection features, but need a relational database (TinyDB, SQLite)
to store the information and use different different non standard fixed proprietary models. In the end they
are not highly flexible to configure the kind of information captured and the desired level of granularity.</p>
<p>A different approach is to record provenance as structured logs, which is the one proposed in this PIG. In
this optic we may find as the most relevant examples <a class="reference external" href="https://pythonhosted.org/Autologging/">Autologging</a>, <a class="reference external" href="https://eliot.readthedocs.io/en/stable/">Eliot</a> and <a class="reference external" href="http://www.structlog.org/en/stable/">Structlog</a>. Autologging
provides an automatic basic logging for class methods calls with parameters values passed and returned, that
is activated through class decorators. Whereas Eliot and Structlog provide Python APIs to perform a detailed
structured logging in the form of nested dictionaries and arrays. Eliot also provides a tool to display these
logs as a structured sequence of nested actions and subactions, as well as the parameters values involved.
These APIs could be used to develop the custom-model provenance capture layer proposed in this PIG, but they
add an external dependency that for our simple model we find oversized and could be easily avoided. It remains
that if technical blockers are found during the development of this PIG, we could always explore the solutions
offered by these APIs.</p>
</section>
<section id="task-list">
<h2>Task list<a class="headerlink" href="#task-list" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Define a syntax for the description provenance file and agree on a level of provenance granularity captured.</p></li>
<li><p>Define a structured format for logging as time-stamped messages in a log file and/or in output stream.</p></li>
<li><p>Prototype a non-intrusive solution to capture provenance with high-level interface tasks.</p></li>
<li><p>Additions on the configuration settings of the high-level interface to enable provenance capture.</p></li>
<li><p>Improve the prototype based on users and core developers feedback to achieve a final solution.</p></li>
<li><p>Develop a small set of tools which translate provenance logs into W3C syntax formatted files.</p></li>
<li><p>Develop a small set of tools which produce graphs of the workflow process using provenance logs.</p></li>
</ul>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">#</a></h2>
<p>A prototype has been built but since then the effort has stalled. The PIG is withdrawn as is. A future version can be prepared based on more recent status of Gammapy.</p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#status">Status</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposal">Proposal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outlook">Outlook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternatives">Alternatives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-list">Task list</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision">Decision</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/development/pigs/pig-017.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
    
    <p>Licensed under
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a>.</p>
    <p>Examples, recipes, and other code licensed under
      <a href="https://opensource.org/license/BSD-3-Clause>" target="_blank">BSD 3-Clause "New" or "Revised"</a> license.</p>
    <p>Gammapy <a href="https://gammapy.org/DataPrivacy.html">Data Privacy</a> information.</p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>