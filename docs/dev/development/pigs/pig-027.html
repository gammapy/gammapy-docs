
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PIG 27 - Bayesian Inference using Nested Sampling &#8212; gammapy vX.Y.Z</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=35abb870" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=1f75dfce"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'development/pigs/pig-027';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script src="../../_static/matomo.js?v=52704cab"></script>
    <link rel="canonical" href="https://docs.gammapy.org/stable/development/pigs/pig-027.html" />
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PIG 28 - Gammapy version 2.0 Roadmap" href="pig-028.html" />
    <link rel="prev" title="PIG 26 - Model Priors API" href="pig-026.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.0.dev2044+g727ab1b42" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/gammapy_logo.png" class="logo__image only-light" alt="gammapy vX.Y.Z - Home"/>
    <img src="../../_static/gammapy_logo.png" class="logo__image only-dark pst-js-only" alt="gammapy vX.Y.Z - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Project setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">How to contribute to Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">How to make a Gammapy release</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../doc_howto.html">Documentation How To</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_howto.html">Developer How To</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">PIGs</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pig-001.html">PIG 1 - PIG purpose and guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-002.html">PIG 2 - Organization of low level analysis code</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-003.html">PIG 3 - Plan for dropping Python 2.7 support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-004.html">PIG 4 - Setup for tutorial notebooks and data</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-005.html">PIG 5 - Gammapy 1.0 roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-006.html">PIG 6 - CTA observation handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-007.html">PIG 7 - Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-008.html">PIG 8 - Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-009.html">PIG 9 - Event sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-010.html">PIG 10 - Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-011.html">PIG 11 - Light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-012.html">PIG 12 - High level interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-013.html">PIG 13 - Gammapy dependencies and distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-014.html">PIG 14 - Uncertainty estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-016.html">PIG 16 - Gammapy package structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-017.html">PIG 17 - Provenance capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-018.html">PIG 18 - Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-019.html">PIG 19 - Gammapy package structure follow up</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-020.html">PIG 20 - Global Model API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-021.html">PIG 21 - Models improvements</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-022.html">PIG 22 - Unified flux estimators API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-023.html">PIG 23 - Gammapy release cycle and version numbering</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-024.html">PIG 24 - Authorship policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-025.html">PIG 25 - Metadata container for Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-026.html">PIG 26 - Model Priors API</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">PIG 27 - Bayesian Inference using Nested Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="pig-028.html">PIG 28 - Gammapy version 2.0 Roadmap</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Developer guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">PIGs</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">PIG 27 - Bayesian Inference using Nested Sampling</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="pig-27-bayesian-inference-using-nested-sampling">
<span id="pig-027"></span><h1>PIG 27 - Bayesian Inference using Nested Sampling<a class="headerlink" href="#pig-27-bayesian-inference-using-nested-sampling" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Author: Fabio Acero, Régis Terrier, Bruno Khelifi</p></li>
<li><p>Created: <code class="docutils literal notranslate"><span class="pre">2024-10-14</span></code></p></li>
<li><p>Accepted: <code class="docutils literal notranslate"><span class="pre">2025-01-29</span></code></p></li>
<li><p>Status: Accepted</p></li>
<li><p>Discussion:</p></li>
</ul>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">#</a></h2>
<p>This PIG is intended to introduce a Bayesian Inference class to support nested sampling algorithm to estimate
the marginal evidence and the posterior distributions of all model parameters.</p>
</section>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">#</a></h2>
<p>(The material below are some notes that I took that can be used later for a tutorial introduction)</p>
<p>Bayesian inference uses prior knowledge, in the form of a prior distribution, in order to estimate posterior probabilities which we traditionally visualize in the form of corner plots.
These distributions contain much more information than a single best-fit as they reveal not only the “best model” but the (not always Gaussian) errors and correlation between parameters.</p>
<p>A well-know approach to estimate this posterior distribution is the Markov Chain Monte Carlo (MCMC) which uses an ensemble of walkers to produce a chain of samples that after a convergence period will reach a stationary state.
<em>Once convergence</em> is reached the successive elements of the chain are samples of the target posterior distribution.
However the weakness of the MCMC approach lies in the <em>Once convergence</em> part.
Started far from the best likelihood region, the convergence time can be long or never reached if the walkers fall in a local minima.
The choice of the initialization point can become critical for complex models with a high number of dimensions and the ability of these walkers to escape a local minimum or to accurately describe a complex likelihood space is not guaranteed.</p>
<p>To overcome these issues, we propose to implement a Bayesian Inference class in gammapy based on the nested sampling (NS) algorithm,
which is a Monte Carlo algorithm for computing an integral of the likelihood function over the prior model parameter space in 2004 by John Skilling.
The method performs this integral by evolving a collection of points through the parameter space (see recent reviews of Ashton2022, and of Buchner2023).
Without going into too many details, one important specificity of the NS method is that it starts from the entire parameter space and evolves a collection of live points to map all minima (including multiple modes if any)
whereas Markov Chain Monte Carlo methods require an initialization point and the walkers will explore the local likelihood. The ability of these walkers to escape a local minimum or to accurately describe a complex likelihood space is not guaranteed.
This is a fundamental difference between MCMC (and Minuit) which will only ever probe the vicinity along their minimization paths and do not have an overview of the global likelihood landscape.
The analysis using the NS framework is more CPU time consuming than a standard classical fit but provides the full posterior distribution for all parameters, which is out of reach with traditional fitting techniques (N*(N-1)/2 contour plots to generate).
In addition it is more robust to the choice of initialization, requires less human intervention and is therefore readily integrated in pipeline analysis.
The following PIG focuses on the implementation of the NS with the UltraNest package, one of the leading package in Astronomy (already used in Cosmology and in X-rays). Another relevant implementation is the one by Dynesty.
However, UltraNest is claimed to be more robust, provide safer uncertainties, and better parallelization (see <a class="reference external" href="https://johannesbuchner.github.io/UltraNest/issues.html#what-is-the-difference-between-ultranest-and-multinest-dynesty">UltraNest doc</a>)</p>
<p>Reference :</p>
<ul class="simple">
<li><p>Ultranest : <a class="reference external" href="https://johannesbuchner.github.io/UltraNest">https://johannesbuchner.github.io/UltraNest</a></p></li>
<li><p>Literature : <a class="reference external" href="http://arxiv.org/abs/2101.09675">Buchner 2023,</a> , <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022NRvMP...2...39A">Ashton 2022,</a></p></li>
</ul>
<p><strong>Potential limitations of MCMC in a BayesianInference class?</strong></p>
<p>Besides the many advantages of the NS described above, one technical specificity of the MCMC method is that the user needs to specify a warmup/burn period <em>that can only be estimated once the chain has run</em>.
From an implementation point of view of the class this means that the user would need to run the sampler, then look at the chain, specify the burn period and then estimate the best model parameters.
This implies that the class will not be able to update the model parameters in a single round like the Fit class does.
In addition, there is no convergence criteria in the MCMC so the MCMC can not return a <code class="xref py py-obj docutils literal notranslate"><span class="pre">convergence</span> <span class="pre">successful</span> <span class="pre">:</span> <span class="pre">True</span></code> status.
NS has no warmup period, a well defined convergence criteria, and can estimate convergence success.</p>
<p>However we might want to keep the class general enough so that MCMC can be plugged easily in the future?</p>
<p><strong>A visual comparison of the approaches of MCMC vs NS</strong></p>
<p>NS approximate the posterior distribution via sparse sampling of the entire likelihood landscape covering the full prior space.
At the opposite, MCMC (like gradient descent methods) will only “visit” the landscape in the vicinity of their walk.
Below is an illustration of Nested Sampling and MCMC modeling of the dataset <code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/joint-crab/spectra/hess/pha_obs23523.fits</span></code>.</p>
<img alt="MCMC vs Nested Sampling likelihood exploration" src="../../_images/pig-027-Landscape-Crab-NestedSampling-MCMC.png" />
</section>
<section id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<p>intro here (TBC)</p>
<section id="case-1-estimate-the-posterior-distribution-with-a-tuning-parameter-free-approach">
<h3>Case 1: Estimate the posterior distribution with a tuning-parameter free approach<a class="headerlink" href="#case-1-estimate-the-posterior-distribution-with-a-tuning-parameter-free-approach" title="Link to this heading">#</a></h3>
<p>Estimating the errors and correlations between the N parameters in a model scales as N*(N-1)/2 and quickly becomes impossible with the regular grid approach of iMinuit.
MCMC methods can provide an approximation of this posterior distribution and have been used for a while in science (dating back to Los Alamos work by Metropolis et al., 1953).
However they still have a few fundamental tuning parameters that require human intervention:
1. the number of walkers
2. the length of the chain
3. the burn period within that chain (the steps needed to reach convergence)</p>
<p>While some methods exists to choose these parameters in an automated way, the user usually ends up choosing by eye the length of the chain and the burn period.
In addition as the MCMC only explores a small fraction of the likelihood landscape, there is no guarantee to reach the global minima.</p>
</section>
<section id="case-2-minuit-convergence-issues">
<h3>Case 2: Minuit convergence issues<a class="headerlink" href="#case-2-minuit-convergence-issues" title="Link to this heading">#</a></h3>
<p>One of the comment I hear frequently at tutorials, schools or colleagues is not knowing what to do in front of a <code class="xref py py-obj docutils literal notranslate"><span class="pre">Fit</span> <span class="pre">failed`</span></code> iMinuit message.
This can be due to multiple good reasons (e.g. hitting a boundary) but most commonly it can be related to a starting point far from the solution (in particular the amplitude parameter).
Nested sampling can address this issue by providing a sparse sampling of a large prior space for the amplitude for example via a <code class="xref py py-obj docutils literal notranslate"><span class="pre">LogUniform</span></code> prior.
In addition by providing a full landscape of the likelihood and with no notion of initialization, the model exploration is more robust and with less human intervention.</p>
</section>
<section id="case-3-model-comparison-using-the-bayesian-evidence-aka-marginal-evidence">
<h3>Case 3: Model comparison using the Bayesian evidence (aka marginal evidence)<a class="headerlink" href="#case-3-model-comparison-using-the-bayesian-evidence-aka-marginal-evidence" title="Link to this heading">#</a></h3>
<p>replaces the deltaCstat / AIC/BIC, etc
comparing non nested models</p>
</section>
<section id="case-4-parallelization-of-the-fitting">
<h3>Case 4: Parallelization of the “fitting”<a class="headerlink" href="#case-4-parallelization-of-the-fitting" title="Link to this heading">#</a></h3>
<p>How to speed up a fit and the error estimation has been in discussion for a while. UltraNest supports parallelisation out-of-the-box with MPI support.
This allows to take advantage of the CPUs on a laptop or a cluster. From my experience in X-ray analysis, parallelisation scales well up to 16 cores (but this is probably very data dependent).
Whether or not this interfaces well with gammapy must be explored.</p>
</section>
</section>
<section id="implementation-impact">
<h2>Implementation impact<a class="headerlink" href="#implementation-impact" title="Link to this heading">#</a></h2>
<p>The implementation of the Bayesian inference class implies some addition/modifications to the current codebase.</p>
<p>Namely:</p>
<ol class="arabic simple">
<li><p>Likelihood: The <code class="xref py py-obj docutils literal notranslate"><span class="pre">stat_sum</span></code> value needs to be separated into a likelihood term and a prior penalty term.
While prior will be attached to the model, we want the stat_sum to return only the likelihood and not the penalty term as it is not needed
for the NS technique. In addition, the NS algorithm aims to maximize the likelihood (not minimize) and the factor of 2 for the Cstat needs to be removed.
So likelihood should be : <code class="xref py py-obj docutils literal notranslate"><span class="pre">-0.5*Stat</span></code></p></li>
<li><p>Priors: The sampling in the NS algorithm is drawn from a “unity cube”. This means that all sample are drawn from a [0,1] random uniform distribution that
are latter transformed to the parameter space via their inverse cumulative distribution (cdf). An <code class="xref py py-obj docutils literal notranslate"><span class="pre">inverse_cdf</span></code> attribute needs to be implemented for all Priors.</p></li>
<li><p>Sampler: The UltraNest sampler object needs to be initialized with the correct parameters and (modified) likelihood</p></li>
</ol>
</section>
<section id="outputs-from-the-nested-sampling">
<h2>Outputs from the Nested Sampling<a class="headerlink" href="#outputs-from-the-nested-sampling" title="Link to this heading">#</a></h2>
<p>Similarly to the MCMC method, the NS sampler will return samples of the posterior distributions. However there are several conceptual differences with the chains returned by the MCMC sampler.</p>
<ol class="arabic simple">
<li><p>There is no concept of chains in NS, each sample (live or dead points) serve to explore the entire likelihood landscape.
To estimate the posterior distributions, the samples need to be weighted in NS (See review paper listed in the intro).</p></li>
<li><p>The NS computes the full integral of the likelihood over the entire prior space. The integral result is the Bayesian
evidence Z which can be used to compare different models in apparently a better way that the BIC/AIC.
In addition an error on Z is estimated via bootstrap of the samples.</p></li>
<li><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">converged</span> <span class="pre">:</span> <span class="pre">True/False</span></code> status can be returned</p></li>
</ol>
<p>The UltraNest sampler returns a dictionary that is very complete and that contains all (and even more) information that is needed.
Here are the keys of that dictionary :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="s1">&#39;logz&#39;</span><span class="p">,</span> <span class="s1">&#39;logzerr&#39;</span><span class="p">,</span> <span class="s1">&#39;logz_bs&#39;</span><span class="p">,</span> <span class="s1">&#39;logz_single&#39;</span><span class="p">,</span> <span class="s1">&#39;logzerr_tail&#39;</span><span class="p">,</span> <span class="s1">&#39;logzerr_bs&#39;</span><span class="p">,</span> <span class="s1">&#39;ess&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Herr&#39;</span><span class="p">,</span> <span class="s1">&#39;posterior&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum_likelihood&#39;</span><span class="p">,</span> <span class="s1">&#39;ncall&#39;</span><span class="p">,</span> <span class="s1">&#39;paramnames&#39;</span><span class="p">,</span> <span class="s1">&#39;logzerr_single&#39;</span><span class="p">,</span> <span class="s1">&#39;insertion_order_MWW_test&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>In particular, the posterior key returns all the information needed to update the model Parameters :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;posterior&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.014811633859834</span><span class="p">,</span> <span class="mf">2.989779066475214e-12</span><span class="p">],</span>
 <span class="s1">&#39;stdev&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.010066705375548107</span><span class="p">,</span> <span class="mf">3.739770898783367e-14</span><span class="p">],</span>
 <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0148015517529894</span><span class="p">,</span> <span class="mf">2.988413141629203e-12</span><span class="p">],</span>
 <span class="s1">&#39;errlo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.00472179200096</span><span class="p">,</span> <span class="mf">2.9537056583888585e-12</span><span class="p">],</span>
 <span class="s1">&#39;errup&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.024897178551308</span><span class="p">,</span> <span class="mf">3.028549898215494e-12</span><span class="p">],</span>
</pre></div>
</div>
</section>
<section id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NestedSampler</span><span class="p">:</span>
  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">live_points</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">frac_remain</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_sampler</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">min_num_live_points</span> <span class="o">=</span> <span class="n">live_points</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">frac_remain</span> <span class="o">=</span> <span class="n">frac_remain</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">_parse_datasets</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
      <span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Datasets</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">)):</span>
          <span class="n">datasets</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">free_parameters</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">_update_models</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
      <span class="n">posterior</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;posterior&quot;</span><span class="p">]</span>
      <span class="n">samples</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">free_parameters</span><span class="p">):</span>
          <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
          <span class="n">par</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s2">&quot;stdev&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
          <span class="n">par</span><span class="o">.</span><span class="n">_samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">par</span><span class="o">.</span><span class="n">unit</span>

      <span class="c1"># Compute a covariance from the samples?</span>
      <span class="n">covariance</span> <span class="o">=</span> <span class="n">Covariance</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">free_parameters</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
      <span class="n">models</span><span class="o">.</span><span class="n">covariance</span><span class="o">=</span><span class="n">covariance</span>
      <span class="k">return</span> <span class="n">models</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasets</span><span class="p">):</span>
      <span class="n">datasets</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">)</span>
      <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">free_parameters</span>

      <span class="c1"># create log likelihood function</span>
      <span class="c1"># need to remove prior penalty</span>
      <span class="n">like</span> <span class="o">=</span> <span class="n">SamplerLikelihood</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">datasets</span><span class="o">.</span><span class="n">stat_sum_no_prior</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

      <span class="c1"># create ultranest object</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_sampler</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">like</span><span class="o">.</span><span class="n">fcn</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">prior_inverse_cdf</span><span class="p">)</span>

      <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_num_live_points</span><span class="p">,</span> <span class="n">frac_remain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frac_remain</span><span class="p">)</span>

      <span class="n">updated_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_models</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">results</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">BayesianInference</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">updated_models</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SamplerLikelihood</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Wrapper of the likelihood function used by the sampler.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  parameters : `~gammapy.modeling.Parameters`</span>
<span class="sd">      Parameters with starting values.</span>
<span class="sd">  function : callable</span>
<span class="sd">      Likelihood function.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">fcn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
      <span class="n">total_stat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>

      <span class="k">return</span> <span class="n">total_stat</span>
</pre></div>
</div>
<section id="serialisation-of-the-samples">
<h3>Serialisation of the samples<a class="headerlink" href="#serialisation-of-the-samples" title="Link to this heading">#</a></h3>
<p>In UltraNest, a serialisation is proposed to save to disk the samples and results dictionary. So this can be
used directly to <code class="xref py py-obj docutils literal notranslate"><span class="pre">save</span></code> and there is also a <code class="xref py py-obj docutils literal notranslate"><span class="pre">read_file</span></code> function.</p>
</section>
<section id="task-list">
<h3>Task list<a class="headerlink" href="#task-list" title="Link to this heading">#</a></h3>
<p>The task will be split between different subcategories</p>
<p><em>Modifications to existing code</em></p>
<ol class="arabic simple">
<li><p>Add a stat_sum function <code class="xref py py-obj docutils literal notranslate"><span class="pre">stat_sum_no_prior</span></code> which returns only the likelihood term Without the penalty term</p></li>
<li><p>Add inverse_cdf attributes to all the Priors</p></li>
<li><p>Add LogUniform prior (crucial for amplitude)</p></li>
<li><p>Add function to compute inverse_cdf on Parameters</p></li>
</ol>
<p><em>Design &amp; decisions of a new Bayesian class</em></p>
<ol class="arabic simple">
<li><p>Should the class be called NestedSampler (only NS) or BayesianFit (would host MCMC and NS)</p></li>
<li><p>Should we return the sampler in the BayesianInference(models=updated_models, results=results)?</p></li>
<li><p>Should we create a <code class="xref py py-obj docutils literal notranslate"><span class="pre">posterior</span></code> attribute for each model parameter? To contain what exactly?</p></li>
<li><p>UltraNest provides different samplers options. How do we implement them (e.g. self._sampler.stepsampler = ultranest.stepsampler.SliceSampler)</p></li>
</ol>
<p><em>Update the docs</em></p>
<ol class="arabic simple">
<li><p>Prepare a tutorial to show case this new class</p></li>
<li><p>Add section presenting the different approaches of Minuit, MCMC, and NS?</p></li>
<li><p>Update the ‘stats’ documentation page for the new prior and new inverse_cdf</p></li>
</ol>
</section>
<section id="user-testing-of-the-api">
<h3>User testing of the API<a class="headerlink" href="#user-testing-of-the-api" title="Link to this heading">#</a></h3>
<p>Once a dev version is working, we could run a small user testing on experienced gammapy users to have their
feedback and then on less experienced users.</p>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">#</a></h2>
<p>The PIG is accepted 2025-01-29. First PRs are underway.</p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use cases</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-1-estimate-the-posterior-distribution-with-a-tuning-parameter-free-approach">Case 1: Estimate the posterior distribution with a tuning-parameter free approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-2-minuit-convergence-issues">Case 2: Minuit convergence issues</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-3-model-comparison-using-the-bayesian-evidence-aka-marginal-evidence">Case 3: Model comparison using the Bayesian evidence (aka marginal evidence)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-4-parallelization-of-the-fitting">Case 4: Parallelization of the “fitting”</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-impact">Implementation impact</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs-from-the-nested-sampling">Outputs from the Nested Sampling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposal">Proposal</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serialisation-of-the-samples">Serialisation of the samples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#task-list">Task list</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-testing-of-the-api">User testing of the API</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision">Decision</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/development/pigs/pig-027.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
    
    <p>Licensed under
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a>.</p>
    <p>Examples, recipes, and other code licensed under
      <a href="https://opensource.org/license/BSD-3-Clause>" target="_blank">BSD 3-Clause "New" or "Revised"</a> license.</p>
    <p>Gammapy <a href="https://gammapy.org/DataPrivacy.html">Data Privacy</a> information.</p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>