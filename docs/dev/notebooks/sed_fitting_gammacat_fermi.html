
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Flux point fitting in Gammapy &#8212; gammapy v0.7.dev5391</title>
    <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.dev5391',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../index.html">gammapy v0.7.dev5391</a>
	 &#187;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<script type="text/javascript" src="../_static/linksdl.js"></script><div class="admonition note">
<p class="first"><strong>This is a fixed-text formatted version of a Jupyter notebook.</strong></p>
<p>Try online on Binder</p>
<p><a class="reference external" href="https://beta.mybinder.org/v2/gh/gammapy/gammapy-extra/master?filepath=sed_fitting_gammacat_fermi.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a></p>
<p>Alternatively you can download for each version of Gammapy a <a class="reference external" href="http://readthedocs.org/projects/gammapy/downloads/">HTMLZip
pack</a> containing
the whole HTML documentation and full collection of notebooks, so you
can execute them in your local <code class="docutils literal"><span class="pre">_static/notebooks/</span></code> folder. You can
also contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy-extra/tree/master/notebooks">GitHub
repository</a>.</p>
<p class="last"><strong>Source files:</strong>
<a class="reference external" href="../_static/notebooks/sed_fitting_gammacat_fermi.ipynb">sed_fitting_gammacat_fermi.ipynb</a>
|
<a class="reference external" href="../_static/notebooks/sed_fitting_gammacat_fermi.py">sed_fitting_gammacat_fermi.py</a></p>
</div>
<div class="section" id="Flux-point-fitting-in-Gammapy">
<h1>Flux point fitting in Gammapy<a class="headerlink" href="#Flux-point-fitting-in-Gammapy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we’re going to learn how to fit spectral models to
combined Fermi-LAT and IACT flux points.</p>
<p>The central class we’re going to use for this example analysis is:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/gammapy.spectrum.FluxPointFitter.html"><span class="doc">gammapy.spectrum.FluxPointFitter</span></a></li>
</ul>
<p>In addition we will work with the following data classes:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/gammapy.spectrum.FluxPoints.html"><span class="doc">gammapy.spectrum.FluxPoints</span></a></li>
<li><a class="reference internal" href="../api/gammapy.catalog.SourceCatalogGammaCat.html"><span class="doc">gammapy.catalog.SourceCatalogGammaCat</span></a></li>
<li><a class="reference internal" href="../api/gammapy.catalog.SourceCatalog3FHL.html"><span class="doc">gammapy.catalog.SourceCatalog3FHL</span></a></li>
<li><a class="reference internal" href="../api/gammapy.catalog.SourceCatalog3FGL.html"><span class="doc">gammapy.catalog.SourceCatalog3FGL</span></a></li>
</ul>
<p>And the following spectral model classes:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/gammapy.spectrum.models.PowerLaw.html"><span class="doc">PowerLaw</span></a></li>
<li><a class="reference internal" href="../api/gammapy.spectrum.models.ExponentialCutoffPowerLaw.html"><span class="doc">ExponentialCutoffPowerLaw</span></a></li>
<li><a class="reference internal" href="../api/gammapy.spectrum.models.LogParabola.html"><span class="doc">LogParabola</span></a></li>
</ul>
</div>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<p>Let us start with the usual IPython notebook and Python imports:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">vstack</span>
<span class="kn">from</span> <span class="nn">gammapy.spectrum.models</span> <span class="kn">import</span> <span class="n">PowerLaw</span><span class="p">,</span> <span class="n">ExponentialCutoffPowerLaw</span><span class="p">,</span> <span class="n">LogParabola</span>
<span class="kn">from</span> <span class="nn">gammapy.spectrum</span> <span class="kn">import</span> <span class="n">FluxPointFitter</span><span class="p">,</span> <span class="n">FluxPoints</span>
<span class="kn">from</span> <span class="nn">gammapy.catalog</span> <span class="kn">import</span> <span class="n">SourceCatalog3FGL</span><span class="p">,</span> <span class="n">SourceCatalogGammaCat</span><span class="p">,</span> <span class="n">SourceCatalog3FHL</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-spectral-points">
<h2>Load spectral points<a class="headerlink" href="#Load-spectral-points" title="Permalink to this headline">¶</a></h2>
<p>For this analysis we choose to work with the source ‘HESS J1507-622’ and
the associated Fermi-LAT sources ‘3FGL J1506.6-6219’ and ‘3FHL
J1507.9-6228e’. We load the source catalogs, and then access source of
interest by name:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">fermi_3fgl</span> <span class="o">=</span> <span class="n">SourceCatalog3FGL</span><span class="p">()</span>
<span class="n">fermi_3fhl</span> <span class="o">=</span> <span class="n">SourceCatalog3FHL</span><span class="p">()</span>
<span class="n">gammacat</span> <span class="o">=</span> <span class="n">SourceCatalogGammaCat</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">source_gammacat</span> <span class="o">=</span>  <span class="n">gammacat</span><span class="p">[</span><span class="s1">&#39;HESS J1507-622&#39;</span><span class="p">]</span>
<span class="n">source_fermi_3fgl</span> <span class="o">=</span> <span class="n">fermi_3fgl</span><span class="p">[</span><span class="s1">&#39;3FGL J1506.6-6219&#39;</span><span class="p">]</span>
<span class="n">source_fermi_3fhl</span> <span class="o">=</span> <span class="n">fermi_3fhl</span><span class="p">[</span><span class="s1">&#39;3FHL J1507.9-6228e&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The corresponding flux points data can be accessed with <code class="docutils literal"><span class="pre">.flux_points</span></code>
attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">flux_points_gammacat</span> <span class="o">=</span> <span class="n">source_gammacat</span><span class="o">.</span><span class="n">flux_points</span>
<span class="n">flux_points_gammacat</span><span class="o">.</span><span class="n">table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<i>Table length=6</i>
<table id="table4433829392" class="table-striped table-bordered table-condensed">
<thead><tr><th>e_ref</th><th>dnde</th><th>dnde_errn</th><th>dnde_errp</th></tr></thead>
<thead><tr><th>TeV</th><th>1 / (cm2 s TeV)</th><th>1 / (cm2 s TeV)</th><th>1 / (cm2 s TeV)</th></tr></thead>
<thead><tr><th>float32</th><th>float32</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>0.8609</td><td>2.29119e-12</td><td>8.70543e-13</td><td>8.95502e-13</td></tr>
<tr><td>1.56151</td><td>6.98172e-13</td><td>2.20354e-13</td><td>2.30407e-13</td></tr>
<tr><td>2.76375</td><td>1.69062e-13</td><td>6.7587e-14</td><td>7.18838e-14</td></tr>
<tr><td>4.8916</td><td>7.72925e-14</td><td>2.40132e-14</td><td>2.60749e-14</td></tr>
<tr><td>9.98858</td><td>1.03253e-14</td><td>5.06315e-15</td><td>5.64195e-15</td></tr>
<tr><td>27.0403</td><td>7.44987e-16</td><td>5.72089e-16</td><td>7.25999e-16</td></tr>
</table></div>
</div>
<p>In the Fermi-LAT catalogs, integral flux points are given. Currently the
flux point fitter only works with differential flux points, so we apply
the conversion here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">flux_points_3fgl</span> <span class="o">=</span> <span class="n">source_fermi_3fgl</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">to_sed_type</span><span class="p">(</span>
    <span class="n">sed_type</span><span class="o">=</span><span class="s1">&#39;dnde&#39;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">source_fermi_3fgl</span><span class="o">.</span><span class="n">spectral_model</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">flux_points_3fhl</span> <span class="o">=</span> <span class="n">source_fermi_3fhl</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">to_sed_type</span><span class="p">(</span>
    <span class="n">sed_type</span><span class="o">=</span><span class="s1">&#39;dnde&#39;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">source_fermi_3fhl</span><span class="o">.</span><span class="n">spectral_model</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally we stack the flux points into a single <code class="docutils literal"><span class="pre">FluxPoints</span></code> object and
drop the upper limit values, because currently we can’t handle them in
the fit:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># stack flux point tables</span>
<span class="n">flux_points</span> <span class="o">=</span> <span class="n">FluxPoints</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
    <span class="n">flux_points_gammacat</span><span class="p">,</span>
    <span class="n">flux_points_3fhl</span><span class="p">,</span>
    <span class="n">flux_points_3fgl</span>
<span class="p">])</span>

<span class="c1"># drop the flux upper limit values</span>
<span class="n">flux_points</span> <span class="o">=</span> <span class="n">flux_points</span><span class="o">.</span><span class="n">drop_ul</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Fitter-Setup">
<h2>Fitter Setup<a class="headerlink" href="#Fitter-Setup" title="Permalink to this headline">¶</a></h2>
<p>We initialze the fitter object with the <code class="docutils literal"><span class="pre">'chi2assym'</span></code> statistic,
because we have assymmetric errors on the flux points. As optimizer we
choose the <code class="docutils literal"><span class="pre">'simplex'</span></code> algorithm and to estimate the errors we use
<code class="docutils literal"><span class="pre">'covar'</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">fitter</span> <span class="o">=</span> <span class="n">FluxPointFitter</span><span class="p">(</span>
    <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;chi2assym&#39;</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;simplex&#39;</span><span class="p">,</span>
    <span class="n">error_estimator</span><span class="o">=</span><span class="s1">&#39;covar&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Power-Law-Fit">
<h2>Power Law Fit<a class="headerlink" href="#Power-Law-Fit" title="Permalink to this headline">¶</a></h2>
<p>First we start with fitting a simple <a class="reference internal" href="../api/gammapy.spectrum.models.PowerLaw.html#gammapy.spectrum.models.PowerLaw"><span class="std std-ref">power
law</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLaw</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mf">1e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 TeV-1&#39;</span><span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>After creating the model we run the fit by passing the <code class="docutils literal"><span class="pre">'flux_points'</span></code>
and <code class="docutils literal"><span class="pre">'pwl'</span></code> objects:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result_pwl</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">flux_points</span><span class="p">,</span> <span class="n">pwl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And print the result:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">result_pwl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PowerLaw

Parameters:

           name     value     error         unit      min max frozen
        --------- --------- --------- --------------- --- --- ------
            index 1.950e+00 2.656e-02                 nan nan  False
        amplitude 1.248e-12 1.599e-13 1 / (cm2 s TeV) nan nan  False
        reference 1.000e+00 0.000e+00             TeV nan nan   True

Covariance:

        name/name   index   amplitude
        --------- --------- ---------
            index  0.000706 -2.25e-15
        amplitude -2.25e-15  2.56e-26
</pre></div></div>
</div>
<p>As a quick check we print the value of the fit statistics per degrees of
freedom as well:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">result_pwl</span><span class="p">[</span><span class="s1">&#39;statval/dof&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.5038842921602655
</pre></div></div>
</div>
<p>Finally we plot the data points and the best fit model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">flux_points</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_pwl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_pwl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_error</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(1e-13, 1e-11)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sed_fitting_gammacat_fermi_26_1.png" src="../_images/notebooks_sed_fitting_gammacat_fermi_26_1.png" />
</div>
</div>
</div>
<div class="section" id="Exponential-Cut-Off-Powerlaw-Fit">
<h2>Exponential Cut-Off Powerlaw Fit<a class="headerlink" href="#Exponential-Cut-Off-Powerlaw-Fit" title="Permalink to this headline">¶</a></h2>
<p>Next we fit an <a class="reference internal" href="../api/gammapy.spectrum.models.ExponentialCutoffPowerLaw.html#gammapy.spectrum.models.ExponentialCutoffPowerLaw"><span class="std std-ref">exponential cut-off
power</span></a>
law to the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ecpl</span> <span class="o">=</span> <span class="n">ExponentialCutoffPowerLaw</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mf">1e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 TeV-1&#39;</span><span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">lambda_</span><span class="o">=</span><span class="mf">0.</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>We run the fitter again by passing the flux points and the <code class="docutils literal"><span class="pre">ecpl</span></code>
model instance:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result_ecpl</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">flux_points</span><span class="p">,</span> <span class="n">ecpl</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result_ecpl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ExponentialCutoffPowerLaw

Parameters:

           name     value     error         unit      min max frozen
        --------- --------- --------- --------------- --- --- ------
            index 1.876e+00 4.388e-02                 nan nan  False
        amplitude 1.932e-12 3.873e-13 1 / (cm2 s TeV) nan nan  False
        reference 1.000e+00 0.000e+00             TeV nan nan   True
          lambda_ 6.147e-02 5.795e-02         1 / TeV nan nan  False

Covariance:

        name/name   index   amplitude lambda_
        --------- --------- --------- --------
            index   0.00193 -1.35e-14 -0.00178
        amplitude -1.35e-14   1.5e-25 1.73e-14
          lambda_  -0.00178  1.73e-14  0.00336
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">result_ecpl</span><span class="p">[</span><span class="s1">&#39;statval/dof&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.001353939388082
</pre></div></div>
</div>
<p>We plot the data and best fit model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">flux_points</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_ecpl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_ecpl</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_error</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[17]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(1e-13, 1e-11)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sed_fitting_gammacat_fermi_33_1.png" src="../_images/notebooks_sed_fitting_gammacat_fermi_33_1.png" />
</div>
</div>
</div>
<div class="section" id="Log-Parabola-Fit">
<h2>Log-Parabola Fit<a class="headerlink" href="#Log-Parabola-Fit" title="Permalink to this headline">¶</a></h2>
<p>Finally we try to fit a
<a class="reference internal" href="../api/gammapy.spectrum.models.LogParabola.html#gammapy.spectrum.models.LogParabola"><span class="std std-ref">log-parabola</span></a>
model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">log_parabola</span> <span class="o">=</span> <span class="n">LogParabola</span><span class="p">(</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mf">1e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;cm-2 s-1 TeV-1&#39;</span><span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">0.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result_log_parabola</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">flux_points</span><span class="p">,</span> <span class="n">log_parabola</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result_log_parabola</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LogParabola

Parameters:

           name     value     error         unit      min max frozen
        --------- --------- --------- --------------- --- --- ------
        amplitude 1.954e-12 2.797e-13 1 / (cm2 s TeV) nan nan  False
        reference 1.000e+00 0.000e+00             TeV nan nan   True
            alpha 2.140e+00 7.377e-02                 nan nan  False
             beta 4.947e-02 1.757e-02                 nan nan  False

Covariance:

        name/name amplitude  alpha     beta
        --------- --------- -------- --------
        amplitude  7.82e-26 1.79e-15 2.19e-15
            alpha  1.79e-15  0.00544  0.00112
             beta  2.19e-15  0.00112 0.000309
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">result_log_parabola</span><span class="p">[</span><span class="s1">&#39;statval/dof&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.5798902196277185
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">flux_points</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_log_parabola</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result_log_parabola</span><span class="p">[</span><span class="s1">&#39;best-fit-model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_error</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">energy_power</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(1e-13, 1e-11)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sed_fitting_gammacat_fermi_38_1.png" src="../_images/notebooks_sed_fitting_gammacat_fermi_38_1.png" />
</div>
</div>
</div>
<div class="section" id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Fit a <code class="docutils literal"><span class="pre">PowerLaw2</span></code> and <code class="docutils literal"><span class="pre">ExponentialCutoffPowerLaw3FGL</span></code> to the same
data.</li>
<li>Fit a <code class="docutils literal"><span class="pre">ExponentialCutoffPowerLaw</span></code> model to Vela X (‘HESS
J0835-455’) only and check if the best fit values correspond to the
values given in the Gammacat catalog</li>
</ul>
</div>
<div class="section" id="What-next?">
<h2>What next?<a class="headerlink" href="#What-next?" title="Permalink to this headline">¶</a></h2>
<p>This was an introduction to SED fitting in Gammapy.</p>
<ul class="simple">
<li>If you would like to learn how to perform a full Poisson maximum
likelihood spectral fit, please check out the <a class="reference internal" href="spectrum_pipe.html"><span class="doc">spectrum
pipe</span></a> tutorial.</li>
<li>If you are interested in simulation of spectral data in the context
of CTA, please check out the <a class="reference internal" href="spectrum_simulation_cta.html"><span class="doc">spectrum simulation
cta</span></a> notebook.</li>
<li>To learn more about other parts of Gammapy (e.g. Fermi-LAT and TeV
data analysis), check out the other tutorial notebooks.</li>
<li>To see what’s available in Gammapy, browse the <a class="reference external" href="http://docs.gammapy.org/">Gammapy
docs</a> or use the full-text search.</li>
<li>If you have any questions, ask on the mailing list .</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Flux point fitting in Gammapy</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#Load-spectral-points">Load spectral points</a></li>
<li><a class="reference internal" href="#Fitter-Setup">Fitter Setup</a></li>
<li><a class="reference internal" href="#Power-Law-Fit">Power Law Fit</a></li>
<li><a class="reference internal" href="#Exponential-Cut-Off-Powerlaw-Fit">Exponential Cut-Off Powerlaw Fit</a></li>
<li><a class="reference internal" href="#Log-Parabola-Fit">Log-Parabola Fit</a></li>
<li><a class="reference internal" href="#Exercises">Exercises</a></li>
<li><a class="reference internal" href="#What-next?">What next?</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/notebooks/sed_fitting_gammacat_fermi.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5. &nbsp;
    Last built 08 Jan 2018. <br/>
  </p>
</footer>
  </body>
</html>