
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectral analysis with the HLI &#8212; gammapy vX.Y.Z</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Spectral analysis with energy-dependent directional cuts" href="spectral_analysis_rad_max.html" />
    <link rel="prev" title="Spectral analysis" href="spectral_analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user-guide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorials/analysis-1d/spectral_analysis_hli and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorials/analysis-1d/spectral_analysis_hli.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorials/analysis-1d/spectral_analysis_hli.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.2.dev339+g47ba55456 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/analysis_1.html">
   High level interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/analysis_2.html">
   Low level API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/overview.html">
   Data structures
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../data/cta.html">
   CTA with Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/fermi_lat.html">
   Fermi-LAT with Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/hawc.html">
   HAWC with Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/hess.html">
   H.E.S.S. with Gammapy
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cta_sensitivity.html">
   Point source sensitivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="extended_source_spectral_analysis.html">
   Spectral analysis of extended sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sed_fitting.html">
   Flux point fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spectral_analysis.html">
   Spectral analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Spectral analysis with the HLI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spectral_analysis_rad_max.html">
   Spectral analysis with energy-dependent directional cuts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spectrum_simulation.html">
   1D spectrum simulation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/detect.html">
   Source detection and significance maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/modeling_2D.html">
   2D map fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/ring_background.html">
   Ring background map
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/analysis_3d.html">
   3D detailed analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/analysis_mwl.html">
   Multi instrument joint 3D and 1D analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/cta_data_analysis.html">
   Basic image exploration and fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/event_sampling.html">
   Event sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/event_sampling_nrg_depend_models.html">
   Sample a source with energy-dependent temporal evolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/flux_profiles.html">
   Flux Profile Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/simulate_3d.html">
   3D map simulation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve.html">
   Light curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve_flare.html">
   Light curves for flares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve_simulation.html">
   Simulating and fitting a time varying source
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/pulsar_analysis.html">
   Pulsar analysis
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../api/astro_dark_matter.html">
   Dark matter spatial and spectral models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/catalog.html">
   Source catalogs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/datasets.html">
   Datasets - Reduced data, IRFs, models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/fitting.html">
   Fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/makers.html">
   Makers - Data reduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/maps.html">
   Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/mask_maps.html">
   Mask maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/model_management.html">
   Modelling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/models.html">
   Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../scripts/survey_map.html">
   Survey Map Script
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites">
   Prerequisites
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#context">
   Context
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#proposed-approach">
   Proposed approach
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-setup">
   Check setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-configuration">
   Analysis configuration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-data-stored-into-your-computer">
     Using data stored into your computer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-the-exclusion-mask">
     Setting the exclusion mask
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters">
     Using YAML configuration files for setting/writing the Data Reduction parameters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-first-step-of-the-analysis-the-data-reduction">
   Running the first step of the analysis: the Data Reduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration-of-the-analysis">
     Configuration of the analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#observation-selection">
     Observation selection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-the-data-reduction">
     Running the Data Reduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results-exploration">
     Results exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-dataset-to-disk">
     Save dataset to disk
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-fitting">
   Model fitting
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creation-of-the-model">
     Creation of the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-fitting-parameters">
     Setting fitting parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-the-fit">
     Running the fit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploration-of-the-fit-results">
     Exploration of the fit results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#serialisation-of-the-fit-result">
     Serialisation of the fit result
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creation-of-the-flux-points">
   Creation of the Flux points
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-the-estimation">
     Running the estimation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#serialisation-of-the-results">
     Serialisation of the results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-final-results-of-the-1d-analysis">
   Plotting the final results of the 1D Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#whats-next">
   What’s next?
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-analysis-1d-spectral-analysis-hli-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="spectral-analysis-with-the-hli">
<span id="sphx-glr-tutorials-analysis-1d-spectral-analysis-hli-py"></span><h1>Spectral analysis with the HLI<a class="headerlink" href="#spectral-analysis-with-the-hli" title="Permalink to this headline">#</a></h1>
<p>Introduction to 1D analysis using the Gammapy high level interface.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Understanding the gammapy data workflow, in particular what are DL3
events and instrument response functions (IRF).</p></li>
</ul>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">#</a></h2>
<p>This notebook is an introduction to gammapy analysis using the high
level interface.</p>
<p>Gammapy analysis consists in two main steps.</p>
<p>The first one is data reduction: user selected observations are reduced
to a geometry defined by the user. It can be 1D (spectrum from a given
extraction region) or 3D (with a sky projection and an energy axis). The
resulting reduced data and instrument response functions (IRF) are
called datasets in Gammapy.</p>
<p>The second step consists in setting a physical model on the datasets and
fitting it to obtain relevant physical information.</p>
<p><strong>Objective: Create a 1D dataset of the Crab using the H.E.S.S. DL3 data
release 1 and perform a simple model fitting of the Crab nebula.</strong></p>
</section>
<section id="proposed-approach">
<h2>Proposed approach<a class="headerlink" href="#proposed-approach" title="Permalink to this headline">#</a></h2>
<p>This notebook uses the high level <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> class to orchestrate data
reduction and run the data fits. In its current state, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code>
supports the standard analysis cases of joint or stacked 3D and 1D
analyses. It is instantiated with an <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> object that
gives access to analysis parameters either directly or via a YAML config
file.</p>
<p>To see what is happening under-the-hood and to get an idea of the
internal API, a second notebook performs the same analysis without using
the <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> class.</p>
<p>In summary, we have to:</p>
<ul class="simple">
<li><p>Create an <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> object and the
analysis configuration:</p>
<ul>
<li><p>Define what observations to use</p></li>
<li><p>Define the geometry of the dataset (data and IRFs)</p></li>
<li><p>Define the model we want to fit on the dataset.</p></li>
</ul>
</li>
<li><p>Instantiate a <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> from this configuration
and run the different analysis steps</p>
<ul>
<li><p>Observation selection</p></li>
<li><p>Data reduction</p></li>
<li><p>Model fitting</p></li>
<li><p>Estimating flux points</p></li>
</ul>
</li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a>

<span class="c1"># %matplotlib inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">gammapy.analysis</span> <span class="kn">import</span> <a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class"><span class="n">Analysis</span></a><span class="p">,</span> <span class="n">AnalysisConfig</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">Models</span>
</pre></div>
</div>
</section>
<section id="check-setup">
<h2>Check setup<a class="headerlink" href="#check-setup" title="Permalink to this headline">#</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.utils.check</span> <span class="kn">import</span> <span class="n">check_tutorials_setup</span>

<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/bin/python
        python_version         : 3.9.17
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 1.2.dev339+g47ba55456
        path                   : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy


Other packages:

        numpy                  : 1.25.1
        scipy                  : 1.11.1
        astropy                : 5.2.2
        regions                : 0.7
        click                  : 8.1.5
        yaml                   : 6.0
        IPython                : 8.14.0
        jupyterlab             : not installed
        matplotlib             : 3.7.2
        pandas                 : not installed
        healpy                 : 1.16.3
        iminuit                : 2.22.0
        sherpa                 : 4.15.1
        naima                  : 0.10.0
        emcee                  : 3.1.4
        corner                 : 2.2.2
        ray                    : 2.5.1


Gammapy environment variables:

        GAMMAPY_DATA           : /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/dev
</pre></div>
</div>
</section>
<section id="analysis-configuration">
<h2>Analysis configuration<a class="headerlink" href="#analysis-configuration" title="Permalink to this headline">#</a></h2>
<p>For configuration of the analysis we use the
<a class="reference external" href="https://en.wikipedia.org/wiki/YAML">YAML</a> data format. YAML is a
machine-readable serialisation format, that is also friendly for humans
to read. In this tutorial we will write the configuration file just
using Python strings, but of course the file can be created and modified
with any text editor of your choice.</p>
<p>Here is what the configuration for our analysis looks like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">yaml_str</span></a> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">observations:</span>
<span class="s2">    datastore: $GAMMAPY_DATA/hess-dl3-dr1</span>
<span class="s2">    obs_cone: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 5 deg}</span>

<span class="s2">datasets:</span>
<span class="s2">    type: 1d</span>
<span class="s2">    stack: true</span>
<span class="s2">    geom:</span>
<span class="s2">        axes:</span>
<span class="s2">            energy: {min: 0.5 TeV, max: 30 TeV, nbins: 20}</span>
<span class="s2">            energy_true: {min: 0.1 TeV, max: 50 TeV, nbins: 40}</span>
<span class="s2">    on_region: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 0.11 deg}</span>
<span class="s2">    containment_correction: true</span>
<span class="s2">    safe_mask:</span>
<span class="s2">       methods: [&#39;aeff-default&#39;, &#39;aeff-max&#39;]</span>
<span class="s2">       parameters: </span><span class="si">{aeff_percent: 0.1}</span>
<span class="s2">    background:</span>
<span class="s2">        method: reflected</span>
<span class="s2">fit:</span>
<span class="s2">    fit_range: {min: 1 TeV, max: 20 TeV}</span>

<span class="s2">flux_points:</span>
<span class="s2">    energy: {min: 1 TeV, max: 20 TeV, nbins: 8}</span>
<span class="s2">    source: &#39;crab&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.from_yaml" title="gammapy.analysis.AnalysisConfig.from_yaml" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">AnalysisConfig</span><span class="o">.</span><span class="n">from_yaml</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">yaml_str</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>AnalysisConfig

    general:
        log: {level: info, filename: null, filemode: null, format: null, datefmt: null}
        outdir: .
        n_jobs: 1
        datasets_file: null
        models_file: null
    observations:
        datastore: $GAMMAPY_DATA/hess-dl3-dr1
        obs_ids: []
        obs_file: null
        obs_cone: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 5.0 deg}
        obs_time: {start: null, stop: null}
        required_irf: [aeff, edisp, psf, bkg]
    datasets:
        type: 1d
        stack: true
        geom:
            wcs:
                skydir: {frame: null, lon: null, lat: null}
                binsize: 0.02 deg
                width: {width: 5.0 deg, height: 5.0 deg}
                binsize_irf: 0.2 deg
            selection: {offset_max: 2.5 deg}
            axes:
                energy: {min: 0.5 TeV, max: 30.0 TeV, nbins: 20}
                energy_true: {min: 0.1 TeV, max: 50.0 TeV, nbins: 40}
        map_selection: [counts, exposure, background, psf, edisp]
        background:
            method: reflected
            exclusion: null
            parameters: {}
        safe_mask:
            methods: [aeff-default, aeff-max]
            parameters: {aeff_percent: 0.1}
        on_region: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 0.11 deg}
        containment_correction: true
    fit:
        fit_range: {min: 1.0 TeV, max: 20.0 TeV}
    flux_points:
        energy: {min: 1.0 TeV, max: 20.0 TeV, nbins: 8}
        source: crab
        parameters: {selection_optional: all}
    excess_map:
        correlation_radius: 0.1 deg
        parameters: {}
        energy_edges: {min: null, max: null, nbins: null}
    light_curve:
        time_intervals: {start: null, stop: null}
        energy_edges: {min: null, max: null, nbins: null}
        source: source
        parameters: {selection_optional: all}
</pre></div>
</div>
<p>Note that you can save this string into a yaml file and load it as
follow:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># config = AnalysisConfig.read(&quot;config-1d.yaml&quot;)</span>
<span class="c1"># # the AnalysisConfig gives access to the various parameters used from logging to reduced dataset geometries</span>
<span class="c1"># print(config)</span>
</pre></div>
</div>
<section id="using-data-stored-into-your-computer">
<h3>Using data stored into your computer<a class="headerlink" href="#using-data-stored-into-your-computer" title="Permalink to this headline">#</a></h3>
<p>Here, we want to use Crab runs from the H.E.S.S. DL3-DR1. We have
defined the datastore and a cone search of observations pointing with 5
degrees of the Crab nebula. Parameters can be set directly or as a
python dict.</p>
<p>PS: do not forget to set up your environment variable <em>$GAMMAPY_DATA</em> to
your local directory containing the H.E.S.S. DL3-DR1 as described in
<a class="reference internal" href="../../getting-started/quickstart.html#quickstart-setup"><span class="std std-ref">Quickstart Setup</span></a>.</p>
</section>
<section id="setting-the-exclusion-mask">
<h3>Setting the exclusion mask<a class="headerlink" href="#setting-the-exclusion-mask" title="Permalink to this headline">#</a></h3>
<p>In order to properly adjust the background normalisation on regions
without gamma-ray signal, one needs to define an exclusion mask for the
background normalisation. For this tutorial, we use the following one
<code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/joint-crab/exclusion/exclusion_mask_crab.fits.gz</span></code></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">exclusion</span></a> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/joint-crab/exclusion/exclusion_mask_crab.fits.gz&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We’re all set. But before we go on let’s see how to save or import
<a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> objects though YAML files.</p>
</section>
<section id="using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters">
<h3>Using YAML configuration files for setting/writing the Data Reduction parameters<a class="headerlink" href="#using-yaml-configuration-files-for-setting-writing-the-data-reduction-parameters" title="Permalink to this headline">#</a></h3>
<p>One can export/import the <a class="reference internal" href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AnalysisConfig</span></code></a> to/from a YAML file.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.write" title="gammapy.analysis.AnalysisConfig.write" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">config</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig.read" title="gammapy.analysis.AnalysisConfig.read" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">AnalysisConfig</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>AnalysisConfig

    general:
        log: {level: info, filename: null, filemode: null, format: null, datefmt: null}
        outdir: .
        n_jobs: 1
        datasets_file: null
        models_file: null
    observations:
        datastore: $GAMMAPY_DATA/hess-dl3-dr1
        obs_ids: []
        obs_file: null
        obs_cone: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 5.0 deg}
        obs_time: {start: null, stop: null}
        required_irf: [aeff, edisp, psf, bkg]
    datasets:
        type: 1d
        stack: true
        geom:
            wcs:
                skydir: {frame: null, lon: null, lat: null}
                binsize: 0.02 deg
                width: {width: 5.0 deg, height: 5.0 deg}
                binsize_irf: 0.2 deg
            selection: {offset_max: 2.5 deg}
            axes:
                energy: {min: 0.5 TeV, max: 30.0 TeV, nbins: 20}
                energy_true: {min: 0.1 TeV, max: 50.0 TeV, nbins: 40}
        map_selection: [counts, exposure, background, psf, edisp]
        background:
            method: reflected
            exclusion: $GAMMAPY_DATA/joint-crab/exclusion/exclusion_mask_crab.fits.gz
            parameters: {}
        safe_mask:
            methods: [aeff-default, aeff-max]
            parameters: {aeff_percent: 0.1}
        on_region: {frame: icrs, lon: 83.633 deg, lat: 22.014 deg, radius: 0.11 deg}
        containment_correction: true
    fit:
        fit_range: {min: 1.0 TeV, max: 20.0 TeV}
    flux_points:
        energy: {min: 1.0 TeV, max: 20.0 TeV, nbins: 8}
        source: crab
        parameters: {selection_optional: all}
    excess_map:
        correlation_radius: 0.1 deg
        parameters: {}
        energy_edges: {min: null, max: null, nbins: null}
    light_curve:
        time_intervals: {start: null, stop: null}
        energy_edges: {min: null, max: null, nbins: null}
        source: source
        parameters: {selection_optional: all}
</pre></div>
</div>
</section>
</section>
<section id="running-the-first-step-of-the-analysis-the-data-reduction">
<h2>Running the first step of the analysis: the Data Reduction<a class="headerlink" href="#running-the-first-step-of-the-analysis-the-data-reduction" title="Permalink to this headline">#</a></h2>
<section id="configuration-of-the-analysis">
<h3>Configuration of the analysis<a class="headerlink" href="#configuration-of-the-analysis" title="Permalink to this headline">#</a></h3>
<p>We first create an <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code></a> object from our
configuration.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span></a> <span class="o">=</span> <a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class"><span class="n">Analysis</span></a><span class="p">(</span><a href="../../api/gammapy.analysis.AnalysisConfig.html#gammapy.analysis.AnalysisConfig" title="gammapy.analysis.AnalysisConfig" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">config</span></a><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="observation-selection">
<h3>Observation selection<a class="headerlink" href="#observation-selection" title="Permalink to this headline">#</a></h3>
<p>We can directly select and load the observations from disk using
<a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_observations" title="gammapy.analysis.Analysis.get_observations"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_observations()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_observations" title="gammapy.analysis.Analysis.get_observations" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_observations</span></a><span class="p">()</span>
</pre></div>
</div>
<p>The observations are now available on the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code> object. The
selection corresponds to the following ids:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.data.Observations.html#gammapy.data.Observations.ids" title="gammapy.data.Observations.ids" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-attribute"><span class="n">analysis</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">ids</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;23523&#39;, &#39;23526&#39;, &#39;23559&#39;, &#39;23592&#39;]
</pre></div>
</div>
<p>To see how to explore observations, please refer to the following
notebook: <a class="reference internal" href="../data/cta.html"><span class="doc">CTA with Gammapy</span></a> or <a class="reference internal" href="../data/hess.html"><span class="doc">H.E.S.S. with Gammapy</span></a></p>
</section>
<section id="running-the-data-reduction">
<h3>Running the Data Reduction<a class="headerlink" href="#running-the-data-reduction" title="Permalink to this headline">#</a></h3>
<p>Now we proceed to the data reduction. In the config file we have chosen
a WCS map geometry, energy axis and decided to stack the maps. We can
run the reduction using <a class="reference internal" href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_datasets" title="gammapy.analysis.Analysis.get_datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_datasets()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_datasets" title="gammapy.analysis.Analysis.get_datasets" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_datasets</span></a><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="results-exploration">
<h3>Results exploration<a class="headerlink" href="#results-exploration" title="Permalink to this headline">#</a></h3>
<p>As we have chosen to stack the data, one can print what contains the
unique entry of the datasets:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SpectrumDatasetOnOff
--------------------

  Name                            : stacked

  Total counts                    : 427
  Total background counts         : 25.86
  Total excess counts             : 401.14

  Predicted counts                : 43.14
  Predicted background counts     : 43.14
  Predicted excess counts         : nan

  Exposure min                    : 2.90e+07 m2 s
  Exposure max                    : 2.64e+09 m2 s

  Number of total bins            : 20
  Number of fit bins              : 18

  Fit statistic type              : wstat
  Fit statistic value (-2 log(L)) : 1396.10

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0

  Total counts_off                : 581
  Acceptance                      : 20
  Acceptance off                  : 495
</pre></div>
</div>
<p>As you can see the dataset uses WStat with the background computed with
the Reflected Background method during the data reduction, but no source
model has been set yet.</p>
<p>The counts, exposure and background, etc are directly available on the
dataset and can be printed:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.info_table" title="gammapy.datasets.Datasets.info_table" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">info_table</span></a><span class="p">()</span>
<a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Tobs=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;livetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Excess=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;excess&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">Significance=</span><span class="si">{</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info_table</span></a><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Tobs=1.8 h Excess=401.1 Significance=37.04
</pre></div>
</div>
</section>
<section id="save-dataset-to-disk">
<h3>Save dataset to disk<a class="headerlink" href="#save-dataset-to-disk" title="Permalink to this headline">#</a></h3>
<p>It is common to run the preparation step independent of the likelihood
fit, because often the preparation of counts, collection are and energy
dispersion is slow if you have a lot of data. We first create a folder:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a><span class="p">(</span><span class="s2">&quot;hli_spectrum_analysis&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir" title="pathlib.Path.mkdir" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-method"><span class="n">path</span><span class="o">.</span><span class="n">mkdir</span></a><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>And then write the stacked dataset to disk by calling the dedicated
<code class="xref py py-obj docutils literal notranslate"><span class="pre">write()</span></code> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;crab-stacked-dataset.fits.gz&quot;</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.write" title="gammapy.datasets.Datasets.write" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="model-fitting">
<h2>Model fitting<a class="headerlink" href="#model-fitting" title="Permalink to this headline">#</a></h2>
<section id="creation-of-the-model">
<h3>Creation of the model<a class="headerlink" href="#creation-of-the-model" title="Permalink to this headline">#</a></h3>
<p>First, let’s create a model to be adjusted. As we are performing a 1D
Analysis, only a spectral model is needed within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code>
object. Here is a pre-defined YAML configuration file created for this
1D analysis:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_str</span></a> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">components:</span>
<span class="s2">- name: crab</span>
<span class="s2">  type: SkyModel</span>
<span class="s2">  spectral:</span>
<span class="s2">    type: PowerLawSpectralModel</span>
<span class="s2">    parameters:</span>
<span class="s2">      - name: index</span>
<span class="s2">        frozen: false</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: &#39;&#39;</span>
<span class="s2">        value: 2.6</span>
<span class="s2">      - name: amplitude</span>
<span class="s2">        frozen: false</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: cm-2 s-1 TeV-1</span>
<span class="s2">        value: 5.0e-11</span>
<span class="s2">      - name: reference</span>
<span class="s2">        frozen: true</span>
<span class="s2">        scale: 1.0</span>
<span class="s2">        unit: TeV</span>
<span class="s2">        value: 1.0</span>
<span class="s2">&quot;&quot;&quot;</span>
<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.from_yaml" title="gammapy.modeling.models.Models.from_yaml" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">Models</span><span class="o">.</span><span class="n">from_yaml</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_str</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Models

Component 0: SkyModel

  Name                      : crab
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       :
  Temporal model type       :
  Parameters:
    index                         :      2.600   +/-    0.00
    amplitude                     :   5.00e-11   +/- 0.0e+00 1 / (cm2 s TeV)
    reference             (frozen):      1.000       TeV
</pre></div>
</div>
<p>Or from a yaml file, e.g.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model_1d = Models.read(&quot;model-1d.yaml&quot;)</span>
<span class="c1"># print(model_1d)</span>
</pre></div>
</div>
<p>Now we set the model on the analysis object:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.set_models" title="gammapy.analysis.Analysis.set_models" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">set_models</span></a><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_1d</span></a><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setting-fitting-parameters">
<h3>Setting fitting parameters<a class="headerlink" href="#setting-fitting-parameters" title="Permalink to this headline">#</a></h3>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Analysis</span></code> can perform a few modeling and fitting tasks besides data
reduction. Parameters have then to be passed to the configuration
object.</p>
</section>
<section id="running-the-fit">
<h3>Running the fit<a class="headerlink" href="#running-the-fit" title="Permalink to this headline">#</a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.run_fit" title="gammapy.analysis.Analysis.run_fit" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">run_fit</span></a><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="exploration-of-the-fit-results">
<h3>Exploration of the fit results<a class="headerlink" href="#exploration-of-the-fit-results" title="Permalink to this headline">#</a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis" title="gammapy.analysis.Analysis" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span></a><span class="o">.</span><span class="n">fit_result</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.to_parameters_table" title="gammapy.modeling.models.Models.to_parameters_table" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">model_1d</span><span class="o">.</span><span class="n">to_parameters_table</span></a><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>OptimizeResult

        backend    : minuit
        method     : migrad
        success    : True
        message    : Optimization terminated successfully.
        nfev       : 37
        total stat : 10.29

CovarianceResult

        backend    : minuit
        method     : hesse
        success    : True
        message    : Hesse terminated successfully.

model   type      name     value         unit      ... max frozen is_norm link
----- -------- --------- ---------- -------------- ... --- ------ ------- ----
 crab spectral     index 2.6768e+00                ... nan  False   False
 crab spectral amplitude 4.6795e-11 cm-2 s-1 TeV-1 ... nan  False    True
 crab spectral reference 1.0000e+00            TeV ... nan   True   False
</pre></div>
</div>
<p>To check the fit is correct, we compute the excess spectrum with the
predicted counts.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_spectrum</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_residuals</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_spectrum</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_spectrum</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_residuals</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_masks</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_spectrum</span></a><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_001.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_001.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="serialisation-of-the-fit-result">
<h3>Serialisation of the fit result<a class="headerlink" href="#serialisation-of-the-fit-result" title="Permalink to this headline">#</a></h3>
<p>This is how we can write the model back to file again:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;model-best-fit.yaml&quot;</span>
<a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.models" title="gammapy.analysis.Analysis.models" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-attribute"><span class="n">analysis</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.open" title="pathlib.Path.open" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-method"><span class="n">filename</span><span class="o">.</span><span class="n">open</span></a><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="io.TextIOWrapper" class="sphx-glr-backref-module-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">f</span></a><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="io.TextIOWrapper" class="sphx-glr-backref-module-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">f</span></a><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>components:
-   name: crab
    type: SkyModel
    spectral:
        type: PowerLawSpectralModel
        parameters:
        -   name: index
            value: 2.6768369901843756
            error: 0.10350022668787177
        -   name: amplitude
            value: 4.6794780128525457e-11
            unit: cm-2 s-1 TeV-1
            error: 4.67868433199427e-12
        -   name: reference
            value: 1.0
            unit: TeV
covariance: model-best-fit_covariance.dat
</pre></div>
</div>
</section>
</section>
<section id="creation-of-the-flux-points">
<h2>Creation of the Flux points<a class="headerlink" href="#creation-of-the-flux-points" title="Permalink to this headline">#</a></h2>
<section id="running-the-estimation">
<h3>Running the estimation<a class="headerlink" href="#running-the-estimation" title="Permalink to this headline">#</a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.analysis.Analysis.html#gammapy.analysis.Analysis.get_flux_points" title="gammapy.analysis.Analysis.get_flux_points" class="sphx-glr-backref-module-gammapy-analysis sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">get_flux_points</span></a><span class="p">()</span>

<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">data</span></a>
<a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp_table</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.to_table" title="gammapy.estimators.FluxPoints.to_table" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">to_table</span></a><span class="p">(</span><span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;dnde&quot;</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><a href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table" class="sphx-glr-backref-module-astropy-table sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">crab_fp_table</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>e_ref  e_min  e_max  ... success   norm_scan        stat_scan
 TeV    TeV    TeV   ...
------ ------ ------ ... ------- -------------- ------------------
 1.134  0.924  1.392 ...    True 0.200 .. 5.000  61.061 .. 323.310
 1.708  1.392  2.096 ...    True 0.200 .. 5.000 137.686 .. 402.694
 2.572  2.096  3.156 ...    True 0.200 .. 5.000 105.216 .. 245.371
 3.873  3.156  4.753 ...    True 0.200 .. 5.000  30.617 .. 190.044
 5.833  4.753  7.158 ...    True 0.200 .. 5.000   35.669 .. 89.296
 7.929  7.158  8.784 ...    True 0.200 .. 5.000    5.680 .. 33.974
10.779  8.784 13.228 ...    True 0.200 .. 5.000   15.247 .. 34.090
16.233 13.228 19.921 ...    True 0.200 .. 5.000    2.084 .. 28.509
</pre></div>
</div>
<p>Let’s plot the flux points with their likelihood profile</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">()</span>
<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.plot" title="gammapy.estimators.FluxPoints.plot" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;e2dnde&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">1.0e-12</span><span class="p">,</span> <span class="mf">2.0e-10</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.plot_ts_profiles" title="gammapy.estimators.FluxPoints.plot_ts_profiles" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">crab_fp</span><span class="o">.</span><span class="n">plot_ts_profiles</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <span class="n">sed_type</span><span class="o">=</span><span class="s2">&quot;e2dnde&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_002.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_002.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="serialisation-of-the-results">
<h3>Serialisation of the results<a class="headerlink" href="#serialisation-of-the-results" title="Permalink to this headline">#</a></h3>
<p>The flux points can be exported to a fits table following the format
defined
<a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/spectra/flux_points/index.html">here</a></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;flux-points.fits&quot;</span>
<a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.write" title="gammapy.datasets.FluxPointsDataset.write" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="plotting-the-final-results-of-the-1d-analysis">
<h2>Plotting the final results of the 1D Analysis<a class="headerlink" href="#plotting-the-final-results-of-the-1d-analysis" title="Permalink to this headline">#</a></h2>
<p>We can plot of the spectral fit with its error band overlaid with the
flux points:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_sed</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax_residuals</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.plot_fit" title="gammapy.datasets.FluxPointsDataset.plot_fit" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">analysis</span><span class="o">.</span><span class="n">flux_points</span><span class="o">.</span><span class="n">plot_fit</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html#matplotlib.axes.Axes.set_ylim" title="matplotlib.axes.Axes.set_ylim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_ylim</span></a><span class="p">(</span><span class="mf">1.0e-12</span><span class="p">,</span> <span class="mf">1.0e-9</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlim.html#matplotlib.axes.Axes.set_xlim" title="matplotlib.axes.Axes.set_xlim" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax_sed</span><span class="o">.</span><span class="n">set_xlim</span></a><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_spectral_analysis_hli_003.png" srcset="../../_images/sphx_glr_spectral_analysis_hli_003.png" alt="spectral analysis hli" class = "sphx-glr-single-img"/></section>
<section id="whats-next">
<h2>What’s next?<a class="headerlink" href="#whats-next" title="Permalink to this headline">#</a></h2>
<p>You can look at the same analysis without the high level interface in
<a class="reference internal" href="spectral_analysis.html"><span class="doc">Spectral analysis</span></a></p>
<p>As we can store the best model fit, you can overlay the fit results of
both methods on a unique plot.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  10.612 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-analysis-1d-spectral-analysis-hli-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/notebooks/dev/tutorials/analysis-1d/spectral_analysis_hli.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/409b56028ef9cfd36f43c590e76e483f/spectral_analysis_hli.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">spectral_analysis_hli.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9881fc418a8ff65abb21b42cdd40a75d/spectral_analysis_hli.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">spectral_analysis_hli.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>