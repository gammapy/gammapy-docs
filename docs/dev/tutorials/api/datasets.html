
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Datasets - Reduced data, IRFs, models &#8212; gammapy vX.Y.Z</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fitting" href="fitting.html" />
    <link rel="prev" title="Source catalogs" href="catalog.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user-guide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorials/api/datasets and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorials/api/datasets.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorials/api/datasets.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.20.2.dev555+geae94d979 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/analysis_1.html">
   High level interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/analysis_2.html">
   Low level API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../starting/overview.html">
   Data structures
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../data/cta.html">
   CTA with Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/fermi_lat.html">
   Fermi-LAT with Gammapy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/hess.html">
   H.E.S.S. with Gammapy
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/cta_sensitivity.html">
   Point source sensitivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/extended_source_spectral_analysis.html">
   Spectral analysis of extended sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/sed_fitting.html">
   Flux point fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/spectral_analysis.html">
   Spectral analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/spectral_analysis_hli.html">
   Spectral analysis with the HLI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/spectral_analysis_rad_max.html">
   Spectral analysis with energy-dependent directional cuts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-1d/spectrum_simulation.html">
   1D spectrum simulation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/detect.html">
   Source detection and significance maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/modeling_2D.html">
   2D map fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-2d/ring_background.html">
   Ring background map
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/analysis_3d.html">
   3D detailed analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/analysis_mwl.html">
   Multi instrument joint 3D and 1D analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/cta_data_analysis.html">
   Basic image exploration and fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/event_sampling.html">
   Event sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/flux_profiles.html">
   Flux Profile Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-3d/simulate_3d.html">
   3D map simulation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve.html">
   Light curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve_flare.html">
   Light curves for flares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/light_curve_simulation.html">
   Simulating and fitting a time varying source
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analysis-time/pulsar_analysis.html">
   Pulsar analysis
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="astro_dark_matter.html">
   Dark matter spatial and spectral models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="catalog.html">
   Source catalogs
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Datasets - Reduced data, IRFs, models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fitting.html">
   Fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="makers.html">
   Makers - Data reduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="maps.html">
   Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mask_maps.html">
   Mask maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_management.html">
   Modelling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="models.html">
   Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../scripts/survey_map.html">
   Survey Map Script
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-setup">
   Check setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mapdataset">
   MapDataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-an-empty-dataset">
     Creating an empty dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-contents-of-a-dataset">
   Accessing contents of a dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-masks">
     Using masks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#resampling-datasets">
     Resampling datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spectrumdataset">
   SpectrumDataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fluxpointsdataset">
   FluxPointsDataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datasets">
   Datasets
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-tutorials-api-datasets-py"><span class="std std-ref">here</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="datasets-reduced-data-irfs-models">
<span id="sphx-glr-tutorials-api-datasets-py"></span><h1>Datasets - Reduced data, IRFs, models<a class="headerlink" href="#datasets-reduced-data-irfs-models" title="Permalink to this headline">#</a></h1>
<p>Learn how to work with datasets</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../../api-reference/datasets.html#module-gammapy.datasets" title="gammapy.datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datasets</span></code></a> are a crucial part of the gammapy API. <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a>
objects constitute <code class="xref py py-obj docutils literal notranslate"><span class="pre">DL4</span></code> data - binned counts, IRFs, models and the associated
likelihoods. <a class="reference internal" href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Datasets</span></code></a> from the end product of the data reduction stage,
see <a class="reference external" href="makers.ipynb">makers notebook</a>, and are passed on to the <a class="reference internal" href="../../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit" title="gammapy.modeling.Fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fit</span></code></a>
or estimator classes for modelling and fitting purposes.</p>
<p>To find the different types of <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> objects that are supported see
<a class="reference external" href="../../user-guide/datasets/index.rst#Types-of-supported-datasets">Datasets
home</a></p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <a href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord" class="sphx-glr-backref-module-astropy-coordinates sphx-glr-backref-type-py-class"><span class="n">SkyCoord</span></a>
<span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class"><span class="n">CircleSkyRegion</span></a>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">GTI</span>
<span class="kn">from</span> <span class="nn">gammapy.datasets</span> <span class="kn">import</span> <span class="p">(</span>
    <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">Datasets</span></a><span class="p">,</span>
    <a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">FluxPointsDataset</span></a><span class="p">,</span>
    <span class="n">MapDataset</span><span class="p">,</span>
    <span class="n">SpectrumDatasetOnOff</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">gammapy.estimators</span> <span class="kn">import</span> <span class="n">FluxPoints</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="n">MapAxis</span><span class="p">,</span> <span class="n">WcsGeom</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <a href="../../api/gammapy.modeling.models.FoVBackgroundModel.html#gammapy.modeling.models.FoVBackgroundModel" title="gammapy.modeling.models.FoVBackgroundModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">FoVBackgroundModel</span></a><span class="p">,</span> <a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawSpectralModel</span></a><span class="p">,</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">SkyModel</span></a>
</pre></div>
</div>
</section>
<section id="check-setup">
<h2>Check setup<a class="headerlink" href="#check-setup" title="Permalink to this headline">#</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.utils.check</span> <span class="kn">import</span> <span class="n">check_tutorials_setup</span>
<span class="kn">from</span> <span class="nn">gammapy.utils.scripts</span> <span class="kn">import</span> <a href="../../api/gammapy.utils.scripts.make_path.html#gammapy.utils.scripts.make_path" title="gammapy.utils.scripts.make_path" class="sphx-glr-backref-module-gammapy-utils-scripts sphx-glr-backref-type-py-function"><span class="n">make_path</span></a>

<span class="c1"># %matplotlib inline</span>


<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/runner/micromamba-root/envs/gammapy-dev/bin/python
        python_version         : 3.8.13
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 0.20.2.dev555+geae94d979
        path                   : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy


Other packages:

        numpy                  : 1.22.4
        scipy                  : 1.9.1
        astropy                : 5.1
        regions                : 0.6
        click                  : 8.1.3
        yaml                   : 6.0
        IPython                : 8.5.0
        jupyterlab             : 3.4.7
        matplotlib             : 3.6.0
        pandas                 : 1.5.0
        healpy                 : 1.16.1
        iminuit                : 2.17.0
        sherpa                 : 4.14.1
        naima                  : 0.10.0
        emcee                  : 3.1.3
        corner                 : 2.2.1


Gammapy environment variables:

        GAMMAPY_DATA           : /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/dev
</pre></div>
</div>
</section>
<section id="mapdataset">
<h2>MapDataset<a class="headerlink" href="#mapdataset" title="Permalink to this headline">#</a></h2>
<p>The counts, exposure, background, masks, and IRF maps are bundled
together in a data structure named <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a>. While the <code class="xref py py-obj docutils literal notranslate"><span class="pre">counts</span></code>,
and <code class="xref py py-obj docutils literal notranslate"><span class="pre">background</span></code> maps are binned in reconstructed energy and must have
the same geometry, the IRF maps can have a different spatial (coarsely
binned and larger) geometry and spectral range (binned in true
energies). It is usually recommended that the true energy bin should be
larger and more finely sampled and the reco energy bin.</p>
<section id="creating-an-empty-dataset">
<h3>Creating an empty dataset<a class="headerlink" href="#creating-an-empty-dataset" title="Permalink to this headline">#</a></h3>
<p>An empty <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> can be directly instantiated from any
<a class="reference internal" href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WcsGeom</span></code></a> object:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.from_energy_bounds" title="gammapy.maps.MapAxis.from_energy_bounds" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;TeV&quot;</span><span class="p">)</span>

<a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.create" title="gammapy.maps.WcsGeom.create" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span></a><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mf">83.63</span><span class="p">,</span> <span class="mf">22.01</span><span class="p">),</span>
    <span class="n">axes</span><span class="o">=</span><span class="p">[</span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis</span></a><span class="p">],</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a><span class="p">,</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.05</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
<span class="p">)</span>

<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_empty</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.create" title="gammapy.datasets.MapDataset.create" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">MapDataset</span><span class="o">.</span><span class="n">create</span></a><span class="p">(</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="o">=</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-dataset&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is good practice to define a name for the dataset, such that you can
identify it later by name. However if you define a name it <strong>must</strong> be
unique. Now we can already print the dataset:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_empty</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapDataset
----------

  Name                            : my-dataset

  Total counts                    : 0
  Total background counts         : 0.00
  Total excess counts             : 0.00

  Predicted counts                : 0.00
  Predicted background counts     : 0.00
  Predicted excess counts         : nan

  Exposure min                    : 0.00e+00 m2 s
  Exposure max                    : 0.00e+00 m2 s

  Number of total bins            : 110000
  Number of fit bins              : 0

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : nan

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0
</pre></div>
</div>
<p>The printout shows the key summary information of the dataset, such as
total counts, fit statistics, model information etc.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">from_geom</span></code> has additional keywords, that can be used to
define the binning of the IRF related maps:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># choose a different true energy binning for the exposure, psf and edisp</span>
<a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis_true</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.from_energy_bounds" title="gammapy.maps.MapAxis.from_energy_bounds" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span></a><span class="p">(</span>
    <span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;TeV&quot;</span><span class="p">,</span> <span class="n">per_decade</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># choose a different rad axis binning for the psf</span>
<a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rad_axis</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.from_bounds" title="gammapy.maps.MapAxis.from_bounds" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">)</span>

<a href="../../api/gammapy.data.GTI.html#gammapy.data.GTI" title="gammapy.data.GTI" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gti</span></a> <span class="o">=</span> <a href="../../api/gammapy.data.GTI.html#gammapy.data.GTI.create" title="gammapy.data.GTI.create" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-method"><span class="n">GTI</span><span class="o">.</span><span class="n">create</span></a><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.IrreducibleUnit.html#astropy.units.IrreducibleUnit" title="astropy.units.IrreducibleUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">s</span></a><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.IrreducibleUnit.html#astropy.units.IrreducibleUnit" title="astropy.units.IrreducibleUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">s</span></a><span class="p">)</span>

<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_empty</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.create" title="gammapy.datasets.MapDataset.create" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">MapDataset</span><span class="o">.</span><span class="n">create</span></a><span class="p">(</span>
    <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="o">=</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="p">,</span>
    <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis_true</span></a><span class="o">=</span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis_true</span></a><span class="p">,</span>
    <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rad_axis</span></a><span class="o">=</span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rad_axis</span></a><span class="p">,</span>
    <span class="n">binsz_irf</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <a href="../../api/gammapy.data.GTI.html#gammapy.data.GTI" title="gammapy.data.GTI" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gti</span></a><span class="o">=</span><a href="../../api/gammapy.data.GTI.html#gammapy.data.GTI" title="gammapy.data.GTI" class="sphx-glr-backref-module-gammapy-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gti</span></a><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset-empty&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To see the geometry of each map, we can use:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.geoms" title="gammapy.datasets.MapDataset.geoms" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">dataset_empty</span><span class="o">.</span><span class="n">geoms</span></a>
</pre></div>
</div>
<p>Another way to create a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> is to just read an existing one
from a FITS file:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.read" title="gammapy.datasets.MapDataset.read" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">MapDataset</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/cta-1dc-gc/cta-1dc-gc.fits.gz&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset-cta&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapDataset
----------

  Name                            : dataset-cta

  Total counts                    : 104317
  Total background counts         : 91507.70
  Total excess counts             : 12809.30

  Predicted counts                : 91507.69
  Predicted background counts     : 91507.70
  Predicted excess counts         : nan

  Exposure min                    : 6.28e+07 m2 s
  Exposure max                    : 1.90e+10 m2 s

  Number of total bins            : 768000
  Number of fit bins              : 691680

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : nan

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0
</pre></div>
</div>
</section>
</section>
<section id="accessing-contents-of-a-dataset">
<h2>Accessing contents of a dataset<a class="headerlink" href="#accessing-contents-of-a-dataset" title="Permalink to this headline">#</a></h2>
<p>To further explore the contents of a <code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code>, you can use
e.g. <code class="xref py py-obj docutils literal notranslate"><span class="pre">info_dict()</span></code></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For a quick info, use</span>
<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.info_dict" title="gammapy.datasets.MapDataset.info_dict" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">info_dict</span></a><span class="p">()</span>

<span class="c1"># For a quick view, use</span>
<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.peek" title="gammapy.datasets.MapDataset.peek" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">peek</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_001.png" srcset="../../_images/sphx_glr_datasets_001.png" alt="Counts, Excess counts, Exposure, Background" class = "sphx-glr-single-img"/><p>And access individual maps like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">counts_image</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.smooth" title="gammapy.maps.WcsNDMap.smooth" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">counts_image</span><span class="o">.</span><span class="n">smooth</span></a><span class="p">(</span><span class="s2">&quot;0.1 deg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_002.png" srcset="../../_images/sphx_glr_datasets_002.png" alt="datasets" class = "sphx-glr-single-img"/><p>Of course you can also access IRF related maps, e.g. the psf as
<a class="reference internal" href="../../api/gammapy.irf.PSFMap.html#gammapy.irf.PSFMap" title="gammapy.irf.PSFMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PSFMap</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.irf.PSFMap.html#gammapy.irf.PSFMap" title="gammapy.irf.PSFMap" class="sphx-glr-backref-module-gammapy-irf sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">psf</span></a>
</pre></div>
</div>
<p>And use any method on the <a class="reference internal" href="../../api/gammapy.irf.PSFMap.html#gammapy.irf.PSFMap" title="gammapy.irf.PSFMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PSFMap</span></code></a> object:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://docs.astropy.org/en/latest/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">radius</span></a> <span class="o">=</span> <a href="../../api/gammapy.irf.PSFMap.html#gammapy.irf.PSFMap.containment_radius" title="gammapy.irf.PSFMap.containment_radius" class="sphx-glr-backref-module-gammapy-irf sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">containment_radius</span></a><span class="p">(</span><span class="n">energy_true</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.astropy.org/en/latest/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">radius</span></a><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplot.html#matplotlib.pyplot.subplot" title="matplotlib.pyplot.subplot" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span></a><span class="p">()</span>
<a href="../../api/gammapy.irf.EDispKernel.html#gammapy.irf.EDispKernel" title="gammapy.irf.EDispKernel" class="sphx-glr-backref-module-gammapy-irf sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">edisp_kernel</span></a> <span class="o">=</span> <a href="../../api/gammapy.irf.EDispKernelMap.html#gammapy.irf.EDispKernelMap.get_edisp_kernel" title="gammapy.irf.EDispKernelMap.get_edisp_kernel" class="sphx-glr-backref-module-gammapy-irf sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">edisp</span><span class="o">.</span><span class="n">get_edisp_kernel</span></a><span class="p">()</span>
<a href="../../api/gammapy.irf.EDispKernel.html#gammapy.irf.EDispKernel.plot_matrix" title="gammapy.irf.EDispKernel.plot_matrix" class="sphx-glr-backref-module-gammapy-irf sphx-glr-backref-type-py-method"><span class="n">edisp_kernel</span><span class="o">.</span><span class="n">plot_matrix</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_003.png" srcset="../../_images/sphx_glr_datasets_003.png" alt="datasets" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0.08675] deg
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> typically also contains the information on the
residual hadronic background, stored in <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.background" title="gammapy.datasets.MapDataset.background"><code class="xref py py-obj docutils literal notranslate"><span class="pre">background</span></code></a> as a
map:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">background</span></a>
</pre></div>
</div>
<p>As a next step we define a minimal model on the dataset using the
<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.models" title="gammapy.datasets.MapDataset.models"><code class="xref py py-obj docutils literal notranslate"><span class="pre">models</span></code></a> setter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel.create" title="gammapy.modeling.models.SkyModel.create" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">SkyModel</span><span class="o">.</span><span class="n">create</span></a><span class="p">(</span><span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gc&quot;</span><span class="p">)</span>
<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel.spatial_model" title="gammapy.modeling.models.SkyModel.spatial_model" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">spatial_model</span><span class="o">.</span><span class="n">position</span></a> <span class="o">=</span> <a href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord" class="sphx-glr-backref-module-astropy-coordinates sphx-glr-backref-type-py-class"><span class="n">SkyCoord</span></a><span class="p">(</span><span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<a href="../../api/gammapy.modeling.models.FoVBackgroundModel.html#gammapy.modeling.models.FoVBackgroundModel" title="gammapy.modeling.models.FoVBackgroundModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_bkg</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.FoVBackgroundModel.html#gammapy.modeling.models.FoVBackgroundModel" title="gammapy.modeling.models.FoVBackgroundModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">FoVBackgroundModel</span></a><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;dataset-cta&quot;</span><span class="p">)</span>

<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.models" title="gammapy.datasets.MapDataset.models" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">models</span></a> <span class="o">=</span> <span class="p">[</span><a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="../../api/gammapy.modeling.models.FoVBackgroundModel.html#gammapy.modeling.models.FoVBackgroundModel" title="gammapy.modeling.models.FoVBackgroundModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_bkg</span></a><span class="p">]</span>
</pre></div>
</div>
<p>Assigning models to datasets is covered in more detail in the <a class="reference external" href="model_management.ipynb">Modeling
notebook</a>. Printing the dataset will now show
the mode components:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapDataset
----------

  Name                            : dataset-cta

  Total counts                    : 104317
  Total background counts         : 91507.70
  Total excess counts             : 12809.30

  Predicted counts                : 91719.65
  Predicted background counts     : 91507.69
  Predicted excess counts         : 211.96

  Exposure min                    : 6.28e+07 m2 s
  Exposure max                    : 1.90e+10 m2 s

  Number of total bins            : 768000
  Number of fit bins              : 691680

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : 424648.57

  Number of models                : 2
  Number of parameters            : 8
  Number of free parameters       : 5

  Component 0: SkyModel

    Name                      : gc
    Datasets names            : None
    Spectral model type       : PowerLawSpectralModel
    Spatial  model type       : PointSpatialModel
    Temporal model type       :
    Parameters:
      index                         :      2.000   +/-    0.00
      amplitude                     :   1.00e-12   +/- 0.0e+00 1 / (cm2 s TeV)
      reference             (frozen):      1.000       TeV
      lon_0                         :      4.650   +/-    0.00 rad
      lat_0                         :     -0.505   +/-    0.00 rad

  Component 1: FoVBackgroundModel

    Name                      : dataset-cta-bkg
    Datasets names            : [&#39;dataset-cta&#39;]
    Spectral model type       : PowerLawNormSpectralModel
    Parameters:
      norm                          :      1.000   +/-    0.00
      tilt                  (frozen):      0.000
      reference             (frozen):      1.000       TeV
</pre></div>
</div>
<p>Now we can use the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.npred" title="gammapy.datasets.MapDataset.npred"><code class="xref py py-obj docutils literal notranslate"><span class="pre">npred</span></code></a> method to get a map of the total predicted counts
of the model:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">npred</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.npred" title="gammapy.datasets.MapDataset.npred" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">npred</span></a><span class="p">()</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">npred</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_004.png" srcset="../../_images/sphx_glr_datasets_004.png" alt="datasets" class = "sphx-glr-single-img"/><p>To get the predicted counts from an individual model component we can
use:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">npred_source</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.npred_signal" title="gammapy.datasets.MapDataset.npred_signal" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">npred_signal</span></a><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;gc&quot;</span><span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">npred_source</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_005.png" srcset="../../_images/sphx_glr_datasets_005.png" alt="datasets" class = "sphx-glr-single-img"/><p><a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.background" title="gammapy.datasets.MapDataset.background"><code class="xref py py-obj docutils literal notranslate"><span class="pre">background</span></code></a> contains the background map computed from the
IRF. Internally it will be combined with a <a class="reference internal" href="../../api/gammapy.modeling.models.FoVBackgroundModel.html#gammapy.modeling.models.FoVBackgroundModel" title="gammapy.modeling.models.FoVBackgroundModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FoVBackgroundModel</span></code></a>, to
allow for adjusting the backgroun model during a fit. To get the model
corrected background, one can use <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.npred_background" title="gammapy.datasets.MapDataset.npred_background"><code class="xref py py-obj docutils literal notranslate"><span class="pre">npred_background</span></code></a>.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">npred_background</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.npred_background" title="gammapy.datasets.MapDataset.npred_background" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">npred_background</span></a><span class="p">()</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">npred_background</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_006.png" srcset="../../_images/sphx_glr_datasets_006.png" alt="datasets" class = "sphx-glr-single-img"/><section id="using-masks">
<h3>Using masks<a class="headerlink" href="#using-masks" title="Permalink to this headline">#</a></h3>
<p>There are two masks that can be set on a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a>, <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_safe" title="gammapy.datasets.MapDataset.mask_safe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code></a> and
<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a>.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_safe" title="gammapy.datasets.MapDataset.mask_safe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code></a> is computed during the data reduction process
according to the specified selection cuts, and should not be changed
by the user.</p></li>
<li><p>During modelling and fitting, the user might want to additionally
ignore some parts of a reduced dataset, e.g. to restrict the fit to a
specific energy range or to ignore parts of the region of interest.
This should be done by applying the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a>. To see details of
applying masks, please refer to <span class="xref std std-ref">Masks for fitting</span>.</p></li>
</ul>
<p>Both the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a> and <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_safe" title="gammapy.datasets.MapDataset.mask_safe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code></a> must
have the same <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.geom" title="gammapy.maps.Map.geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">geom</span></code></a> as the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.counts" title="gammapy.datasets.MapDataset.counts"><code class="xref py py-obj docutils literal notranslate"><span class="pre">counts</span></code></a> and <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.background" title="gammapy.datasets.MapDataset.background"><code class="xref py py-obj docutils literal notranslate"><span class="pre">background</span></code></a> maps.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eg: to see the safe data range</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">mask_safe</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_007.png" srcset="../../_images/sphx_glr_datasets_007.png" alt="Energy 100 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 158 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 251 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 398 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 631 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.58 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 2.51 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 3.98 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 6.31 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/><p>In addition it is possible to define a custom <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To apply a mask fit - in enegy and space</span>
<a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">region</span></a> <span class="o">=</span> <a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class"><span class="n">CircleSkyRegion</span></a><span class="p">(</span><a href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord" class="sphx-glr-backref-module-astropy-coordinates sphx-glr-backref-type-py-class"><span class="n">SkyCoord</span></a><span class="p">(</span><span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">),</span> <span class="mf">1.5</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a><span class="p">)</span>

<a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.geom" title="gammapy.maps.WcsNDMap.geom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-attribute"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span></a>

<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_space</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.region_mask" title="gammapy.maps.WcsGeom.region_mask" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">geom</span><span class="o">.</span><span class="n">region_mask</span></a><span class="p">([</span><a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">region</span></a><span class="p">])</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_energy</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.energy_mask" title="gammapy.maps.WcsGeom.energy_mask" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">geom</span><span class="o">.</span><span class="n">energy_mask</span></a><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">,</span> <span class="mi">8</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">mask_fit</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_space</span></a> <span class="o">&amp;</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_energy</span></a>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">mask_fit</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_008.png" srcset="../../_images/sphx_glr_datasets_008.png" alt="Energy 100 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 158 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 251 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 398 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 631 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.58 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 2.51 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 3.98 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 6.31 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/><p>To access the energy range defined by the mask you can use:</p>
<p>-<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.energy_range_safe" title="gammapy.datasets.MapDataset.energy_range_safe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">energy_range_safe</span></code></a> : energy range definedby the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_safe" title="gammapy.datasets.MapDataset.mask_safe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code></a>
- <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.energy_range_fit" title="gammapy.datasets.MapDataset.energy_range_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">energy_range_fit</span></code></a> : energy range defined by the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a>
- <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.energy_range" title="gammapy.datasets.MapDataset.energy_range"><code class="xref py py-obj docutils literal notranslate"><span class="pre">energy_range</span></code></a> : the final energy range used in likelihood computation</p>
<p>These methods return two maps, with the <a class="reference external" href="https://docs.python.org/3/library/functions.html#min" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">min</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/functions.html#max" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">max</span></code></a> energy
values at each spatial pixel</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">e_min</span></a><span class="p">,</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">e_max</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.energy_range" title="gammapy.datasets.MapDataset.energy_range" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">energy_range</span></a>

<span class="c1"># To see the lower energy threshold at each point</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot" title="gammapy.maps.WcsNDMap.plot" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">e_min</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># To see the lower energy threshold at each point</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot" title="gammapy.maps.WcsNDMap.plot" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">e_max</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_009.png" srcset="../../_images/sphx_glr_datasets_009.png" alt="datasets" class = "sphx-glr-single-img"/><p>Just as for <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> objects it is possible to cutout a whole
<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a>, which will perform the cutout for all maps in
parallel.Optionally one can provide a new name to the resulting dataset:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cutout</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.cutout" title="gammapy.datasets.MapDataset.cutout" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">cutout</span></a><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><a href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord" class="sphx-glr-backref-module-astropy-coordinates sphx-glr-backref-type-py-class"><span class="n">SkyCoord</span></a><span class="p">(</span><span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="s2">&quot;0d&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">),</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cta-cutout&quot;</span><span class="p">,</span>
<span class="p">)</span>

<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">cutout</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_010.png" srcset="../../_images/sphx_glr_datasets_010.png" alt="datasets" class = "sphx-glr-single-img"/><p>It is also possible to slice a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> in energy:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sliced</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.slice_by_energy" title="gammapy.datasets.MapDataset.slice_by_energy" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">slice_by_energy</span></a><span class="p">(</span>
    <span class="n">energy_min</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;slice-energy&quot;</span>
<span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">sliced</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_011.png" srcset="../../_images/sphx_glr_datasets_011.png" alt="Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.58 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 2.51 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/><p>The same operation will be applied to all other maps contained in the
datasets such as <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.mask_fit" title="gammapy.datasets.MapDataset.mask_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_fit</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">sliced</span><span class="o">.</span><span class="n">mask_fit</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_012.png" srcset="../../_images/sphx_glr_datasets_012.png" alt="Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.58 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 2.51 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/></section>
<section id="resampling-datasets">
<h3>Resampling datasets<a class="headerlink" href="#resampling-datasets" title="Permalink to this headline">#</a></h3>
<p>It can often be useful to coarsely rebin an initially computed datasets
by a specified factor. This can be done in either spatial or energy
axes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">downsampled</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.downsample" title="gammapy.datasets.MapDataset.downsample" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">downsample</span></a><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.sum_over_axes" title="gammapy.maps.WcsNDMap.sum_over_axes" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">downsampled</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">sum_over_axes</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_013.png" srcset="../../_images/sphx_glr_datasets_013.png" alt="datasets" class = "sphx-glr-single-img"/><p>And the same downsampling process is possible along the energy axis:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">downsampled_energy</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.downsample" title="gammapy.datasets.MapDataset.downsample" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">downsample</span></a><span class="p">(</span>
    <span class="n">factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;downsampled-energy&quot;</span>
<span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">downsampled_energy</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_014.png" srcset="../../_images/sphx_glr_datasets_014.png" alt="Energy 100 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/><p>In the printout one can see that the actual number of counts is
preserved during the downsampling:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">downsampled_energy</span></a><span class="p">,</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapDataset
----------

  Name                            : downsampled-energy

  Total counts                    : 104317
  Total background counts         : 91507.69
  Total excess counts             : 12809.31

  Predicted counts                : 91507.69
  Predicted background counts     : 91507.69
  Predicted excess counts         : nan

  Exposure min                    : 6.28e+07 m2 s
  Exposure max                    : 1.90e+10 m2 s

  Number of total bins            : 153600
  Number of fit bins              : 22608

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : nan

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0

 MapDataset
----------

  Name                            : dataset-cta

  Total counts                    : 104317
  Total background counts         : 91507.70
  Total excess counts             : 12809.30

  Predicted counts                : 91719.65
  Predicted background counts     : 91507.69
  Predicted excess counts         : 211.96

  Exposure min                    : 6.28e+07 m2 s
  Exposure max                    : 1.90e+10 m2 s

  Number of total bins            : 768000
  Number of fit bins              : 67824

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : 44317.66

  Number of models                : 2
  Number of parameters            : 8
  Number of free parameters       : 5

  Component 0: SkyModel

    Name                      : gc
    Datasets names            : None
    Spectral model type       : PowerLawSpectralModel
    Spatial  model type       : PointSpatialModel
    Temporal model type       :
    Parameters:
      index                         :      2.000   +/-    0.00
      amplitude                     :   1.00e-12   +/- 0.0e+00 1 / (cm2 s TeV)
      reference             (frozen):      1.000       TeV
      lon_0                         :      4.650   +/-    0.00 rad
      lat_0                         :     -0.505   +/-    0.00 rad

  Component 1: FoVBackgroundModel

    Name                      : dataset-cta-bkg
    Datasets names            : [&#39;dataset-cta&#39;]
    Spectral model type       : PowerLawNormSpectralModel
    Parameters:
      norm                          :      1.000   +/-    0.00
      tilt                  (frozen):      0.000
      reference             (frozen):      1.000       TeV
</pre></div>
</div>
<p>We can also resample the finer binned datasets to an arbitrary coarser
energy binning using:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis_new</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.from_energy_edges" title="gammapy.maps.MapAxis.from_energy_edges" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_edges</span></a><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">)</span>
<a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">resampled</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.resample_energy_axis" title="gammapy.datasets.MapDataset.resample_energy_axis" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">resample_energy_axis</span></a><span class="p">(</span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis</span></a><span class="o">=</span><a href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy_axis_new</span></a><span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_grid" title="gammapy.maps.WcsNDMap.plot_grid" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">resampled</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot_grid</span></a><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_015.png" srcset="../../_images/sphx_glr_datasets_015.png" alt="Energy 100 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 251 GeV - {energy_unit_format(axis.edges[idx+1])}, Energy 1.00 TeV - {energy_unit_format(axis.edges[idx+1])}, Energy 2.51 TeV - {energy_unit_format(axis.edges[idx+1])}" class = "sphx-glr-single-img"/><p>To squash the whole dataset into a single energy bin there is the
<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.to_image" title="gammapy.datasets.MapDataset.to_image"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_image()</span></code></a> convenience method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_image</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.to_image" title="gammapy.datasets.MapDataset.to_image" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">to_image</span></a><span class="p">()</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot" title="gammapy.maps.WcsNDMap.plot" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">dataset_image</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_016.png" srcset="../../_images/sphx_glr_datasets_016.png" alt="datasets" class = "sphx-glr-single-img"/></section>
</section>
<section id="spectrumdataset">
<h2>SpectrumDataset<a class="headerlink" href="#spectrumdataset" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset" title="gammapy.datasets.SpectrumDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a> inherits from a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a>, and is specially
adapted for 1D spectral analysis, and uses a <code class="xref py py-obj docutils literal notranslate"><span class="pre">RegionGeom</span></code> instead of a
<code class="xref py py-obj docutils literal notranslate"><span class="pre">WcsGeom</span></code>. A <code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatset</span></code> can be converted to a <a class="reference internal" href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset" title="gammapy.datasets.SpectrumDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a>,
by summing the <code class="xref py py-obj docutils literal notranslate"><span class="pre">counts</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">background</span></code> inside the <code class="xref py py-obj docutils literal notranslate"><span class="pre">on_region</span></code>,
which can then be used for classical spectral analysis. Containment
correction is feasible only for circular regions.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">region</span></a> <span class="o">=</span> <a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class"><span class="n">CircleSkyRegion</span></a><span class="p">(</span><a href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord" class="sphx-glr-backref-module-astropy-coordinates sphx-glr-backref-type-py-class"><span class="n">SkyCoord</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/latest/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a><span class="p">)</span>
<a href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset" title="gammapy.datasets.SpectrumDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectrum_dataset</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.to_spectrum_dataset" title="gammapy.datasets.MapDataset.to_spectrum_dataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">to_spectrum_dataset</span></a><span class="p">(</span>
    <a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">region</span></a><span class="p">,</span> <span class="n">containment_correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;spectrum-dataset&quot;</span>
<span class="p">)</span>

<span class="c1"># For a quick look</span>
<a href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset.peek" title="gammapy.datasets.SpectrumDataset.peek" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">spectrum_dataset</span><span class="o">.</span><span class="n">peek</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_017.png" srcset="../../_images/sphx_glr_datasets_017.png" alt="Counts, Exposure, Energy Dispersion" class = "sphx-glr-single-img"/><p>A <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> can also be integrated over the <code class="xref py py-obj docutils literal notranslate"><span class="pre">on_region</span></code> to create
a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> with a <a class="reference internal" href="../../api/gammapy.maps.RegionGeom.html#gammapy.maps.RegionGeom" title="gammapy.maps.RegionGeom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RegionGeom</span></code></a>. Complex regions can be handled
and since the full IRFs are used, containment correction is not
required.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reg_dataset</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset.to_region_map_dataset" title="gammapy.datasets.MapDataset.to_region_map_dataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">dataset_cta</span><span class="o">.</span><span class="n">to_region_map_dataset</span></a><span class="p">(</span><a href="https://astropy-regions.readthedocs.io/en/latest/api/regions.CircleSkyRegion.html#regions.CircleSkyRegion" title="regions.CircleSkyRegion" class="sphx-glr-backref-module-regions sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">region</span></a><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;region-map-dataset&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reg_dataset</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapDataset
----------

  Name                            : region-map-dataset

  Total counts                    : 5644
  Total background counts         : 3323.66
  Total excess counts             : 2320.34

  Predicted counts                : 3323.66
  Predicted background counts     : 3323.66
  Predicted excess counts         : nan

  Exposure min                    : 4.66e+08 m2 s
  Exposure max                    : 1.89e+10 m2 s

  Number of total bins            : 10
  Number of fit bins              : 6

  Fit statistic type              : cash
  Fit statistic value (-2 log(L)) : nan

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0
</pre></div>
</div>
</section>
<section id="fluxpointsdataset">
<h2>FluxPointsDataset<a class="headerlink" href="#fluxpointsdataset" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPointsDataset</span></code></a> is a <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> container for precomputed flux
points, which can be then used in fitting. <a class="reference internal" href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPointsDataset</span></code></a> cannot
be read directly, but should be read through <code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPoints</span></code>, with an
additional <a class="reference internal" href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code></a>. Similarly, <a class="reference internal" href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.write" title="gammapy.datasets.FluxPointsDataset.write"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write</span></code></a> only
saves the <code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPointsDataset,data</span></code> attribute to disk.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">flux_points</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints.read" title="gammapy.estimators.FluxPoints.read" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">FluxPoints</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/tests/spectrum/flux_points/diff_flux_points.fits&quot;</span>
<span class="p">)</span>
<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">SkyModel</span></a><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawSpectralModel</span></a><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mf">2.3</span><span class="p">))</span>
<a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fp_dataset</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">FluxPointsDataset</span></a><span class="p">(</span><span class="n">data</span><span class="o">=</span><a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">flux_points</span></a><span class="p">,</span> <span class="n">models</span><span class="o">=</span><a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">)</span>

<a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.plot_spectrum" title="gammapy.datasets.FluxPointsDataset.plot_spectrum" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">fp_dataset</span><span class="o">.</span><span class="n">plot_spectrum</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_datasets_018.png" srcset="../../_images/sphx_glr_datasets_018.png" alt="datasets" class = "sphx-glr-single-img"/><p>The masks on <a class="reference internal" href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset" title="gammapy.datasets.FluxPointsDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPointsDataset</span></code></a> are <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.23)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a> objects
and the data is a
<code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPoints</span></code> object. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code>, by default, masks the upper
limit points</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fp_dataset</span><span class="o">.</span><span class="n">mask_safe</span></a>  <span class="c1"># Note: the mask here is simply a numpy array</span>

<a href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fp_dataset</span><span class="o">.</span><span class="n">data</span></a>  <span class="c1"># is a `FluxPoints` object</span>

<a href="../../api/gammapy.datasets.FluxPointsDataset.html#gammapy.datasets.FluxPointsDataset.data_shape" title="gammapy.datasets.FluxPointsDataset.data_shape" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">fp_dataset</span><span class="o">.</span><span class="n">data_shape</span></a><span class="p">()</span>  <span class="c1"># number of data points</span>
</pre></div>
</div>
<p>For an example of fitting <a class="reference internal" href="../../api/gammapy.estimators.FluxPoints.html#gammapy.estimators.FluxPoints" title="gammapy.estimators.FluxPoints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPoints</span></code></a>, see <a class="reference external" href="../analysis/1D/sed_fitting.ipynb">flux point
fitting</a>, and can be used for
catalog objects, eg see <a class="reference external" href="catalog.ipynb">catalog notebook</a></p>
</section>
<section id="datasets">
<h2>Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Datasets</span></code></a> are a collection of <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> objects. They can be of the
same type, or of different types, eg: mix of <code class="xref py py-obj docutils literal notranslate"><span class="pre">FluxPointDataset</span></code>,
<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> and <a class="reference internal" href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset" title="gammapy.datasets.SpectrumDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a>.</p>
<p>For modelling and fitting of a list of <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> objects, you can
either - Do a joint fitting of all the datasets together - Stack the
datasets together, and then fit them.</p>
<p><a class="reference internal" href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Datasets</span></code></a> is a convenient tool to handle joint fitting of
simultaneous datasets. As an example, please see the <a class="reference external" href="../analysis/3D/analysis_mwl.ipynb">joint fitting
tutorial</a></p>
<p>To see how stacking is performed, please see <a class="reference external" href="../../user-guide/datasets/index.rst#stacking-multiple-datasets">Implementation of
stacking</a></p>
<p>To create a <a class="reference internal" href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Datasets</span></code></a> object, pass a list of <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> on init, eg</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">Datasets</span></a><span class="p">([</span><a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_empty</span></a><span class="p">,</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_cta</span></a><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Datasets
--------

Dataset 0:

  Type       : MapDataset
  Name       : dataset-empty
  Instrument :
  Models     :

Dataset 1:

  Type       : MapDataset
  Name       : dataset-cta
  Instrument :
  Models     : [&#39;gc&#39;, &#39;dataset-cta-bkg&#39;]
</pre></div>
</div>
<p>If all the datasets have the same type we can also print an info table,
collectiong all the information from the individual calls to
<code class="xref py py-obj docutils literal notranslate"><span class="pre">info_dict()</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.info_table" title="gammapy.datasets.Datasets.info_table" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">info_table</span></a><span class="p">()</span>  <span class="c1"># quick info of all datasets</span>

<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.names" title="gammapy.datasets.Datasets.names" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets</span><span class="o">.</span><span class="n">names</span></a>  <span class="c1"># unique name of each dataset</span>
</pre></div>
</div>
<p>We can access individual datasets in <code class="xref py py-obj docutils literal notranslate"><span class="pre">Datasets</span></code> object by name:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="s2">&quot;dataset-empty&quot;</span><span class="p">]</span>  <span class="c1"># extracts the first dataset</span>
</pre></div>
</div>
<p>Or by index:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Other list type operations work as well such as:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use python list convention to remove/add datasets, eg:</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.remove" title="gammapy.datasets.Datasets.remove" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">remove</span></a><span class="p">(</span><span class="s2">&quot;dataset-empty&quot;</span><span class="p">)</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.names" title="gammapy.datasets.Datasets.names" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets</span><span class="o">.</span><span class="n">names</span></a>
</pre></div>
</div>
<p>Or</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.append" title="gammapy.datasets.Datasets.append" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">append</span></a><span class="p">(</span><a href="../../api/gammapy.datasets.SpectrumDataset.html#gammapy.datasets.SpectrumDataset" title="gammapy.datasets.SpectrumDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectrum_dataset</span></a><span class="p">)</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.names" title="gammapy.datasets.Datasets.names" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets</span><span class="o">.</span><span class="n">names</span></a>
</pre></div>
</div>
<p>Let’s create a list of spectrum datasets to illustrate some more
functionality:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">Datasets</span></a><span class="p">()</span>

<a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">=</span> <a href="../../api/gammapy.utils.scripts.make_path.html#gammapy.utils.scripts.make_path" title="gammapy.utils.scripts.make_path" class="sphx-glr-backref-module-gammapy-utils-scripts sphx-glr-backref-type-py-function"><span class="n">make_path</span></a><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/joint-crab/spectra/hess&quot;</span><span class="p">)</span>

<span class="k">for</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="ow">in</span> <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.glob" title="pathlib.Path.glob" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-method"><span class="n">path</span><span class="o">.</span><span class="n">glob</span></a><span class="p">(</span><span class="s2">&quot;pha_*.fits&quot;</span><span class="p">):</span>
    <a href="../../api/gammapy.datasets.SpectrumDatasetOnOff.html#gammapy.datasets.SpectrumDatasetOnOff" title="gammapy.datasets.SpectrumDatasetOnOff" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.SpectrumDatasetOnOff.html#gammapy.datasets.SpectrumDatasetOnOff.read" title="gammapy.datasets.SpectrumDatasetOnOff.read" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">SpectrumDatasetOnOff</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">)</span>
    <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.append" title="gammapy.datasets.Datasets.append" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">append</span></a><span class="p">(</span><a href="../../api/gammapy.datasets.SpectrumDatasetOnOff.html#gammapy.datasets.SpectrumDatasetOnOff" title="gammapy.datasets.SpectrumDatasetOnOff" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset</span></a><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Datasets
--------

Dataset 0:

  Type       : SpectrumDatasetOnOff
  Name       : 23526
  Instrument :
  Models     :

Dataset 1:

  Type       : SpectrumDatasetOnOff
  Name       : 23523
  Instrument :
  Models     :

Dataset 2:

  Type       : SpectrumDatasetOnOff
  Name       : 23592
  Instrument :
  Models     :

Dataset 3:

  Type       : SpectrumDatasetOnOff
  Name       : 23559
  Instrument :
  Models     :
</pre></div>
</div>
<p>Now we can stack all datasets using <a class="reference internal" href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.stack_reduce" title="gammapy.datasets.Datasets.stack_reduce"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stack_reduce()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.SpectrumDatasetOnOff.html#gammapy.datasets.SpectrumDatasetOnOff" title="gammapy.datasets.SpectrumDatasetOnOff" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stacked</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.stack_reduce" title="gammapy.datasets.Datasets.stack_reduce" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">stack_reduce</span></a><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;stacked&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.SpectrumDatasetOnOff.html#gammapy.datasets.SpectrumDatasetOnOff" title="gammapy.datasets.SpectrumDatasetOnOff" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stacked</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SpectrumDatasetOnOff
--------------------

  Name                            : stacked

  Total counts                    : 459
  Total background counts         : 27.50
  Total excess counts             : 431.50

  Predicted counts                : 45.27
  Predicted background counts     : 45.27
  Predicted excess counts         : nan

  Exposure min                    : 2.13e+06 m2 s
  Exposure max                    : 2.63e+09 m2 s

  Number of total bins            : 80
  Number of fit bins              : 43

  Fit statistic type              : wstat
  Fit statistic value (-2 log(L)) : 1530.36

  Number of models                : 0
  Number of parameters            : 0
  Number of free parameters       : 0

  Total counts_off                : 645
  Acceptance                      : 80
  Acceptance off                  : 2016
</pre></div>
</div>
<p>Or slice all datasets by a given energy range:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets_sliced</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.slice_by_energy" title="gammapy.datasets.Datasets.slice_by_energy" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">slice_by_energy</span></a><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="s2">&quot;1 TeV&quot;</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="s2">&quot;10 TeV&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.energy_ranges" title="gammapy.datasets.Datasets.energy_ranges" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets_sliced</span><span class="o">.</span><span class="n">energy_ranges</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(&lt;Quantity [1.e+09, 1.e+09, 1.e+09, 1.e+09] keV&gt;, &lt;Quantity [1.e+10, 1.e+10, 1.e+10, 1.e+10] keV&gt;)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  18.708 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-api-datasets-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/notebooks/dev/tutorials/api/datasets.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo7.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1574af02de7a1c335664819e66ace9e7/datasets.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">datasets.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/624f67a6339c97aafd7b74d77d3635a5/datasets.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">datasets.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>