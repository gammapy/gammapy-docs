
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fermi-LAT with Gammapy &#8212; gammapy vX.Y.Z</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=35abb870" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=1f75dfce"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/data/fermi_lat';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script src="../../_static/matomo.js?v=52704cab"></script>
    <link rel="canonical" href="https://docs.gammapy.org/stable/tutorials/data/fermi_lat.html" />
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HAWC with Gammapy" href="hawc.html" />
    <link rel="prev" title="MAGIC with Gammapy" href="magic.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.0.dev2199+g25afca4ac" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/gammapy_logo.png" class="logo__image only-light" alt="gammapy vX.Y.Z - Home"/>
    <img src="../../_static/gammapy_logo.png" class="logo__image only-dark pst-js-only" alt="gammapy vX.Y.Z - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../development/index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api-reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../development/index.html">
    Developer guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release-notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../starting/index.html">Introduction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../starting/overview.html">Data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../starting/analysis_1.html">High level interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../starting/analysis_2.html">Low level API</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Data exploration</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hess.html">H.E.S.S. with Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="cta.html">CTAO with Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="magic.html">MAGIC with Gammapy</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Fermi-LAT with Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="hawc.html">HAWC with Gammapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="veritas.html">VERITAS with Gammapy</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../model-gallery/index.html">Model Gallery</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../details/index.html">Detailed explanation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../details/irfs.html">Using Gammapy IRFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/observation_clustering.html">Observational clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/theta_square_plot.html">Make a theta-square plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/makers.html">Makers - Data reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/datasets.html">Datasets - Reduced data, IRFs, models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/maps.html">Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/mask_maps.html">Mask maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/catalog.html">Source catalogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/priors.html">Priors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/model_management.html">Modelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/fitting.html">Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/nested_sampling_Crab.html">Bayesian analysis with nested sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/estimators.html">Estimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/parameter_ul.html">Constraining parameter limits</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../analysis-1d/index.html">Data analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/cta_sensitivity.html">Point source sensitivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/spectral_analysis.html">Spectral analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/spectral_analysis_hli.html">Spectral analysis with the HLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/extended_source_spectral_analysis.html">Spectral analysis of extended sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/spectrum_simulation.html">1D spectrum simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-1d/sed_fitting.html">Flux point fitting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../analysis-2d/index.html">2D Image</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis-2d/detect.html">Source detection and significance maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-2d/ring_background.html">Ring background map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-2d/modeling_2D.html">2D map fitting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../analysis-3d/index.html">3D Cube</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/analysis_3d.html">3D detailed analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/cta_data_analysis.html">Basic image exploration and fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/analysis_mwl.html">Multi instrument joint 3D and 1D analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/simulate_3d.html">3D map simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/event_sampling.html">Event sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/event_sampling_nrg_depend_models.html">Sample a source with energy-dependent temporal evolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/flux_profiles.html">Flux Profile Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-3d/non_detected_source.html">Computing flux upper limits</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../analysis-time/index.html">Time series</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis-time/light_curve.html">Light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-time/light_curve_flare.html">Light curves for flares</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-time/variability_estimation.html">Estimation of time variability in a lightcurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-time/time_resolved_spectroscopy.html">Time resolved spectroscopy estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-time/light_curve_simulation.html">Simulating and fitting a time varying source</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../astrophysics/index.html">Astrophysics use cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../astrophysics/ebl.html">Account for spectral absorption due to the EBL</a></li>

<li class="toctree-l2"><a class="reference internal" href="../astrophysics/energy_dependent_estimation.html">Morphological energy dependence estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astrophysics/pulsar_analysis.html">Pulsar analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astrophysics/astro_dark_matter.html">Dark matter spatial and spectral models</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../scripts/index.html">Scripts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scripts/survey_map.html">Survey Map Script</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Data exploration</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Fermi-LAT with Gammapy</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-data-fermi-lat-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code. or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="fermi-lat-with-gammapy">
<span id="sphx-glr-tutorials-data-fermi-lat-py"></span><h1>Fermi-LAT with Gammapy<a class="headerlink" href="#fermi-lat-with-gammapy" title="Link to this heading">#</a></h1>
<p>Data inspection and preliminary analysis with Fermi-LAT data.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Gammapy fully supports Fermi-LAT data analysis from DL4 level (binned
maps). In order to perform data reduction from the events list and
spacecraft files to binned counts and IRFs maps we recommend to use
<a class="reference external" href="http://fermipy.readthedocs.io/">Fermipy</a>, which is based on
the <a class="reference external" href="https://fermi.gsfc.nasa.gov/ssc/data/analysis/software/">Fermi Science
Tools</a>
(Fermi ST).</p>
<p>Using Gammapy with Fermi-LAT data could be an option for you if you want
to do an analysis that is not easily possible with Fermipy and the Fermi
Science Tools. For example a joint likelihood fit of Fermi-LAT data with
data e.g. from H.E.S.S., MAGIC, VERITAS or some other instrument, or
analysis of Fermi-LAT data with a complex spatial or spectral model that
is not available in Fermipy or the Fermi ST.</p>
<p>This tutorial will show you how to convert Fermi-LAT data into a DL4
format  that can be used by Gammapy (<a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a>) and perform a 3D analysis. As an
example, we will look at the Galactic center.
We are going to analyses high-energy data from 10 GeV from 1 TeV (in reconstructed energy).</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>For this notebook you have to get the prepared
<code class="xref py py-obj docutils literal notranslate"><span class="pre">fermi-gc</span></code> data provided in your <code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib inline</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.catalog</span><span class="w"> </span><span class="kn">import</span> <span class="n">CATALOG_REGISTRY</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.datasets</span><span class="w"> </span><span class="kn">import</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">Datasets</span></a><span class="p">,</span> <a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">FermipyDatasetsReader</span></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.estimators</span><span class="w"> </span><span class="kn">import</span> <a href="../../api/gammapy.estimators.TSMapEstimator.html#gammapy.estimators.TSMapEstimator" title="gammapy.estimators.TSMapEstimator" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class"><span class="n">TSMapEstimator</span></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.maps</span><span class="w"> </span><span class="kn">import</span> <span class="n">Map</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.modeling</span><span class="w"> </span><span class="kn">import</span> <a href="../../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit" title="gammapy.modeling.Fit" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class"><span class="n">Fit</span></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.modeling.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">Models</span></a><span class="p">,</span>
    <a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PointSpatialModel</span></a><span class="p">,</span>
    <a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawSpectralModel</span></a><span class="p">,</span>
    <span class="n">TemplateSpatialModel</span><span class="p">,</span>
    <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">SkyModel</span></a><span class="p">,</span>
    <a href="../../api/gammapy.modeling.models.PowerLawNormSpectralModel.html#gammapy.modeling.models.PowerLawNormSpectralModel" title="gammapy.modeling.models.PowerLawNormSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawNormSpectralModel</span></a><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.utils.scripts</span><span class="w"> </span><span class="kn">import</span> <a href="../../api/gammapy.utils.scripts.make_path.html#gammapy.utils.scripts.make_path" title="gammapy.utils.scripts.make_path" class="sphx-glr-backref-module-gammapy-utils-scripts sphx-glr-backref-type-py-function"><span class="n">make_path</span></a>
</pre></div>
</div>
<section id="check-setup">
<h3>Check setup<a class="headerlink" href="#check-setup" title="Link to this heading">#</a></h3>
<p>We check the setup in this tutorial, as we require specific files to be
downloaded to continue.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gammapy.utils.check</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_tutorials_setup</span>

<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/bin/python
        python_version         : 3.11.13
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 2.0.dev2199+g25afca4ac
        path                   : /home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/gammapy


Other packages:

        numpy                  : 2.1.3
        scipy                  : 1.16.1
        astropy                : 7.1.0
        regions                : 0.10
        click                  : 8.2.1
        yaml                   : 6.0.2
        IPython                : 9.4.0
        jupyterlab             : not installed
        matplotlib             : 3.9.4
        pandas                 : not installed
        healpy                 : 1.18.1
        iminuit                : 2.31.1
        sherpa                 : 4.17.1
        naima                  : 0.10.2
        emcee                  : 3.1.6
        corner                 : 2.2.3
        ray                    : 2.48.0


Gammapy environment variables:

        GAMMAPY_DATA           : /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/dev
</pre></div>
</div>
</section>
</section>
<section id="fermipy-configuration-file">
<h2>Fermipy configuration file<a class="headerlink" href="#fermipy-configuration-file" title="Link to this heading">#</a></h2>
<p>Gammapy can utilise the same configuration file as Fermipy to convert
the Fermipy-generated maps into Gammapy datasets. For more information on the
structure of these files, refer to the <a class="reference external" href="https://fermipy.readthedocs.io/en/latest/config.html">Fermipy configuration
page</a>. In this
tutorial, we will analyse Galactic center data generated with Fermipy version 1.3 and
the configuration given in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/fermi-gc/config_fermipy_gc_example.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fermipy example configuration</span>
<span class="c1"># for details, see https://fermipy.readthedocs.io/en/latest/config.html</span>
<span class="c1"># For IRFs, event type and event class options, see https://fermi.gsfc.nasa.gov/ssc/data/analysis/documentation/Cicerone/Cicerone_Data/LAT_DP.html</span>
<span class="nt">components</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">isodiff</span><span class="p">:</span><span class="w"> </span><span class="nv">$FERMI_DIR/refdata/fermi/galdiffuse/iso_P8R3_CLEAN_V3_PSF2_v1.txt</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">selection</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">evtype</span><span class="p">:</span><span class="w"> </span><span class="nv">16</span><span class="p p-Indicator">}</span><span class="w">  </span><span class="c1">#4 is PSF0, 8 PSF1, 16 PSF2, 32 PSF3</span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">ltcube</span><span class="p">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">isodiff</span><span class="p">:</span><span class="w"> </span><span class="nv">$FERMI_DIR/refdata/fermi/galdiffuse/iso_P8R3_CLEAN_V3_PSF3_v1.txt</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">selection</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">evtype</span><span class="p">:</span><span class="w"> </span><span class="nv">32</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">ltcube</span><span class="p">:</span><span class="w"> </span><span class="nv">null</span><span class="p p-Indicator">}</span>

<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">evfile </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./raw/events_list.lst</span>
<span class="w">  </span><span class="nt">scfile </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./raw/L241227031840F357373F12_SC00.fits</span>

<span class="nt">binning</span><span class="p">:</span>
<span class="w">  </span><span class="nt">roiwidth   </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span>
<span class="w">  </span><span class="nt">binsz      </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">binsperdec   </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="nt">coordsys </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GAL</span>
<span class="w">  </span><span class="nt">proj</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAR</span>
<span class="w">  </span><span class="nt">projtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WCS</span>

<span class="nt">selection </span><span class="p">:</span>
<span class="c1"># gtselect parameters</span>
<span class="w">  </span><span class="nt">emin </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3981.0717055349733</span><span class="w"> </span><span class="c1"># ENERGY TRUE for Gammapy</span>
<span class="w">  </span><span class="nt">emax </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2511886.4315095823</span><span class="w"> </span><span class="c1"># ENERGY TRUE for Gammapy</span>
<span class="w">  </span><span class="nt">zmax    </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">105</span><span class="w"> </span><span class="c1"># deg</span>
<span class="w">  </span><span class="nt">evclass </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w"> </span><span class="c1"># CLEAN</span>
<span class="w">  </span><span class="nt">tmin    </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">239557417</span>
<span class="w">  </span><span class="nt">tmax    </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">752112005</span>

<span class="c1"># gtmktime parameters</span>
<span class="w">  </span><span class="nt">filter </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;DATA_QUAL&gt;0</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">LAT_CONFIG==1&#39;</span>
<span class="w">  </span><span class="nt">roicut </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;no&#39;</span>

<span class="c1"># Set the ROI center to the coordinates of this source</span>
<span class="w">  </span><span class="nt">glon </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span>
<span class="w">  </span><span class="nt">glat </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span>

<span class="nt">fileio</span><span class="p">:</span>
<span class="w">   </span><span class="nt">outdir </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">   </span><span class="nt">logfile </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;out.log&#39;</span>
<span class="w">   </span><span class="nt">usescratch </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">   </span><span class="nt">scratchdir  </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/scratch&#39;</span>

<span class="nt">gtlike</span><span class="p">:</span>
<span class="w">  </span><span class="nt">edisp </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">edisp_bins </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># DO NOT CHANGE edisp_bins will be handled by Gammapy</span>
<span class="w">  </span><span class="nt">irfs </span><span class="p">:</span><span class="w"> </span><span class="s">&#39;P8R3_CLEAN_V3&#39;</span>

<span class="nt">model</span><span class="p">:</span>
<span class="w">  </span><span class="nt">src_roiwidth </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0</span><span class="w"> </span><span class="c1"># This is used by Fermipy to compute the PSF RADMAX, even if no models are set</span>
</pre></div>
</div>
<p>The most important points for Gammapy users are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">emin</span></code> and <code class="docutils literal notranslate"><span class="pre">emax</span></code> in this file should be considered as the energy true range.
It should be larger that the reconstructed energy range.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edisp_bins</span> <span class="pre">:</span> <span class="pre">0</span></code> is strongly recommended at this stage otherwise you
might face inconsistencies in the energy axes of the different IRFs created by Fermipy.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">edisp_bins</span></code> value will be redefined later on by Gammapy as a positive value
in order to create the reconstructed energy axis properly.</p></li>
<li><p>If you want to use the <code class="xref py py-obj docutils literal notranslate"><span class="pre">$FERMI_DIR</span></code> variable to read the background models
it must also be defined in your Gammapy environment,
otherwise you have to define your own paths.</p></li>
<li><p>For this tutorial we copied the iso files in <code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA/fermi-gc</span></code> and
edited the paths in the yaml file for simplicity.</p></li>
</ul>
<p>More generally in order to select a good binning it is important to know
the instrument resolution, for that you can have a quick look at the
IRFs in the <a class="reference external" href="https://www.slac.stanford.edu/exp/glast/groups/canda/lat_Performance.htm">Fermi-LAT performance
page</a>.</p>
<p>Since the energy resolution varies with energy, it is important to
choose an energy binning that is fine enough to capture this energy
dependence. That is why we recommend a binning with 8 to 10 bins per
decade. The energy axes will be created such as it is linear in log space
so it’s better to define <code class="docutils literal notranslate"><span class="pre">emin</span></code> and <code class="docutils literal notranslate"><span class="pre">emax</span></code> such as they align with a log binning.
Here we have as true energy range <span class="math notranslate nohighlight">\(\log(emin) = 0.6 \sim 4\)</span> GeV to
<span class="math notranslate nohighlight">\(\log(emax) = 3.4 \sim 2500\)</span> GeV.
While the reconstructed energy range of our analysis will be 10 GeV to 1000 GeV.</p>
<p>The spatial binning should be of the same order of the PSF 68%
containment radius which is in average 0.1 degree above 10 GeV and
rapidly increases at lower energy. Ideally it should remain within a
factor of 2 or 3 of the PSF radius at most. In order to properly take
into account for the sources outside the region of interest that
contribute inside due to the PSF we have to define a wider <code class="docutils literal notranslate"><span class="pre">roiwidth</span></code>
than our actual region of interest. Typically, we need a margin equal to the
99% containment of the PSF on each side. Above 10 GeV considering only
PSF2&amp;3 the 99% PSF containment radius is about 1 degree. Thus, if we
want to study a 3 degree radius around the GC we have to take a <code class="docutils literal notranslate"><span class="pre">roiwidth</span></code> of 8
deg. (If considering lower energies or including PSF0 and PSF1, it should be much
larger).</p>
</section>
<section id="from-fermipy-maps-to-gammapy-datasets">
<h2>From Fermipy maps to Gammapy datasets<a class="headerlink" href="#from-fermipy-maps-to-gammapy-datasets" title="Link to this heading">#</a></h2>
<p>In your Fermipy environment you have to run the following commands</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fermipy.gtanalysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">GTAnalysis</span>
<span class="n">gta</span> <span class="o">=</span> <span class="n">GTAnalysis</span><span class="p">(</span><span class="s1">&#39;config_fermipy_gc_example.yaml&#39;</span><span class="p">,</span><span class="n">logging</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;verbosity&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="n">gta</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="n">gta</span><span class="o">.</span><span class="n">compute_psf</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># this creates the psf kernel</span>
<span class="n">gta</span><span class="o">.</span><span class="n">compute_drm</span><span class="p">(</span><span class="n">edisp_bins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># this creates the energy dispersion matrix</span>
<span class="c1"># DO NOT CHANGE edisp_bins here, it will be redefined by Gammapy later on</span>
</pre></div>
</div>
<p>This will produce a number of files including:</p>
<ul class="simple">
<li><p>“ccube_00.fits” (counts)</p></li>
<li><p>“bexpmap_00.fits” (exposure)</p></li>
<li><p>“psf_00.fits” (psf)</p></li>
<li><p>“drm_00.fits” (edisp)</p></li>
</ul>
<p>In your Gammapy environment you can create the datasets using the
same configuration file.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reader</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">FermipyDatasetsReader</span></a><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-gc/config_fermipy_gc_example.yaml&quot;</span><span class="p">,</span> <span class="n">edisp_bins</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader.read" title="gammapy.datasets.FermipyDatasetsReader.read" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">reader</span><span class="o">.</span><span class="n">read</span></a><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/astropy/wcs/wcs.py:805: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set DATEREF to &#39;2001-01-01T00:01:04.184&#39; from MJDREF.
Set MJD-OBS to 54682.655283 from DATE-OBS.
Set MJD-END to 60614.993543 from DATE-END&#39;.
  warnings.warn(
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/astropy/wcs/wcs.py:805: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set DATEREF to &#39;2001-01-01T00:01:04.184&#39; from MJDREF.
Set MJD-OBS to 54682.655283 from DATE-OBS.
Set MJD-END to 60614.993543 from DATE-END&#39;.
  warnings.warn(
Datasets
--------

Dataset 0:

  Type       : MapDataset
  Name       : P8R3_CLEAN_V3_PSF2_v1
  Instrument :
  Models     : [&#39;isotropic_P8R3_CLEAN_V3_PSF2_v1&#39;]

Dataset 1:

  Type       : MapDataset
  Name       : P8R3_CLEAN_V3_PSF3_v1
  Instrument :
  Models     : [&#39;isotropic_P8R3_CLEAN_V3_PSF3_v1&#39;]
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">edisp_bins</span></code> is set again here as a positive number so
Gammapy can create its reconstructed energy axis properly. The energy
dispersion correction implemented Gammapy is closer to the version
implemented in Fermitools &gt;1.2.0, which take into account the interplay
between the energy dispersion and PSF.</p>
<p>Across most of the Fermi energy range, the level of migration in log10(E)
remains within 0.2, increasing up to 0.4 below 100 MeV,
due to energy dispersion. Therefore, we recommend that the
product of |edisp_bins| and the width of the log10(E) bins be at
least equal to 0.2. For a binning of 8 to 10 bins per decade, this
corresponds to |edisp_bins| ≥ 2. For further information, see
<a class="reference external" href="https://fermi.gsfc.nasa.gov/ssc/data/analysis/documentation/Pass8_edisp_usage.html">Pass8_edisp_usage</a>.
In our case, we have 10 bins per decade and true energy axis starts
at about 4 GeV, so with <code class="docutils literal notranslate"><span class="pre">edisp_bins=4</span></code> the reconstructed energy axis
starts at 10 GeV:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;energy_true&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapAxis

        name       : energy_true
        unit       : &#39;MeV&#39;
        nbins      : 28
        node type  : edges
        edges min  : 4.0e+03 MeV
        edges max  : 2.5e+06 MeV
        interp     : log

MapAxis

        name       : energy
        unit       : &#39;MeV&#39;
        nbins      : 20
        node type  : edges
        edges min  : 1.0e+04 MeV
        edges max  : 1.0e+06 MeV
        interp     : log
</pre></div>
</div>
<p>Note that selecting <code class="docutils literal notranslate"><span class="pre">edisp_bins=2</span></code> means the reconstructed energy
of the counts geometry will start at <span class="math notranslate nohighlight">\(10^{0.8} \sim 6.3\)</span> GeV.
If we want to start the analysis at 10 GeV in this case, we need to
update the <code class="docutils literal notranslate"><span class="pre">mask_fit</span></code> to exclude the first 2 reconstructed energy bins.
Considering more <code class="docutils literal notranslate"><span class="pre">edisp_bins</span></code> is generally safer but requires more memory
and increases computation time.</p>
<p>Alternatively, if you created the counts and IRF files from the
Fermi-LAT science tools without Fermipy you can use the
<code class="docutils literal notranslate"><span class="pre">create_dataset</span></code>  method. Note that in this case we cannot guarantee
that your maps have the correct axes dimensions to be properly converted
into Gammapy datasets.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">=</span> <a href="../../api/gammapy.utils.scripts.make_path.html#gammapy.utils.scripts.make_path" title="gammapy.utils.scripts.make_path" class="sphx-glr-backref-module-gammapy-utils-scripts sphx-glr-backref-type-py-function"><span class="n">make_path</span></a><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/fermi-gc&quot;</span><span class="p">)</span>
<span class="n">dataset0</span> <span class="o">=</span> <a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reader</span></a><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;ccube_00.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;bexpmap_00.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;psf_00.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;drm_00.fits&quot;</span><span class="p">,</span>
    <span class="n">isotropic_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">edisp_bins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_psf2&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dataset1</span> <span class="o">=</span> <a href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reader</span></a><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;ccube_01.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;bexpmap_01.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;psf_01.fits&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">path</span></a> <span class="o">/</span> <span class="s2">&quot;drm_01.fits&quot;</span><span class="p">,</span>
    <span class="n">isotropic_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">edisp_bins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_psf3&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">datasets_fromST</span> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class"><span class="n">Datasets</span></a><span class="p">([</span><span class="n">dataset0</span><span class="p">,</span> <span class="n">dataset1</span><span class="p">])</span>


<span class="c1"># The above was an alternative reading method we don&#39;t need those after</span>
<span class="k">del</span> <span class="n">dataset0</span><span class="p">,</span> <span class="n">dataset1</span><span class="p">,</span> <span class="n">datasets_fromST</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/astropy/wcs/wcs.py:805: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set DATEREF to &#39;2001-01-01T00:01:04.184&#39; from MJDREF.
Set MJD-OBS to 54682.655283 from DATE-OBS.
Set MJD-END to 60614.993543 from DATE-END&#39;.
  warnings.warn(
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/astropy/wcs/wcs.py:805: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set DATEREF to &#39;2001-01-01T00:01:04.184&#39; from MJDREF.
Set MJD-OBS to 54682.655283 from DATE-OBS.
Set MJD-END to 60614.993543 from DATE-END&#39;.
  warnings.warn(
</pre></div>
</div>
</section>
<section id="fermi-lat-irf-properties">
<h2>Fermi-LAT IRF properties<a class="headerlink" href="#fermi-lat-irf-properties" title="Link to this heading">#</a></h2>
<section id="exposure">
<h3>Exposure<a class="headerlink" href="#exposure" title="Link to this heading">#</a></h3>
<p>Exposure is almost constant across the field of view, with less than 5%
variation at a given energy.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">plot_interactive</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_001.png" srcset="../../_images/sphx_glr_fermi_lat_001.png" alt="fermi lat" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>interactive(children=(SelectionSlider(continuous_update=False, description=&#39;Select energy_true:&#39;, layout=Layout(width=&#39;50%&#39;), options=(&#39;3.98 GeV - 5.01 GeV&#39;, &#39;5.01 GeV - 6.31 GeV&#39;, &#39;6.31 GeV - 7.94 GeV&#39;, &#39;7.94 GeV - 10.0 GeV&#39;, &#39;10.0 GeV - 12.6 GeV&#39;, &#39;12.6 GeV - 15.8 GeV&#39;, &#39;15.8 GeV - 20.0 GeV&#39;, &#39;20.0 GeV - 25.1 GeV&#39;, &#39;25.1 GeV - 31.6 GeV&#39;, &#39;31.6 GeV - 39.8 GeV&#39;, &#39;39.8 GeV - 50.1 GeV&#39;, &#39;50.1 GeV - 63.1 GeV&#39;, &#39;63.1 GeV - 79.4 GeV&#39;, &#39;79.4 GeV - 100 GeV&#39;, &#39;100 GeV - 126 GeV&#39;, &#39;126 GeV - 158 GeV&#39;, &#39;158 GeV - 200 GeV&#39;, &#39;200 GeV - 251 GeV&#39;, &#39;251 GeV - 316 GeV&#39;, &#39;316 GeV - 398 GeV&#39;, &#39;398 GeV - 501 GeV&#39;, &#39;501 GeV - 631 GeV&#39;, &#39;631 GeV - 794 GeV&#39;, &#39;794 GeV - 1 TeV&#39;, &#39;1 TeV - 1.26 TeV&#39;, &#39;1.26 TeV - 1.58 TeV&#39;, &#39;1.58 TeV - 2.00 TeV&#39;, &#39;2.00 TeV - 2.51 TeV&#39;), style=SliderStyle(description_width=&#39;initial&#39;), value=&#39;3.98 GeV - 5.01 GeV&#39;), RadioButtons(description=&#39;Select stretch:&#39;, index=1, options=(&#39;linear&#39;, &#39;sqrt&#39;, &#39;log&#39;), style=DescriptionStyle(description_width=&#39;initial&#39;), value=&#39;sqrt&#39;), Output()), _dom_classes=(&#39;widget-interact&#39;,))
</pre></div>
</div>
</section>
<section id="psf">
<h3>PSF<a class="headerlink" href="#psf" title="Link to this heading">#</a></h3>
<p>For Fermi-LAT, the PSF only varies little within a given regions of
the sky, especially at high energies like what we have here.
So we have only one PSF kernel.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">psf</span><span class="o">.</span><span class="n">plot_containment_radius_vs_energy</span><span class="p">(</span><span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">))</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_002.png" srcset="../../_images/sphx_glr_fermi_lat_002.png" alt="fermi lat" class = "sphx-glr-single-img"/></section>
</section>
<section id="region-of-interest-and-mask-definition">
<h2>Region of interest and mask definition<a class="headerlink" href="#region-of-interest-and-mask-definition" title="Link to this heading">#</a></h2>
<p>As mentioned previously, the width of dataset is larger that our actual
region of interest in order to properly take into account for the
sources outside that contributes inside due to the PSF. So we define the
valid RoI for fitting by creating a <code class="docutils literal notranslate"><span class="pre">mask_fit</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">margin</span></a> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">2.0</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.Unit.html#astropy.units.Unit" title="astropy.units.Unit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">deg</span></a>
<span class="p">)</span>  <span class="c1"># &gt;1 deg should be fine for this dataset we take 2 so the notebook is faster</span>
<a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_fit</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.from_geom" title="gammapy.maps.Map.from_geom" class="sphx-glr-backref-module-gammapy-maps-Map sphx-glr-backref-type-py-method"><span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span></a><span class="p">(</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_fit</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.binary_erode" title="gammapy.maps.WcsNDMap.binary_erode" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">mask_fit</span><span class="o">.</span><span class="n">binary_erode</span></a><span class="p">(</span><span class="n">width</span><span class="o">=</span><a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">margin</span></a><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;disk&quot;</span><span class="p">)</span>

<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot_interactive" title="gammapy.maps.WcsNDMap.plot_interactive" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">mask_fit</span><span class="o">.</span><span class="n">plot_interactive</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_003.png" srcset="../../_images/sphx_glr_fermi_lat_003.png" alt="fermi lat" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>interactive(children=(SelectionSlider(continuous_update=False, description=&#39;Select energy:&#39;, layout=Layout(width=&#39;50%&#39;), options=(&#39;10.0 GeV - 12.6 GeV&#39;, &#39;12.6 GeV - 15.8 GeV&#39;, &#39;15.8 GeV - 20.0 GeV&#39;, &#39;20.0 GeV - 25.1 GeV&#39;, &#39;25.1 GeV - 31.6 GeV&#39;, &#39;31.6 GeV - 39.8 GeV&#39;, &#39;39.8 GeV - 50.1 GeV&#39;, &#39;50.1 GeV - 63.1 GeV&#39;, &#39;63.1 GeV - 79.4 GeV&#39;, &#39;79.4 GeV - 100 GeV&#39;, &#39;100 GeV - 126 GeV&#39;, &#39;126 GeV - 158 GeV&#39;, &#39;158 GeV - 200 GeV&#39;, &#39;200 GeV - 251 GeV&#39;, &#39;251 GeV - 316 GeV&#39;, &#39;316 GeV - 398 GeV&#39;, &#39;398 GeV - 501 GeV&#39;, &#39;501 GeV - 631 GeV&#39;, &#39;631 GeV - 794 GeV&#39;, &#39;794 GeV - 1 TeV&#39;), style=SliderStyle(description_width=&#39;initial&#39;), value=&#39;10.0 GeV - 12.6 GeV&#39;), RadioButtons(description=&#39;Select stretch:&#39;, index=1, options=(&#39;linear&#39;, &#39;sqrt&#39;, &#39;log&#39;), style=DescriptionStyle(description_width=&#39;initial&#39;), value=&#39;sqrt&#39;), Output()), _dom_classes=(&#39;widget-interact&#39;,))
</pre></div>
</div>
<p>Now we attach it the datasets</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <a href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">d</span></a> <span class="ow">in</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">:</span>
    <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">d</span><span class="o">.</span><span class="n">mask_fit</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_fit</span></a>
</pre></div>
</div>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading">#</a></h2>
<section id="isotropic-diffuse-background">
<h3>Isotropic diffuse background<a class="headerlink" href="#isotropic-diffuse-background" title="Link to this heading">#</a></h3>
<p>The <a class="reference internal" href="../../api/gammapy.datasets.FermipyDatasetsReader.html#gammapy.datasets.FermipyDatasetsReader" title="gammapy.datasets.FermipyDatasetsReader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FermipyDatasetsReader</span></code></a> also created one isotropic diffuse model
for each dataset:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_iso</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">Models</span></a><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.models" title="gammapy.datasets.Datasets.models" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets</span><span class="o">.</span><span class="n">models</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_iso</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Models

Component 0: SkyModel

  Name                      : isotropic_P8R3_CLEAN_V3_PSF2_v1
  Datasets names            : [&#39;P8R3_CLEAN_V3_PSF2_v1&#39;]
  Spectral model type       : CompoundSpectralModel
  Spatial  model type       : ConstantSpatialModel
  Temporal model type       :
  Parameters:
    tilt                  (frozen):      0.000
    norm                          :      1.000   +/-    0.00
    reference             (frozen):      1.000       TeV
    value                 (frozen):      1.000       1 / sr

Component 1: SkyModel

  Name                      : isotropic_P8R3_CLEAN_V3_PSF3_v1
  Datasets names            : [&#39;P8R3_CLEAN_V3_PSF3_v1&#39;]
  Spectral model type       : CompoundSpectralModel
  Spatial  model type       : ConstantSpatialModel
  Temporal model type       :
  Parameters:
    tilt                  (frozen):      0.000
    norm                          :      1.000   +/-    0.00
    reference             (frozen):      1.000       TeV
    value                 (frozen):      1.000       1 / sr
</pre></div>
</div>
</section>
<section id="galactic-diffuse-background">
<h3>Galactic diffuse background<a class="headerlink" href="#galactic-diffuse-background" title="Link to this heading">#</a></h3>
<p>The Fermi-LAT collaboration provides a galactic diffuse emission model,
that can be used as a background model for Fermi-LAT source analysis.
These files are called usually IEM for interstellar emission model, the
latest is
<a class="reference external" href="https://fermi.gsfc.nasa.gov/ssc/data/analysis/software/aux/4fgl/gll_iem_v07.fits">gll_iem_v07.fits</a>.
For details see the <a class="reference external" href="https://fermi.gsfc.nasa.gov/ssc/data/access/lat/BackgroundModels.html">BackgroundModels
page</a>.
If you have Fermipy installed it can also be found in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">$FERMI_DIR/refdata/fermi/galdiffuse/gll_iem_v07.fits</span></code></p>
<p>Diffuse model maps are very large (100s of MB), so as an example here,
we just load one that represents a small cutout for the Galactic center
region.</p>
<p>In this case, the maps are already in differential units, so we do not
want to normalise it again.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.TemplateSpatialModel.html#gammapy.modeling.models.TemplateSpatialModel" title="gammapy.modeling.models.TemplateSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">template_iem</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.TemplateSpatialModel.html#gammapy.modeling.models.TemplateSpatialModel.read" title="gammapy.modeling.models.TemplateSpatialModel.read" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">TemplateSpatialModel</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;$GAMMAPY_DATA/fermi-gc/gll_iem_v07_gc.fits.gz&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_iem</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">SkyModel</span></a><span class="p">(</span>
    <a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectral_model</span></a><span class="o">=</span><a href="../../api/gammapy.modeling.models.PowerLawNormSpectralModel.html#gammapy.modeling.models.PowerLawNormSpectralModel" title="gammapy.modeling.models.PowerLawNormSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawNormSpectralModel</span></a><span class="p">(),</span>
    <a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spatial_model</span></a><span class="o">=</span><a href="../../api/gammapy.modeling.models.TemplateSpatialModel.html#gammapy.modeling.models.TemplateSpatialModel" title="gammapy.modeling.models.TemplateSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">template_iem</span></a><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;diffuse-iem&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s look at the template :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.TemplateSpatialModel.html#gammapy.modeling.models.TemplateSpatialModel.map" title="gammapy.modeling.models.TemplateSpatialModel.map" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">template_iem</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">plot_interactive</span></a><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>


<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_diffuse</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_iso</span></a> <span class="o">+</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_iem</span></a>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_004.png" srcset="../../_images/sphx_glr_fermi_lat_004.png" alt="fermi lat" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>interactive(children=(SelectionSlider(continuous_update=False, description=&#39;Select energy_true:&#39;, layout=Layout(width=&#39;50%&#39;), options=(&#39;50.0 MeV&#39;, &#39;65.0 MeV&#39;, &#39;84.5 MeV&#39;, &#39;110 MeV&#39;, &#39;143 MeV&#39;, &#39;185 MeV&#39;, &#39;241 MeV&#39;, &#39;313 MeV&#39;, &#39;407 MeV&#39;, &#39;529 MeV&#39;, &#39;687 MeV&#39;, &#39;893 MeV&#39;, &#39;1.16 GeV&#39;, &#39;1.51 GeV&#39;, &#39;1.96 GeV&#39;, &#39;2.55 GeV&#39;, &#39;3.31 GeV&#39;, &#39;4.31 GeV&#39;, &#39;7.27 GeV&#39;, &#39;12.3 GeV&#39;, &#39;20.8 GeV&#39;, &#39;35.0 GeV&#39;, &#39;59.2 GeV&#39;, &#39;100.0 GeV&#39;, &#39;169 GeV&#39;, &#39;285 GeV&#39;, &#39;482 GeV&#39;, &#39;814 GeV&#39;), style=SliderStyle(description_width=&#39;initial&#39;), value=&#39;50.0 MeV&#39;), RadioButtons(description=&#39;Select stretch:&#39;, index=1, options=(&#39;linear&#39;, &#39;sqrt&#39;, &#39;log&#39;), style=DescriptionStyle(description_width=&#39;initial&#39;), value=&#39;sqrt&#39;), Output()), _dom_classes=(&#39;widget-interact&#39;,))
</pre></div>
</div>
</section>
<section id="sources">
<h3>Sources<a class="headerlink" href="#sources" title="Link to this heading">#</a></h3>
<p>Source models can be loaded from the 4FGL catalog directly available in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA</span></code>. For details see the <a class="reference external" href="https://fermi.gsfc.nasa.gov/ssc/data/access/lat/14yr_catalog/">Fermi-LAT catalog
page</a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.catalog.SourceCatalog4FGL.html#gammapy.catalog.SourceCatalog4FGL" title="gammapy.catalog.SourceCatalog4FGL" class="sphx-glr-backref-module-gammapy-catalog sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">catalog_4fgl</span></a> <span class="o">=</span> <span class="n">CATALOG_REGISTRY</span><span class="o">.</span><span class="n">get_cls</span><span class="p">(</span><span class="s2">&quot;4fgl&quot;</span><span class="p">)()</span>  <span class="c1"># load 4FGL catalog</span>
</pre></div>
</div>
<p>We want to select only the sources inside the dataset spatial geometry:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">in_geom</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom.to_image" title="gammapy.maps.WcsGeom.to_image" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">geom</span><span class="o">.</span><span class="n">to_image</span></a><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><a href="../../api/gammapy.catalog.SourceCatalog4FGL.html#gammapy.catalog.SourceCatalog4FGL.positions" title="gammapy.catalog.SourceCatalog4FGL.positions" class="sphx-glr-backref-module-gammapy-catalog sphx-glr-backref-type-py-attribute"><span class="n">catalog_4fgl</span><span class="o">.</span><span class="n">positions</span></a><span class="p">)</span>
<a href="../../api/gammapy.catalog.SourceCatalog4FGL.html#gammapy.catalog.SourceCatalog4FGL" title="gammapy.catalog.SourceCatalog4FGL" class="sphx-glr-backref-module-gammapy-catalog sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">catalog_4fgl_gc</span></a> <span class="o">=</span> <a href="../../api/gammapy.catalog.SourceCatalog4FGL.html#gammapy.catalog.SourceCatalog4FGL" title="gammapy.catalog.SourceCatalog4FGL" class="sphx-glr-backref-module-gammapy-catalog sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">catalog_4fgl</span></a><span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">in_geom</span></a><span class="p">]</span>

<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_4fgl_gc</span></a> <span class="o">=</span> <a href="../../api/gammapy.catalog.SourceCatalog4FGL.html#gammapy.catalog.SourceCatalog4FGL.to_models" title="gammapy.catalog.SourceCatalog4FGL.to_models" class="sphx-glr-backref-module-gammapy-catalog sphx-glr-backref-type-py-method"><span class="n">catalog_4fgl_gc</span><span class="o">.</span><span class="n">to_models</span></a><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/gammapy/catalog/fermi.py:587: UserWarning: Warning: converting a masked element to nan.
  &quot;index_2&quot;: np.nan_to_num(float(self.data[&quot;Unc_PLEC_Exp_Index&quot;])),
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/gammapy/catalog/fermi.py:587: UserWarning: Warning: converting a masked element to nan.
  &quot;index_2&quot;: np.nan_to_num(float(self.data[&quot;Unc_PLEC_Exp_Index&quot;])),
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/.tox/build_docs/lib/python3.11/site-packages/gammapy/catalog/fermi.py:587: UserWarning: Warning: converting a masked element to nan.
  &quot;index_2&quot;: np.nan_to_num(float(self.data[&quot;Unc_PLEC_Exp_Index&quot;])),
</pre></div>
</div>
<p>That’s still quite a lot of sources</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of source models&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_4fgl_gc</span></a><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of source models 110
</pre></div>
</div>
<p>In order to improve performances we can store all the sources outside
the <code class="docutils literal notranslate"><span class="pre">mask_fit</span></code> region into a single template (the same could be done
for all the sources we want to keep frozen).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_ouside_roi</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.select_mask" title="gammapy.modeling.models.Models.select_mask" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">models_4fgl_gc</span><span class="o">.</span><span class="n">select_mask</span></a><span class="p">(</span><span class="o">~</span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mask_fit</span></a><span class="p">,</span> <span class="n">use_evaluation_region</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_inside_roi</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">Models</span></a><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_4fgl_gc</span></a> <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_ouside_roi</span></a><span class="p">])</span>

<a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom_true</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom</span></a>
<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_outside_roi</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.to_template_sky_model" title="gammapy.modeling.models.Models.to_template_sky_model" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">sources_ouside_roi</span><span class="o">.</span><span class="n">to_template_sky_model</span></a><span class="p">(</span>
    <a href="../../api/gammapy.maps.WcsGeom.html#gammapy.maps.WcsGeom" title="gammapy.maps.WcsGeom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geom_true</span></a><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sources_outside&quot;</span>
<span class="p">)</span>

<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel.spatial_model" title="gammapy.modeling.models.SkyModel.spatial_model" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">sources_outside_roi</span><span class="o">.</span><span class="n">spatial_model</span><span class="o">.</span><span class="n">filename</span></a> <span class="o">=</span> <span class="s2">&quot;sources_outside.fits&quot;</span>

<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel.spatial_model" title="gammapy.modeling.models.SkyModel.spatial_model" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">sources_outside_roi</span><span class="o">.</span><span class="n">spatial_model</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">plot_interactive</span></a><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_005.png" srcset="../../_images/sphx_glr_fermi_lat_005.png" alt="fermi lat" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>interactive(children=(SelectionSlider(continuous_update=False, description=&#39;Select energy_true:&#39;, layout=Layout(width=&#39;50%&#39;), options=(&#39;3.98 GeV - 5.01 GeV&#39;, &#39;5.01 GeV - 6.31 GeV&#39;, &#39;6.31 GeV - 7.94 GeV&#39;, &#39;7.94 GeV - 10.0 GeV&#39;, &#39;10.0 GeV - 12.6 GeV&#39;, &#39;12.6 GeV - 15.8 GeV&#39;, &#39;15.8 GeV - 20.0 GeV&#39;, &#39;20.0 GeV - 25.1 GeV&#39;, &#39;25.1 GeV - 31.6 GeV&#39;, &#39;31.6 GeV - 39.8 GeV&#39;, &#39;39.8 GeV - 50.1 GeV&#39;, &#39;50.1 GeV - 63.1 GeV&#39;, &#39;63.1 GeV - 79.4 GeV&#39;, &#39;79.4 GeV - 100 GeV&#39;, &#39;100 GeV - 126 GeV&#39;, &#39;126 GeV - 158 GeV&#39;, &#39;158 GeV - 200 GeV&#39;, &#39;200 GeV - 251 GeV&#39;, &#39;251 GeV - 316 GeV&#39;, &#39;316 GeV - 398 GeV&#39;, &#39;398 GeV - 501 GeV&#39;, &#39;501 GeV - 631 GeV&#39;, &#39;631 GeV - 794 GeV&#39;, &#39;794 GeV - 1 TeV&#39;, &#39;1 TeV - 1.26 TeV&#39;, &#39;1.26 TeV - 1.58 TeV&#39;, &#39;1.58 TeV - 2.00 TeV&#39;, &#39;2.00 TeV - 2.51 TeV&#39;), style=SliderStyle(description_width=&#39;initial&#39;), value=&#39;3.98 GeV - 5.01 GeV&#39;), RadioButtons(description=&#39;Select stretch:&#39;, index=1, options=(&#39;linear&#39;, &#39;sqrt&#39;, &#39;log&#39;), style=DescriptionStyle(description_width=&#39;initial&#39;), value=&#39;sqrt&#39;), Output()), _dom_classes=(&#39;widget-interact&#39;,))
</pre></div>
</div>
<p>Now we have less models to describe the sources</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_sources</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_inside_roi</span></a> <span class="o">+</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_outside_roi</span></a>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of source models&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_sources</span></a><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of source models 28
</pre></div>
</div>
</section>
</section>
<section id="fit">
<h2>Fit<a class="headerlink" href="#fit" title="Link to this heading">#</a></h2>
<p>Now, the big finale: let’s do a 3D of the brightest sources and IEM
models.</p>
<p>First we attach the models to the datasets.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_sources</span></a> <span class="o">+</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models_diffuse</span></a>

<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.models" title="gammapy.datasets.Datasets.models" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-attribute"><span class="n">datasets</span><span class="o">.</span><span class="n">models</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models</span></a>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of models&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">models</span></a><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of models 31
</pre></div>
</div>
<p>Let’s find the 3 brightest sources:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_brightest</span></a> <span class="o">=</span> <span class="mi">3</span>
<a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">integrated_flux</span></a> <span class="o">=</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class"><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span></a><span class="p">(</span>
    <span class="p">[</span><span class="n">m</span><span class="o">.</span><a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectral_model</span></a><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">GeV</span></a><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">TeV</span></a><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_inside_roi</span></a><span class="p">]</span>
<span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">order</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.argsort.html#numpy.argsort" title="numpy.argsort" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">argsort</span></a><span class="p">(</span><a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">integrated_flux</span></a><span class="p">)</span>
<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">selected_sources</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">Models</span></a><span class="p">([</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sources_inside_roi</span></a><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">order</span></a><span class="p">[:</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_brightest</span></a><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.names" title="gammapy.modeling.models.Models.names" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">selected_sources</span><span class="o">.</span><span class="n">names</span></a><span class="p">)</span>

<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">free_models</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models" title="gammapy.modeling.models.Models" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">selected_sources</span></a> <span class="o">+</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_iem</span></a>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;4FGL J1739.4-3015&#39;, &#39;4FGL J1751.6-3002&#39;, &#39;4FGL J1754.3-2915&#39;]
</pre></div>
</div>
<p>We keep only their normalisation free for simplicity:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.freeze" title="gammapy.modeling.models.Models.freeze" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">models</span><span class="o">.</span><span class="n">freeze</span></a><span class="p">()</span>  <span class="c1"># freeze all parameters</span>

<span class="c1"># and unfreeze only the amplitude or norm of the selected models</span>
<span class="k">for</span> <a href="../../api/gammapy.modeling.Parameter.html#gammapy.modeling.Parameter" title="gammapy.modeling.Parameter" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p</span></a> <span class="ow">in</span> <a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.parameters" title="gammapy.modeling.models.Models.parameters" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">free_models</span><span class="o">.</span><span class="n">parameters</span></a><span class="p">:</span>
    <span class="k">if</span> <a href="../../api/gammapy.modeling.Parameter.html#gammapy.modeling.Parameter.name" title="gammapy.modeling.Parameter.name" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-attribute"><span class="n">p</span><span class="o">.</span><span class="n">name</span></a> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="s2">&quot;norm&quot;</span><span class="p">]:</span>
        <a href="../../api/gammapy.modeling.Parameter.html#gammapy.modeling.Parameter.frozen" title="gammapy.modeling.Parameter.frozen" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-attribute"><span class="n">p</span><span class="o">.</span><span class="n">frozen</span></a> <span class="o">=</span> <span class="kc">False</span>
        <a href="../../api/gammapy.modeling.Parameter.html#gammapy.modeling.Parameter.min" title="gammapy.modeling.Parameter.min" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-attribute"><span class="n">p</span><span class="o">.</span><span class="n">min</span></a> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of free parameters&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.parameters" title="gammapy.modeling.models.Models.parameters" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-attribute"><span class="n">models</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">free_parameters</span></a><span class="p">))</span>

<a href="../../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit" title="gammapy.modeling.Fit" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fit</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit" title="gammapy.modeling.Fit" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class"><span class="n">Fit</span></a><span class="p">()</span>
<a href="../../api/gammapy.modeling.FitResult.html#gammapy.modeling.FitResult" title="gammapy.modeling.FitResult" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">result</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.Fit.html#gammapy.modeling.Fit.run" title="gammapy.modeling.Fit.run" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-method"><span class="n">fit</span><span class="o">.</span><span class="n">run</span></a><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="o">=</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><a href="../../api/gammapy.modeling.FitResult.html#gammapy.modeling.FitResult" title="gammapy.modeling.FitResult" class="sphx-glr-backref-module-gammapy-modeling sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">result</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of free parameters 4
OptimizeResult

        backend    : minuit
        method     : migrad
        success    : True
        message    : Optimization terminated successfully.
        nfev       : 97
        total stat : 20322.54

CovarianceResult

        backend    : minuit
        method     : hesse
        success    : True
        message    : Hesse terminated successfully.
</pre></div>
</div>
</section>
<section id="residual-ts-map">
<h2>Residual TS map<a class="headerlink" href="#residual-ts-map" title="Link to this heading">#</a></h2>
<p>Now we can look at the residual TS map to check there is no significant
excess left:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spatial_model</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PointSpatialModel</span></a><span class="p">()</span>
<a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectral_model</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">PowerLawSpectralModel</span></a><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class"><span class="n">SkyModel</span></a><span class="p">(</span><a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spatial_model</span></a><span class="o">=</span><a href="../../api/gammapy.modeling.models.PointSpatialModel.html#gammapy.modeling.models.PointSpatialModel" title="gammapy.modeling.models.PointSpatialModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spatial_model</span></a><span class="p">,</span> <a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectral_model</span></a><span class="o">=</span><a href="../../api/gammapy.modeling.models.PowerLawSpectralModel.html#gammapy.modeling.models.PowerLawSpectralModel" title="gammapy.modeling.models.PowerLawSpectralModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">spectral_model</span></a><span class="p">)</span>

<a href="../../api/gammapy.estimators.TSMapEstimator.html#gammapy.estimators.TSMapEstimator" title="gammapy.estimators.TSMapEstimator" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts_estimator</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.TSMapEstimator.html#gammapy.estimators.TSMapEstimator" title="gammapy.estimators.TSMapEstimator" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class"><span class="n">TSMapEstimator</span></a><span class="p">(</span>
    <a href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span>
    <span class="n">kernel_width</span><span class="o">=</span><span class="s2">&quot;1 deg&quot;</span><span class="p">,</span>  <span class="c1"># this set close to the 95-99% containment radius of the PSF</span>
    <span class="n">selection_optional</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">sum_over_energy_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">energy_edges</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.PrefixUnit.html#astropy.units.PrefixUnit" title="astropy.units.PrefixUnit" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">u</span><span class="o">.</span><span class="n">GeV</span></a><span class="p">,</span>
<span class="p">)</span>


<a href="../../api/gammapy.estimators.FluxMaps.html#gammapy.estimators.FluxMaps" title="gammapy.estimators.FluxMaps" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts_results</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.TSMapEstimator.html#gammapy.estimators.TSMapEstimator.run" title="gammapy.estimators.TSMapEstimator.run" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-method"><span class="n">ts_estimator</span><span class="o">.</span><span class="n">run</span></a><span class="p">(</span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets</span></a><span class="p">)</span>


<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">image</span></a> <span class="o">=</span> <a href="../../api/gammapy.estimators.FluxMaps.html#gammapy.estimators.FluxMaps" title="gammapy.estimators.FluxMaps" class="sphx-glr-backref-module-gammapy-estimators sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts_results</span></a><span class="p">[</span><span class="s2">&quot;sqrt_ts&quot;</span><span class="p">]</span>
<a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap" title="gammapy.maps.WcsNDMap" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">image</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.cutout" title="gammapy.maps.WcsNDMap.cutout" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">image</span><span class="o">.</span><span class="n">cutout</span></a><span class="p">(</span>
    <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.geom" title="gammapy.maps.WcsNDMap.geom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-attribute"><span class="n">image</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">center_skydir</span></a><span class="p">,</span> <span class="n">width</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.geom" title="gammapy.maps.WcsNDMap.geom" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-attribute"><span class="n">image</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">width</span></a><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <a href="https://docs.astropy.org/en/stable/api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity" class="sphx-glr-backref-module-astropy-units sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">margin</span></a>
<span class="p">)</span>

<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a href="https://docs.astropy.org/en/stable/api/astropy.visualization.wcsaxes.WCSAxes.html#astropy.visualization.wcsaxes.WCSAxes" title="astropy.visualization.wcsaxes.WCSAxes" class="sphx-glr-backref-module-astropy-visualization-wcsaxes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="../../api/gammapy.maps.WcsNDMap.html#gammapy.maps.WcsNDMap.plot" title="gammapy.maps.WcsNDMap.plot" class="sphx-glr-backref-module-gammapy-maps sphx-glr-backref-type-py-method"><span class="n">image</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span>
    <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.LinearSegmentedColormap.html#matplotlib.colors.LinearSegmentedColormap" title="matplotlib.colors.LinearSegmentedColormap" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span></a><span class="p">,</span>
    <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">kwargs_colorbar</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\sqrt</span><span class="si">{TS}</span><span class="s2">$ [$\sigma$]&quot;</span><span class="p">},</span>
<span class="p">)</span>
<a href="../../api/gammapy.modeling.models.Models.html#gammapy.modeling.models.Models.plot_regions" title="gammapy.modeling.models.Models.plot_regions" class="sphx-glr-backref-module-gammapy-modeling-models sphx-glr-backref-type-py-method"><span class="n">sources_inside_roi</span><span class="o">.</span><span class="n">plot_regions</span></a><span class="p">(</span>
    <a href="https://docs.astropy.org/en/stable/api/astropy.visualization.wcsaxes.WCSAxes.html#astropy.visualization.wcsaxes.WCSAxes" title="astropy.visualization.wcsaxes.WCSAxes" class="sphx-glr-backref-module-astropy-visualization-wcsaxes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="o">=</span><a href="https://docs.astropy.org/en/stable/api/astropy.visualization.wcsaxes.WCSAxes.html#astropy.visualization.wcsaxes.WCSAxes" title="astropy.visualization.wcsaxes.WCSAxes" class="sphx-glr-backref-module-astropy-visualization-wcsaxes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">kwargs_point</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_fermi_lat_006.png" srcset="../../_images/sphx_glr_fermi_lat_006.png" alt="fermi lat" class = "sphx-glr-single-img"/></section>
<section id="serialisation">
<h2>Serialisation<a class="headerlink" href="#serialisation" title="Link to this heading">#</a></h2>
<p>To serialise the created dataset, you must proceed through the Datasets
API</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.write" title="gammapy.datasets.Datasets.write" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">datasets</span><span class="o">.</span><span class="n">write</span></a><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_datasets.yaml&quot;</span><span class="p">,</span>
    <span class="n">filename_models</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_models.yaml&quot;</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets" title="gammapy.datasets.Datasets" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">datasets_read</span></a> <span class="o">=</span> <a href="../../api/gammapy.datasets.Datasets.html#gammapy.datasets.Datasets.read" title="gammapy.datasets.Datasets.read" class="sphx-glr-backref-module-gammapy-datasets sphx-glr-backref-type-py-method"><span class="n">Datasets</span><span class="o">.</span><span class="n">read</span></a><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_datasets.yaml&quot;</span><span class="p">,</span> <span class="n">filename_models</span><span class="o">=</span><span class="s2">&quot;fermi_lat_gc_models.yaml&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Fit the position and spectrum of the source <a class="reference external" href="http://gamma-sky.net/#/cat/tev/110">SNR
G0.9+0.1</a>.</p></li>
<li><p>Make maps and fit the position and spectrum of the <a class="reference external" href="http://gamma-sky.net/#/cat/tev/25">Crab
nebula</a>.</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this tutorial you have seen how to work with Fermi-LAT data with
Gammapy. You have to use Fermipy or the Fermi ST to perform the data
reduction then you can use Gammapy for analysis using the same methods
that are used to analyse IACT data.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 23.541 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-data-fermi-lat-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/main?urlpath=lab/tree/notebooks/dev/tutorials/data/fermi_lat.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo5.svg" style="width: 150px;" />
</a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9a86f782b420f47c383e0ccef22286f8/fermi_lat.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">fermi_lat.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/486b9bbab34388e381bccada3a10c772/fermi_lat.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">fermi_lat.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/f859fe731238e2fbe18ae0bd172f1eb8/fermi_lat.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">fermi_lat.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-setup">Check setup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fermipy-configuration-file">Fermipy configuration file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-fermipy-maps-to-gammapy-datasets">From Fermipy maps to Gammapy datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fermi-lat-irf-properties">Fermi-LAT IRF properties</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposure">Exposure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#psf">PSF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#region-of-interest-and-mask-definition">Region of interest and mask definition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models">Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isotropic-diffuse-background">Isotropic diffuse background</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#galactic-diffuse-background">Galactic diffuse background</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sources">Sources</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit">Fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#residual-ts-map">Residual TS map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serialisation">Serialisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/data/fermi_lat.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
    
    <p>Licensed under
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a>.</p>
    <p>Examples, recipes, and other code licensed under
      <a href="https://opensource.org/license/BSD-3-Clause>" target="_blank">BSD 3-Clause "New" or "Revised"</a> license.</p>
    <p>Gammapy <a href="https://gammapy.org/DataPrivacy.html">Data Privacy</a> information.</p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>