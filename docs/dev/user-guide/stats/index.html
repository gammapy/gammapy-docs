
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Statistical utility functions &#8212; gammapy vX.Y.Z</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fit statistics" href="fit_statistics.html" />
    <link rel="prev" title="Dark matter" href="../astro/darkmatter/index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api-reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Developer guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../release-notes/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables user-guide/stats/index and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "user-guide/stats/index.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "user-guide/stats/index.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.2.dev982+g4fa3a15a8 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../package.html">
   Gammapy analysis workflow and package structure
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../dl3.html">
     Data access and selection (DL3)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../irf/index.html">
     Instrument Response Functions (DL3)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../makers/index.html">
     Data reduction (DL3 to DL4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../maps/index.html">
     Sky maps (DL4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../datasets/index.html">
     Datasets (DL4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modeling.html">
     Modeling and Fitting (DL4 to DL5)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../estimators.html">
     Estimators (DL4 to DL5, and DL6)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hli.html">
     High Level Analysis Interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scripts/index.html">
     Command line tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../catalog.html">
     Source catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../astro/index.html">
     Astrophysics
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Statistical utility functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualization/index.html">
     Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils.html">
     Utility functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../howto.html">
   How To
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../model-gallery/index.html">
   Model gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_constant.html">
     Constant spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_disk.html">
     Disk spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_gauss.html">
     Gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_gen_gauss.html">
     Generalized gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_piecewise_norm_spatial.html">
     Piecewise norm spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_point.html">
     Point spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_shell.html">
     Shell spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_shell2.html">
     Shell2 spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spatial/plot_template.html">
     Template spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_absorbed.html">
     EBL absorption spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_broken_powerlaw.html">
     Broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_compound.html">
     Compound spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_constant_spectral.html">
     Constant spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_exp_cutoff_powerlaw.html">
     Exponential cutoff power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_exp_cutoff_powerlaw_3fgl.html">
     Exponential cutoff power law spectral model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_exp_cutoff_powerlaw_norm_spectral.html">
     Exponential cutoff power law norm spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_gauss_spectral.html">
     Gaussian spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_logparabola.html">
     Log parabola spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_logparabola_norm_spectral.html">
     Log parabola spectral norm model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_naima.html">
     Naima spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_piecewise_norm_spectral.html">
     Piecewise  norm spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_powerlaw.html">
     Power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_powerlaw2.html">
     Power law 2 spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_powerlaw_norm_spectral.html">
     Power law norm spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_smooth_broken_powerlaw.html">
     Smooth broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_super_exp_cutoff_powerlaw_3fgl.html">
     Super exponential cutoff power law model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl_dr1.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR1 (and DR2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/spectral/plot_template_spectral.html">
     Template spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_constant_temporal.html">
     Constant temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_expdecay_temporal.html">
     ExpDecay temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_gaussian_temporal.html">
     Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_generalized_gaussian_temporal.html">
     Generalized Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_linear_temporal.html">
     Linear temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_powerlaw_temporal.html">
     PowerLaw temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_sine_temporal.html">
     Sine temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_template_phase_temporal.html">
     Phase curve temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model-gallery/temporal/plot_template_temporal.html">
     Light curve temporal model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://gammapy.github.io/gammapy-recipes">
   Gammapy recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   Glossary and references
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Statistical utility functions
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notations">
     Notations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#counts-and-fit-statistics">
     Counts and fit statistics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-ts">
     Estimating TS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#counts-statistics-classes">
   Counts statistics classes
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cash-counts-statistic">
     Cash counts statistic
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#excess-and-significance">
       Excess and Significance
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#excess-errors">
       Excess errors
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wstat-counts-statistic">
     WStat counts statistic
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Excess and Significance
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Excess errors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="statistical-utility-functions">
<span id="stats"></span><h1>Statistical utility functions<a class="headerlink" href="#statistical-utility-functions" title="Permalink to this headline">#</a></h1>
<p><a class="reference internal" href="../../api-reference/stats.html#module-gammapy.stats" title="gammapy.stats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.stats</span></code></a> holds statistical estimators, fit statistics and algorithms
commonly used in gamma-ray astronomy.</p>
<p>It is mostly concerned with the evaluation of one or several observations that
count events in a given region and time window, i.e. with Poisson-distributed
counts measurements.</p>
<section id="notations">
<span id="stats-notation"></span><h2>Notations<a class="headerlink" href="#notations" title="Permalink to this headline">#</a></h2>
<p>For statistical analysis we use the following variable names following mostly the
notation in <a class="reference internal" href="../references.html#lima1983" id="id1"><span>[LiMa1983]</span></a>. For the <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> attributes we chose more verbose
equivalents:</p>
<table class="table">
<colgroup>
<col style="width: 15%" />
<col style="width: 20%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Dataset attribute name</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">n_on</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">counts</span></code></p></td>
<td><p>Observed counts</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">n_off</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">counts_off</span></code></p></td>
<td><p>Observed counts in the off region</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">n_bkg</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">background</span></code></p></td>
<td><p>Estimated background counts, defined as <code class="docutils literal notranslate"><span class="pre">alpha</span> <span class="pre">*</span> <span class="pre">n_off</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">n_sig</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">excess</span></code></p></td>
<td><p>Estimated signal counts defined as <code class="docutils literal notranslate"><span class="pre">n_on</span></code> - <code class="docutils literal notranslate"><span class="pre">n_bkg</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mu_on</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">npred</span></code></p></td>
<td><p>Predicted counts</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mu_off</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">npred_off</span></code></p></td>
<td><p>Predicted counts in the off region</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mu_bkg</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">npred_background</span></code></p></td>
<td><p>Predicted background counts in the on region</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mu_sig</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">npred_signal</span></code></p></td>
<td><p>Predicted signal counts</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a_on</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">acceptance</span></code></p></td>
<td><p>Relative background exposure</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a_off</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">acceptance_off</span></code></p></td>
<td><p>Relative background exposure in the off region</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p>Background efficiency ratio <code class="docutils literal notranslate"><span class="pre">a_on</span></code> / <code class="docutils literal notranslate"><span class="pre">a_off</span></code></p></td>
</tr>
</tbody>
</table>
<p>The on measurement, assumed to contain signal and background counts, <span class="math notranslate nohighlight">\(n_{on}\)</span> follows
a Poisson random variable with expected value
<span class="math notranslate nohighlight">\(\mu_{on} = \mu_{sig} + \mu_{bkg}\)</span>.</p>
<p>The off measurement is assumed to contain only background counts, with an acceptance to background
<span class="math notranslate nohighlight">\(a_{off}\)</span>. This off measurement can be used to estimate the number of background counts in the
on region: <span class="math notranslate nohighlight">\(n_{bkg} = \alpha\ n_{off}\)</span> with <span class="math notranslate nohighlight">\(\alpha = a_{on}/a_{off}\)</span> the ratio of
on and off acceptances.</p>
<p>Therefore, <span class="math notranslate nohighlight">\(n_{off}\)</span> follows a Poisson distribution with expected
value <span class="math notranslate nohighlight">\(\mu_{off} = \mu_{bkg} / \alpha\)</span>.</p>
<p>The expectation or predicted values <span class="math notranslate nohighlight">\(\mu_X\)</span> are in general derived using maximum
likelihood estimation.</p>
</section>
<section id="counts-and-fit-statistics">
<h2>Counts and fit statistics<a class="headerlink" href="#counts-and-fit-statistics" title="Permalink to this headline">#</a></h2>
<p>Gamma-ray measurements are counts, <span class="math notranslate nohighlight">\(n_{on}\)</span>, containing both signal and background events.</p>
<p>Estimation of number of signal events or of quantities in physical models is done through
Poisson likelihood functions, the fit statistics. In gammapy, they are all log-likelihood
functions normalized like chi-squares, i.e. if <span class="math notranslate nohighlight">\(L\)</span> is the likelihood function used,
they follow the expression <span class="math notranslate nohighlight">\(2 \times log L\)</span>.</p>
<p>When the expected number of background events, <span class="math notranslate nohighlight">\(\mu_{bkg}\)</span> is known, the statistic function
is <code class="docutils literal notranslate"><span class="pre">Cash</span></code> (see <a class="reference internal" href="fit_statistics.html#cash"><span class="std std-ref">Cash : Poisson data with background model</span></a>). When the number of background events is unknown, one has to
use a background estimate <span class="math notranslate nohighlight">\(n_{bkg}\)</span> taken from an off measurement where only background events
are expected. In this case, the statistic function is <code class="docutils literal notranslate"><span class="pre">WStat</span></code> (see <a class="reference internal" href="fit_statistics.html#wstat"><span class="std std-ref">WStat : Poisson data with background measurement</span></a>).</p>
<p>These statistic functions are at the heart of the model fitting approach in gammapy. They are
used to estimate the best fit values of model parameters and their associated confidence intervals.</p>
<p>They are used also to estimate the excess counts significance, i.e. the probability that
a given number of measured events <span class="math notranslate nohighlight">\(n_{on}\)</span> actually contains some signal events <span class="math notranslate nohighlight">\(n_{sig}\)</span>,
as well as the errors associated to this estimated number of signal counts.</p>
</section>
<section id="estimating-ts">
<span id="ts"></span><h2>Estimating TS<a class="headerlink" href="#estimating-ts" title="Permalink to this headline">#</a></h2>
<p>A classical approach to modeling and fitting relies on hypothesis testing. One wants to estimate whether
an hypothesis <span class="math notranslate nohighlight">\(H_1\)</span> is statistically preferred over the reference, or null-hypothesis, <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
<p>The maximum log-likelihood ratio test provides a way to estimate the p-value of the data following <span class="math notranslate nohighlight">\(H_1\)</span>
rather than <span class="math notranslate nohighlight">\(H_0\)</span>, when the two hypotheses are nested.
We note this ratio <span class="math notranslate nohighlight">\(\lambda = \frac{max L(X|{H_1})}{max L(X|H_0)}\)</span></p>
<p>The Wilks theorem shows that under some hypothesis, <span class="math notranslate nohighlight">\(2 \log \lambda\)</span> asymptotically follows a <span class="math notranslate nohighlight">\(\chi^2\)</span>
distribution with <span class="math notranslate nohighlight">\(n_{dof}\)</span> degrees of freedom, where <span class="math notranslate nohighlight">\(n_{dof}\)</span> is the difference of free parameters
between <span class="math notranslate nohighlight">\(H_1\)</span> and <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
<p>With the definition the fit statistics <span class="math notranslate nohighlight">\(-2 \log \lambda\)</span> is simply the difference of the fit statistic values for
the two hypotheses, the delta TS (short for test statistic). Hence, <span class="math notranslate nohighlight">\(\Delta TS\)</span> follows <span class="math notranslate nohighlight">\(\chi^2\)</span>
distribution with <span class="math notranslate nohighlight">\(n_{dof}\)</span> degrees of freedom. This can be used to convert <span class="math notranslate nohighlight">\(\Delta TS\)</span> into a “classical
significance” using the following recipe:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">sigma_to_ts</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert sigma to delta ts&quot;&quot;&quot;</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chi2</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">p_value</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ts_to_sigma</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert delta ts to sigma&quot;&quot;&quot;</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">p_value</span><span class="p">)</span>
</pre></div>
</div>
<p>In particular, with only one degree of freedom (e.g. flux amplitude), one
can estimate the statistical significance in terms of number of <span class="math notranslate nohighlight">\(\sigma\)</span>
as <span class="math notranslate nohighlight">\(\sqrt{\Delta TS}\)</span>.</p>
<p>In case the excess is negative, which can happen if the background is overestimated
the following convention is used:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\sqrt{\Delta TS} = \left \{
\begin{array}{ll}
  -\sqrt{\Delta TS} &amp; : \text{if} \text{Excess} &lt; 0 \\
  \sqrt{\Delta TS} &amp; : \text{else}
\end{array}
\right.\end{split}\]</div>
</section>
</section>
<section id="counts-statistics-classes">
<h1>Counts statistics classes<a class="headerlink" href="#counts-statistics-classes" title="Permalink to this headline">#</a></h1>
<p>To estimate the excess counts significance and errors, gammapy uses two classes for Poisson counts with
and without known background: <a class="reference internal" href="../../api/gammapy.stats.CashCountsStatistic.html#gammapy.stats.CashCountsStatistic" title="gammapy.stats.CashCountsStatistic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CashCountsStatistic</span></code></a> and <a class="reference internal" href="../../api/gammapy.stats.WStatCountsStatistic.html#gammapy.stats.WStatCountsStatistic" title="gammapy.stats.WStatCountsStatistic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WStatCountsStatistic</span></code></a></p>
<p>We show below how to use them.</p>
<section id="cash-counts-statistic">
<h2>Cash counts statistic<a class="headerlink" href="#cash-counts-statistic" title="Permalink to this headline">#</a></h2>
<section id="excess-and-significance">
<h3>Excess and Significance<a class="headerlink" href="#excess-and-significance" title="Permalink to this headline">#</a></h3>
<p>Assume one measured <span class="math notranslate nohighlight">\(n_{on} = 13\)</span> counts in a region where one suspects a source might be present.
if the expected number of background events is known (here e.g. <span class="math notranslate nohighlight">\(\mu_{bkg}=5.5\)</span>), one can use
the Cash statistic to estimate the signal or excess number, its statistical significance
as well as the confidence interval on the true signal counts number value.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.stats</span> <span class="kn">import</span> <span class="n">CashCountsStatistic</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">CashCountsStatistic</span><span class="p">(</span><span class="n">n_on</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">mu_bkg</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excess  : </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">n_sig</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error   : </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">error</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TS      : </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">ts</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sqrt(TS): </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">sqrt_ts</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-value : </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Excess  : 7.50
Error   : 3.61
TS      : 7.37
sqrt(TS): 2.71
p-value : 0.0033
</pre></div>
</div>
<p>The error is the symmetric error obtained from the covariance of the statistic function, here <span class="math notranslate nohighlight">\(\sqrt{n_{on}}\)</span>.
The <code class="xref py py-obj docutils literal notranslate"><span class="pre">sqrt_ts</span></code> is the square root of the <span class="math notranslate nohighlight">\(TS\)</span>, multiplied by the sign of the excess,
which is equivalent to the Li &amp; Ma significance for known background. The p-value is now computed taking into
account only positive fluctuations.</p>
<p>To see how the <span class="math notranslate nohighlight">\(TS\)</span>, relates to the statistic function, we plot below the profile of the Cash
statistic as a function of the expected signal events number.</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/24133ee10316499b2406825cd4240d92/plot_cash_significance.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/d364bcf8e56c1e212ff5bb2e97b24598/plot_cash_significance.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/bfe6aa14bdebe4f65370b05f400755e5/plot_cash_significance.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../_images/plot_cash_significance.png" class="plot-directive" src="../../_images/plot_cash_significance.png" />
</figure>
</section>
<section id="excess-errors">
<h3>Excess errors<a class="headerlink" href="#excess-errors" title="Permalink to this headline">#</a></h3>
<p>You can also compute the confidence interval for the true excess based on the statistic value:
If you are interested in 68% (1 <span class="math notranslate nohighlight">\(\sigma\)</span>) and 95% (2 <span class="math notranslate nohighlight">\(\sigma\)</span>) confidence ranges:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.stats</span> <span class="kn">import</span> <span class="n">CashCountsStatistic</span>
<span class="n">count_statistic</span> <span class="o">=</span> <span class="n">CashCountsStatistic</span><span class="p">(</span><span class="n">n_on</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">mu_bkg</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
<span class="n">excess</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">n_sig</span>
<span class="n">errn</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errn</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">errp</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errp</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;68% confidence range: </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errn</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &lt; mu &lt; </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errp</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>68% confidence range: 4.220 &lt; mu &lt; 11.446
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">errn_2sigma</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errn</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">errp_2sigma</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errp</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% confidence range: </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errn_2sigma</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &lt; mu &lt; </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errp_2sigma</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>95% confidence range: 1.556 &lt; mu &lt; 16.102
</pre></div>
</div>
<p>The 68% confidence interval (1 <span class="math notranslate nohighlight">\(\sigma\)</span>) is obtained by finding the expected signal values for which the TS
variation is 1. The 95% confidence interval (2 <span class="math notranslate nohighlight">\(\sigma\)</span>) is obtained by finding the expected signal values
for which the TS variation is <span class="math notranslate nohighlight">\(2^2 = 4\)</span>.</p>
<p>On the following plot, we show how the 1 <span class="math notranslate nohighlight">\(\sigma\)</span> and 2 <span class="math notranslate nohighlight">\(\sigma\)</span> confidence errors
relate to the Cash statistic profile.</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/b400c5542f2efa76383fd38fb6cd87f8/plot_cash_errors.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/1cd8ee6f799261baf2c5585bf04677f2/plot_cash_errors.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/c8dacdfbdf94c97cce7a5ee9555295b5/plot_cash_errors.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../_images/plot_cash_errors.png" class="plot-directive" src="../../_images/plot_cash_errors.png" />
</figure>
</section>
</section>
<section id="wstat-counts-statistic">
<h2>WStat counts statistic<a class="headerlink" href="#wstat-counts-statistic" title="Permalink to this headline">#</a></h2>
<section id="id2">
<h3>Excess and Significance<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p>To measure the significance of an excess, one can directly use the TS of the measurement with and
without the excess. Taking the square root of the result yields the so-called Li &amp; Ma significance
<a class="reference internal" href="../references.html#lima1983" id="id3"><span>[LiMa1983]</span></a> (see equation 17).</p>
<p>As an example, assume you measured <span class="math notranslate nohighlight">\(n_{on} = 13\)</span> counts in a region where
you suspect a source might be present and <span class="math notranslate nohighlight">\(n_{off} = 11\)</span> counts in a
background control region where you assume no source is present and that is
<span class="math notranslate nohighlight">\(a_{off}/a_{on}=2\)</span> times larger than the on-region.</p>
<p>Here’s how you compute the statistical significance of your detection:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.stats</span> <span class="kn">import</span> <span class="n">WStatCountsStatistic</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">WStatCountsStatistic</span><span class="p">(</span><span class="n">n_on</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">n_off</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excess  : </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">n_sig</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sqrt(TS): </span><span class="si">{</span><span class="n">stat</span><span class="o">.</span><span class="n">sqrt_ts</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Excess  : 7.50
sqrt(TS): 2.09
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../_downloads/a8931eed2343dc7e3fad48b91496267a/plot_wstat_significance.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/7fb9d8d4dd03683280d89de685238eb8/plot_wstat_significance.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/a647e703f1c14b3b2be137109a402268/plot_wstat_significance.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../_images/plot_wstat_significance.png" class="plot-directive" src="../../_images/plot_wstat_significance.png" />
</figure>
</section>
<section id="id4">
<h3>Excess errors<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>You can also compute the confidence interval for the true excess based on the statistic value:</p>
<p>If you are interested in 68% (1 <span class="math notranslate nohighlight">\(\sigma\)</span>) and 95% (1 <span class="math notranslate nohighlight">\(\sigma\)</span>) confidence errors:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.stats</span> <span class="kn">import</span> <span class="n">WStatCountsStatistic</span>
<span class="n">count_statistic</span> <span class="o">=</span> <span class="n">WStatCountsStatistic</span><span class="p">(</span><span class="n">n_on</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">n_off</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">excess</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">n_sig</span>
<span class="n">errn</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errn</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">errp</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errp</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;68% confidence range: </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errn</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &lt; mu &lt; </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errp</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>68% confidence range: 3.750 &lt; mu &lt; 11.736
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">errn_2sigma</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errn</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">errp_2sigma</span> <span class="o">=</span> <span class="n">count_statistic</span><span class="o">.</span><span class="n">compute_errp</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% confidence range: </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errn_2sigma</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &lt; mu &lt; </span><span class="si">{</span><span class="n">excess</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errp_2sigma</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>95% confidence range: 0.311 &lt; mu &lt; 16.580
</pre></div>
</div>
<p>As above, the 68% confidence interval (1 <span class="math notranslate nohighlight">\(\sigma\)</span>) is obtained by finding the expected signal values for which the TS
variation is 1. The 95% confidence interval (2 <span class="math notranslate nohighlight">\(\sigma\)</span>) is obtained by finding the expected signal values
for which the TS variation is <span class="math notranslate nohighlight">\(2^2 = 4\)</span>.</p>
<p>On the following plot, we show how the 1 <span class="math notranslate nohighlight">\(\sigma\)</span> and 2 <span class="math notranslate nohighlight">\(\sigma\)</span> confidence errors
relate to the WStat statistic profile.</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/b7a81aa34ea094cabea32333eea031cc/plot_wstat_errors.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/10d9c72a398aa90a5e1efe08460a32fa/plot_wstat_errors.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/e91c6a55acd94e0e8b0019a37008ed49/plot_wstat_errors.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../_images/plot_wstat_errors.png" class="plot-directive" src="../../_images/plot_wstat_errors.png" />
</figure>
<p>These are references describing the available methods: <a class="reference internal" href="../references.html#lima1983" id="id5"><span>[LiMa1983]</span></a>, <a class="reference internal" href="../references.html#cash1979" id="id6"><span>[Cash1979]</span></a>,
<a class="reference internal" href="../references.html#stewart2009" id="id7"><span>[Stewart2009]</span></a>, <a class="reference internal" href="../references.html#rolke2005" id="id8"><span>[Rolke2005]</span></a>, <a class="reference internal" href="../references.html#feldman1998" id="id9"><span>[Feldman1998]</span></a>, <a class="reference internal" href="../references.html#cousins2007" id="id10"><span>[Cousins2007]</span></a>.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>